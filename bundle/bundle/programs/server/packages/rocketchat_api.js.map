{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:api/server/api.js","meteor://ðŸ’»app/packages/rocketchat:api/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/requestParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/getPaginationItems.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/getUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/isUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/parseJsonQuery.js","meteor://ðŸ’»app/packages/rocketchat:api/server/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/info.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/metrics.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/channels.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/rooms.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/subscriptions.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/chat.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/commands.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/groups.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/im.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/integrations.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/misc.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/permissions.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/push.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/stats.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/users.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/spotlight.js"],"names":["_","module","watch","require","default","v","API","Restivus","constructor","properties","logger","Logger","version","authMethods","fieldSeparator","defaultFieldsToExclude","joinCode","$loki","meta","members","usernames","importIds","limitedUserFieldsToExclude","avatarOrigin","emails","phone","statusConnection","createdAt","lastLogin","services","requirePasswordChange","requirePasswordChangeReason","roles","statusDefault","_updatedAt","customFields","_config","defaultOptionsEndpoint","_defaultOptionsEndpoint","request","method","headers","RocketChat","settings","get","response","writeHead","write","done","hasHelperMethods","helperMethods","size","getHelperMethods","addAuthMethod","push","success","result","isObject","statusCode","body","failure","errorType","error","notFound","msg","unauthorized","addRoute","routes","options","endpoints","isArray","forEach","route","Object","keys","action","originalAction","_internalRouteActionHandler","debug","toUpperCase","url","apply","e","stack","v1","message","test","channel","channels","group","groups","developerWarning","name","helperMethod","_initAuth","loginCompatibility","bodyParams","user","username","email","password","code","without","length","auth","includes","hashed","digest","algorithm","totp","login","self","authRequired","post","args","invocation","DDPCommon","MethodInvocation","connection","close","DDP","_CurrentInvocation","withValue","Meteor","call","reason","status","users","findOne","_id","id","userId","update","Accounts","_hashLoginToken","token","$unset","data","authToken","extraData","onLoggedIn","extend","extra","logout","hashedToken","tokenLocation","index","lastIndexOf","tokenPath","substring","tokenFieldName","tokenToRemove","tokenRemovalQuery","$pull","onLoggedOut","console","warn","getUserAuth","_getUserAuth","invalidResults","undefined","payload","JSON","parse","i","arguments","Map","ApiClass","createApi","_createApi","enableCors","useDefaultAuth","prettyJson","process","env","NODE_ENV","key","value","addGroup","section","add","type","public","enableQuery","set","_requestParams","queryParams","_getPaginationItems","hardUpperLimit","defaultCount","offset","parseInt","count","_getUserFromParams","doesntExist","_doesntExist","params","requestParams","trim","models","Users","findOneById","findOneByUsername","Error","_isUserFromParams","_parseJsonQuery","sort","fields","nonSelectableFields","authz","hasPermission","concat","k","split","assign","query","nonQuerableFields","_getLoggedInUser","getLoggedInUser","hasRole","info","Info","promclient","register","metrics","findChannelByIdOrName","checkedArchived","returnUsernames","roomId","roomName","room","Rooms","findOneByName","t","archived","findResult","runAsUser","activeUsersOnly","getUserFromParams","latest","oldest","Date","inclusive","sub","Subscriptions","findOneByRoomIdAndUserId","open","createChannelValidator","createChannel","readOnly","rid","create","validate","execute","getPaginationItems","parseJsonQuery","ourQuery","files","Uploads","find","skip","limit","fetch","total","includeAllPublicChannels","$in","integrations","Integrations","_createdAt","latestDate","oldestDate","unreads","hasPermissionToSeeAllPublicChannels","rooms","pluck","totalCount","processQueryOptionsOnResult","sortFn","a","b","Match","Number","Array","from","utcOffset","messages","Messages","ts","online","findUsersNotOffline","onlineInRoom","indexOf","description","purpose","ro","topic","Busboy","updatedSince","updatedSinceDate","isNaN","remove","urlParams","busboy","wrapAsync","callback","on","fieldname","file","filename","encoding","mimetype","fileDate","fileBuffer","Buffer","bindEnvironment","pipe","fileStore","FileUpload","getStore","details","uploadedFile","insert","bind","check","String","ObjectIncluding","msgId","asUser","Maybe","Boolean","u","now","lastUpdate","messageId","pinnedMessage","messageReturn","processWebhookMessage","searchText","starred","text","emoji","command","cmd","slashCommands","commands","toLowerCase","values","filter","run","Random","findPrivateGroupByIdOrName","roomSub","findOneByRoomNameAndUserId","_room","includeAllPrivateGroups","channelsToSearch","findDirectMessageRoom","getRoomByNameOrIdWithOptionToJoin","currentUserId","nameOrId","subscription","log","msgs","ims","enabled","urls","event","triggerWords","alias","avatar","scriptEnabled","script","targetChannel","integration","history","IntegrationHistory","items","target_url","integrationId","me","pick","verifiedEmail","verified","address","onlineCache","onlineCacheDate","cacheInvalid","icon","types","map","hideIcon","backgroundColor","TAPi18n","__","iconSize","leftSize","rightSize","width","height","replace","appName","delete","affectedRecords","Push","appCollection","$or","hidden","$ne","Settings","findOneNotHiddenById","Any","updateValueNotHiddenById","ServiceConfiguration","Package","configurations","secret","refresh","stats","statistics","Statistics","active","joinDefaultChannels","sendWelcomeEmail","validateCustomFields","newUserId","saveUser","saveCustomFieldsWithoutValidation","getURL","cdn","full","setHeader","isUserFromParams","presence","connectionStatus","avatarUrl","setUserAvatar","imageData","userData","saveCustomFields","currentPassword","newPassword","realname","typedPassword","preferences","language","newRoomNotification","newMessageNotification","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","autoImageLoad","emailNotificationMode","roomsListExhibitionMode","unreadAlert","notificationsSoundVolume","desktopNotifications","mobileNotifications","enableAutoAway","highlights","desktopNotificationDuration","viewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","sendOnEnter","roomCounterSidebar","sidebarShowFavorites","Optional","sidebarShowUnread","sidebarSortby","sidebarViewMode","sidebarHideAvatar","mergeChannels","muteFocusedConversations","currentUserRoles"],"mappings":"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","file":"/packages/rocketchat_api.js","sourcesContent":["/* global Restivus, DDP, DDPCommon */\nimport _ from 'underscore';\n\nclass API extends Restivus {\n\tconstructor(properties) {\n\t\tsuper(properties);\n\t\tthis.logger = new Logger(`API ${ properties.version ? properties.version : 'default' } Logger`, {});\n\t\tthis.authMethods = [];\n\t\tthis.fieldSeparator = '.';\n\t\tthis.defaultFieldsToExclude = {\n\t\t\tjoinCode: 0,\n\t\t\t$loki: 0,\n\t\t\tmeta: 0,\n\t\t\tmembers: 0,\n\t\t\tusernames: 0, // Please use the `channel/dm/group.members` endpoint. This is disabled for performance reasons\n\t\t\timportIds: 0\n\t\t};\n\t\tthis.limitedUserFieldsToExclude = {\n\t\t\tavatarOrigin: 0,\n\t\t\temails: 0,\n\t\t\tphone: 0,\n\t\t\tstatusConnection: 0,\n\t\t\tcreatedAt: 0,\n\t\t\tlastLogin: 0,\n\t\t\tservices: 0,\n\t\t\trequirePasswordChange: 0,\n\t\t\trequirePasswordChangeReason: 0,\n\t\t\troles: 0,\n\t\t\tstatusDefault: 0,\n\t\t\t_updatedAt: 0,\n\t\t\tcustomFields: 0\n\t\t};\n\n\t\tthis._config.defaultOptionsEndpoint = function _defaultOptionsEndpoint() {\n\t\t\tif (this.request.method === 'OPTIONS' && this.request.headers['access-control-request-method']) {\n\t\t\t\tif (RocketChat.settings.get('API_Enable_CORS') === true) {\n\t\t\t\t\tthis.response.writeHead(200, {\n\t\t\t\t\t\t'Access-Control-Allow-Origin': RocketChat.settings.get('API_CORS_Origin'),\n\t\t\t\t\t\t'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept, X-User-Id, X-Auth-Token'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.response.writeHead(405);\n\t\t\t\t\tthis.response.write('CORS not enabled. Go to \"Admin > General > REST Api\" to enable it.');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.response.writeHead(404);\n\t\t\t}\n\n\t\t\tthis.done();\n\t\t};\n\t}\n\n\thasHelperMethods() {\n\t\treturn RocketChat.API.helperMethods.size !== 0;\n\t}\n\n\tgetHelperMethods() {\n\t\treturn RocketChat.API.helperMethods;\n\t}\n\n\taddAuthMethod(method) {\n\t\tthis.authMethods.push(method);\n\t}\n\n\tsuccess(result = {}) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = true;\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 200,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\tfailure(result, errorType) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = false;\n\t\t} else {\n\t\t\tresult = {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: result\n\t\t\t};\n\n\t\t\tif (errorType) {\n\t\t\t\tresult.errorType = errorType;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 400,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\tnotFound(msg) {\n\t\treturn {\n\t\t\tstatusCode: 404,\n\t\t\tbody: {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: msg ? msg : 'Resource not found'\n\t\t\t}\n\t\t};\n\t}\n\n\tunauthorized(msg) {\n\t\treturn {\n\t\t\tstatusCode: 403,\n\t\t\tbody: {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: msg ? msg : 'unauthorized'\n\t\t\t}\n\t\t};\n\t}\n\n\taddRoute(routes, options, endpoints) {\n\t\t//Note: required if the developer didn't provide options\n\t\tif (typeof endpoints === 'undefined') {\n\t\t\tendpoints = options;\n\t\t\toptions = {};\n\t\t}\n\n\t\t//Allow for more than one route using the same option and endpoints\n\t\tif (!_.isArray(routes)) {\n\t\t\troutes = [routes];\n\t\t}\n\n\t\troutes.forEach((route) => {\n\t\t\t//Note: This is required due to Restivus calling `addRoute` in the constructor of itself\n\t\t\tif (this.hasHelperMethods()) {\n\t\t\t\tObject.keys(endpoints).forEach((method) => {\n\t\t\t\t\tif (typeof endpoints[method] === 'function') {\n\t\t\t\t\t\tendpoints[method] = {action: endpoints[method]};\n\t\t\t\t\t}\n\n\t\t\t\t\t//Add a try/catch for each endpoint\n\t\t\t\t\tconst originalAction = endpoints[method].action;\n\t\t\t\t\tendpoints[method].action = function _internalRouteActionHandler() {\n\t\t\t\t\t\tthis.logger.debug(`${ this.request.method.toUpperCase() }: ${ this.request.url }`);\n\t\t\t\t\t\tlet result;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = originalAction.apply(this);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthis.logger.debug(`${ method } ${ route } threw an error:`, e.stack);\n\t\t\t\t\t\t\treturn RocketChat.API.v1.failure(e.message, e.error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult = result ? result : RocketChat.API.v1.success();\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t/(channels|groups)\\./.test(route)\n\t\t\t\t\t\t\t&& result\n\t\t\t\t\t\t\t&& result.body\n\t\t\t\t\t\t\t&& result.body.success === true\n\t\t\t\t\t\t\t&& (result.body.channel || result.body.channels || result.body.group || result.body.groups)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// TODO: Remove this after three versions have been released. That means at 0.64 this should be gone. ;)\n\t\t\t\t\t\t\tresult.body.developerWarning = '[WARNING]: The \"usernames\" field has been removed for performance reasons. Please use the \"*.members\" endpoint to get a list of members/users in a room.';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t};\n\n\t\t\t\t\tfor (const [name, helperMethod] of this.getHelperMethods()) {\n\t\t\t\t\t\tendpoints[method][name] = helperMethod;\n\t\t\t\t\t}\n\n\t\t\t\t\t//Allow the endpoints to make usage of the logger which respects the user's settings\n\t\t\t\t\tendpoints[method].logger = this.logger;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsuper.addRoute(route, options, endpoints);\n\t\t});\n\t}\n\n\t_initAuth() {\n\t\tconst loginCompatibility = (bodyParams) => {\n\t\t\t// Grab the username or email that the user is logging in with\n\t\t\tconst {user, username, email, password, code} = bodyParams;\n\n\t\t\tif (password == null) {\n\t\t\t\treturn bodyParams;\n\t\t\t}\n\n\t\t\tif (_.without(Object.keys(bodyParams), 'user', 'username', 'email', 'password', 'code').length > 0) {\n\t\t\t\treturn bodyParams;\n\t\t\t}\n\n\t\t\tconst auth = {\n\t\t\t\tpassword\n\t\t\t};\n\n\t\t\tif (typeof user === 'string') {\n\t\t\t\tauth.user = user.includes('@') ? {email: user} : {username: user};\n\t\t\t} else if (username) {\n\t\t\t\tauth.user = {username};\n\t\t\t} else if (email) {\n\t\t\t\tauth.user = {email};\n\t\t\t}\n\n\t\t\tif (auth.user == null) {\n\t\t\t\treturn bodyParams;\n\t\t\t}\n\n\t\t\tif (auth.password.hashed) {\n\t\t\t\tauth.password = {\n\t\t\t\t\tdigest: auth.password,\n\t\t\t\t\talgorithm: 'sha-256'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (code) {\n\t\t\t\treturn {\n\t\t\t\t\ttotp: {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tlogin: auth\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn auth;\n\t\t};\n\n\t\tconst self = this;\n\n\t\tthis.addRoute('login', {authRequired: false}, {\n\t\t\tpost() {\n\t\t\t\tconst args = loginCompatibility(this.bodyParams);\n\n\t\t\t\tconst invocation = new DDPCommon.MethodInvocation({\n\t\t\t\t\tconnection: {\n\t\t\t\t\t\tclose() {}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlet auth;\n\t\t\t\ttry {\n\t\t\t\t\tauth = DDP._CurrentInvocation.withValue(invocation, () => Meteor.call('login', args));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlet e = error;\n\t\t\t\t\tif (error.reason === 'User not found') {\n\t\t\t\t\t\te = {\n\t\t\t\t\t\t\terror: 'Unauthorized',\n\t\t\t\t\t\t\treason: 'Unauthorized'\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstatusCode: 401,\n\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\t\terror: e.error,\n\t\t\t\t\t\t\tmessage: e.reason || e.message\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis.user = Meteor.users.findOne({\n\t\t\t\t\t_id: auth.id\n\t\t\t\t});\n\n\t\t\t\tthis.userId = this.user._id;\n\n\t\t\t\t// Remove tokenExpires to keep the old behavior\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: this.user._id,\n\t\t\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(auth.token)\n\t\t\t\t}, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t'services.resume.loginTokens.$.when': 1\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tconst response = {\n\t\t\t\t\tstatus: 'success',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tauthToken: auth.token\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tconst extraData = self._config.onLoggedIn && self._config.onLoggedIn.call(this);\n\n\t\t\t\tif (extraData != null) {\n\t\t\t\t\t_.extend(response.data, {\n\t\t\t\t\t\textra: extraData\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn response;\n\t\t\t}\n\t\t});\n\n\t\tconst logout = function() {\n\t\t\t// Remove the given auth token from the user's account\n\t\t\tconst authToken = this.request.headers['x-auth-token'];\n\t\t\tconst hashedToken = Accounts._hashLoginToken(authToken);\n\t\t\tconst tokenLocation = self._config.auth.token;\n\t\t\tconst index = tokenLocation.lastIndexOf('.');\n\t\t\tconst tokenPath = tokenLocation.substring(0, index);\n\t\t\tconst tokenFieldName = tokenLocation.substring(index + 1);\n\t\t\tconst tokenToRemove = {};\n\t\t\ttokenToRemove[tokenFieldName] = hashedToken;\n\t\t\tconst tokenRemovalQuery = {};\n\t\t\ttokenRemovalQuery[tokenPath] = tokenToRemove;\n\n\t\t\tMeteor.users.update(this.user._id, {\n\t\t\t\t$pull: tokenRemovalQuery\n\t\t\t});\n\n\t\t\tconst response = {\n\t\t\t\tstatus: 'success',\n\t\t\t\tdata: {\n\t\t\t\t\tmessage: 'You\\'ve been logged out!'\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Call the logout hook with the authenticated user attached\n\t\t\tconst extraData = self._config.onLoggedOut && self._config.onLoggedOut.call(this);\n\t\t\tif (extraData != null) {\n\t\t\t\t_.extend(response.data, {\n\t\t\t\t\textra: extraData\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn response;\n\t\t};\n\n\t\t/*\n\t\t\tAdd a logout endpoint to the API\n\t\t\tAfter the user is logged out, the onLoggedOut hook is called (see Restfully.configure() for\n\t\t\tadding hook).\n\t\t*/\n\t\treturn this.addRoute('logout', {\n\t\t\tauthRequired: true\n\t\t}, {\n\t\t\tget() {\n\t\t\t\tconsole.warn('Warning: Default logout via GET will be removed in Restivus v1.0. Use POST instead.');\n\t\t\t\tconsole.warn('    See https://github.com/kahmali/meteor-restivus/issues/100');\n\t\t\t\treturn logout.call(this);\n\t\t\t},\n\t\t\tpost: logout\n\t\t});\n\t}\n}\n\nconst getUserAuth = function _getUserAuth() {\n\tconst invalidResults = [undefined, null, false];\n\treturn {\n\t\ttoken: 'services.resume.loginTokens.hashedToken',\n\t\tuser() {\n\t\t\tif (this.bodyParams && this.bodyParams.payload) {\n\t\t\t\tthis.bodyParams = JSON.parse(this.bodyParams.payload);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < RocketChat.API.v1.authMethods.length; i++) {\n\t\t\t\tconst method = RocketChat.API.v1.authMethods[i];\n\n\t\t\t\tif (typeof method === 'function') {\n\t\t\t\t\tconst result = method.apply(this, arguments);\n\t\t\t\t\tif (!invalidResults.includes(result)) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet token;\n\t\t\tif (this.request.headers['x-auth-token']) {\n\t\t\t\ttoken = Accounts._hashLoginToken(this.request.headers['x-auth-token']);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tuserId: this.request.headers['x-user-id'],\n\t\t\t\ttoken\n\t\t\t};\n\t\t}\n\t};\n};\n\nRocketChat.API = {\n\thelperMethods: new Map(),\n\tgetUserAuth,\n\tApiClass: API\n};\n\nconst createApi = function _createApi(enableCors) {\n\tif (!RocketChat.API.v1 || RocketChat.API.v1._config.enableCors !== enableCors) {\n\t\tRocketChat.API.v1 = new API({\n\t\t\tversion: 'v1',\n\t\t\tuseDefaultAuth: true,\n\t\t\tprettyJson: process.env.NODE_ENV === 'development',\n\t\t\tenableCors,\n\t\t\tauth: getUserAuth()\n\t\t});\n\t}\n\n\tif (!RocketChat.API.default || RocketChat.API.default._config.enableCors !== enableCors) {\n\t\tRocketChat.API.default = new API({\n\t\t\tuseDefaultAuth: true,\n\t\t\tprettyJson: process.env.NODE_ENV === 'development',\n\t\t\tenableCors,\n\t\t\tauth: getUserAuth()\n\t\t});\n\t}\n};\n\n// register the API to be re-created once the CORS-setting changes.\nRocketChat.settings.get('API_Enable_CORS', (key, value) => {\n\tcreateApi(value);\n});\n\n// also create the API immediately\ncreateApi(!!RocketChat.settings.get('API_Enable_CORS'));\n","RocketChat.settings.addGroup('General', function() {\n\tthis.section('REST API', function() {\n\t\tthis.add('API_Upper_Count_Limit', 100, { type: 'int', public: false });\n\t\tthis.add('API_Default_Count', 50, { type: 'int', public: false });\n\t\tthis.add('API_Allow_Infinite_Count', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Direct_Message_History_EndPoint', false, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Shields', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Shield_Types', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_Shields', value: true } });\n\t\tthis.add('API_Enable_CORS', false, { type: 'boolean', public: false });\n\t\tthis.add('API_CORS_Origin', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_CORS', value: true } });\n\t});\n});\n","RocketChat.API.helperMethods.set('requestParams', function _requestParams() {\n\treturn ['POST', 'PUT'].includes(this.request.method) ? this.bodyParams : this.queryParams;\n});\n","// If the count query param is higher than the \"API_Upper_Count_Limit\" setting, then we limit that\n// If the count query param isn't defined, then we set it to the \"API_Default_Count\" setting\n// If the count is zero, then that means unlimited and is only allowed if the setting \"API_Allow_Infinite_Count\" is true\n\nRocketChat.API.helperMethods.set('getPaginationItems', function _getPaginationItems() {\n\tconst hardUpperLimit = RocketChat.settings.get('API_Upper_Count_Limit') <= 0 ? 100 : RocketChat.settings.get('API_Upper_Count_Limit');\n\tconst defaultCount = RocketChat.settings.get('API_Default_Count') <= 0 ? 50 : RocketChat.settings.get('API_Default_Count');\n\tconst offset = this.queryParams.offset ? parseInt(this.queryParams.offset) : 0;\n\tlet count = defaultCount;\n\n\t// Ensure count is an appropiate amount\n\tif (typeof this.queryParams.count !== 'undefined') {\n\t\tcount = parseInt(this.queryParams.count);\n\t} else {\n\t\tcount = defaultCount;\n\t}\n\n\tif (count > hardUpperLimit) {\n\t\tcount = hardUpperLimit;\n\t}\n\n\tif (count === 0 && !RocketChat.settings.get('API_Allow_Infinite_Count')) {\n\t\tcount = defaultCount;\n\t}\n\n\treturn {\n\t\toffset,\n\t\tcount\n\t};\n});\n","//Convenience method, almost need to turn it into a middleware of sorts\nRocketChat.API.helperMethods.set('getUserFromParams', function _getUserFromParams() {\n\tconst doesntExist = { _doesntExist: true };\n\tlet user;\n\tconst params = this.requestParams();\n\n\tif (params.userId && params.userId.trim()) {\n\t\tuser = RocketChat.models.Users.findOneById(params.userId) || doesntExist;\n\t} else if (params.username && params.username.trim()) {\n\t\tuser = RocketChat.models.Users.findOneByUsername(params.username) || doesntExist;\n\t} else if (params.user && params.user.trim()) {\n\t\tuser = RocketChat.models.Users.findOneByUsername(params.user) || doesntExist;\n\t} else {\n\t\tthrow new Meteor.Error('error-user-param-not-provided', 'The required \"userId\" or \"username\" param was not provided');\n\t}\n\n\tif (user._doesntExist) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'The required \"userId\" or \"username\" param provided does not match any users');\n\t}\n\n\treturn user;\n});\n","RocketChat.API.helperMethods.set('isUserFromParams', function _isUserFromParams() {\n\tconst params = this.requestParams();\n\n\treturn (!params.userId && !params.username && !params.user) ||\n\t\t(params.userId && this.userId === params.userId) ||\n\t\t(params.username && this.user.username === params.username) ||\n\t\t(params.user && this.user.username === params.user);\n});\n","RocketChat.API.helperMethods.set('parseJsonQuery', function _parseJsonQuery() {\n\tlet sort;\n\tif (this.queryParams.sort) {\n\t\ttry {\n\t\t\tsort = JSON.parse(this.queryParams.sort);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid sort parameter provided \"${ this.queryParams.sort }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-sort', `Invalid sort parameter provided: \"${ this.queryParams.sort }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\tlet fields;\n\tif (this.queryParams.fields) {\n\t\ttry {\n\t\t\tfields = JSON.parse(this.queryParams.fields);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid fields parameter provided \"${ this.queryParams.fields }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-fields', `Invalid fields parameter provided: \"${ this.queryParams.fields }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\t// Verify the user's selected fields only contains ones which their role allows\n\tif (typeof fields === 'object') {\n\t\tlet nonSelectableFields = Object.keys(RocketChat.API.v1.defaultFieldsToExclude);\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info') && this.request.route.includes('/v1/users.')) {\n\t\t\tnonSelectableFields = nonSelectableFields.concat(Object.keys(RocketChat.API.v1.limitedUserFieldsToExclude));\n\t\t}\n\n\t\tObject.keys(fields).forEach((k) => {\n\t\t\tif (nonSelectableFields.includes(k) || nonSelectableFields.includes(k.split(RocketChat.API.v1.fieldSeparator)[0])) {\n\t\t\t\tdelete fields[k];\n\t\t\t}\n\t\t});\n\t}\n\n\t// Limit the fields by default\n\tfields = Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude);\n\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info') && this.request.route.includes('/v1/users.')) {\n\t\tfields = Object.assign(fields, RocketChat.API.v1.limitedUserFieldsToExclude);\n\t}\n\n\tlet query;\n\tif (this.queryParams.query) {\n\t\ttry {\n\t\t\tquery = JSON.parse(this.queryParams.query);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid query parameter provided \"${ this.queryParams.query }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-query', `Invalid query parameter provided: \"${ this.queryParams.query }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\t// Verify the user has permission to query the fields they are\n\tif (typeof query === 'object') {\n\t\tlet nonQuerableFields = Object.keys(RocketChat.API.v1.defaultFieldsToExclude);\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info') && this.request.route.includes('/v1/users.')) {\n\t\t\tnonQuerableFields = nonQuerableFields.concat(Object.keys(RocketChat.API.v1.limitedUserFieldsToExclude));\n\t\t}\n\n\t\tObject.keys(query).forEach((k) => {\n\t\t\tif (nonQuerableFields.includes(k) || nonQuerableFields.includes(k.split(RocketChat.API.v1.fieldSeparator)[0])) {\n\t\t\t\tdelete query[k];\n\t\t\t}\n\t\t});\n\t}\n\n\treturn {\n\t\tsort,\n\t\tfields,\n\t\tquery\n\t};\n});\n","RocketChat.API.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","RocketChat.API.default.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tversion: RocketChat.Info.version\n\t\t});\n\t}\n});\n","RocketChat.API.default.addRoute('metrics', { authRequired: false }, {\n\tget() {\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'text/plain' },\n\t\t\tbody: RocketChat.promclient.register.metrics()\n\t\t};\n\t}\n});\n","import _ from 'underscore';\n\n//Returns the channel IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findChannelByIdOrName({ params, checkedArchived = true, returnUsernames = false }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tconst fields = { ...RocketChat.API.v1.defaultFieldsToExclude };\n\tif (returnUsernames) {\n\t\tdelete fields.usernames;\n\t}\n\n\tlet room;\n\tif (params.roomId) {\n\t\troom = RocketChat.models.Rooms.findOneById(params.roomId, { fields });\n\t} else if (params.roomName) {\n\t\troom = RocketChat.models.Rooms.findOneByName(params.roomName, { fields });\n\t}\n\n\tif (!room || room.t !== 'c') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any channel');\n\t}\n\n\tif (checkedArchived && room.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The channel, ${ room.name }, is archived`);\n\t}\n\n\treturn room;\n}\n\nRocketChat.API.v1.addRoute('channels.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult._id, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.cleanHistory', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (!this.bodyParams.latest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"latest\" is required.');\n\t\t}\n\n\t\tif (!this.bodyParams.oldest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"oldest\" is required.');\n\t\t}\n\n\t\tconst latest = new Date(this.bodyParams.latest);\n\t\tconst oldest = new Date(this.bodyParams.oldest);\n\n\t\tlet inclusive = false;\n\t\tif (typeof this.bodyParams.inclusive !== 'undefined') {\n\t\t\tinclusive = this.bodyParams.inclusive;\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('cleanChannelHistory', { roomId: findResult._id, latest, oldest, inclusive });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }.`);\n\t\t}\n\n\t\tif (!sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n// Channel -> create\n\nfunction createChannelValidator(params) {\n\tif (!RocketChat.authz.hasPermission(params.user.value, 'create-c')) {\n\t\tthrow new Error('unauthorized');\n\t}\n\n\tif (!params.name || !params.name.value) {\n\t\tthrow new Error(`Param \"${ params.name.key }\" is required`);\n\t}\n\n\tif (params.members && params.members.value && !_.isArray(params.members.value)) {\n\t\tthrow new Error(`Param \"${ params.members.key }\" must be an array if provided`);\n\t}\n\n\tif (params.customFields && params.customFields.value && !(typeof params.customFields.value === 'object')) {\n\t\tthrow new Error(`Param \"${ params.customFields.key }\" must be an object if provided`);\n\t}\n}\n\nfunction createChannel(userId, params) {\n\tlet readOnly = false;\n\tif (typeof params.readOnly !== 'undefined') {\n\t\treadOnly = params.readOnly;\n\t}\n\n\tlet id;\n\tMeteor.runAsUser(userId, () => {\n\t\tid = Meteor.call('createChannel', params.name, params.members ? params.members : [], readOnly, params.customFields);\n\t});\n\n\treturn {\n\t\tchannel: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t};\n}\n\nRocketChat.API.channels = {};\nRocketChat.API.channels.create = {\n\tvalidate: createChannelValidator,\n\texecute: createChannel\n};\n\nRocketChat.API.v1.addRoute('channels.create', { authRequired: true }, {\n\tpost() {\n\t\tconst userId = this.userId;\n\t\tconst bodyParams = this.bodyParams;\n\n\t\tlet error;\n\n\t\ttry {\n\t\t\tRocketChat.API.channels.create.validate({\n\t\t\t\tuser: {\n\t\t\t\t\tvalue: userId\n\t\t\t\t},\n\t\t\t\tname: {\n\t\t\t\t\tvalue: bodyParams.name,\n\t\t\t\t\tkey: 'name'\n\t\t\t\t},\n\t\t\t\tmembers: {\n\t\t\t\t\tvalue: bodyParams.members,\n\t\t\t\t\tkey: 'members'\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tif (e.message === 'unauthorized') {\n\t\t\t\terror = RocketChat.API.v1.unauthorized();\n\t\t\t} else {\n\t\t\t\terror = RocketChat.API.v1.failure(e.message);\n\t\t\t}\n\t\t}\n\n\t\tif (error) {\n\t\t\treturn error;\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(RocketChat.API.channels.create.execute(userId, bodyParams));\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: findResult\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.files', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('canAccessRoom', findResult._id, this.userId);\n\t\t});\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult._id });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles,\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tlet includeAllPublicChannels = true;\n\t\tif (typeof this.queryParams.includeAllPublicChannels !== 'undefined') {\n\t\t\tincludeAllPublicChannels = this.queryParams.includeAllPublicChannels === 'true';\n\t\t}\n\n\t\tlet ourQuery = {\n\t\t\tchannel: `#${ findResult.name }`\n\t\t};\n\n\t\tif (includeAllPublicChannels) {\n\t\t\tourQuery.channel = {\n\t\t\t\t$in: [ourQuery.channel, 'all_public_channels']\n\t\t\t};\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', {\n\t\t\t\trid: findResult._id,\n\t\t\t\tlatest: latestDate,\n\t\t\t\toldest: oldestDate,\n\t\t\t\tinclusive,\n\t\t\t\tcount,\n\t\t\t\tunreads\n\t\t\t});\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.join', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('joinRoom', findResult._id, this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list', { authRequired: true }, {\n\tget: {\n\t\t//This is defined as such only to provide an example of how the routes can be defined :X\n\t\taction() {\n\t\t\tconst { offset, count } = this.getPaginationItems();\n\t\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\t\tconst hasPermissionToSeeAllPublicChannels = RocketChat.authz.hasPermission(this.userId, 'view-c-room');\n\n\t\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-joined-room') && !hasPermissionToSeeAllPublicChannels) {\n\t\t\t\tourQuery.usernames = {\n\t\t\t\t\t$in: [this.user.username]\n\t\t\t\t};\n\t\t\t} else if (!hasPermissionToSeeAllPublicChannels) {\n\t\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t\t}\n\n\t\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\t\tskip: offset,\n\t\t\t\tlimit: count,\n\t\t\t\tfields\n\t\t\t}).fetch();\n\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tchannels: rooms,\n\t\t\t\tcount: rooms.length,\n\t\t\t\toffset,\n\t\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t\t});\n\t\t}\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list.joined', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, {\n\t\t\tt: 'c',\n\t\t\t'u._id': this.userId\n\t\t});\n\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.find(ourQuery).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannels: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.members', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({\n\t\t\tparams: this.requestParams(),\n\t\t\tcheckedArchived: false,\n\t\t\treturnUsernames: true\n\t\t});\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\n\t\tlet sortFn = (a, b) => a > b;\n\t\tif (Match.test(sort, Object) && Match.test(sort.username, Number) && sort.username === -1) {\n\t\t\tsortFn = (a, b) => b < a;\n\t\t}\n\n\t\tconst members = RocketChat.models.Rooms.processQueryOptionsOnResult(Array.from(findResult.usernames).sort(sortFn), {\n\t\t\tskip: offset,\n\t\t\tlimit: count\n\t\t});\n\n\t\tconst users = RocketChat.models.Users.find({ username: { $in: members } }, {\n\t\t\tfields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 },\n\t\t\tsort: sort ? sort : { username: 1 }\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: members.length,\n\t\t\toffset,\n\t\t\ttotal: findResult.usernames.length\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.messages', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult._id });\n\n\t\t//Special check for the permissions\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-joined-room') && !findResult.usernames.includes(this.user.username)) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t} else if (!RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Channel does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }\".`);\n\t\t}\n\n\t\tif (sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already open to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: { roomId: this.bodyParams.roomId } });\n\n\t\tif (findResult.name === this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('The channel name is the same as what it would be renamed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.description === this.bodyParams.description) {\n\t\t\treturn RocketChat.API.v1.failure('The channel description is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setJoinCode', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.joinCode || !this.bodyParams.joinCode.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"joinCode\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'joinCode', this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.description === this.bodyParams.purpose) {\n\t\t\treturn RocketChat.API.v1.failure('The channel purpose (description) is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The channel read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.topic === this.bodyParams.topic) {\n\t\t\treturn RocketChat.API.v1.failure('The channel topic is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The channel type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tif (!findResult.archived) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is not archived`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","import Busboy from 'busboy';\n\nRocketChat.API.v1.addRoute('rooms.get', { authRequired: true }, {\n\tget() {\n\t\tconst { updatedSince } = this.queryParams;\n\n\t\tlet updatedSinceDate;\n\t\tif (updatedSince) {\n\t\t\tif (isNaN(Date.parse(updatedSince))) {\n\t\t\t\tthrow new Meteor.Error('error-updatedSince-param-invalid', 'The \"updatedSince\" query parameter must be a valid date.');\n\t\t\t} else {\n\t\t\t\tupdatedSinceDate = new Date(updatedSince);\n\t\t\t}\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('rooms/get', updatedSinceDate));\n\n\t\tif (Array.isArray(result)) {\n\t\t\tresult = {\n\t\t\t\tupdate: result,\n\t\t\t\tremove: []\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute('rooms.upload/:rid', { authRequired: true }, {\n\tpost() {\n\t\tconst room = Meteor.call('canAccessRoom', this.urlParams.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\t\tconst files = [];\n\t\tconst fields = {};\n\n\t\tMeteor.wrapAsync((callback) => {\n\t\t\tbusboy.on('file', (fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\tif (fieldname !== 'file') {\n\t\t\t\t\treturn files.push(new Meteor.Error('invalid-field'));\n\t\t\t\t}\n\n\t\t\t\tconst fileDate = [];\n\t\t\t\tfile.on('data', data => fileDate.push(data));\n\n\t\t\t\tfile.on('end', () => {\n\t\t\t\t\tfiles.push({ fieldname, file, filename, encoding, mimetype, fileBuffer: Buffer.concat(fileDate) });\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tbusboy.on('field', (fieldname, value) => fields[fieldname] = value);\n\n\t\t\tbusboy.on('finish', Meteor.bindEnvironment(() => callback()));\n\n\t\t\tthis.request.pipe(busboy);\n\t\t})();\n\n\t\tif (files.length === 0) {\n\t\t\treturn RocketChat.API.v1.failure('File required');\n\t\t}\n\n\t\tif (files.length > 1) {\n\t\t\treturn RocketChat.API.v1.failure('Just 1 file is allowed');\n\t\t}\n\n\t\tconst file = files[0];\n\n\t\tconst fileStore = FileUpload.getStore('Uploads');\n\n\t\tconst details = {\n\t\t\tname: file.filename,\n\t\t\tsize: file.fileBuffer.length,\n\t\t\ttype: file.mimetype,\n\t\t\trid: this.urlParams.rid\n\t\t};\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tconst uploadedFile = Meteor.wrapAsync(fileStore.insert.bind(fileStore))(details, file.fileBuffer);\n\n\t\t\tuploadedFile.description = fields.description;\n\n\t\t\tdelete fields.description;\n\n\t\t\tRocketChat.API.v1.success(Meteor.call('sendFileMessage', this.urlParams.rid, null, uploadedFile, fields));\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","RocketChat.API.v1.addRoute('subscriptions.get', { authRequired: true }, {\n\tget() {\n\t\tconst { updatedSince } = this.queryParams;\n\n\t\tlet updatedSinceDate;\n\t\tif (updatedSince) {\n\t\t\tif (isNaN(Date.parse(updatedSince))) {\n\t\t\t\tthrow new Meteor.Error('error-roomId-param-invalid', 'The \"lastUpdate\" query parameter must be a valid date.');\n\t\t\t} else {\n\t\t\t\tupdatedSinceDate = new Date(updatedSince);\n\t\t\t}\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('subscriptions/get', updatedSinceDate));\n\n\t\tif (Array.isArray(result)) {\n\t\t\tresult = {\n\t\t\t\tupdate: result,\n\t\t\t\tremove: []\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\n/**\n\tThis API is suppose to mark any room as read.\n\n\tMethod: POST\n\tRoute: api/v1/subscriptions.read\n\tParams:\n\t\t- rid: The rid of the room to be marked as read.\n */\nRocketChat.API.v1.addRoute('subscriptions.read', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\trid: String\n\t\t});\n\n\t\tMeteor.runAsUser(this.userId, () =>\n\t\t\tMeteor.call('readMessages', this.bodyParams.rid)\n\t\t);\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n","/* global processWebhookMessage */\nRocketChat.API.v1.addRoute('chat.delete', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tmsgId: String,\n\t\t\troomId: String,\n\t\t\tasUser: Match.Maybe(Boolean)\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId, { fields: { u: 1, rid: 1 }});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\tif (this.bodyParams.asUser && msg.u._id !== this.userId && !RocketChat.authz.hasPermission(Meteor.userId(), 'force-delete-message', msg.rid)) {\n\t\t\treturn RocketChat.API.v1.failure('Unauthorized. You must have the permission \"force-delete-message\" to delete other\\'s message as them.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.bodyParams.asUser ? msg.u._id : this.userId, () => {\n\t\t\tMeteor.call('deleteMessage', { _id: msg._id });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\t_id: msg._id,\n\t\t\tts: Date.now(),\n\t\t\tmessage: msg\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.syncMessages', { authRequired: true }, {\n\tget() {\n\t\tconst { roomId, lastUpdate } = this.queryParams;\n\n\t\tif (!roomId) {\n\t\t\tthrow new Meteor.Error('error-roomId-param-not-provided', 'The required \"roomId\" query param is missing.');\n\t\t}\n\n\t\tif (!lastUpdate) {\n\t\t\tthrow new Meteor.Error('error-lastUpdate-param-not-provided', 'The required \"lastUpdate\" query param is missing.');\n\t\t} else if (isNaN(Date.parse(lastUpdate))) {\n\t\t\tthrow new Meteor.Error('error-roomId-param-invalid', 'The \"lastUpdate\" query parameter must be a valid date.');\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('messages/get', roomId, { lastUpdate: new Date(lastUpdate) });\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.failure();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tresult\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.getMessage', { authRequired: true }, {\n\tget() {\n\t\tif (!this.queryParams.msgId) {\n\t\t\treturn RocketChat.API.v1.failure('The \"msgId\" query parameter must be provided.');\n\t\t}\n\n\t\tlet msg;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tmsg = Meteor.call('getSingleMessage', this.queryParams.msgId);\n\t\t});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: msg\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.pinMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is missing.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tlet pinnedMessage;\n\t\tMeteor.runAsUser(this.userId, () => pinnedMessage = Meteor.call('pinMessage', msg));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: pinnedMessage\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.postMessage', { authRequired: true }, {\n\tpost() {\n\t\tconst messageReturn = processWebhookMessage(this.bodyParams, this.user, undefined, true)[0];\n\n\t\tif (!messageReturn) {\n\t\t\treturn RocketChat.API.v1.failure('unknown-error');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tts: Date.now(),\n\t\t\tchannel: messageReturn.channel,\n\t\t\tmessage: messageReturn.message\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.search', { authRequired: true }, {\n\tget() {\n\t\tconst { roomId, searchText, limit } = this.queryParams;\n\n\t\tif (!roomId) {\n\t\t\tthrow new Meteor.Error('error-roomId-param-not-provided', 'The required \"roomId\" query param is missing.');\n\t\t}\n\n\t\tif (!searchText) {\n\t\t\tthrow new Meteor.Error('error-searchText-param-not-provided', 'The required \"searchText\" query param is missing.');\n\t\t}\n\n\t\tif (limit && (typeof limit !== 'number' || isNaN(limit) || limit <= 0)) {\n\t\t\tthrow new Meteor.Error('error-limit-param-invalid', 'The \"limit\" query parameter must be a valid number and be greater than 0.');\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('messageSearch', searchText, roomId, limit));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result.messages\n\t\t});\n\t}\n});\n\n// The difference between `chat.postMessage` and `chat.sendMessage` is that `chat.sendMessage` allows\n// for passing a value for `_id` and the other one doesn't. Also, `chat.sendMessage` only sends it to\n// one channel whereas the other one allows for sending to more than one channel at a time.\nRocketChat.API.v1.addRoute('chat.sendMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.message) {\n\t\t\tthrow new Meteor.Error('error-invalid-params', 'The \"message\" parameter must be provided.');\n\t\t}\n\n\t\tlet message;\n\t\tMeteor.runAsUser(this.userId, () => message = Meteor.call('sendMessage', this.bodyParams.message));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.starMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('starMessage', {\n\t\t\t_id: msg._id,\n\t\t\trid: msg.rid,\n\t\t\tstarred: true\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.unPinMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('unpinMessage', msg));\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.unStarMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('starMessage', {\n\t\t\t_id: msg._id,\n\t\t\trid: msg.rid,\n\t\t\tstarred: false\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\troomId: String,\n\t\t\tmsgId: String,\n\t\t\ttext: String //Using text to be consistant with chat.postMessage\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId);\n\n\t\t//Ensure the message exists\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\t//Permission checks are already done in the updateMessage method, so no need to duplicate them\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('updateMessage', { _id: msg._id, msg: this.bodyParams.text, rid: msg.rid });\n\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: RocketChat.models.Messages.findOneById(msg._id)\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.react', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is missing.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tconst emoji = this.bodyParams.emoji;\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('setReaction', emoji, msg._id));\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","RocketChat.API.v1.addRoute('commands.get', { authRequired: true }, {\n\tget() {\n\t\tconst params = this.queryParams;\n\n\t\tif (typeof params.command !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The query param \"command\" must be provided.');\n\t\t}\n\n\t\tconst cmd = RocketChat.slashCommands.commands[params.command.toLowerCase()];\n\n\t\tif (!cmd) {\n\t\t\treturn RocketChat.API.v1.failure(`There is no command in the system by the name of: ${ params.command }`);\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ command: cmd });\n\t}\n});\n\nRocketChat.API.v1.addRoute('commands.list', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet commands = Object.values(RocketChat.slashCommands.commands);\n\n\t\tif (query && query.command) {\n\t\t\tcommands = commands.filter((command) => command.command === query.command);\n\t\t}\n\n\t\tconst totalCount = commands.length;\n\t\tcommands = RocketChat.models.Rooms.processQueryOptionsOnResult(commands, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tcommands,\n\t\t\toffset,\n\t\t\tcount: commands.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\n// Expects a body of: { command: 'gimme', params: 'any string value', roomId: 'value' }\nRocketChat.API.v1.addRoute('commands.run', { authRequired: true }, {\n\tpost() {\n\t\tconst body = this.bodyParams;\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (typeof body.command !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('You must provide a command to run.');\n\t\t}\n\n\t\tif (body.params && typeof body.params !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The parameters for the command must be a single string.');\n\t\t}\n\n\t\tif (typeof body.roomId !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The room\\'s id where to execute this command must provided and be a string.');\n\t\t}\n\n\t\tconst cmd = body.command.toLowerCase();\n\t\tif (!RocketChat.slashCommands.commands[body.command.toLowerCase()]) {\n\t\t\treturn RocketChat.API.v1.failure('The command provided does not exist (or is disabled).');\n\t\t}\n\n\t\t// This will throw an error if they can't or the room is invalid\n\t\tMeteor.call('canAccessRoom', body.roomId, user._id);\n\n\t\tconst params = body.params ? body.params : '';\n\n\t\tlet result;\n\t\tMeteor.runAsUser(user._id, () => {\n\t\t\tresult = RocketChat.slashCommands.run(cmd, params, {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: body.roomId,\n\t\t\t\tmsg: `/${ cmd } ${ params }`\n\t\t\t});\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({ result });\n\t}\n});\n","import _ from 'underscore';\n\n//Returns the private group subscription IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findPrivateGroupByIdOrName({ params, userId, checkedArchived = true }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-room-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tlet roomSub;\n\tif (params.roomId) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(params.roomId, userId);\n\t} else if (params.roomName) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomNameAndUserId(params.roomName, userId);\n\t}\n\n\tif (!roomSub || roomSub.t !== 'p') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any group');\n\t}\n\n\tif (checkedArchived && roomSub.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The private group, ${ roomSub.name }, is archived`);\n\t}\n\n\treturn roomSub;\n}\n\nRocketChat.API.v1.addRoute('groups.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult.rid, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addLeader', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst user = this.getUserFromParams();\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomLeader', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Archives a private group only if it wasn't\nRocketChat.API.v1.addRoute('groups.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tif (!findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Create Private Group\nRocketChat.API.v1.addRoute('groups.create', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-p')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createPrivateGroup', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.processQueryOptionsOnResult([findResult._room], { fields: RocketChat.API.v1.defaultFieldsToExclude })[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.files', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.rid });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles,\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tlet includeAllPrivateGroups = true;\n\t\tif (typeof this.queryParams.includeAllPrivateGroups !== 'undefined') {\n\t\t\tincludeAllPrivateGroups = this.queryParams.includeAllPrivateGroups === 'true';\n\t\t}\n\n\t\tconst channelsToSearch = [`#${ findResult.name }`];\n\t\tif (includeAllPrivateGroups) {\n\t\t\tchannelsToSearch.push('all_private_groups');\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { channel: { $in: channelsToSearch } });\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult.rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//List Private Groups a user has access to\nRocketChat.API.v1.addRoute('groups.list', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, {\n\t\t\tt: 'p',\n\t\t\t'u._id': this.userId\n\t\t});\n\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.find(ourQuery).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\n\nRocketChat.API.v1.addRoute('groups.listAll', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'p' });\n\n\t\tlet rooms = RocketChat.models.Rooms.find(ourQuery).fetch();\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.members', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\n\t\tlet sortFn = (a, b) => a > b;\n\t\tif (Match.test(sort, Object) && Match.test(sort.username, Number) && sort.username === -1) {\n\t\t\tsortFn = (a, b) => b < a;\n\t\t}\n\n\t\tconst members = RocketChat.models.Rooms.processQueryOptionsOnResult(Array.from(findResult._room.usernames).sort(sortFn), {\n\t\t\tskip: offset,\n\t\t\tlimit: count\n\t\t});\n\n\t\tconst users = RocketChat.models.Users.find({ username: { $in: members } }, {\n\t\t\tfields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 },\n\t\t\tsort: sort ? sort : { username: 1 }\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: members.length,\n\t\t\toffset,\n\t\t\ttotal: findResult._room.usernames.length\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.messages', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.rid });\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'p' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Group does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tif (findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ findResult.name }, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeLeader', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomLeader', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: { roomId: this.bodyParams.roomId}, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The private group read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The private group type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","import _ from 'underscore';\n\nfunction findDirectMessageRoom(params, user) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.username || !params.username.trim())) {\n\t\tthrow new Meteor.Error('error-room-param-not-provided', 'Body param \"roomId\" or \"username\" is required');\n\t}\n\n\tconst room = RocketChat.getRoomByNameOrIdWithOptionToJoin({\n\t\tcurrentUserId: user._id,\n\t\tnameOrId: params.username || params.roomId,\n\t\ttype: 'd'\n\t});\n\n\tif (!room || room.t !== 'd') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"username\" param provided does not match any dirct message');\n\t}\n\n\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user._id);\n\n\treturn {\n\t\troom,\n\t\tsubscription\n\t};\n}\n\nRocketChat.API.v1.addRoute(['dm.create', 'im.create'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\troom: findResult.room\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.close', 'im.close'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tif (!findResult.subscription.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${ this.bodyParams.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.room._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.files', 'im.files'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.room._id });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles,\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.history', 'im.history'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', {\n\t\t\t\trid: findResult.room._id,\n\t\t\t\tlatest: latestDate,\n\t\t\t\toldest: oldestDate,\n\t\t\t\tinclusive,\n\t\t\t\tcount,\n\t\t\t\tunreads\n\t\t\t});\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.members', 'im.members'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\n\t\tconst members = RocketChat.models.Rooms.processQueryOptionsOnResult(Array.from(findResult.room.usernames), {\n\t\t\tsort: sort ? sort : -1,\n\t\t\tskip: offset,\n\t\t\tlimit: count\n\t\t});\n\n\t\tconst users = RocketChat.models.Users.find({ username: { $in: members } },\n\t\t\t{ fields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 } }).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: members.length,\n\t\t\toffset,\n\t\t\ttotal: findResult.room.usernames.length\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.messages', 'im.messages'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconsole.log(findResult);\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.room._id });\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.messages.others', 'im.messages.others'], { authRequired: true }, {\n\tget() {\n\t\tif (RocketChat.settings.get('API_Enable_Direct_Message_History_EndPoint') !== true) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/im.messages.others' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst roomId = this.queryParams.roomId;\n\t\tif (!roomId || !roomId.trim()) {\n\t\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" is required');\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\tif (!room || room.t !== 'd') {\n\t\t\tthrow new Meteor.Error('error-room-not-found', `No direct message room found by the id of: ${ roomId }`);\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { rid: room._id });\n\n\t\tconst msgs = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: msgs,\n\t\t\toffset,\n\t\t\tcount: msgs.length,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list', 'im.list'], { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, {\n\t\t\tt: 'd',\n\t\t\t'u._id': this.userId\n\t\t});\n\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.find(ourQuery).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list.everyone', 'im.list.everyone'], { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { t: 'd' });\n\n\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.open', 'im.open'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tif (!findResult.subscription.open) {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('openRoom', findResult.room._id);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.setTopic', 'im.setTopic'], { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.room._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('integrations.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\tname: String,\n\t\t\tenabled: Boolean,\n\t\t\tusername: String,\n\t\t\turls: Match.Maybe([String]),\n\t\t\tchannel: String,\n\t\t\tevent: Match.Maybe(String),\n\t\t\ttriggerWords: Match.Maybe([String]),\n\t\t\talias: Match.Maybe(String),\n\t\t\tavatar: Match.Maybe(String),\n\t\t\temoji: Match.Maybe(String),\n\t\t\ttoken: Match.Maybe(String),\n\t\t\tscriptEnabled: Boolean,\n\t\t\tscript: Match.Maybe(String),\n\t\t\ttargetChannel: Match.Maybe(String)\n\t\t}));\n\n\t\tlet integration;\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addOutgoingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addIncomingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ integration });\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.history', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.queryParams.id || this.queryParams.id.trim() === '') {\n\t\t\treturn RocketChat.API.v1.failure('Invalid integration id.');\n\t\t}\n\n\t\tconst id = this.queryParams.id;\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { 'integration._id': id });\n\t\tconst history = RocketChat.models.IntegrationHistory.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _updatedAt: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\thistory,\n\t\t\toffset,\n\t\t\titems: history.length,\n\t\t\ttotal: RocketChat.models.IntegrationHistory.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query);\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\toffset,\n\t\t\titems: integrations.length,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.remove', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\ttarget_url: Match.Maybe(String),\n\t\t\tintegrationId: Match.Maybe(String)\n\t\t}));\n\n\t\tif (!this.bodyParams.target_url && !this.bodyParams.integrationId) {\n\t\t\treturn RocketChat.API.v1.failure('An integrationId or target_url needs to be provided.');\n\t\t}\n\n\t\tlet integration;\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tif (this.bodyParams.target_url) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ urls: this.bodyParams.target_url });\n\t\t\t\t} else if (this.bodyParams.integrationId) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\t\t\t\t}\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteOutgoingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration\n\t\t\t\t});\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteIncomingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.API.v1.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tinfo: {\n\t\t\t\t'version': RocketChat.Info.version\n\t\t\t}\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('me', { authRequired: true }, {\n\tget() {\n\t\tconst me = _.pick(this.user, [\n\t\t\t'_id',\n\t\t\t'name',\n\t\t\t'emails',\n\t\t\t'status',\n\t\t\t'statusConnection',\n\t\t\t'username',\n\t\t\t'utcOffset',\n\t\t\t'active',\n\t\t\t'language'\n\t\t]);\n\n\t\tconst verifiedEmail = me.emails.find((email) => email.verified);\n\n\t\tme.email = verifiedEmail ? verifiedEmail.address : undefined;\n\n\t\treturn RocketChat.API.v1.success(me);\n\t}\n});\n\nlet onlineCache = 0;\nlet onlineCacheDate = 0;\nconst cacheInvalid = 60000; // 1 minute\nRocketChat.API.v1.addRoute('shield.svg', { authRequired: false }, {\n\tget() {\n\t\tconst { type, channel, name, icon } = this.queryParams;\n\t\tif (!RocketChat.settings.get('API_Enable_Shields')) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/shield.svg' });\n\t\t}\n\n\t\tconst types = RocketChat.settings.get('API_Shield_Types');\n\t\tif (type && (types !== '*' && !types.split(',').map((t) => t.trim()).includes(type))) {\n\t\t\tthrow new Meteor.Error('error-shield-disabled', 'This shield type is disabled', { route: '/api/v1/shield.svg' });\n\t\t}\n\n\t\tconst hideIcon = icon === 'false';\n\t\tif (hideIcon && (!name || !name.trim())) {\n\t\t\treturn RocketChat.API.v1.failure('Name cannot be empty when icon is hidden');\n\t\t}\n\n\t\tlet text;\n\t\tlet backgroundColor = '#4c1';\n\t\tswitch (type) {\n\t\t\tcase 'online':\n\t\t\t\tif (Date.now() - onlineCacheDate > cacheInvalid) {\n\t\t\t\t\tonlineCache = RocketChat.models.Users.findUsersNotOffline().count();\n\t\t\t\t\tonlineCacheDate = Date.now();\n\t\t\t\t}\n\n\t\t\t\ttext = `${ onlineCache } ${ TAPi18n.__('Online') }`;\n\t\t\t\tbreak;\n\t\t\tcase 'channel':\n\t\t\t\tif (!channel) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('Shield channel is required for type \"channel\"');\n\t\t\t\t}\n\n\t\t\t\ttext = `#${ channel }`;\n\t\t\t\tbreak;\n\t\t\tcase 'user':\n\t\t\t\tconst user = this.getUserFromParams();\n\n\t\t\t\t// Respect the server's choice for using their real names or not\n\t\t\t\tif (user.name && RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\t\t\ttext = `${ user.name }`;\n\t\t\t\t} else {\n\t\t\t\t\ttext = `@${ user.username }`;\n\t\t\t\t}\n\n\t\t\t\tswitch (user.status) {\n\t\t\t\t\tcase 'online':\n\t\t\t\t\t\tbackgroundColor = '#1fb31f';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'away':\n\t\t\t\t\t\tbackgroundColor = '#dc9b01';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'busy':\n\t\t\t\t\t\tbackgroundColor = '#bc2031';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'offline':\n\t\t\t\t\t\tbackgroundColor = '#a5a1a1';\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\ttext = TAPi18n.__('Join_Chat').toUpperCase();\n\t\t}\n\n\t\tconst iconSize = hideIcon ? 7 : 24;\n\t\tconst leftSize = name ? name.length * 6 + 7 + iconSize : iconSize;\n\t\tconst rightSize = text.length * 6 + 20;\n\t\tconst width = leftSize + rightSize;\n\t\tconst height = 20;\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'image/svg+xml;charset=utf-8' },\n\t\t\tbody: `\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"${ width }\" height=\"${ height }\">\n\t\t\t\t  <linearGradient id=\"b\" x2=\"0\" y2=\"100%\">\n\t\t\t\t    <stop offset=\"0\" stop-color=\"#bbb\" stop-opacity=\".1\"/>\n\t\t\t\t    <stop offset=\"1\" stop-opacity=\".1\"/>\n\t\t\t\t  </linearGradient>\n\t\t\t\t  <mask id=\"a\">\n\t\t\t\t    <rect width=\"${ width }\" height=\"${ height }\" rx=\"3\" fill=\"#fff\"/>\n\t\t\t\t  </mask>\n\t\t\t\t  <g mask=\"url(#a)\">\n\t\t\t\t    <path fill=\"#555\" d=\"M0 0h${ leftSize }v${ height }H0z\"/>\n\t\t\t\t    <path fill=\"${ backgroundColor }\" d=\"M${ leftSize } 0h${ rightSize }v${ height }H${ leftSize }z\"/>\n\t\t\t\t    <path fill=\"url(#b)\" d=\"M0 0h${ width }v${ height }H0z\"/>\n\t\t\t\t  </g>\n\t\t\t\t    ${ hideIcon ? '' : '<image x=\"5\" y=\"3\" width=\"14\" height=\"14\" xlink:href=\"/assets/favicon.svg\"/>' }\n\t\t\t\t  <g fill=\"#fff\" font-family=\"DejaVu Sans,Verdana,Geneva,sans-serif\" font-size=\"11\">\n\t\t\t\t\t\t${ name ? `<text x=\"${ iconSize }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ name }</text>\n\t\t\t\t    <text x=\"${ iconSize }\" y=\"14\">${ name }</text>` : '' }\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ text }</text>\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"14\">${ text }</text>\n\t\t\t\t  </g>\n\t\t\t\t</svg>\n\t\t\t`.trim().replace(/\\>[\\s]+\\</gm, '><')\n\t\t};\n\t}\n});\n","/**\n\tThis API returns all permissions that exists\n\ton the server, with respective roles.\n\n\tMethod: GET\n\tRoute: api/v1/permissions\n */\nRocketChat.API.v1.addRoute('permissions', { authRequired: true }, {\n\tget() {\n\t\tconst result = Meteor.runAsUser(this.userId, () => Meteor.call('permissions/get'));\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n","/* globals Push */\n\nRocketChat.API.v1.addRoute('push.token', { authRequired: true }, {\n\tpost() {\n\t\tconst { type, value, appName } = this.bodyParams;\n\t\tlet { id } = this.bodyParams;\n\n\t\tif (id && typeof id !== 'string') {\n\t\t\tthrow new Meteor.Error('error-id-param-not-valid', 'The required \"id\" body param is invalid.');\n\t\t} else {\n\t\t\tid = Random.id();\n\t\t}\n\n\t\tif (!type || (type !== 'apn' && type !== 'gcm')) {\n\t\t\tthrow new Meteor.Error('error-type-param-not-valid', 'The required \"type\" body param is missing or invalid.');\n\t\t}\n\n\t\tif (!value || typeof value !== 'string') {\n\t\t\tthrow new Meteor.Error('error-token-param-not-valid', 'The required \"token\" body param is missing or invalid.');\n\t\t}\n\n\t\tif (!appName || typeof appName !== 'string') {\n\t\t\tthrow new Meteor.Error('error-appName-param-not-valid', 'The required \"appName\" body param is missing or invalid.');\n\t\t}\n\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('raix:push-update', {\n\t\t\tid,\n\t\t\ttoken: { [type]: value },\n\t\t\tappName,\n\t\t\tuserId: this.userId\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success({ result });\n\t},\n\tdelete() {\n\t\tconst { token } = this.bodyParams;\n\n\t\tif (!token || typeof token !== 'string') {\n\t\t\tthrow new Meteor.Error('error-token-param-not-valid', 'The required \"token\" body param is missing or invalid.');\n\t\t}\n\n\t\tconst affectedRecords = Push.appCollection.remove({\n\t\t\t$or: [{\n\t\t\t\t'token.apn': token\n\t\t\t}, {\n\t\t\t\t'token.gcm': token\n\t\t\t}],\n\t\t\tuserId: this.userId\n\t\t});\n\n\t\tif (affectedRecords === 0) {\n\t\t\treturn RocketChat.API.v1.notFound();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","import _ from 'underscore';\n\n// settings endpoints\nRocketChat.API.v1.addRoute('settings.public', { authRequired: false }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet ourQuery = {\n\t\t\thidden: { $ne: true },\n\t\t\t'public': true\n\t\t};\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst settings = RocketChat.models.Settings.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _id: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({ _id: 1, value: 1 }, fields)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsettings,\n\t\t\tcount: settings.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Settings.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('settings', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet ourQuery = {\n\t\t\thidden: { $ne: true }\n\t\t};\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\tourQuery.public = true;\n\t\t}\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst settings = RocketChat.models.Settings.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _id: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({ _id: 1, value: 1 }, fields)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsettings,\n\t\t\tcount: settings.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Settings.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('settings/:_id', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(_.pick(RocketChat.models.Settings.findOneNotHiddenById(this.urlParams._id), '_id', 'value'));\n\t},\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'edit-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tcheck(this.bodyParams, {\n\t\t\tvalue: Match.Any\n\t\t});\n\n\t\tif (RocketChat.models.Settings.updateValueNotHiddenById(this.urlParams._id, this.bodyParams.value)) {\n\t\t\treturn RocketChat.API.v1.success();\n\t\t}\n\n\t\treturn RocketChat.API.v1.failure();\n\t}\n});\n\nRocketChat.API.v1.addRoute('service.configurations', { authRequired: false }, {\n\tget() {\n\t\tconst ServiceConfiguration = Package['service-configuration'].ServiceConfiguration;\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tconfigurations: ServiceConfiguration.configurations.find({}, {fields: {secret: 0}}).fetch()\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('statistics', { authRequired: true }, {\n\tget() {\n\t\tlet refresh = false;\n\t\tif (typeof this.queryParams.refresh !== 'undefined' && this.queryParams.refresh === 'true') {\n\t\t\trefresh = true;\n\t\t}\n\n\t\tlet stats;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tstats = Meteor.call('getStatistics', refresh);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics: stats\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('statistics.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-statistics')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst statistics = RocketChat.models.Statistics.find(query, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics,\n\t\t\tcount: statistics.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Statistics.find(query).count()\n\t\t});\n\t}\n});\n","import _ from 'underscore';\nimport Busboy from 'busboy';\n\nRocketChat.API.v1.addRoute('users.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\temail: String,\n\t\t\tname: String,\n\t\t\tpassword: String,\n\t\t\tusername: String,\n\t\t\tactive: Match.Maybe(Boolean),\n\t\t\troles: Match.Maybe(Array),\n\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\tverified: Match.Maybe(Boolean),\n\t\t\tcustomFields: Match.Maybe(Object)\n\t\t});\n\n\t\t//New change made by pull request #5152\n\t\tif (typeof this.bodyParams.joinDefaultChannels === 'undefined') {\n\t\t\tthis.bodyParams.joinDefaultChannels = true;\n\t\t}\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.validateCustomFields(this.bodyParams.customFields);\n\t\t}\n\n\t\tconst newUserId = RocketChat.saveUser(this.userId, this.bodyParams);\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.saveCustomFieldsWithoutValidation(newUserId, this.bodyParams.customFields);\n\t\t}\n\n\n\t\tif (typeof this.bodyParams.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', newUserId, this.bodyParams.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(newUserId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.delete', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'delete-user')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('deleteUser', user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getAvatar', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tconst url = RocketChat.getURL(`/avatar/${ user.username }`, { cdn: false, full: true });\n\t\tthis.response.setHeader('Location', url);\n\n\t\treturn {\n\t\t\tstatusCode: 307,\n\t\t\tbody: url\n\t\t};\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getPresence', { authRequired: true }, {\n\tget() {\n\t\tif (this.isUserFromParams()) {\n\t\t\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tpresence: user.status,\n\t\t\t\tconnectionStatus: user.statusConnection,\n\t\t\t\tlastLogin: user.lastLogin\n\t\t\t});\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpresence: user.status\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.info', { authRequired: true }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getFullUserData', { filter: user.username, limit: 1 });\n\t\t});\n\n\t\tif (!result || result.length !== 1) {\n\t\t\treturn RocketChat.API.v1.failure(`Failed to get the user data for the userId of \"${ user._id }\".`);\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tuser: result[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-d-room')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst users = RocketChat.models.Users.find(query, {\n\t\t\tsort: sort ? sort : { username: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tusers,\n\t\t\tcount: users.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Users.find(query).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.register', { authRequired: false }, {\n\tpost() {\n\t\tif (this.userId) {\n\t\t\treturn RocketChat.API.v1.failure('Logged in users can not register again.');\n\t\t}\n\n\t\t//We set their username here, so require it\n\t\t//The `registerUser` checks for the other requirements\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tusername: String\n\t\t}));\n\n\t\t//Register the user\n\t\tconst userId = Meteor.call('registerUser', this.bodyParams);\n\n\t\t//Now set their username\n\t\tMeteor.runAsUser(userId, () => Meteor.call('setUsername', this.bodyParams.username));\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.resetAvatar', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tif (user._id === this.userId) {\n\t\t\tMeteor.runAsUser(this.userId, () => Meteor.call('resetAvatar'));\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tMeteor.runAsUser(user._id, () => Meteor.call('resetAvatar'));\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.setAvatar', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tavatarUrl: Match.Maybe(String),\n\t\t\tuserId: Match.Maybe(String),\n\t\t\tusername: Match.Maybe(String)\n\t\t}));\n\n\t\tlet user;\n\t\tif (this.isUserFromParams()) {\n\t\t\tuser = Meteor.users.findOne(this.userId);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tuser = this.getUserFromParams();\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tMeteor.runAsUser(user._id, () => {\n\t\t\tif (this.bodyParams.avatarUrl) {\n\t\t\t\tRocketChat.setUserAvatar(user, this.bodyParams.avatarUrl, '', 'url');\n\t\t\t} else {\n\t\t\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\n\t\t\t\tMeteor.wrapAsync((callback) => {\n\t\t\t\t\tbusboy.on('file', Meteor.bindEnvironment((fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\t\t\tif (fieldname !== 'image') {\n\t\t\t\t\t\t\treturn callback(new Meteor.Error('invalid-field'));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst imageData = [];\n\t\t\t\t\t\tfile.on('data', Meteor.bindEnvironment((data) => {\n\t\t\t\t\t\t\timageData.push(data);\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\tfile.on('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\t\tRocketChat.setUserAvatar(user, Buffer.concat(imageData), mimetype, 'rest');\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t}));\n\t\t\t\t\tthis.request.pipe(busboy);\n\t\t\t\t})();\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tuserId: String,\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\temail: Match.Maybe(String),\n\t\t\t\tname: Match.Maybe(String),\n\t\t\t\tpassword: Match.Maybe(String),\n\t\t\t\tusername: Match.Maybe(String),\n\t\t\t\tactive: Match.Maybe(Boolean),\n\t\t\t\troles: Match.Maybe(Array),\n\t\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\t\tverified: Match.Maybe(Boolean),\n\t\t\t\tcustomFields: Match.Maybe(Object)\n\t\t\t})\n\t\t});\n\n\t\tconst userData = _.extend({ _id: this.bodyParams.userId }, this.bodyParams.data);\n\n\t\tMeteor.runAsUser(this.userId, () => RocketChat.saveUser(this.userId, userData));\n\n\t\tif (this.bodyParams.data.customFields) {\n\t\t\tRocketChat.saveCustomFields(this.bodyParams.userId, this.bodyParams.data.customFields);\n\t\t}\n\n\t\tif (typeof this.bodyParams.data.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', this.bodyParams.userId, this.bodyParams.data.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(this.bodyParams.userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.updateOwnBasicInfo', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\temail: Match.Maybe(String),\n\t\t\t\tname: Match.Maybe(String),\n\t\t\t\tusername: Match.Maybe(String),\n\t\t\t\tcurrentPassword: Match.Maybe(String),\n\t\t\t\tnewPassword: Match.Maybe(String)\n\t\t\t}),\n\t\t\tcustomFields: Match.Maybe(Object)\n\t\t});\n\n\t\tconst userData = {\n\t\t\temail: this.bodyParams.data.email,\n\t\t\trealname: this.bodyParams.data.name,\n\t\t\tusername: this.bodyParams.data.username,\n\t\t\tnewPassword: this.bodyParams.data.newPassword,\n\t\t\ttypedPassword: this.bodyParams.data.currentPassword\n\t\t};\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('saveUserProfile', userData, this.bodyParams.customFields));\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(this.userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.createToken', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\t\tlet data;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tdata = Meteor.call('createToken', user._id);\n\t\t});\n\t\treturn data ? RocketChat.API.v1.success({ data }) : RocketChat.API.v1.unauthorized();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getPreferences', { authRequired: true }, {\n\tget() {\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\t\tif (user.settings) {\n\t\t\tconst preferences = user.settings.preferences;\n\t\t\tpreferences['language'] = user.language;\n\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tpreferences\n\t\t\t});\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.failure(TAPi18n.__('Accounts_Default_User_Preferences_not_available').toUpperCase());\n\t\t}\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.setPreferences', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tuserId: Match.Maybe(String),\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\tnewRoomNotification: Match.Maybe(String),\n\t\t\t\tnewMessageNotification: Match.Maybe(String),\n\t\t\t\tuseEmojis: Match.Maybe(Boolean),\n\t\t\t\tconvertAsciiEmoji: Match.Maybe(Boolean),\n\t\t\t\tsaveMobileBandwidth: Match.Maybe(Boolean),\n\t\t\t\tcollapseMediaByDefault: Match.Maybe(Boolean),\n\t\t\t\tautoImageLoad: Match.Maybe(Boolean),\n\t\t\t\temailNotificationMode: Match.Maybe(String),\n\t\t\t\troomsListExhibitionMode: Match.Maybe(String),\n\t\t\t\tunreadAlert: Match.Maybe(Boolean),\n\t\t\t\tnotificationsSoundVolume: Match.Maybe(Number),\n\t\t\t\tdesktopNotifications: Match.Maybe(String),\n\t\t\t\tmobileNotifications: Match.Maybe(String),\n\t\t\t\tenableAutoAway: Match.Maybe(Boolean),\n\t\t\t\thighlights: Match.Maybe(Array),\n\t\t\t\tdesktopNotificationDuration: Match.Maybe(Number),\n\t\t\t\tviewMode: Match.Maybe(Number),\n\t\t\t\thideUsernames: Match.Maybe(Boolean),\n\t\t\t\thideRoles: Match.Maybe(Boolean),\n\t\t\t\thideAvatars: Match.Maybe(Boolean),\n\t\t\t\thideFlexTab: Match.Maybe(Boolean),\n\t\t\t\tsendOnEnter: Match.Maybe(String),\n\t\t\t\troomCounterSidebar: Match.Maybe(Boolean),\n\t\t\t\tlanguage: Match.Maybe(String),\n\t\t\t\tsidebarShowFavorites: Match.Optional(Boolean),\n\t\t\t\tsidebarShowUnread: Match.Optional(Boolean),\n\t\t\t\tsidebarSortby: Match.Optional(String),\n\t\t\t\tsidebarViewMode: Match.Optional(String),\n\t\t\t\tsidebarHideAvatar: Match.Optional(Boolean),\n\t\t\t\tmergeChannels: Match.Optional(Boolean),\n\t\t\t\tmuteFocusedConversations: Match.Optional(Boolean)\n\t\t\t})\n\t\t});\n\n\t\tlet preferences;\n\t\tconst userId = this.bodyParams.userId ? this.bodyParams.userId : this.userId;\n\t\tif (this.bodyParams.data.language) {\n\t\t\tconst language = this.bodyParams.data.language;\n\t\t\tdelete this.bodyParams.data.language;\n\t\t\tpreferences = _.extend({ _id: userId, settings: { preferences: this.bodyParams.data }, language });\n\t\t} else {\n\t\t\tpreferences = _.extend({ _id: userId, settings: { preferences: this.bodyParams.data }});\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => RocketChat.saveUser(this.userId, preferences));\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(this.bodyParams.userId, { fields: preferences }) });\n\t}\n});\n\n/**\n\tThis API returns the logged user roles.\n\n\tMethod: GET\n\tRoute: api/v1/user.roles\n */\nRocketChat.API.v1.addRoute('user.roles', { authRequired: true }, {\n\tget() {\n\t\tlet currentUserRoles = {};\n\n\t\tconst result = Meteor.runAsUser(this.userId, () => Meteor.call('getUserRoles'));\n\n\t\tif (Array.isArray(result) && result.length > 0) {\n\t\t\tcurrentUserRoles = result[0];\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(currentUserRoles);\n\t}\n});\n","/**\n\tThis API returns the result of a query of rooms\n\tand users, using Meteor's Spotlight method.\n\n\tMethod: GET\n\tRoute: api/v1/spotlight\n\tQuery params:\n\t\t- query: The term to be searched.\n */\nRocketChat.API.v1.addRoute('spotlight', { authRequired: true }, {\n\tget() {\n\t\tcheck(this.queryParams, {\n\t\t\tquery: String\n\t\t});\n\n\t\tconst { query } = this.queryParams;\n\n\t\tconst result = Meteor.runAsUser(this.userId, () =>\n\t\t\tMeteor.call('spotlight', query, null, {\n\t\t\t\trooms: true,\n\t\t\t\tusers: true\n\t\t\t})\n\t\t);\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n"]}