{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:lib/lib/core.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/RoomTypeConfig.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/conversation.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/direct.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/favorite.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/index.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/private.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/public.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypes/unread.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/getURL.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/callbacks.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/fileUploadRestrictions.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/getAvatarColor.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/getValidRoomName.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/placeholders.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/promises.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/RoomTypesCommon.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/slashCommand.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/Message.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/messageBox.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/MessageTypes.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/templateVarHandler.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/getUserPreference.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/startup/settingsOnLoadSiteUrl.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/debug.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/bugsnag.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/metrics.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/RateLimiter.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/configLogger.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/PushNotification.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/defaultBlockedDomainsList.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/interceptDirectReplyEmails.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/loginErrorMessageOverride.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/notifyUsersOnMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/processDirectEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/roomTypes.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/sendEmailOnMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/sendNotificationsOnMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/validateEmailDomain.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/index.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/isDocker.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/addUserToDefaultChannels.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/addUserToRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/archiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/checkUsernameAvailability.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/checkEmailAvailability.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/createRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/deleteMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/deleteUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/getFullUserData.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/getRoomByNameOrIdWithOptionToJoin.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/loadMessageHistory.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/removeUserFromRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/saveUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/saveCustomFields.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/saveCustomFieldsWithoutValidation.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/sendMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setUserAvatar.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setUsername.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setRealName.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/unarchiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/updateMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/validateCustomFields.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/Notifications.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/_Base.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Avatars.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Messages.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Reports.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Rooms.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Subscriptions.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Uploads.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Users.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/_BaseCache.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/_BaseDb.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/oauth/oauth.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/oauth/google.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/oauth/proxy.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/statsTracker.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/cache/CacheLoad.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settingsOnLoadCdnPrefix.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settingsOnLoadDirectReply.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settingsOnLoadSMTP.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/oAuthServicesUpdate.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/publications/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/addOAuthService.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/refreshOAuthService.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/addUserToRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/addUsersToRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/archiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/blockUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/checkRegistrationSecretURL.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/checkUsernameAvailability.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/cleanChannelHistory.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/createChannel.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/createToken.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/createPrivateGroup.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/deleteMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/deleteUserOwnAccount.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/filterBadWords.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/filterATAllTag.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/filterATHereTag.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getChannelHistory.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getFullUserData.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getRoomJoinCode.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getRoomRoles.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getServerInfo.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getSingleMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getUserRoles.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/insertOrUpdateUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/joinDefaultChannels.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/joinRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/leaveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/removeOAuthService.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/restartServer.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/robotMethods.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/saveSetting.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/sendInvitationEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/sendMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/sendSMTPTestEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setAdminStatus.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setRealName.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setUsername.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/unarchiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/unblockUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/updateMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/startup/defaultRoomTypes.js"],"names":["EventEmitter","module","watch","require","default","v","RocketChat","models","export","RoomSettingsEnum","UiTextContext","RoomTypeRouteConfig","RoomTypeConfig","NAME","TOPIC","ANNOUNCEMENT","DESCRIPTION","READ_ONLY","REACT_WHEN_READ_ONLY","ARCHIVE_OR_UNARCHIVE","JOIN_CODE","CLOSE_WARNING","HIDE_WARNING","LEAVE_WARNING","NO_ROOMS_SUBSCRIBED","constructor","name","path","length","Error","_name","_path","identifier","Random","id","order","icon","header","label","route","_identifier","_order","_icon","_header","_label","_route","getDisplayName","room","allowRoomSettingChange","canBeCreated","Meteor","isServer","authz","hasAtLeastOnePermission","userId","canBeDeleted","t","_id","supportMembersList","isGroupChat","canAddUser","userDetailShowAll","userDetailShowAdmin","preventRenaming","includeInRoomSearch","enableMembersListProfile","getUiText","ConversationRoomType","condition","user","getUserPreference","DirectMessageRoomRoute","DirectMessageRoomType","action","params","openRoom","username","link","sub","findRoom","query","subscription","ChatSubscription","findOne","rid","ChatRoom","roomName","roomData","fields","fname","settings","get","secondaryRoomName","mergeChannels","getUserStatus","roomId","Subscriptions","Session","usernames","join","setting","context","FavoriteRoomType","PrivateRoomType","PublicRoomType","UnreadRoomType","PrivateRoomRoute","hasAllPermission","PublicRoomRoute","showJoinLink","unread","s","getURL","cdn","full","cdnPrefix","rtrim","trim","pathPrefix","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","basePath","finalPath","ltrim","isCordova","absoluteUrl","_","callbacks","regexCallbacks","ts","Date","callback","onload","Object","keys","forEach","key","value","isRegExp","test","reduce","items","push","set","call","batchSet","save","editor","actions","map","reduceRight","wrap","err","success","load","initialLoad","item","cbKey","cbValue","regex","concat","k","source","showTime","showTotalTime","priority","HIGH","MEDIUM","LOW","add","hook","isNumber","stack","find","cb","remove","hookName","reject","run","constant","totalTime","result","sortBy","time","now","callbackResult","currentTime","statsTracker","timing","split","match","console","log","String","runAsync","defer","fileUploadMediaWhiteList","mediaTypeWhiteList","fileUploadIsValidContentType","type","list","contains","wildCardGlob","wildcards","filter","indexOf","replace","colors","getAvatarColor","getValidRoomName","displayName","slugifiedName","Rooms","findOneByDisplayName","archived","function","channel_name","slugify","nameValidation","RegExp","error","findOneByName","tmpName","next","findOneByNameAndNotId","placeholders","str","data","strLeft","strRightBack","email","password","reason","unsubscribe","promises","p","Promise","resolve","previousPromise","then","RoomTypesCommon","roomTypes","roomTypesOrder","mainOrder","roomConfig","routeConfig","isClient","triggersExit","roomExit","FlowRouter","hasCustomLink","roomType","getRouteLink","subData","routeData","openRouteLink","queryParams","go","slashCommands","commands","command","options","description","permission","clientOnly","methods","slashCommand","method","cmd","msg","Message","parse","language","messageType","MessageTypes","getType","render","template","message","localStorage","getItem","TAPi18n","__","u","html","escapeHTML","messageBox","group","config","actionExists","ret","getById","messageActions","types","registerType","isSystemMessage","system","startup","room_name","user_by","user_added","user_removed","user_left","user_muted","user_unmuted","role","logger","Logger","templateVarHandler","variable","object","templateRegex","exec","tmpVariable","hasOwnProperty","debug","tmplVar","tmplAttrName","attrVal","defaultValue","undefined","preference","preferences","host","ROOT_URL","defaultOptions","rootUrl","hostname","process","env","MOBILE_ROOT_URL","MOBILE_DDP_URL","WebAppInternals","generateBoilerplate","publish","wrapMethods","originalHandler","methodsMap","args","Array","prototype","slice","arguments","apply","originalMeteorMethods","methodMap","each","handler","originalMeteorPublish","func","WebApp","rawConnectHandlers","use","req","res","setHeader","InstanceStatus","bugsnag","register","notify","Info","app","version","info","on","bindEnvironment","originalMeteorDebug","_debug","client","promclient","metrics","messagesSent","Counter","RateLimiter","limitFunction","fn","numRequests","timeInterval","matchers","TEST_MODE","rateLimiter","addRule","matcher","increment","rateLimitResult","check","allowed","Math","ceil","timeToReset","seconds","limitMethod","methodName","DDPRateLimiter","LoggerManager","showPackage","showFileAndLine","logLevel","parseInt","setTimeout","enable","PushNotification","getNotificationId","serverId","hash","i","charCodeAt","send","usersTo","payload","badge","category","title","url","defaultUrl","from","sound","text","notId","gcm","style","summaryText","image","apn","Push","emailDomainDefaultBlackList","IMAPIntercepter","POP3Intercepter","POP3Helper","IMAP","POP3","simpleParser","imap","port","tls","connTimeout","keepalive","delete","state","openInbox","getEmails","end","openBox","start","connect","isActive","stop","Function","once","restart","search","newEmails","f","fetch","bodies","struct","markSeen","seqno","stream","headerBuffer","bodyBuffer","chunk","which","toString","body","headers","parseHeader","to","date","seq","addFlags","processDirectEmail","pop3","enabletls","totalMsgCount","currentMsgCount","login","status","msgcount","retr","quit","msgnumber","mail","initialProcess","dele","messageId","running","setInterval","max","clearInterval","_runLoginHandlers","Accounts","methodInvocation","moment","editedAt","abs","diff","incMsgCountById","lastMessage","setLastMessageById","messageContainsHighlight","highlights","has","some","highlight","regexp","escapeRegExp","toAll","toHere","mentionIds","highlightsIds","Users","findUsersByUsernamesWithHighlights","mentions","mention","userHighlights","unreadCountDM","incUnreadForRoomIdExcludingUserId","incGroupMentionsAndUnreadForRoomIdExcludingUserId","incUserMentionsAndUnreadForRoomIdAndUserIds","compact","unique","unreadCount","incUnread","includes","incMsgCountAndSetLastMessageById","setAlertForRoomIdExcludingUserId","reply","EmailReplyParser","sendMessage","sentByEmail","groupable","tsDiff","findOneByEmailAddress","prevMessage","Messages","findOneById","mid","roomInfo","prevMessageLink","findOneByRoomIdAndUserId","blocked","blocker","muted","alias","inc","parse_reply","roomTypesServer","setPublish","setRoomFind","roomFind","getRoomFind","runPublish","scope","getEmailContent","messageContent","lng","userName","channel","file","fileHeader","content","attachments","attachment","getMessageLink","roomPath","divisorMessage","messageHTML","tokens","token","footer","usersToSendEmail","isMentionAll","maxMembersForNotification","findByRoomId","userIds","findByRoomIdAndUserIdsOrAllMessages","disableNotifications","emailNotifications","mentionedUser","userIdsToSendEmail","defaultLink","linkByUser","findByRoomIdAndUserIds","usersOfMention","getUsersToSendOfflineEmail","emailNotificationMode","userEmailPreferenceIsDisabled","directMessageEmailPreference","emailSubject","emails","verified","address","subject","Email","CATEGORY_MESSAGE","CATEGORY_MESSAGE_NOREPLY","replaceMentionedUsernamesWithFullNames","canSendMessageToRoom","parseMessageText","image_type","notifyDesktopUser","duration","UI_Use_Real_Name","Notifications","notifyUser","sender","notifyAudioUser","getBadgeCount","subscriptions","findUnreadByUserId","sendPushNotifications","userIdsToPushNotify","push_room","push_username","push_message","pushUsernames","enabled","userIdToNotify","callJoin","active","runAsUser","alwaysNotifyDesktopUsers","dontNotifyDesktopUsers","alwaysNotifyMobileUsers","dontNotifyMobileUsers","desktopNotificationDurations","alwaysNotifyAudioUsers","dontNotifyAudioUsers","audioNotificationValues","canBeNotified","desktop","mobile","audio","disableAllMessageNotifications","findNotificationPreferencesByRoom","users","findUsersByIds","audioNotifications","desktopNotifications","mobilePushNotifications","audioNotificationValue","desktopNotificationDuration","userIdsForAudio","userIdsToNotify","alwaysNotifyMobileBoolean","usersWithHighlights","userOfMentionId","userOfMention","statusConnection","curRoom","Sandstorm","desktopMentionIds","union","difference","usersOfDesktopMentions","$in","usersOfMentionItem","pluck","mobileMentionIds","usersOfMobileMentionsQuery","$ne","usersOfMobileMentions","userMobile","audioMentionIds","usersOfAudioMentions","e","without","usersOfMentionId","allUserIdsToNotify","dns","emailDomainBlackList","emailDomainWhiteList","useDefaultBlackList","useDNSDomainCheck","domain","validateEmailDomain","emailValidation","emailDomain","substr","lastIndexOf","wrapAsync","resolveMx","fs","hasDockerEnv","statSync","hasDockerCGroup","readFileSync","isDocker","addUserToDefaultChannels","silenced","defaultRooms","findByDefaultAndTypes","ro","hasPermission","addUsernameById","createWithRoomAndUser","open","alert","userMentions","groupMentions","createUserJoinWithRoomIdAndUser","addUserToRoom","inviter","createUserAddedWithRoomIdAndUser","archiveRoom","archiveById","archiveByRoomId","checkUsernameAvailability","usernameBlackList","every","restrictedUsername","$regex","checkEmailAvailability","createRoom","owner","members","readOnly","extraData","findOneByUsername","slugifiedRoomName","sysMes","assign","createWithTypeNameUserAndUsernames","member","muteUsernameByRoomId","extra","ls","addUserRoles","deleteMessage","keepHistory","showDeletedStatus","deletedMsg","cloneAndSaveAsHistoryById","setHiddenById","Uploads","update","$set","_hidden","removeById","FileUpload","getStore","deleteById","getLastVisibleMessageSentWithNoTypeByRoomId","setAsDeletedByIdAndUser","notifyRoom","deleteUser","removeByUserId","db","findByUserId","removeByRoomId","removeByTypeContainingUsername","removeUsernameFromAll","avatarOrigin","deleteByName","Integrations","disableByUserId","getFullUserData","limit","utcOffset","extend","phone","createdAt","lastLogin","services","requirePasswordChange","requirePasswordChangeReason","roles","customFields","sort","findByUsername","filterReg","findByUsernameNameOrEmailAddress","getRoomByNameOrIdWithOptionToJoin","_getRoomByNameOrIdWithOptionToJoin","currentUserId","nameOrId","tryDirectByUserIdOnly","joinChannel","errorOnEmpty","startsWith","substring","findOneByIdOrName","roomUser","$or","isObject","hideMessagesOfType","index","splice","loadMessageHistory","records","findVisibleByRoomIdBeforeTimestampNotContainingTypes","findVisibleByRoomIdNotContainingTypes","messages","starred","findWhere","unreadNotLoaded","firstUnread","firstMessage","unreadMessages","findVisibleByRoomIdBetweenTimestampsNotContainingTypes","count","removeUserFromRoom","removeUsernameById","removedUser","createUserLeaveWithRoomIdAndUser","createCommandWithRoomIdAndUser","removeByRoomIdAndUserId","saveUser","userData","existingRoles","getRoles","field","escape","input","createUser","joinDefaultChannels","updateUser","sendWelcomeEmail","gravatarUrl","Gravatar","imageUrl","size","secure","setUserAvatar","setUsername","setRealName","shouldSendVerificationEmailToUser","setEmail","setPassword","saveCustomFields","formData","validateCustomFields","saveCustomFieldsWithoutValidation","customFieldsMeta","JSON","setCustomFields","setCustomFieldsDirectMessagesByUserId","fieldName","modifyRecordField","array","$addToSet","upsert","pick","Match","updated_room","parseUrls","urls","sandstormSessionId","insert","blockedSettings","SETTINGS_BLOCKED","settingId","hiddenSettings","SETTINGS_HIDDEN","_sorter","packageValue","valueSource","hidden","sorter","enableQuery","stringify","i18nDefaultQuery","toLowerCase","processEnvValue","meteorSettingsValue","i18nLabel","i18nDescription","updateOperations","$setOnInsert","force","section","$unset","$exists","existantSetting","Settings","addGroup","isFunction","updateById","updateValueAndEditorById","updateValueById","updateOptionsById","clearById","init","observe","added","record","changed","removed","afterInitialLoad","onAfterInitialLoad","dataURI","contentType","service","encoding","setAvatarOrigin","HTTP","npmRequestOptions","response","statusCode","fileData","RocketChatFile","dataURIParse","buffer","Buffer","fileStore","notifyLogged","_setUsername","previousUsername","sendEnrollmentEmail","avatarSuggestions","getAvatarSuggestionForUser","gravatar","avatarData","blob","updateAllUsernamesByUserId","updateUsernameOfEditByUserId","findByMention","updatedMsg","updateUsernameAndMessageOfMentionByIdAndOldUsername","replaceUsername","replaceMutedUsername","replaceUsernameOfUserByUserId","setUserUsernameByUserId","setNameForDirectRoomsWithOldName","model","updateFileNameById","_setRealName","setName","_setEmail","shouldSendVerificationEmail","unarchiveRoom","unarchiveById","unarchiveByRoomId","updateMessage","editedBy","tempid","fieldValue","required","maxLength","minLength","streamAll","Streamer","streamLogged","streamRoom","streamRoomUsers","streamUser","allowWrite","eventName","findByRoomIdAndNotUserId","allowRead","warn","notifyAll","unshift","emit","notifyAllInThisInstance","emitWithoutBroadcast","notifyLoggedInThisInstance","notifyRoomInThisInstance","notifyUserInThisInstance","typing","ModelsBaseDb","ModelsBaseCache","_CacheControl","EnvironmentVariable","ModelsBase","nameOrModel","useCache","_db","collectionName","_useCache","cache","bind","getDynamicView","processQueryOptionsOnResult","origin","arrayToCursor","setUpdatedAt","findOneByIds","ids","insertOrUpsert","allow","deny","ensureIndex","dropIndex","tryEnsureIndex","tryDropIndex","trashFind","trashFindDeletedAfter","_Base","Avatars","before","doc","instanceId","insertAvatarFileInit","store","complete","uploading","progress","extension","uploadedAt","updateFileComplete","fileId","direct","updateFileCompleteByNameAndUserId","deleteFile","sparse","expireAfterSeconds","findVisibleByMentionAndRoomId","findVisibleByRoomId","$nin","findInvisibleByRoomId","findVisibleByRoomIdAfterTimestamp","timestamp","$gt","findForUpdates","_updatedAt","findVisibleByRoomIdBeforeTimestamp","$lt","findVisibleByRoomIdBeforeTimestampInclusive","$lte","findVisibleByRoomIdBetweenTimestamps","afterTimestamp","beforeTimestamp","findVisibleByRoomIdBetweenTimestampsInclusive","$gte","findVisibleCreatedOrEditedAfterTimestamp","findStarredByUserAtRoom","findPinnedByRoom","pinned","findSnippetedByRoom","snippeted","getLastTimestamp","findByRoomIdAndMessageIds","messageIds","findOneBySlackBotIdAndSlackTs","slackBotId","slackTs","findOneBySlackTs","me","parent","reactions","setPinnedByIdAndUserId","pinnedBy","pinnedAt","setSnippetedByIdAndUserId","snippetName","snippetedBy","snippetedAt","setUrlsById","multi","oldUsername","newUsername","newMessage","updateUserStarById","$pull","upgradeEtsToEditAt","ets","$rename","setMessageAttachments","setSlackBotIdAndSlackTs","createWithTypeRoomIdMessageAndUser","createUserRemovedWithRoomIdAndUser","createUserMutedWithRoomIdAndUser","createUserUnmutedWithRoomIdAndUser","createNewModeratorWithRoomIdAndUser","createModeratorRemovedWithRoomIdAndUser","createNewOwnerWithRoomIdAndUser","createOwnerRemovedWithRoomIdAndUser","createNewLeaderWithRoomIdAndUser","createLeaderRemovedWithRoomIdAndUser","createSubscriptionRoleAddedWithRoomIdAndUser","createSubscriptionRoleRemovedWithRoomIdAndUser","getMessageByFileId","fileID","setAsRead","until","setAsReadById","findUnreadMessagesByRoomAndDate","after","Reports","createWithMessageDescriptionAndUserId","ModelRooms","ignoreUpdatedFields","_idOrName","findOneByImportId","importIds","findOneByNameAndType","findOneByIdContainingUsername","findOneByNameAndTypeNotContainingUsername","findById","findByIds","roomIds","findByType","findByTypes","findBySubscriptionUserId","_room","findBySubscriptionUserIdUpdatedAfter","findByNameContaining","nameRegex","findByNameContainingTypesWithUsername","obj","findContainingTypesWithUsername","findByNameContainingAndTypes","findByNameAndType","findByNameAndTypeNotDefault","findByNameAndTypesNotContainingUsername","findByNameStartingAndTypes","findByTypeContainingUsername","findByTypeContainingUsernames","$all","findByTypesAndNotUserIdContainingUsername","uid","findByContainingUsername","findByTypeAndName","findByIndex","findByTypeAndNameContainingUsername","findByTypeAndArchivationState","archivationstate","addImportIds","$each","addUsernamesById","addUsernameByName","removeUsernamesById","removeUsernameByName","setNameById","$inc","msgs","lastMessageTimestamp","lm","setJoinCodeById","joinCode","joinCodeRequired","setUserById","setTypeById","setTopicById","topic","setAnnouncementById","announcement","unmuteUsernameByRoomId","saveDefaultById","setTopicAndTagsById","tags","setData","unsetData","isEmpty","tag","createWithIdTypeAndName","ModelSettings","findOneNotHiddenById","findByRole","findPublic","public","findNotHiddenPublic","findNotHiddenPublicUpdatedAfter","updatedAt","findNotHiddenPrivate","findNotHidden","findNotHiddenUpdatedAfter","updateValueNotHiddenById","createWithIdAndValue","_createdAt","ModelSubscriptions","findOneByRoomNameAndUserId","findByUserIdUpdatedAfter","findByRoomIdAndRoles","findByTypeAndUserId","findByTypeNameAndUserId","getLastSeen","getMinimumLastSeenByRoomId","hideByRoomIdAndUserId","openByRoomIdAndUserId","setAsReadByRoomIdAndUserId","setAsUnreadByRoomIdAndUserId","firstMessageUnreadTimestamp","values","setFavoriteByRoomIdAndUserId","favorite","updateNameAndAlertByRoomId","updateNameByRoomId","oldName","incGroup","incUser","setBlockedByRoomId","query2","update2","unsetBlockedByRoomId","updateTypeByRoomId","addRoleById","removeRoleById","setArchivedByUsername","findNotHiddenFilesOfRoom","fileQuery","fileOptions","insertFileInit","ModelUsers","emailAddress","findOneAdmin","admin","findOneByIdAndLoginToken","_hashLoginToken","findUsersNotOffline","findActiveByUsernameOrNameRegexWithExceptions","searchTerm","exceptions","isArray","termRegex","$and","findByActiveUsersExcept","orStmt","acc","el","findUsersByNameOrUsername","nameOrUsername","usernameNameOrEmailAddress","findLDAPUsers","ldap","findCrowdUsers","crowd","getLastLogin","findUsersByUsernames","updateLastLoginById","setServiceId","serviceName","serviceId","serviceIdKey","setEmailVerified","$elemMatch","unsetAvatarOrigin","setCurrentRoom","setUserActive","setAllUsersActive","unsetLoginTokens","unsetRequirePasswordChange","resetPasswordAndSetRequirePasswordChange","setLanguage","setProfile","profile","clearSettings","setPreferences","setUtcOffset","saveUserById","phoneNumber","create","usersIds","loki","objectPath","lokiEq","LokiOps","$eq","lokiNe","a","b","lokiIn","subA","subB","ignore","traceMethodCalls","target","_stats","property","calls","avg","origMethod","loaded","startTime","round","_getStatsAvg","stats","Adapter","loadDatabase","saveDatabase","deleteDatabase","adapter","indexes","joins","collection","addCollection","hasOne","hasMany","processRemoteJoinInserted","remote","processRemoteJoinRemoved","localRecord","processLocalJoinInserted","local","localRecords","_findByIndex","where","mutableRecord","transform","addToAllIndexes","indexName","addToIndex","removeFromAllIndexes","removeFromIndex","startSync","updateDiffById","r","direction","valueA","valueB","skip","fieldsToRemove","fieldsToGet","pickFields","picked","omit","processQuery","parentField","and","subValue","observeChanges","_publishCursor","cursor","addDynamicView","updatedFields","updateRecord","topLevelFields","del","$min","curValue","$max","$mul","$pullAll","$pop","shift","pop","valueItem","removeWhere","exportDefault","baseName","trash","Mongo","Collection","_ensureIndex","_deletedAt","isOplogAvailable","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","isOplogEnabled","baseModel","wrapModel","event","processOplogRecord","_defineTooFarBehind","Number","MAX_SAFE_INTEGER","originals","self","defineSyncStrategy","modifier","cacheAllowedModifiers","notAllowedModifiers","placeholderFields","updateHasPositionalOperator","op","o","oplog","listenerCount","strategy","findOptions","insertedId","_returnObject","__collection__","_dropIndex","deletedAt","AccessTokenServices","registerAccessTokenService","handleAccessTokenRequest","registerLoginHandler","accessToken","ObjectIncluding","ServiceConfiguration","configurations","ConfigError","oauth","serviceNames","LoginCancelledError","numericError","oauthResult","updateOrCreateUserFromExternalService","serviceData","getIdentity","access_token","getScopes","idToken","expiresIn","Integer","Maybe","identity","expiresAt","scopes","Google","whitelistedFields","refreshToken","OAuth","_redirectUri","proxy","StatsD","StatsTracker","dogstatsd","track","hrtime","decrement","histogram","gauge","arr","applyFind","$size","testWebAppInternals","isString","setBundledJsCssPrefix","startEmailIntercepter","debounce","buildMailURL","MAIL_URL","encodeURIComponent","oauth_updated","_OAuthServicesUpdate","clientId","secret","custom","serverURL","tokenPath","identityPath","authorizePath","buttonLabelText","buttonLabelColor","loginStyle","buttonColor","tokenSentVia","identityTokenSentVia","usernameField","mergeUsers","CustomOAuth","appId","consumerKey","OAuthServicesUpdate","OAuthServicesRemove","DEPLOYMENT_ID","readonly","actionText","code","multiline","placeholder","unblock","addOAuthService","capitalize","persistent","refreshOAuthService","addUsersToRoom","userInRoom","newUser","blockUser","subscription2","checkRegistrationSecretURL","cleanChannelHistory","latest","oldest","inclusive","Boolean","createChannel","Optional","createToken","_generateStampedLoginToken","_insertLoginToken","authToken","createPrivateGroup","tokenpass","balance","originalMessage","forceDelete","deleteAllowed","deleteOwn","blockDeleteInMinutes","msgTs","currentTsDiff","deleteUserOwnAccount","bcrypt","_checkPassword","digest","algorithm","Filter","badWordsList","clean","getChannelHistory","unreads","fromUserId","isUndefined","isDate","firstMsg","getRoomJoinCode","getRoomRoles","Roles","getServerInfo","getSingleMessage","msgId","getUserRoles","roleIds","findUsersInRoles","intersection","insertOrUpdateUser","joinRoom","balances","updateUserTokenpassBalances","Tokenpass","validateAccess","leaveRoom","hasRole","numOwners","getUsersInRole","removeOAuthService","restart_server","abort","exit","m","saveSetting","OneOf","sendInvitationEmail","rfcMailPattern","validEmails","message_ts","server_ts","getTime","sandstorm","connection","sendSMTPTestEmail","setAdminStatus","param","joinDefaultChannelsSilenced","unblockUser","editAllowed","editOwn","blockEditInMinutes"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAIA,YAAJ;AAAiBC,OAAOC,KAAP,CAAaC,QAAQ,sBAAR,CAAb,EAA6C;AAACC,UAAQC,CAAR,EAAU;AAACL,mBAAaK,CAAb;AAAe;;AAA3B,CAA7C,EAA0E,CAA1E;AACjBC,aAAa,IAAIN,YAAJ,EAAb;AACA;;;;;AAIAM,WAAWC,MAAX,GAAoB,EAApB,C;;;;;;;;;;;ACNAN,OAAOO,MAAP,CAAc;AAACC,oBAAiB,MAAIA,gBAAtB;AAAuCC,iBAAc,MAAIA,aAAzD;AAAuEC,uBAAoB,MAAIA,mBAA/F;AAAmHC,kBAAe,MAAIA;AAAtI,CAAd;AAAO,MAAMH,mBAAmB;AAC/BI,QAAM,UADyB;AAE/BC,SAAO,WAFwB;AAG/BC,gBAAc,kBAHiB;AAI/BC,eAAa,iBAJkB;AAK/BC,aAAW,UALoB;AAM/BC,wBAAsB,mBANS;AAO/BC,wBAAsB,oBAPS;AAQ/BC,aAAW;AARoB,CAAzB;AAWA,MAAMV,gBAAgB;AAC5BW,iBAAe,cADa;AAE5BC,gBAAc,aAFc;AAG5BC,iBAAe,cAHa;AAI5BC,uBAAqB;AAJO,CAAtB;;AAOA,MAAMb,mBAAN,CAA0B;AAChCc,cAAY;AAAEC,QAAF;AAAQC;AAAR,GAAZ,EAA4B;AAC3B,QAAI,OAAOD,IAAP,KAAgB,WAAhB,KAAgC,OAAOA,IAAP,KAAgB,QAAhB,IAA4BA,KAAKE,MAAL,KAAgB,CAA5E,CAAJ,EAAoF;AACnF,YAAM,IAAIC,KAAJ,CAAU,4BAAV,CAAN;AACA;;AAED,QAAI,OAAOF,IAAP,KAAgB,WAAhB,KAAgC,OAAOA,IAAP,KAAgB,QAAhB,IAA4BA,KAAKC,MAAL,KAAgB,CAA5E,CAAJ,EAAoF;AACnF,YAAM,IAAIC,KAAJ,CAAU,4BAAV,CAAN;AACA;;AAED,SAAKC,KAAL,GAAaJ,IAAb;AACA,SAAKK,KAAL,GAAaJ,IAAb;AACA;;AAED,MAAID,IAAJ,GAAW;AACV,WAAO,KAAKI,KAAZ;AACA;;AAED,MAAIH,IAAJ,GAAW;AACV,WAAO,KAAKI,KAAZ;AACA;;AApB+B;;AAuB1B,MAAMnB,cAAN,CAAqB;AAC3Ba,cAAY;AACXO,iBAAaC,OAAOC,EAAP,EADF;AAEXC,SAFW;AAGXC,QAHW;AAIXC,UAJW;AAKXC,SALW;AAMXC;AANW,GAAZ,EAOG;AACF,QAAI,OAAOP,UAAP,KAAsB,QAAtB,IAAkCA,WAAWJ,MAAX,KAAsB,CAA5D,EAA+D;AAC9D,YAAM,IAAIC,KAAJ,CAAU,kCAAV,CAAN;AACA;;AAED,QAAI,OAAOM,KAAP,KAAiB,QAArB,EAA+B;AAC9B,YAAM,IAAIN,KAAJ,CAAU,6BAAV,CAAN;AACA;;AAED,QAAI,OAAOO,IAAP,KAAgB,WAAhB,KAAgC,OAAOA,IAAP,KAAgB,QAAhB,IAA4BA,KAAKR,MAAL,KAAgB,CAA5E,CAAJ,EAAoF;AACnF,YAAM,IAAIC,KAAJ,CAAU,4BAAV,CAAN;AACA;;AAED,QAAI,OAAOQ,MAAP,KAAkB,WAAlB,KAAkC,OAAOA,MAAP,KAAkB,QAAlB,IAA8BA,OAAOT,MAAP,KAAkB,CAAlF,CAAJ,EAA0F;AACzF,YAAM,IAAIC,KAAJ,CAAU,8BAAV,CAAN;AACA;;AAED,QAAI,OAAOS,KAAP,KAAiB,WAAjB,KAAiC,OAAOA,KAAP,KAAiB,QAAjB,IAA6BA,MAAMV,MAAN,KAAiB,CAA/E,CAAJ,EAAuF;AACtF,YAAM,IAAIC,KAAJ,CAAU,6BAAV,CAAN;AACA;;AAED,QAAI,OAAOU,KAAP,KAAiB,WAAjB,IAAgC,EAAEA,iBAAiB5B,mBAAnB,CAApC,EAA6E;AAC5E,YAAM,IAAIkB,KAAJ,CAAU,iGAAV,CAAN;AACA;;AAED,SAAKW,WAAL,GAAmBR,UAAnB;AACA,SAAKS,MAAL,GAAcN,KAAd;AACA,SAAKO,KAAL,GAAaN,IAAb;AACA,SAAKO,OAAL,GAAeN,MAAf;AACA,SAAKO,MAAL,GAAcN,KAAd;AACA,SAAKO,MAAL,GAAcN,KAAd;AACA;AAED;;;;;AAGA,MAAIP,UAAJ,GAAiB;AAChB,WAAO,KAAKQ,WAAZ;AACA;AAED;;;;;AAGA,MAAIL,KAAJ,GAAY;AACX,WAAO,KAAKM,MAAZ;AACA;AAED;;;;;;;AAKA,MAAIN,KAAJ,CAAUA,KAAV,EAAiB;AAChB,QAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC9B,YAAM,IAAIN,KAAJ,CAAU,6BAAV,CAAN;AACA;;AAED,SAAKY,MAAL,GAAcN,KAAd;AACA;AAED;;;;;AAGA,MAAIC,IAAJ,GAAW;AACV,WAAO,KAAKM,KAAZ;AACA;AAED;;;;;AAGA,MAAIL,MAAJ,GAAa;AACZ,WAAO,KAAKM,OAAZ;AACA;AAED;;;;;AAGA,MAAIL,KAAJ,GAAY;AACX,WAAO,KAAKM,MAAZ;AACA;AAED;;;;;AAGA,MAAIL,KAAJ,GAAY;AACX,WAAO,KAAKM,MAAZ;AACA;AAED;;;;;;;AAKAC,iBAAeC,IAAf,EAAqB;AACpB,WAAOA,KAAKrB,IAAZ;AACA;;AAEDsB;AAAuB;AAAqB;AAC3C,WAAO,IAAP;AACA;;AAEDC,iBAAe;AACd,WAAOC,OAAOC,QAAP,GACN7C,WAAW8C,KAAX,CAAiBC,uBAAjB,CAAyCH,OAAOI,MAAP,EAAzC,EAA0D,CAAE,UAAU,KAAKd,WAAa,EAA9B,CAA1D,CADM,GAENlC,WAAW8C,KAAX,CAAiBC,uBAAjB,CAAyC,CAAE,UAAU,KAAKb,WAAa,EAA9B,CAAzC,CAFD;AAGA;;AAEDe,eAAaR,IAAb,EAAmB;AAClB,WAAOG,OAAOC,QAAP,GACN7C,WAAW8C,KAAX,CAAiBC,uBAAjB,CAAyCH,OAAOI,MAAP,EAAzC,EAA0D,CAAE,UAAUP,KAAKS,CAAG,EAApB,CAA1D,EAAkFT,KAAKU,GAAvF,CADM,GAENnD,WAAW8C,KAAX,CAAiBC,uBAAjB,CAAyC,CAAE,UAAUN,KAAKS,CAAG,EAApB,CAAzC,EAAiET,KAAKU,GAAtE,CAFD;AAGA;;AAEDC;AAAmB;AAAY;AAC9B,WAAO,IAAP;AACA;;AAEDC,gBAAc;AACb,WAAO,KAAP;AACA;;AAEDC;AAAW;AAAoB;AAC9B,WAAO,KAAP;AACA;;AAEDC;AAAkB;AAAY;AAC7B,WAAO,IAAP;AACA;;AAEDC;AAAoB;AAAY;AAC/B,WAAO,IAAP;AACA;;AAEDC;AAAgB;AAAY;AAC3B,WAAO,KAAP;AACA;;AAEDC,wBAAsB;AACrB,WAAO,KAAP;AACA;;AAEDC,6BAA2B;AAC1B,WAAO,KAAP;AACA;AAED;;;;;;;;AAMAC;AAAU;AAAe;AACxB,WAAO,EAAP;AACA;;AAjK0B,C;;;;;;;;;;;ACzC5BjE,OAAOO,MAAP,CAAc;AAAC2D,wBAAqB,MAAIA;AAA1B,CAAd;AAA+D,IAAIvD,cAAJ;AAAmBX,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACS,iBAAeP,CAAf,EAAiB;AAACO,qBAAeP,CAAf;AAAiB;;AAApC,CAA1C,EAAgF,CAAhF;;AAE3E,MAAM8D,oBAAN,SAAmCvD,cAAnC,CAAkD;AACxDa,gBAAc;AACb,UAAM;AACLO,kBAAY,QADP;AAELG,aAAO,EAFF;AAGLG,aAAO;AAHF,KAAN;AAKA;;AAED8B,cAAY;AACX,UAAMC,OAAOnB,OAAOmB,IAAP,EAAb;AACA,WAAO/D,WAAWgE,iBAAX,CAA6BD,IAA7B,EAAmC,eAAnC,CAAP;AACA;;AAZuD,C;;;;;;;;;;;ACFzDpE,OAAOO,MAAP,CAAc;AAAC+D,0BAAuB,MAAIA,sBAA5B;AAAmDC,yBAAsB,MAAIA;AAA7E,CAAd;AAAmH,IAAI5D,cAAJ,EAAmBD,mBAAnB,EAAuCF,gBAAvC,EAAwDC,aAAxD;AAAsET,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACS,iBAAeP,CAAf,EAAiB;AAACO,qBAAeP,CAAf;AAAiB,GAApC;;AAAqCM,sBAAoBN,CAApB,EAAsB;AAACM,0BAAoBN,CAApB;AAAsB,GAAlF;;AAAmFI,mBAAiBJ,CAAjB,EAAmB;AAACI,uBAAiBJ,CAAjB;AAAmB,GAA1H;;AAA2HK,gBAAcL,CAAd,EAAgB;AAACK,oBAAcL,CAAd;AAAgB;;AAA5J,CAA1C,EAAwM,CAAxM;;AAGlL,MAAMkE,sBAAN,SAAqC5D,mBAArC,CAAyD;AAC/Dc,gBAAc;AACb,UAAM;AACLC,YAAM,QADD;AAELC,YAAM;AAFD,KAAN;AAIA;;AAED8C,SAAOC,MAAP,EAAe;AACd,WAAOC,SAAS,GAAT,EAAcD,OAAOE,QAArB,CAAP;AACA;;AAEDC,OAAKC,GAAL,EAAU;AACT,WAAO;AAACF,gBAAUE,IAAIpD;AAAf,KAAP;AACA;;AAd8D;;AAiBzD,MAAM8C,qBAAN,SAAoC5D,cAApC,CAAmD;AACzDa,gBAAc;AACb,UAAM;AACLO,kBAAY,GADP;AAELG,aAAO,EAFF;AAGLG,aAAO,iBAHF;AAILC,aAAO,IAAIgC,sBAAJ;AAJF,KAAN;AAMA;;AAEDQ,WAAS/C,UAAT,EAAqB;AACpB,UAAMgD,QAAQ;AACbxB,SAAG,GADU;AAEb9B,YAAMM;AAFO,KAAd;AAKA,UAAMiD,eAAeC,iBAAiBC,OAAjB,CAAyBH,KAAzB,CAArB;;AACA,QAAIC,gBAAgBA,aAAaG,GAAjC,EAAsC;AACrC,aAAOC,SAASF,OAAT,CAAiBF,aAAaG,GAA9B,CAAP;AACA;AACD;;AAEDE,WAASC,QAAT,EAAmB;AAClB,UAAMN,eAAeC,iBAAiBC,OAAjB,CAAyB;AAACC,WAAKG,SAAS9B;AAAf,KAAzB,EAA8C;AAAC+B,cAAQ;AAAC9D,cAAM,CAAP;AAAU+D,eAAO;AAAjB;AAAT,KAA9C,CAArB;;AACA,QAAI,CAACR,YAAL,EAAmB;AAClB,aAAO,EAAP;AACA;;AAED,QAAI3E,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,KAA+CV,aAAaQ,KAAhE,EAAuE;AACtE,aAAOR,aAAaQ,KAApB;AACA;;AAED,WAAOR,aAAavD,IAApB;AACA;;AAEDkE,oBAAkBL,QAAlB,EAA4B;AAC3B,QAAIjF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,CAAJ,EAAiD;AAChD,YAAMV,eAAeC,iBAAiBC,OAAjB,CAAyB;AAACC,aAAKG,SAAS9B;AAAf,OAAzB,EAA8C;AAAC+B,gBAAQ;AAAC9D,gBAAM;AAAP;AAAT,OAA9C,CAArB;AACA,aAAOuD,gBAAgBA,aAAavD,IAApC;AACA;AACD;;AAED0C,cAAY;AACX,UAAMC,OAAOnB,OAAOmB,IAAP,EAAb;AACA,UAAMwB,gBAAgBvF,WAAWgE,iBAAX,CAA6BD,IAA7B,EAAmC,eAAnC,CAAtB;AACA,WAAO,CAACwB,aAAD,IAAkBvF,WAAW8C,KAAX,CAAiBC,uBAAjB,CAAyC,CAAC,aAAD,EAAgB,kBAAhB,CAAzC,CAAzB;AACA;;AAEDyC,gBAAcC,MAAd,EAAsB;AACrB,UAAMd,eAAe3E,WAAWC,MAAX,CAAkByF,aAAlB,CAAgCb,OAAhC,CAAwC;AAACC,WAAKW;AAAN,KAAxC,CAArB;;AACA,QAAId,gBAAgB,IAApB,EAA0B;AACzB;AACA;;AAED,WAAOgB,QAAQN,GAAR,CAAa,QAAQV,aAAavD,IAAM,SAAxC,CAAP;AACA;;AAEDoB,iBAAeC,IAAf,EAAqB;AACpB,WAAOA,KAAKmD,SAAL,CAAeC,IAAf,CAAoB,KAApB,CAAP;AACA;;AAEDnD,yBAAuBD,IAAvB,EAA6BqD,OAA7B,EAAsC;AACrC,YAAQA,OAAR;AACC,WAAK3F,iBAAiBI,IAAtB;AACA,WAAKJ,iBAAiBO,WAAtB;AACA,WAAKP,iBAAiBQ,SAAtB;AACA,WAAKR,iBAAiBS,oBAAtB;AACA,WAAKT,iBAAiBU,oBAAtB;AACA,WAAKV,iBAAiBW,SAAtB;AACC,eAAO,KAAP;;AACD;AACC,eAAO,IAAP;AATF;AAWA;;AAED6C,6BAA2B;AAC1B,WAAO,IAAP;AACA;;AAEDJ;AAAkB;AAAY;AAC7B,WAAO,KAAP;AACA;;AAEDK,YAAUmC,OAAV,EAAmB;AAClB,YAAQA,OAAR;AACC,WAAK3F,cAAcY,YAAnB;AACC,eAAO,sBAAP;;AACD,WAAKZ,cAAca,aAAnB;AACC,eAAO,uBAAP;;AACD;AACC,eAAO,EAAP;AANF;AAQA;;AA5FwD,C;;;;;;;;;;;ACpB1DtB,OAAOO,MAAP,CAAc;AAAC8F,oBAAiB,MAAIA;AAAtB,CAAd;AAAuD,IAAI1F,cAAJ;AAAmBX,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACS,iBAAeP,CAAf,EAAiB;AAACO,qBAAeP,CAAf;AAAiB;;AAApC,CAA1C,EAAgF,CAAhF;;AAEnE,MAAMiG,gBAAN,SAA+B1F,cAA/B,CAA8C;AACpDa,gBAAc;AACb,UAAM;AACLO,kBAAY,GADP;AAELG,aAAO,EAFF;AAGLE,cAAQ,UAHH;AAILD,YAAM,MAJD;AAKLE,aAAO;AALF,KAAN;AAOA;;AACD8B,cAAY;AACX,UAAMC,OAAOnB,OAAOmB,IAAP,EAAb;AACA,WAAO/D,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,gBAAxB,KAA6CrF,WAAWgE,iBAAX,CAA6BD,IAA7B,EAAmC,sBAAnC,CAApD;AACA;;AAbmD,C;;;;;;;;;;;ACFrDpE,OAAOO,MAAP,CAAc;AAAC2D,wBAAqB,MAAIA,oBAA1B;AAA+CK,yBAAsB,MAAIA,qBAAzE;AAA+F8B,oBAAiB,MAAIA,gBAApH;AAAqIC,mBAAgB,MAAIA,eAAzJ;AAAyKC,kBAAe,MAAIA,cAA5L;AAA2MC,kBAAe,MAAIA;AAA9N,CAAd;AAA6P,IAAItC,oBAAJ;AAAyBlE,OAAOC,KAAP,CAAaC,QAAQ,gBAAR,CAAb,EAAuC;AAACgE,uBAAqB9D,CAArB,EAAuB;AAAC8D,2BAAqB9D,CAArB;AAAuB;;AAAhD,CAAvC,EAAyF,CAAzF;AAA4F,IAAImE,qBAAJ;AAA0BvE,OAAOC,KAAP,CAAaC,QAAQ,UAAR,CAAb,EAAiC;AAACqE,wBAAsBnE,CAAtB,EAAwB;AAACmE,4BAAsBnE,CAAtB;AAAwB;;AAAlD,CAAjC,EAAqF,CAArF;AAAwF,IAAIiG,gBAAJ;AAAqBrG,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACmG,mBAAiBjG,CAAjB,EAAmB;AAACiG,uBAAiBjG,CAAjB;AAAmB;;AAAxC,CAAnC,EAA6E,CAA7E;AAAgF,IAAIkG,eAAJ;AAAoBtG,OAAOC,KAAP,CAAaC,QAAQ,WAAR,CAAb,EAAkC;AAACoG,kBAAgBlG,CAAhB,EAAkB;AAACkG,sBAAgBlG,CAAhB;AAAkB;;AAAtC,CAAlC,EAA0E,CAA1E;AAA6E,IAAImG,cAAJ;AAAmBvG,OAAOC,KAAP,CAAaC,QAAQ,UAAR,CAAb,EAAiC;AAACqG,iBAAenG,CAAf,EAAiB;AAACmG,qBAAenG,CAAf;AAAiB;;AAApC,CAAjC,EAAuE,CAAvE;AAA0E,IAAIoG,cAAJ;AAAmBxG,OAAOC,KAAP,CAAaC,QAAQ,UAAR,CAAb,EAAiC;AAACsG,iBAAepG,CAAf,EAAiB;AAACoG,qBAAepG,CAAf;AAAiB;;AAApC,CAAjC,EAAuE,CAAvE,E;;;;;;;;;;;ACA1xBJ,OAAOO,MAAP,CAAc;AAACkG,oBAAiB,MAAIA,gBAAtB;AAAuCH,mBAAgB,MAAIA;AAA3D,CAAd;AAA2F,IAAI9F,gBAAJ,EAAqBG,cAArB,EAAoCD,mBAApC,EAAwDD,aAAxD;AAAsET,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACM,mBAAiBJ,CAAjB,EAAmB;AAACI,uBAAiBJ,CAAjB;AAAmB,GAAxC;;AAAyCO,iBAAeP,CAAf,EAAiB;AAACO,qBAAeP,CAAf;AAAiB,GAA5E;;AAA6EM,sBAAoBN,CAApB,EAAsB;AAACM,0BAAoBN,CAApB;AAAsB,GAA1H;;AAA2HK,gBAAcL,CAAd,EAAgB;AAACK,oBAAcL,CAAd;AAAgB;;AAA5J,CAA1C,EAAwM,CAAxM;;AAG1J,MAAMqG,gBAAN,SAA+B/F,mBAA/B,CAAmD;AACzDc,gBAAc;AACb,UAAM;AACLC,YAAM,OADD;AAELC,YAAM;AAFD,KAAN;AAIA;;AAED8C,SAAOC,MAAP,EAAe;AACd,WAAOC,SAAS,GAAT,EAAcD,OAAOhD,IAArB,CAAP;AACA;;AAVwD;;AAanD,MAAM6E,eAAN,SAA8B3F,cAA9B,CAA6C;AACnDa,gBAAc;AACb,UAAM;AACLO,kBAAY,GADP;AAELG,aAAO,EAFF;AAGLC,YAAM,MAHD;AAILE,aAAO,gBAJF;AAKLC,aAAO,IAAImE,gBAAJ;AALF,KAAN;AAOA;;AAED3B,WAAS/C,UAAT,EAAqB;AACpB,UAAMgD,QAAQ;AACbxB,SAAG,GADU;AAEb9B,YAAMM;AAFO,KAAd;AAKA,WAAOqD,SAASF,OAAT,CAAiBH,KAAjB,CAAP;AACA;;AAEDM,WAASC,QAAT,EAAmB;AAClB,QAAIjF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wCAAxB,CAAJ,EAAuE;AACtE,aAAOJ,SAASE,KAAT,IAAkBF,SAAS7D,IAAlC;AACA;;AAED,WAAO6D,SAAS7D,IAAhB;AACA;;AAED0C,cAAY;AACX,UAAMC,OAAOnB,OAAOmB,IAAP,EAAb;AACA,UAAMwB,gBAAgBvF,WAAWgE,iBAAX,CAA6BD,IAA7B,EAAmC,eAAnC,CAAtB;AACA,WAAO,CAACwB,aAAD,IAAkBvF,WAAW8C,KAAX,CAAiBuD,gBAAjB,CAAkC,aAAlC,CAAzB;AACA;;AAEDhD,gBAAc;AACb,WAAO,IAAP;AACA;;AAEDC,aAAWb,IAAX,EAAiB;AAChB,WAAOzC,WAAW8C,KAAX,CAAiBC,uBAAjB,CAAyC,CAAC,wBAAD,EAA2B,yBAA3B,CAAzC,EAAgGN,KAAKU,GAArG,CAAP;AACA;;AAEDT,yBAAuBD,IAAvB,EAA6BqD,OAA7B,EAAsC;AACrC,YAAQA,OAAR;AACC,WAAK3F,iBAAiBW,SAAtB;AACC,eAAO,KAAP;;AACD;AACC,eAAO,IAAP;AAJF;AAMA;;AAED6C,6BAA2B;AAC1B,WAAO,IAAP;AACA;;AAEDC,YAAUmC,OAAV,EAAmB;AAClB,YAAQA,OAAR;AACC,WAAK3F,cAAcY,YAAnB;AACC,eAAO,oBAAP;;AACD,WAAKZ,cAAca,aAAnB;AACC,eAAO,qBAAP;;AACD;AACC,eAAO,EAAP;AANF;AAQA;;AAhEkD,C;;;;;;;;;;;AChBpDtB,OAAOO,MAAP,CAAc;AAACoG,mBAAgB,MAAIA,eAArB;AAAqCJ,kBAAe,MAAIA;AAAxD,CAAd;AAAuF,IAAI5F,cAAJ,EAAmBD,mBAAnB,EAAuCD,aAAvC;AAAqDT,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACS,iBAAeP,CAAf,EAAiB;AAACO,qBAAeP,CAAf;AAAiB,GAApC;;AAAqCM,sBAAoBN,CAApB,EAAsB;AAACM,0BAAoBN,CAApB;AAAsB,GAAlF;;AAAmFK,gBAAcL,CAAd,EAAgB;AAACK,oBAAcL,CAAd;AAAgB;;AAApH,CAA1C,EAAgK,CAAhK;;AAGrI,MAAMuG,eAAN,SAA8BjG,mBAA9B,CAAkD;AACxDc,gBAAc;AACb,UAAM;AACLC,YAAM,SADD;AAELC,YAAM;AAFD,KAAN;AAIA;;AAED8C,SAAOC,MAAP,EAAe;AACd,WAAOC,SAAS,GAAT,EAAcD,OAAOhD,IAArB,CAAP;AACA;;AAVuD;;AAalD,MAAM8E,cAAN,SAA6B5F,cAA7B,CAA4C;AAClDa,gBAAc;AACb,UAAM;AACLO,kBAAY,GADP;AAELG,aAAO,EAFF;AAGLC,YAAM,SAHD;AAILE,aAAO,UAJF;AAKLC,aAAO,IAAIqE,eAAJ;AALF,KAAN;AAOA;;AAED7B,WAAS/C,UAAT,EAAqB;AACpB,UAAMgD,QAAQ;AACbxB,SAAG,GADU;AAEb9B,YAAMM;AAFO,KAAd;AAIA,WAAOqD,SAASF,OAAT,CAAiBH,KAAjB,CAAP;AACA;;AAEDM,WAASC,QAAT,EAAmB;AAClB,QAAIjF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wCAAxB,CAAJ,EAAuE;AACtE,aAAOJ,SAASE,KAAT,IAAkBF,SAAS7D,IAAlC;AACA;;AACD,WAAO6D,SAAS7D,IAAhB;AACA;;AAED0C,cAAY;AACX,UAAMC,OAAOnB,OAAOmB,IAAP,EAAb,CADW,CAEX;;AACA,UAAMwB,gBAAgBvF,WAAWgE,iBAAX,CAA6BD,IAA7B,EAAmC,eAAnC,CAAtB;AACA,WAAO,CAACwB,aAAD,KAAmBvF,WAAW8C,KAAX,CAAiBC,uBAAjB,CAAyC,CAAC,aAAD,EAAgB,kBAAhB,CAAzC,KAAiF/C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,6BAAxB,MAA2D,IAA/J,CAAP;AACA;;AAEDkB,eAAad,MAAb,EAAqB;AACpB,WAAO,CAAC,CAACV,SAASF,OAAT,CAAiB;AAAC1B,WAAKsC,MAAN;AAAcvC,SAAG;AAAjB,KAAjB,CAAT;AACA;;AAEDQ,wBAAsB;AACrB,WAAO,IAAP;AACA;;AAEDL,gBAAc;AACb,WAAO,IAAP;AACA;;AAEDC,aAAWb,IAAX,EAAiB;AAChB,WAAOzC,WAAW8C,KAAX,CAAiBC,uBAAjB,CAAyC,CAAC,wBAAD,EAA2B,yBAA3B,CAAzC,EAAgGN,KAAKU,GAArG,CAAP;AACA;;AAEDT,2BAAyB;AACxB,WAAO,IAAP;AACA;;AAEDiB,6BAA2B;AAC1B,WAAO,IAAP;AACA;;AAEDC,YAAUmC,OAAV,EAAmB;AAClB,YAAQA,OAAR;AACC,WAAK3F,cAAcY,YAAnB;AACC,eAAO,mBAAP;;AACD,WAAKZ,cAAca,aAAnB;AACC,eAAO,oBAAP;;AACD;AACC,eAAO,EAAP;AANF;AAQA;;AAlEiD,C;;;;;;;;;;;AChBnDtB,OAAOO,MAAP,CAAc;AAACiG,kBAAe,MAAIA;AAApB,CAAd;AAAmD,IAAI7F,cAAJ;AAAmBX,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACS,iBAAeP,CAAf,EAAiB;AAACO,qBAAeP,CAAf;AAAiB;;AAApC,CAA1C,EAAgF,CAAhF;;AAE/D,MAAMoG,cAAN,SAA6B7F,cAA7B,CAA4C;AAClDa,gBAAc;AACb,UAAM;AACLO,kBAAY,QADP;AAELG,aAAO,EAFF;AAGLG,aAAO;AAHF,KAAN;AAMA,SAAKwE,MAAL,GAAc,IAAd;AACA;;AAED1C,cAAY;AACX,UAAMC,OAAOnB,OAAOmB,IAAP,EAAb;AACA,WAAO/D,WAAWgE,iBAAX,CAA6BD,IAA7B,EAAmC,mBAAnC,CAAP;AACA;;AAdiD,C;;;;;;;;;;;ACFnD,IAAI0C,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAENC,WAAW0G,MAAX,GAAoB,CAACrF,IAAD,EAAO;AAAEsF,QAAM,IAAR;AAAcC,SAAO;AAArB,IAA+B,EAAtC,KAA6C;AAChE,QAAMC,YAAYJ,EAAEK,KAAF,CAAQL,EAAEM,IAAF,CAAO/G,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,YAAxB,KAAyC,EAAhD,CAAR,EAA6D,GAA7D,CAAlB;AACA,QAAM2B,aAAaP,EAAEK,KAAF,CAAQL,EAAEM,IAAF,CAAOE,0BAA0BC,oBAA1B,IAAkD,EAAzD,CAAR,EAAsE,GAAtE,CAAnB;AAEA,MAAIC,QAAJ;AAEA,QAAMC,YAAYX,EAAEY,KAAF,CAAQZ,EAAEM,IAAF,CAAO1F,IAAP,CAAR,EAAsB,GAAtB,CAAlB;;AAEA,MAAIsF,OAAOE,cAAc,EAAzB,EAA6B;AAC5BM,eAAWN,YAAYG,UAAvB;AACA,GAFD,MAEO,IAAIJ,QAAQhE,OAAO0E,SAAnB,EAA8B;AACpC,WAAO1E,OAAO2E,WAAP,CAAmBH,SAAnB,CAAP;AACA,GAFM,MAEA;AACND,eAAWH,UAAX;AACA;;AAED,SAAQ,GAAGG,QAAU,IAAIC,SAAW,EAApC;AACA,CAjBD,C;;;;;;;;;;;ACFA,IAAII,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAEN;;;;AAIAC,WAAWoF,QAAX,GAAsB;AACrBqC,aAAW,EADU;AAErBC,kBAAgB,EAFK;AAGrBC,MAAI,IAAIC,IAAJ,EAHiB;;AAIrBvC,MAAIlC,GAAJ,EAAS0E,QAAT,EAAmB;AAClB,QAAIA,YAAY,IAAhB,EAAsB;AACrB7H,iBAAWoF,QAAX,CAAoB0C,MAApB,CAA2B3E,GAA3B,EAAgC0E,QAAhC;;AACA,UAAI,CAACjF,OAAOwC,QAAZ,EAAsB;AACrB;AACA;;AACD,UAAIjC,QAAQ,GAAZ,EAAiB;AAChB,eAAO4E,OAAOC,IAAP,CAAYpF,OAAOwC,QAAnB,EAA6B6C,OAA7B,CAAqCC,OAAO;AAClD,gBAAMC,QAAQvF,OAAOwC,QAAP,CAAgB8C,GAAhB,CAAd;AACAL,mBAASK,GAAT,EAAcC,KAAd;AACA,SAHM,CAAP;AAIA;;AACD,UAAIX,EAAEY,QAAF,CAAWjF,GAAX,KAAmBP,OAAOwC,QAA9B,EAAwC;AACvC,eAAO2C,OAAOC,IAAP,CAAYpF,OAAOwC,QAAnB,EAA6B6C,OAA7B,CAAqCC,OAAO;AAClD,cAAI,CAAC/E,IAAIkF,IAAJ,CAASH,GAAT,CAAL,EAAoB;AACnB;AACA;;AACD,gBAAMC,QAAQvF,OAAOwC,QAAP,CAAgB8C,GAAhB,CAAd;AACAL,mBAASK,GAAT,EAAcC,KAAd;AACA,SANM,CAAP;AAOA;;AACD,aAAOvF,OAAOwC,QAAP,CAAgBjC,GAAhB,KAAwB,IAAxB,IAAgC0E,SAAS1E,GAAT,EAAcP,OAAOwC,QAAP,CAAgBjC,GAAhB,CAAd,CAAvC;AACA,KArBD,MAqBO;AACN,UAAI,CAACP,OAAOwC,QAAZ,EAAsB;AACrB;AACA;;AACD,UAAIoC,EAAEY,QAAF,CAAWjF,GAAX,CAAJ,EAAqB;AACpB,eAAO4E,OAAOC,IAAP,CAAYpF,OAAOwC,QAAnB,EAA6BkD,MAA7B,CAAoC,CAACC,KAAD,EAAQL,GAAR,KAAgB;AAC1D,gBAAMC,QAAQvF,OAAOwC,QAAP,CAAgB8C,GAAhB,CAAd;;AACA,cAAI/E,IAAIkF,IAAJ,CAASH,GAAT,CAAJ,EAAmB;AAClBK,kBAAMC,IAAN,CAAW;AACVN,iBADU;AAEVC;AAFU,aAAX;AAIA;;AACD,iBAAOI,KAAP;AACA,SATM,EASJ,EATI,CAAP;AAUA;;AACD,aAAO3F,OAAOwC,QAAP,IAAmBxC,OAAOwC,QAAP,CAAgBjC,GAAhB,CAA1B;AACA;AACD,GA5CoB;;AA6CrBsF,MAAItF,GAAJ,EAASgF,KAAT,EAAgBN,QAAhB,EAA0B;AACzB,WAAOjF,OAAO8F,IAAP,CAAY,aAAZ,EAA2BvF,GAA3B,EAAgCgF,KAAhC,EAAuCN,QAAvC,CAAP;AACA,GA/CoB;;AAgDrBc,WAASvD,QAAT,EAAmByC,QAAnB,EAA6B;AAC5B;AACA;AACA,UAAMe,OAAO,UAAS9C,OAAT,EAAkB;AAC9B,aAAO,UAAS+B,QAAT,EAAmB;AACzB,eAAOjF,OAAO8F,IAAP,CAAY,aAAZ,EAA2B5C,QAAQ3C,GAAnC,EAAwC2C,QAAQqC,KAAhD,EAAuDrC,QAAQ+C,MAA/D,EAAuEhB,QAAvE,CAAP;AACA,OAFD;AAGA,KAJD;;AAKA,UAAMiB,UAAUtB,EAAEuB,GAAF,CAAM3D,QAAN,EAAiBU,OAAD,IAAa8C,KAAK9C,OAAL,CAA7B,CAAhB;;AACA,WAAO0B,EAAEsB,OAAF,EAAWE,WAAX,CAAuBxB,EAAEyB,IAAzB,EAA+B,CAACC,GAAD,EAAMC,OAAN,KAAkBtB,SAASqB,GAAT,EAAcC,OAAd,CAAjD,GAAP;AACA,GA1DoB;;AA2DrBC,OAAKlB,GAAL,EAAUC,KAAV,EAAiBkB,WAAjB,EAA8B;AAC7B,KAAC,GAAD,EAAMnB,GAAN,EAAWD,OAAX,CAAmBqB,QAAQ;AAC1B,UAAItJ,WAAWoF,QAAX,CAAoBqC,SAApB,CAA8B6B,IAA9B,CAAJ,EAAyC;AACxCtJ,mBAAWoF,QAAX,CAAoBqC,SAApB,CAA8B6B,IAA9B,EAAoCrB,OAApC,CAA4CJ,YAAYA,SAASK,GAAT,EAAcC,KAAd,EAAqBkB,WAArB,CAAxD;AACA;AACD,KAJD;AAKAtB,WAAOC,IAAP,CAAYhI,WAAWoF,QAAX,CAAoBsC,cAAhC,EAAgDO,OAAhD,CAAwDsB,SAAS;AAChE,YAAMC,UAAUxJ,WAAWoF,QAAX,CAAoBsC,cAApB,CAAmC6B,KAAnC,CAAhB;;AACA,UAAI,CAACC,QAAQC,KAAR,CAAcpB,IAAd,CAAmBH,GAAnB,CAAL,EAA8B;AAC7B;AACA;;AACDsB,cAAQ/B,SAAR,CAAkBQ,OAAlB,CAA0BJ,YAAYA,SAASK,GAAT,EAAcC,KAAd,EAAqBkB,WAArB,CAAtC;AACA,KAND;AAOA,GAxEoB;;AAyErBvB,SAAOI,GAAP,EAAYL,QAAZ,EAAsB;AACrB;AACA;AACA;AACA;AACA;AACA,UAAMG,OAAO,GAAG0B,MAAH,CAAUxB,GAAV,CAAb;AACAF,SAAKC,OAAL,CAAa0B,KAAK;AACjB,UAAInC,EAAEY,QAAF,CAAWuB,CAAX,CAAJ,EAAmB;AAClB3J,mBAAWoF,QAAX,CAAoBsC,cAApB,CAAmCtG,OAAOuI,EAAEC,MAA5C,IAAsD5J,WAAWoF,QAAX,CAAoBsC,cAApB,CAAmCtG,OAAOuI,EAAEC,MAA5C,KAAuD;AAC5GH,iBAAOE,CADqG;AAE5GlC,qBAAW;AAFiG,SAA7G;AAIAzH,mBAAWoF,QAAX,CAAoBsC,cAApB,CAAmCiC,EAAEC,MAArC,EAA6CnC,SAA7C,CAAuDe,IAAvD,CAA4DX,QAA5D;AACA,OAND,MAMO;AACN7H,mBAAWoF,QAAX,CAAoBqC,SAApB,CAA8BkC,CAA9B,IAAmC3J,WAAWoF,QAAX,CAAoBqC,SAApB,CAA8BkC,CAA9B,KAAoC,EAAvE;AACA3J,mBAAWoF,QAAX,CAAoBqC,SAApB,CAA8BkC,CAA9B,EAAiCnB,IAAjC,CAAsCX,QAAtC;AACA;AACD,KAXD;AAYA;;AA5FoB,CAAtB,C;;;;;;;;;;;ACNA,IAAIL,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAEN;;;;AAKAC,WAAWyH,SAAX,GAAuB,EAAvB;;AAEA,IAAI7E,OAAOC,QAAX,EAAqB;AACpB7C,aAAWyH,SAAX,CAAqBoC,QAArB,GAAgC,IAAhC;AACA7J,aAAWyH,SAAX,CAAqBqC,aAArB,GAAqC,IAArC;AACA,CAHD,MAGO;AACN9J,aAAWyH,SAAX,CAAqBoC,QAArB,GAAgC,KAAhC;AACA7J,aAAWyH,SAAX,CAAqBqC,aAArB,GAAqC,KAArC;AACA;AAGD;;;;;AAIA9J,WAAWyH,SAAX,CAAqBsC,QAArB,GAAgC;AAC/BC,QAAM,CAAC,IADwB;AAE/BC,UAAQ,CAFuB;AAG/BC,OAAK;AAH0B,CAAhC;AAOA;;;;;;AAMAlK,WAAWyH,SAAX,CAAqB0C,GAArB,GAA2B,UAASC,IAAT,EAAevC,QAAf,EAAyBkC,QAAzB,EAAmCnI,EAAnC,EAAuC;AACjE,MAAImI,YAAY,IAAhB,EAAsB;AACrBA,eAAW/J,WAAWyH,SAAX,CAAqBsC,QAArB,CAA8BE,MAAzC;AACA;;AACD,MAAI,CAACzC,EAAE6C,QAAF,CAAWN,QAAX,CAAL,EAA2B;AAC1BA,eAAW/J,WAAWyH,SAAX,CAAqBsC,QAArB,CAA8BE,MAAzC;AACA;;AACDpC,WAASkC,QAAT,GAAoBA,QAApB;AACAlC,WAASjG,EAAT,GAAcA,MAAMD,OAAOC,EAAP,EAApB;AACA5B,aAAWyH,SAAX,CAAqB2C,IAArB,IAA6BpK,WAAWyH,SAAX,CAAqB2C,IAArB,KAA8B,EAA3D;;AACA,MAAIpK,WAAWyH,SAAX,CAAqBoC,QAArB,KAAkC,IAAtC,EAA4C;AAC3C,UAAMX,MAAM,IAAI3H,KAAJ,EAAZ;AACAsG,aAASyC,KAAT,GAAiBpB,IAAIoB,KAArB;AACA;;AACD,MAAItK,WAAWyH,SAAX,CAAqB2C,IAArB,EAA2BG,IAA3B,CAAiCC,EAAD,IAAQA,GAAG5I,EAAH,KAAUiG,SAASjG,EAA3D,CAAJ,EAAoE;AACnE;AACA;;AACD5B,aAAWyH,SAAX,CAAqB2C,IAArB,EAA2B5B,IAA3B,CAAgCX,QAAhC;AACA,CAlBD;AAqBA;;;;;;;AAMA7H,WAAWyH,SAAX,CAAqBgD,MAArB,GAA8B,UAASC,QAAT,EAAmB9I,EAAnB,EAAuB;AACpD5B,aAAWyH,SAAX,CAAqBiD,QAArB,IAAiClD,EAAEmD,MAAF,CAAS3K,WAAWyH,SAAX,CAAqBiD,QAArB,CAAT,EAA0C7C,QAAD,IAAcA,SAASjG,EAAT,KAAgBA,EAAvE,CAAjC;AACA,CAFD;AAKA;;;;;;;;;AAQA5B,WAAWyH,SAAX,CAAqBmD,GAArB,GAA2B,UAASR,IAAT,EAAed,IAAf,EAAqBuB,QAArB,EAA+B;AACzD,QAAMpD,YAAYzH,WAAWyH,SAAX,CAAqB2C,IAArB,CAAlB;;AACA,MAAI3C,aAAaA,UAAUnG,MAA3B,EAAmC;AAClC,QAAIwJ,YAAY,CAAhB;;AACA,UAAMC,SAASvD,EAAEwD,MAAF,CAASvD,SAAT,EAAoB,UAASI,QAAT,EAAmB;AACrD,aAAOA,SAASkC,QAAT,IAAqB/J,WAAWyH,SAAX,CAAqBsC,QAArB,CAA8BE,MAA1D;AACA,KAFc,EAEZ3B,MAFY,CAEL,UAASyC,MAAT,EAAiBlD,QAAjB,EAA2B;AACpC,UAAIoD,OAAO,CAAX;;AACA,UAAIjL,WAAWyH,SAAX,CAAqBoC,QAArB,KAAkC,IAAlC,IAA0C7J,WAAWyH,SAAX,CAAqBqC,aAArB,KAAuC,IAArF,EAA2F;AAC1FmB,eAAOrD,KAAKsD,GAAL,EAAP;AACA;;AACD,YAAMC,iBAAiBtD,SAASkD,MAAT,EAAiBF,QAAjB,CAAvB;;AACA,UAAI7K,WAAWyH,SAAX,CAAqBoC,QAArB,KAAkC,IAAlC,IAA0C7J,WAAWyH,SAAX,CAAqBqC,aAArB,KAAuC,IAArF,EAA2F;AAC1F,cAAMsB,cAAcxD,KAAKsD,GAAL,KAAaD,IAAjC;AACAH,qBAAaM,WAAb;;AACA,YAAIpL,WAAWyH,SAAX,CAAqBoC,QAArB,KAAkC,IAAtC,EAA4C;AAC3C,cAAIjH,OAAOC,QAAX,EAAqB;AACpB7C,uBAAWqL,YAAX,CAAwBC,MAAxB,CAA+B,gBAA/B,EAAiDF,WAAjD,EAA8D,CAAE,QAAQhB,IAAM,EAAhB,EAAoB,YAAYvC,SAASjG,EAAI,EAA7C,CAA9D;AACA,WAFD,MAEO;AACN,gBAAI0I,QAAQzC,SAASyC,KAAT,IAAkB,OAAOzC,SAASyC,KAAT,CAAeiB,KAAtB,KAAgC,UAAlD,IAAgE1D,SAASyC,KAAT,CAAeiB,KAAf,CAAqB,IAArB,CAA5E;AACAjB,oBAAQA,SAASA,MAAM,CAAN,CAAT,IAAqB,CAACA,MAAM,CAAN,EAASkB,KAAT,CAAe,QAAf,KAA0B,EAA3B,EAA+B,CAA/B,CAA7B;AACAC,oBAAQC,GAAR,CAAYC,OAAOP,WAAP,CAAZ,EAAiChB,IAAjC,EAAuCvC,SAASjG,EAAhD,EAAoD0I,KAApD;AACA;AACD;AACD;;AACD,aAAQ,OAAOa,cAAP,KAA0B,WAA3B,GAA0CJ,MAA1C,GAAmDI,cAA1D;AACA,KAtBc,EAsBZ7B,IAtBY,CAAf;;AAuBA,QAAItJ,WAAWyH,SAAX,CAAqBqC,aAArB,KAAuC,IAA3C,EAAiD;AAChD,UAAIlH,OAAOC,QAAX,EAAqB;AACpB7C,mBAAWqL,YAAX,CAAwBC,MAAxB,CAA+B,qBAA/B,EAAsDR,SAAtD,EAAiE,CAAE,QAAQV,IAAM,EAAhB,CAAjE;AACA,OAFD,MAEO;AACNqB,gBAAQC,GAAR,CAAa,GAAGtB,IAAM,GAAtB,EAA0BU,SAA1B;AACA;AACD;;AACD,WAAOC,MAAP;AACA,GAjCD,MAiCO;AACN,WAAOzB,IAAP;AACA;AACD,CAtCD;AAyCA;;;;;;;;AAOAtJ,WAAWyH,SAAX,CAAqBmE,QAArB,GAAgC,UAASxB,IAAT,EAAed,IAAf,EAAqBuB,QAArB,EAA+B;AAC9D,QAAMpD,YAAYzH,WAAWyH,SAAX,CAAqB2C,IAArB,CAAlB;;AACA,MAAIxH,OAAOC,QAAP,IAAmB4E,SAAnB,IAAgCA,UAAUnG,MAA9C,EAAsD;AACrDsB,WAAOiJ,KAAP,CAAa,YAAW;AACvBrE,QAAEwD,MAAF,CAASvD,SAAT,EAAqBI,QAAD,IAAcA,SAASkC,QAAT,IAAqB/J,WAAWyH,SAAX,CAAqBsC,QAArB,CAA8BE,MAArF,EAA6FhC,OAA7F,CAAsGJ,QAAD,IAAcA,SAASyB,IAAT,EAAeuB,QAAf,CAAnH;AACA,KAFD;AAGA,GAJD,MAIO;AACN,WAAOvB,IAAP;AACA;AACD,CATD,C;;;;;;;;;;;AC3HA,IAAI9B,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAENC,WAAW8L,wBAAX,GAAsC,YAAW;AAChD,QAAMC,qBAAqB/L,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,+BAAxB,CAA3B;;AAEA,MAAI,CAAC0G,kBAAD,IAAuBA,uBAAuB,GAAlD,EAAuD;AACtD;AACA;;AACD,SAAOvE,EAAEuB,GAAF,CAAMgD,mBAAmBR,KAAnB,CAAyB,GAAzB,CAAN,EAAqC,UAASjC,IAAT,EAAe;AAC1D,WAAOA,KAAKvC,IAAL,EAAP;AACA,GAFM,CAAP;AAGA,CATD;;AAWA/G,WAAWgM,4BAAX,GAA0C,UAASC,IAAT,EAAe;AACxD,QAAMC,OAAOlM,WAAW8L,wBAAX,EAAb;;AACA,MAAI,CAACI,IAAL,EAAW;AACV,WAAO,IAAP;AACA;;AAED,MAAI,CAACD,IAAL,EAAW;AACV,WAAO,KAAP;AACA;;AAED,MAAIzE,EAAE2E,QAAF,CAAWD,IAAX,EAAiBD,IAAjB,CAAJ,EAA4B;AAC3B,WAAO,IAAP;AACA,GAFD,MAEO;AACN,UAAMG,eAAe,IAArB;;AACA,UAAMC,YAAY7E,EAAE8E,MAAF,CAASJ,IAAT,EAAe,UAAS5C,IAAT,EAAe;AAC/C,aAAOA,KAAKiD,OAAL,CAAaH,YAAb,IAA6B,CAApC;AACA,KAFiB,CAAlB;;AAGA,QAAI5E,EAAE2E,QAAF,CAAWE,SAAX,EAAsBJ,KAAKO,OAAL,CAAa,SAAb,EAAwBJ,YAAxB,CAAtB,CAAJ,EAAkE;AACjE,aAAO,IAAP;AACA;AACD;;AACD,SAAO,KAAP;AACA,CAtBD,C;;;;;;;;;;;ACbA,MAAMK,SAAS,CAAC,SAAD,EAAY,SAAZ,EAAuB,SAAvB,EAAkC,SAAlC,EAA6C,SAA7C,EAAwD,SAAxD,EAAmE,SAAnE,EAA8E,SAA9E,EAAyF,SAAzF,EAAoG,SAApG,EAA+G,SAA/G,EAA0H,SAA1H,EAAqI,SAArI,EAAgJ,SAAhJ,EAA2J,SAA3J,EAAsK,SAAtK,EAAiL,SAAjL,EAA4L,SAA5L,CAAf;;AAEAzM,WAAW0M,cAAX,GAA4B,UAAStL,IAAT,EAAe;AAC1C,SAAOqL,OAAOrL,KAAKE,MAAL,GAAcmL,OAAOnL,MAA5B,CAAP;AACA,CAFD,C;;;;;;;;;;;ACFA,IAAImF,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAENC,WAAW2M,gBAAX,GAA8B,SAASA,gBAAT,CAA0BC,WAA1B,EAAuC9H,MAAM,EAA7C,EAAiD;AAC9E,MAAI+H,gBAAgBD,WAApB;;AAEA,MAAI5M,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wCAAxB,CAAJ,EAAuE;AACtE,UAAM5C,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBC,oBAAxB,CAA6CH,WAA7C,CAAb;;AACA,QAAInK,QAAQA,KAAKU,GAAL,KAAa2B,GAAzB,EAA8B;AAC7B,UAAIrC,KAAKuK,QAAT,EAAmB;AAClB,cAAM,IAAIpK,OAAOrB,KAAX,CAAiB,+BAAjB,EAAmD,yCAAyCqL,WAAa,EAAzG,EAA4G;AAAEK,oBAAU,6BAAZ;AAA2CC,wBAAcN;AAAzD,SAA5G,CAAN;AACA,OAFD,MAEO;AACN,cAAM,IAAIhK,OAAOrB,KAAX,CAAiB,8BAAjB,EAAkD,wBAAwBqL,WAAa,UAAvF,EAAkG;AAAEK,oBAAU,6BAAZ;AAA2CC,wBAAcN;AAAzD,SAAlG,CAAN;AACA;AACD;;AACDC,oBAAgBpG,EAAE0G,OAAF,CAAUP,WAAV,CAAhB;AACA;;AAED,MAAIQ,cAAJ;;AACA,MAAI;AACHA,qBAAiB,IAAIC,MAAJ,CAAY,IAAIrN,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAkD,GAAlE,CAAjB;AACA,GAFD,CAEE,OAAOiI,KAAP,EAAc;AACfF,qBAAiB,IAAIC,MAAJ,CAAW,mBAAX,CAAjB;AACA;;AACD,MAAI,CAACD,eAAe/E,IAAf,CAAoBwE,aAApB,CAAL,EAAyC;AACxC,UAAM,IAAIjK,OAAOrB,KAAX,CAAiB,yBAAjB,EAA6C,GAAGsL,aAAe,4BAA/D,EAA4F;AACjG,kBAAY,6BADqF;AAEjGK,oBAAcL;AAFmF,KAA5F,CAAN;AAIA;;AAED,QAAMpK,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBS,aAAxB,CAAsCV,aAAtC,CAAb;;AACA,MAAIpK,QAAQA,KAAKU,GAAL,KAAa2B,GAAzB,EAA8B;AAC7B,QAAI9E,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wCAAxB,CAAJ,EAAuE;AACtE,UAAImI,UAAUX,aAAd;AACA,UAAIY,OAAO,CAAX;;AACA,aAAOzN,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBY,qBAAxB,CAA8CF,OAA9C,EAAuD1I,GAAvD,CAAP,EAAoE;AACnE0I,kBAAW,GAAGX,aAAe,IAAI,EAAEY,IAAM,EAAzC;AACA;;AACDZ,sBAAgBW,OAAhB;AACA,KAPD,MAOO,IAAI/K,KAAKuK,QAAT,EAAmB;AACzB,YAAM,IAAIpK,OAAOrB,KAAX,CAAiB,+BAAjB,EAAmD,yCAAyCsL,aAAe,EAA3G,EAA8G;AAAEI,kBAAU,6BAAZ;AAA2CC,sBAAcL;AAAzD,OAA9G,CAAN;AACA,KAFM,MAEA;AACN,YAAM,IAAIjK,OAAOrB,KAAX,CAAiB,8BAAjB,EAAkD,wBAAwBsL,aAAe,UAAzF,EAAoG;AAAEI,kBAAU,6BAAZ;AAA2CC,sBAAcL;AAAzD,OAApG,CAAN;AACA;AACD;;AAED,SAAOA,aAAP;AACA,CA7CD,C;;;;;;;;;;;ACFA,IAAIpG,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;AAENC,WAAW2N,YAAX,GAA0B,EAA1B;;AAEA3N,WAAW2N,YAAX,CAAwBnB,OAAxB,GAAkC,UAASoB,GAAT,EAAcC,IAAd,EAAoB;AACrD,MAAI,CAACD,GAAL,EAAU;AACT,WAAO,EAAP;AACA;;AAEDA,QAAMA,IAAIpB,OAAJ,CAAY,gBAAZ,EAA8BxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,WAAxB,KAAwC,EAAtE,CAAN;AACAuI,QAAMA,IAAIpB,OAAJ,CAAY,eAAZ,EAA6BxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,KAAuC,EAApE,CAAN;;AAEA,MAAIwI,IAAJ,EAAU;AACTD,UAAMA,IAAIpB,OAAJ,CAAY,WAAZ,EAAyBqB,KAAKzM,IAAL,IAAa,EAAtC,CAAN;AACAwM,UAAMA,IAAIpB,OAAJ,CAAY,YAAZ,EAA0B/F,EAAEqH,OAAF,CAAUD,KAAKzM,IAAf,EAAqB,GAArB,KAA6B,EAAvD,CAAN;AACAwM,UAAMA,IAAIpB,OAAJ,CAAY,YAAZ,EAA0B/F,EAAEsH,YAAF,CAAeF,KAAKzM,IAApB,EAA0B,GAA1B,KAAkC,EAA5D,CAAN;AACAwM,UAAMA,IAAIpB,OAAJ,CAAY,YAAZ,EAA0BqB,KAAKG,KAAL,IAAc,EAAxC,CAAN;AACAJ,UAAMA,IAAIpB,OAAJ,CAAY,eAAZ,EAA6BqB,KAAKI,QAAL,IAAiB,EAA9C,CAAN;AACAL,UAAMA,IAAIpB,OAAJ,CAAY,aAAZ,EAA2BqB,KAAKK,MAAL,IAAe,EAA1C,CAAN;AACAN,UAAMA,IAAIpB,OAAJ,CAAY,WAAZ,EAAyBqB,KAAK9J,IAAL,IAAa,EAAtC,CAAN;AACA6J,UAAMA,IAAIpB,OAAJ,CAAY,WAAZ,EAAyBqB,KAAKpL,IAAL,IAAa,EAAtC,CAAN;;AAEA,QAAIoL,KAAKM,WAAT,EAAsB;AACrBP,YAAMA,IAAIpB,OAAJ,CAAY,kBAAZ,EAAgCqB,KAAKM,WAArC,CAAN;AACA;AACD;;AAEDP,QAAMA,IAAIpB,OAAJ,CAAY,+BAAZ,EAA6C,OAAO,MAAP,GAAgB,IAA7D,CAAN;AAGA,SAAOoB,GAAP;AACA,CA3BD,C;;;;;;;;;;;ACJA,IAAIpG,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAEN;;;;AAKAC,WAAWoO,QAAX,GAAsB,EAAtB;AAGA;;;;AAIApO,WAAWoO,QAAX,CAAoBrE,QAApB,GAA+B;AAC9BC,QAAM,CAAC,IADuB;AAE9BC,UAAQ,CAFsB;AAG9BC,OAAK;AAHyB,CAA/B;AAOA;;;;;;AAMAlK,WAAWoO,QAAX,CAAoBjE,GAApB,GAA0B,UAASC,IAAT,EAAevC,QAAf,EAAyBwG,IAAIrO,WAAWoO,QAAX,CAAoBrE,QAApB,CAA6BE,MAA1D,EAAkErI,EAAlE,EAAsE;AAC/F,QAAMmI,WAAW,CAACvC,EAAE6C,QAAF,CAAWgE,CAAX,CAAD,GAAiBrO,WAAWoO,QAAX,CAAoBrE,QAApB,CAA6BE,MAA9C,GAAuDoE,CAAxE;AACAxG,WAASkC,QAAT,GAAoBA,QAApB;AACAlC,WAASjG,EAAT,GAAcA,MAAMD,OAAOC,EAAP,EAApB;AACA5B,aAAWoO,QAAX,CAAoBhE,IAApB,IAA4BpK,WAAWoO,QAAX,CAAoBhE,IAApB,KAA6B,EAAzD;;AACA,MAAIpK,WAAWoO,QAAX,CAAoBhE,IAApB,EAA0BG,IAA1B,CAA+BC,MAAMA,GAAG5I,EAAH,KAAUiG,SAASjG,EAAxD,CAAJ,EAAiE;AAChE;AACA;;AACD5B,aAAWoO,QAAX,CAAoBhE,IAApB,EAA0B5B,IAA1B,CAA+BX,QAA/B;AACA,CATD;AAYA;;;;;;;AAMA7H,WAAWoO,QAAX,CAAoB3D,MAApB,GAA6B,UAASC,QAAT,EAAmB9I,EAAnB,EAAuB;AACnD5B,aAAWoO,QAAX,CAAoB1D,QAApB,IAAgClD,EAAEmD,MAAF,CAAS3K,WAAWoO,QAAX,CAAoB1D,QAApB,CAAT,EAAyC7C,QAAD,IAAcA,SAASjG,EAAT,KAAgBA,EAAtE,CAAhC;AACA,CAFD;AAKA;;;;;;;;;AAQA5B,WAAWoO,QAAX,CAAoBxD,GAApB,GAA0B,UAASR,IAAT,EAAed,IAAf,EAAqBuB,QAArB,EAA+B;AACxD,MAAIpD,YAAYzH,WAAWoO,QAAX,CAAoBhE,IAApB,CAAhB;;AACA,MAAI3C,aAAa,IAAb,IAAqBA,UAAUnG,MAAV,KAAqB,CAA9C,EAAiD;AAChD,WAAOgN,QAAQC,OAAR,CAAgBjF,IAAhB,CAAP;AACA;;AACD7B,cAAYD,EAAEwD,MAAF,CAASvD,SAAT,EAAqBI,QAAD,IAAcA,SAASkC,QAAT,IAAqB/J,WAAWoO,QAAX,CAAoBrE,QAApB,CAA6BE,MAApF,CAAZ;AACA,SAAOxC,UAAUa,MAAV,CAAiB,UAASkG,eAAT,EAA0B3G,QAA1B,EAAoC;AAC3D,WAAO,IAAIyG,OAAJ,CAAY,UAASC,OAAT,EAAkB5D,MAAlB,EAA0B;AAC5C,aAAO6D,gBAAgBC,IAAhB,CAAsB1D,MAAD,IAAYlD,SAASkD,MAAT,EAAiBF,QAAjB,EAA2B4D,IAA3B,CAAgCF,OAAhC,EAAyC5D,MAAzC,CAAjC,CAAP;AACA,KAFM,CAAP;AAGA,GAJM,EAIJ2D,QAAQC,OAAR,CAAgBjF,IAAhB,CAJI,CAAP;AAKA,CAXD;AAcA;;;;;;;;AAOAtJ,WAAWoO,QAAX,CAAoBxC,QAApB,GAA+B,UAASxB,IAAT,EAAed,IAAf,EAAqBuB,QAArB,EAA+B;AAC7D,QAAMpD,YAAYzH,WAAWoO,QAAX,CAAoBhE,IAApB,CAAlB;;AACA,MAAI,CAACxH,OAAOC,QAAR,IAAoB4E,aAAa,IAAjC,IAAyCA,UAAUnG,MAAV,KAAqB,CAAlE,EAAqE;AACpE,WAAOgI,IAAP;AACA;;AACD1G,SAAOiJ,KAAP,CAAa,MAAM;AAClBrE,MAAEwD,MAAF,CAASvD,SAAT,EAAqBI,QAAD,IAAcA,SAASkC,QAAT,IAAqB/J,WAAWoO,QAAX,CAAoBrE,QAApB,CAA6BE,MAApF,EAA4FhC,OAA5F,CAAoG,UAASJ,QAAT,EAAmB;AACtHA,eAASyB,IAAT,EAAeuB,QAAf;AACA,KAFD;AAGA,GAJD;AAKA,CAVD,C;;;;;;;;;;;AC/EAlL,OAAOO,MAAP,CAAc;AAACwO,mBAAgB,MAAIA;AAArB,CAAd;AAAqD,IAAIpO,cAAJ;AAAmBX,OAAOC,KAAP,CAAaC,QAAQ,kBAAR,CAAb,EAAyC;AAACS,iBAAeP,CAAf,EAAiB;AAACO,qBAAeP,CAAf;AAAiB;;AAApC,CAAzC,EAA+E,CAA/E;;AAGjE,MAAM2O,eAAN,CAAsB;AAC5BvN,gBAAc;AACb,SAAKwN,SAAL,GAAiB,EAAjB;AACA,SAAKC,cAAL,GAAsB,EAAtB;AACA,SAAKC,SAAL,GAAiB,CAAjB;AACA;AAED;;;;;;;;AAMA1E,MAAI2E,UAAJ,EAAgB;AACf,QAAI,EAAEA,sBAAsBxO,cAAxB,CAAJ,EAA6C;AAC5C,YAAM,IAAIiB,KAAJ,CAAU,oEAAV,CAAN;AACA;;AAED,QAAI,KAAKoN,SAAL,CAAeG,WAAWpN,UAA1B,CAAJ,EAA2C;AAC1C,aAAO,KAAP;AACA;;AAED,QAAI,CAACoN,WAAWjN,KAAhB,EAAuB;AACtBiN,iBAAWjN,KAAX,GAAmB,KAAKgN,SAAL,GAAiB,EAApC;AACA,WAAKA,SAAL,IAAkB,EAAlB;AACA;;AAED,SAAKD,cAAL,CAAoBpG,IAApB,CAAyB;AACxB9G,kBAAYoN,WAAWpN,UADC;AAExBG,aAAOiN,WAAWjN;AAFM,KAAzB;AAKA,SAAK8M,SAAL,CAAeG,WAAWpN,UAA1B,IAAwCoN,UAAxC;;AAEA,QAAIA,WAAW7M,KAAX,IAAoB6M,WAAW7M,KAAX,CAAiBZ,IAArC,IAA6CyN,WAAW7M,KAAX,CAAiBb,IAA9D,IAAsE0N,WAAW7M,KAAX,CAAiBkC,MAA3F,EAAmG;AAClG,YAAM4K,cAAc;AACnB3N,cAAM0N,WAAW7M,KAAX,CAAiBb,IADJ;AAEnB+C,gBAAQ2K,WAAW7M,KAAX,CAAiBkC;AAFN,OAApB;;AAKA,UAAIvB,OAAOoM,QAAX,EAAqB;AACpBD,oBAAYE,YAAZ,GAA2B,CAACC,QAAD,CAA3B;AACA;;AAED,aAAOC,WAAWlN,KAAX,CAAiB6M,WAAW7M,KAAX,CAAiBZ,IAAlC,EAAwC0N,WAAxC,CAAP;AACA;AACD;;AAEDK,gBAAcC,QAAd,EAAwB;AACvB,WAAO,KAAKV,SAAL,CAAeU,QAAf,KAA4B,KAAKV,SAAL,CAAeU,QAAf,EAAyBpN,KAArD,IAA8D,KAAK0M,SAAL,CAAeU,QAAf,EAAyBpN,KAAzB,CAA+BsC,IAA/B,IAAuC,IAA5G;AACA;AAED;;;;;;AAIA+K,eAAaD,QAAb,EAAuBE,OAAvB,EAAgC;AAC/B,QAAI,CAAC,KAAKZ,SAAL,CAAeU,QAAf,CAAL,EAA+B;AAC9B,aAAO,KAAP;AACA;;AAED,QAAIG,YAAY,EAAhB;;AACA,QAAI,KAAKb,SAAL,CAAeU,QAAf,KAA4B,KAAKV,SAAL,CAAeU,QAAf,EAAyBpN,KAArD,IAA8D,KAAK0M,SAAL,CAAeU,QAAf,EAAyBpN,KAAzB,CAA+BsC,IAAjG,EAAuG;AACtGiL,kBAAY,KAAKb,SAAL,CAAeU,QAAf,EAAyBpN,KAAzB,CAA+BsC,IAA/B,CAAoCgL,OAApC,CAAZ;AACA,KAFD,MAEO,IAAIA,WAAWA,QAAQnO,IAAvB,EAA6B;AACnCoO,kBAAY;AACXpO,cAAMmO,QAAQnO;AADH,OAAZ;AAGA;;AAED,WAAO+N,WAAW9N,IAAX,CAAgB,KAAKsN,SAAL,CAAeU,QAAf,EAAyBpN,KAAzB,CAA+Bb,IAA/C,EAAqDoO,SAArD,CAAP;AACA;;AAEDC,gBAAcJ,QAAd,EAAwBE,OAAxB,EAAiCG,WAAjC,EAA8C;AAC7C,QAAI,CAAC,KAAKf,SAAL,CAAeU,QAAf,CAAL,EAA+B;AAC9B,aAAO,KAAP;AACA;;AAED,QAAIG,YAAY,EAAhB;;AACA,QAAI,KAAKb,SAAL,CAAeU,QAAf,KAA4B,KAAKV,SAAL,CAAeU,QAAf,EAAyBpN,KAArD,IAA8D,KAAK0M,SAAL,CAAeU,QAAf,EAAyBpN,KAAzB,CAA+BsC,IAAjG,EAAuG;AACtGiL,kBAAY,KAAKb,SAAL,CAAeU,QAAf,EAAyBpN,KAAzB,CAA+BsC,IAA/B,CAAoCgL,OAApC,CAAZ;AACA,KAFD,MAEO,IAAIA,WAAWA,QAAQnO,IAAvB,EAA6B;AACnCoO,kBAAY;AACXpO,cAAMmO,QAAQnO;AADH,OAAZ;AAGA;;AAED,WAAO+N,WAAWQ,EAAX,CAAc,KAAKhB,SAAL,CAAeU,QAAf,EAAyBpN,KAAzB,CAA+Bb,IAA7C,EAAmDoO,SAAnD,EAA8DE,WAA9D,CAAP;AACA;;AAxF2B,C;;;;;;;;;;;ACH7B1P,WAAW4P,aAAX,GAA2B;AAC1BC,YAAU;AADgB,CAA3B;;AAIA7P,WAAW4P,aAAX,CAAyBzF,GAAzB,GAA+B,UAAS2F,OAAT,EAAkBjI,QAAlB,EAA4BkI,UAAU,EAAtC,EAA0ChF,MAA1C,EAAkD;AAChF/K,aAAW4P,aAAX,CAAyBC,QAAzB,CAAkCC,OAAlC,IAA6C;AAC5CA,WAD4C;AAE5CjI,YAF4C;AAG5CzD,YAAQ2L,QAAQ3L,MAH4B;AAI5C4L,iBAAaD,QAAQC,WAJuB;AAK5CC,gBAAYF,QAAQE,UALwB;AAM5CC,gBAAYH,QAAQG,UAAR,IAAsB,KANU;AAO5CnF;AAP4C,GAA7C;AASA,CAVD;;AAYA/K,WAAW4P,aAAX,CAAyBhF,GAAzB,GAA+B,UAASkF,OAAT,EAAkB1L,MAAlB,EAA0BkF,IAA1B,EAAgC;AAC9D,MAAItJ,WAAW4P,aAAX,CAAyBC,QAAzB,CAAkCC,OAAlC,KAA8C9P,WAAW4P,aAAX,CAAyBC,QAAzB,CAAkCC,OAAlC,EAA2CjI,QAA7F,EAAuG;AACtG,WAAO7H,WAAW4P,aAAX,CAAyBC,QAAzB,CAAkCC,OAAlC,EAA2CjI,QAA3C,CAAoDiI,OAApD,EAA6D1L,MAA7D,EAAqEkF,IAArE,CAAP;AACA;AACD,CAJD;;AAMA1G,OAAOuN,OAAP,CAAe;AACdC,eAAaN,OAAb,EAAsB;AACrB,QAAI,CAAClN,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5D8O,gBAAQ;AADoD,OAAvD,CAAN;AAGA;;AAED,WAAOrQ,WAAW4P,aAAX,CAAyBhF,GAAzB,CAA6BkF,QAAQQ,GAArC,EAA0CR,QAAQ1L,MAAlD,EAA0D0L,QAAQS,GAAlE,CAAP;AACA;;AATa,CAAf,E;;;;;;;;;;;ACtBA,IAAI9J,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;AAENC,WAAWwQ,OAAX,GAAqB;AACpBC,QAAMF,GAAN,EAAWG,QAAX,EAAqB;AACpB,UAAMC,cAAc3Q,WAAW4Q,YAAX,CAAwBC,OAAxB,CAAgCN,GAAhC,CAApB;;AACA,QAAII,WAAJ,EAAiB;AAChB,UAAIA,YAAYG,MAAhB,EAAwB;AACvB,eAAOH,YAAYG,MAAZ,CAAmBP,GAAnB,CAAP;AACA,OAFD,MAEO,IAAII,YAAYI,QAAhB,EAA0B;AAChC;AACA;AACA,OAHM,MAGA,IAAIJ,YAAYK,OAAhB,EAAyB;AAC/B,YAAI,CAACN,QAAD,IAAa,OAAOO,YAAP,KAAwB,WAAzC,EAAsD;AACrDP,qBAAWO,aAAaC,OAAb,CAAqB,cAArB,CAAX;AACA;;AACD,cAAMrD,OAAQ,OAAO8C,YAAY9C,IAAnB,KAA4B,UAA5B,IAA0C8C,YAAY9C,IAAZ,CAAiB0C,GAAjB,CAA3C,IAAqE,EAAlF;AACA,eAAOY,QAAQC,EAAR,CAAWT,YAAYK,OAAvB,EAAgCnD,IAAhC,EAAsC6C,QAAtC,CAAP;AACA;AACD;;AACD,QAAIH,IAAIc,CAAJ,IAASd,IAAIc,CAAJ,CAAM/M,QAAN,KAAmBtE,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,CAAhC,EAA6E;AAC5EkL,UAAIe,IAAJ,GAAWf,IAAIA,GAAf;AACA,aAAOA,IAAIe,IAAX;AACA;;AACDf,QAAIe,IAAJ,GAAWf,IAAIA,GAAf;;AACA,QAAI9J,EAAEM,IAAF,CAAOwJ,IAAIe,IAAX,MAAqB,EAAzB,EAA6B;AAC5Bf,UAAIe,IAAJ,GAAW7K,EAAE8K,UAAF,CAAahB,IAAIe,IAAjB,CAAX;AACA;;AACDf,QAAIe,IAAJ,GAAWf,IAAIe,IAAJ,CAAS9E,OAAT,CAAiB,MAAjB,EAAyB,OAAzB,CAAX;AACA,WAAO+D,IAAIe,IAAX;AACA;;AA3BmB,CAArB,C;;;;;;;;;;;;;ACFAtR,WAAWwR,UAAX,GAAwB,EAAxB;AAEAxR,WAAWwR,UAAX,CAAsB1I,OAAtB,GAAgC,IAAI,MAAM;AACzC3H,gBAAc;AACb,SAAK2H,OAAL,GAAe,EAAf;AACA;AAED;;;;;;;;;;AASAqB,MAAIsH,KAAJ,EAAWzP,KAAX,EAAkB0P,MAAlB,EAA0B;AACzB,QAAI,CAACD,KAAD,IAAU,CAACzP,KAAX,IAAoB,CAAC0P,MAAzB,EAAiC;AAChC;AACA;;AAED,QAAI,CAAC,KAAK5I,OAAL,CAAa2I,KAAb,CAAL,EAA0B;AACzB,WAAK3I,OAAL,CAAa2I,KAAb,IAAsB,EAAtB;AACA;;AAED,UAAME,eAAe,KAAK7I,OAAL,CAAa2I,KAAb,EAAoBlH,IAApB,CAA0BpG,MAAD,IAAY;AACzD,aAAOA,OAAOnC,KAAP,KAAiBA,KAAxB;AACA,KAFoB,CAArB;;AAIA,QAAI2P,YAAJ,EAAkB;AACjB;AACA;;AAED,SAAK7I,OAAL,CAAa2I,KAAb,EAAoBjJ,IAApB,cAA6BkJ,MAA7B;AAAqC1P;AAArC;AACA;;AAEDqD,MAAIoM,KAAJ,EAAW;AACV,QAAI,CAACA,KAAL,EAAY;AACX,aAAO1J,OAAOC,IAAP,CAAY,KAAKc,OAAjB,EAA0BR,MAA1B,CAAiC,CAACsJ,GAAD,EAAM1J,GAAN,KAAc;AACrD,cAAMY,UAAU,KAAKA,OAAL,CAAaZ,GAAb,EAAkBoE,MAAlB,CAAyBnI,UAAU,CAACA,OAAOL,SAAR,IAAqBK,OAAOL,SAAP,EAAxD,CAAhB;;AACA,YAAIgF,QAAQxH,MAAZ,EAAoB;AACnBsQ,cAAI1J,GAAJ,IAAWY,OAAX;AACA;;AACD,eAAO8I,GAAP;AACA,OANM,EAMJ,EANI,CAAP;AAOA;;AAED,WAAO,KAAK9I,OAAL,CAAa2I,KAAb,EAAoBnF,MAApB,CAA2BnI,UAAU,CAACA,OAAOL,SAAR,IAAqBK,OAAOL,SAAP,EAA1D,CAAP;AACA;;AAED+N,UAAQjQ,EAAR,EAAY;AACX,UAAMkQ,iBAAiB,KAAKhJ,OAA5B;AACA,QAAIA,UAAU,EAAd;AACAf,WAAOC,IAAP,CAAY8J,cAAZ,EAA4B7J,OAA5B,CAAoC,UAAS9D,MAAT,EAAiB;AACpD2E,gBAAUA,QAAQY,MAAR,CAAeoI,eAAe3N,MAAf,CAAf,CAAV;AACA,KAFD;AAIA,WAAO2E,QAAQwD,MAAR,CAAenI,UAAUA,OAAOvC,EAAP,KAAcA,EAAvC,CAAP;AACA;;AAxDwC,CAAV,EAAhC,C;;;;;;;;;;;ACFA5B,WAAW4Q,YAAX,GAA0B,IAAI,MAAM;AACnCzP,gBAAc;AACb,SAAK4Q,KAAL,GAAa,EAAb;AACA;;AAEDC,eAAajC,OAAb,EAAsB;AACrB,WAAO,KAAKgC,KAAL,CAAWhC,QAAQnO,EAAnB,IAAyBmO,OAAhC;AACA;;AAEDc,UAAQG,OAAR,EAAiB;AAChB,WAAO,KAAKe,KAAL,CAAWf,WAAWA,QAAQ9N,CAA9B,CAAP;AACA;;AAED+O,kBAAgBjB,OAAhB,EAAyB;AACxB,UAAM/E,OAAO,KAAK8F,KAAL,CAAWf,WAAWA,QAAQ9N,CAA9B,CAAb;AACA,WAAO+I,QAAQA,KAAKiG,MAApB;AACA;;AAhBkC,CAAV,EAA1B;AAoBAtP,OAAOuP,OAAP,CAAe,YAAW;AACzBnS,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,GADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,mBAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACNoB,mBAAWpB,QAAQT,GADb;AAEN8B,iBAASrB,QAAQK,CAAR,CAAU/M;AAFb,OAAP;AAIA;;AATmC,GAArC;AAWAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,IADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,eAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACNsB,oBAAYtB,QAAQT,GADd;AAEN8B,iBAASrB,QAAQK,CAAR,CAAU/M;AAFb,OAAP;AAIA;;AATmC,GAArC;AAWAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,IADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,iBAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACNuB,sBAAcvB,QAAQT,GADhB;AAEN8B,iBAASrB,QAAQK,CAAR,CAAU/M;AAFb,OAAP;AAIA;;AATmC,GAArC;AAWAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,IADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,WAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACNwB,mBAAWxB,QAAQK,CAAR,CAAU/M;AADf,OAAP;AAGA;;AARmC,GAArC;AAUAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,IADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,qBAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACNjN,cAAMiN,QAAQK,CAAR,CAAU/M;AADV,OAAP;AAGA;;AARmC,GAArC;AAUAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,IADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,SAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACNjN,cAAMiN,QAAQK,CAAR,CAAU/M;AADV,OAAP;AAGA;;AARmC,GAArC;AAUAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,IADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,iBAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACNjN,cAAMiN,QAAQK,CAAR,CAAU/M;AADV,OAAP;AAGA;;AARmC,GAArC;AAUAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,KADgC;;AAEpCkP,WAAOE,OAAP,EAAgB;AACf,aAAOhR,WAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,kBAAzB,EAA6CoG,OAA7C,CAAP;AACA;;AAJmC,GAArC;AAMAhR,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,YADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,eAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACNyB,oBAAYzB,QAAQT,GADd;AAEN8B,iBAASrB,QAAQK,CAAR,CAAU/M;AAFb,OAAP;AAIA;;AATmC,GAArC;AAWAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,cADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,iBAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACN0B,sBAAc1B,QAAQT,GADhB;AAEN8B,iBAASrB,QAAQK,CAAR,CAAU/M;AAFb,OAAP;AAIA;;AATmC,GAArC;AAWAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,yBADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,yCAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACN1M,kBAAU0M,QAAQT,GADZ;AAENoC,cAAM3B,QAAQ2B,IAFR;AAGNN,iBAASrB,QAAQK,CAAR,CAAU/M;AAHb,OAAP;AAKA;;AAVmC,GAArC;AAYAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,2BADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,sDAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACN1M,kBAAU0M,QAAQT,GADZ;AAENoC,cAAM3B,QAAQ2B,IAFR;AAGNN,iBAASrB,QAAQK,CAAR,CAAU/M;AAHb,OAAP;AAKA;;AAVmC,GAArC;AAYAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,eADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,2CAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACN1M,kBAAU0M,QAAQK,CAAR,CAAU/M;AADd,OAAP;AAGA;;AARmC,GAArC;AAUAtE,aAAW4Q,YAAX,CAAwBoB,YAAxB,CAAqC;AACpCpQ,QAAI,iBADgC;AAEpCsQ,YAAQ,IAF4B;AAGpClB,aAAS,6CAH2B;;AAIpCnD,SAAKmD,OAAL,EAAc;AACb,aAAO;AACN1M,kBAAU0M,QAAQK,CAAR,CAAU/M;AADd,OAAP;AAGA;;AARmC,GAArC;AAUA,CAlJD,E;;;;;;;;;;;ACpBA,IAAIsO,MAAJ;;AAEA,IAAIhQ,OAAOC,QAAX,EAAqB;AACpB+P,WAAS,IAAIC,MAAJ,CAAW,oBAAX,EAAiC,EAAjC,CAAT;AACA;;AAED7S,WAAW8S,kBAAX,GAAgC,UAASC,QAAT,EAAmBC,MAAnB,EAA2B;AAE1D,QAAMC,gBAAgB,gBAAtB;AACA,MAAIzH,QAAQyH,cAAcC,IAAd,CAAmBH,QAAnB,CAAZ;AACA,MAAII,cAAcJ,QAAlB;;AAEA,MAAIvH,SAAS,IAAb,EAAmB;AAClB,QAAI,CAACwH,OAAOI,cAAP,CAAsBL,QAAtB,CAAL,EAAsC;AACrCH,gBAAUA,OAAOS,KAAP,CAAc,iCAAiCN,QAAU,EAAzD,CAAV;AACA;AACA;;AACD,WAAOC,OAAOD,QAAP,CAAP;AACA,GAND,MAMO;AACNH,cAAUA,OAAOS,KAAP,CAAa,kCAAb,CAAV;;AACA,WAAO7H,SAAS,IAAhB,EAAsB;AACrB,YAAM8H,UAAU9H,MAAM,CAAN,CAAhB;AACA,YAAM+H,eAAe/H,MAAM,CAAN,CAArB;;AAEA,UAAI,CAACwH,OAAOI,cAAP,CAAsBG,YAAtB,CAAL,EAA0C;AACzCX,kBAAUA,OAAOS,KAAP,CAAc,iCAAiCE,YAAc,EAA7D,CAAV;AACA;AACA;;AAED,YAAMC,UAAUR,OAAOO,YAAP,CAAhB;AACAX,gBAAUA,OAAOS,KAAP,CAAc,2BAA2BC,OAAS,gBAAgBE,OAAS,EAA3E,CAAV;AACAL,oBAAcA,YAAY3G,OAAZ,CAAoB8G,OAApB,EAA6BE,OAA7B,CAAd;AACAhI,cAAQyH,cAAcC,IAAd,CAAmBH,QAAnB,CAAR;AACA;;AACD,WAAOI,WAAP;AACA;AACD,CA9BD,C;;;;;;;;;;;ACNA;;;;AAIAnT,WAAWgE,iBAAX,GAA+B,UAASD,IAAT,EAAemE,GAAf,EAAoBuL,eAAaC,SAAjC,EAA4C;AAC1E,MAAIC,UAAJ;;AAEA,MAAI5P,QAAQA,KAAKqB,QAAb,IAAyBrB,KAAKqB,QAAL,CAAcwO,WAAvC,IACH7P,KAAKqB,QAAL,CAAcwO,WAAd,CAA0BR,cAA1B,CAAyClL,GAAzC,CADD,EACgD;AAC/CyL,iBAAa5P,KAAKqB,QAAL,CAAcwO,WAAd,CAA0B1L,GAA1B,CAAb;AACA,GAHD,MAGO,IAAIuL,iBAAiBC,SAArB,EAAgC;AACtCC,iBAAa3T,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,qCAAqC6C,GAAK,EAAnE,CAAb;AACA;;AAED,SAAOyL,eAAeD,SAAf,GAA2BC,UAA3B,GAAwCF,YAA/C;AACA,CAXD,C;;;;;;;;;;;ACJA;AACAzT,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,EAAoC,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AACxD,MAAIA,SAAS,IAAT,IAAiBA,MAAMpB,IAAN,OAAiB,EAAtC,EAA0C;AACzC;AACA;;AACD,MAAI8M,OAAO1L,MAAMqE,OAAN,CAAc,KAAd,EAAqB,EAArB,CAAX,CAJwD,CAKxD;;AACA,QAAMhB,QAAQrD,MAAMqD,KAAN,CAAY,2BAAZ,CAAd;;AACA,MAAIA,SAAS,IAAb,EAAmB;AAClBqI,WAAOrI,MAAM,CAAN,CAAP,CADkB,CAElB;AACA;;AACDvE,4BAA0B6M,QAA1B,GAAqC3L,KAArC;;AAEA,MAAIvF,OAAO2E,WAAP,CAAmBwM,cAAnB,IAAqCnR,OAAO2E,WAAP,CAAmBwM,cAAnB,CAAkCC,OAA3E,EAAoF;AACnFpR,WAAO2E,WAAP,CAAmBwM,cAAnB,CAAkCC,OAAlC,GAA4C7L,KAA5C;AACA;;AACD,MAAIvF,OAAOC,QAAX,EAAqB;AACpB7C,eAAWiU,QAAX,GAAsBJ,KAAKrH,OAAL,CAAa,cAAb,EAA6B,EAA7B,CAAtB;AACA0H,YAAQC,GAAR,CAAYC,eAAZ,GAA8BP,IAA9B;AACAK,YAAQC,GAAR,CAAYE,cAAZ,GAA6BR,IAA7B;;AACA,QAAI,OAAOS,eAAP,KAA2B,WAA3B,IAA0CA,gBAAgBC,mBAA9D,EAAmF;AAClF,aAAOD,gBAAgBC,mBAAhB,EAAP;AACA;AACD;AACD,CAxBD,E;;;;;;;;;;;ACDA,IAAI/M,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAGN,MAAM6S,SAAS,IAAIC,MAAJ,CAAW,QAAX,EAAqB;AACnC1C,WAAS;AACRE,YAAQ;AACPpE,YAAM;AADC,KADA;AAIRuI,aAAS;AACRvI,YAAM;AADE;AAJD;AAD0B,CAArB,CAAf;;AAWA,MAAMwI,cAAc,UAASrT,IAAT,EAAesT,eAAf,EAAgCC,UAAhC,EAA4C;AAC/DA,aAAWvT,IAAX,IAAmB,YAAW;AAC7B,UAAMwT,OAAOxT,SAAS,UAAT,GAAsByT,MAAMC,SAAN,CAAgBC,KAAhB,CAAsBrM,IAAtB,CAA2BsM,SAA3B,EAAsC,CAAtC,CAAtB,GAAiEA,SAA9E;AACApC,WAAOvC,MAAP,CAAcjP,IAAd,EAAoB,YAApB,EAAkCwB,OAAOI,MAAP,EAAlC,EAAmD,eAAnD,EAAoE4R,IAApE;AAEA,WAAOF,gBAAgBO,KAAhB,CAAsB,IAAtB,EAA4BD,SAA5B,CAAP;AACA,GALD;AAMA,CAPD;;AASA,MAAME,wBAAwBtS,OAAOuN,OAArC;;AAEAvN,OAAOuN,OAAP,GAAiB,UAASgF,SAAT,EAAoB;AACpC3N,IAAE4N,IAAF,CAAOD,SAAP,EAAkB,UAASE,OAAT,EAAkBjU,IAAlB,EAAwB;AACzCqT,gBAAYrT,IAAZ,EAAkBiU,OAAlB,EAA2BF,SAA3B;AACA,GAFD;;AAGAD,wBAAsBC,SAAtB;AACA,CALD;;AAOA,MAAMG,wBAAwB1S,OAAO4R,OAArC;;AAEA5R,OAAO4R,OAAP,GAAiB,UAASpT,IAAT,EAAemU,IAAf,EAAqB;AACrC,SAAOD,sBAAsBlU,IAAtB,EAA4B,YAAW;AAC7CwR,WAAO4B,OAAP,CAAepT,IAAf,EAAqB,YAArB,EAAmC,KAAK4B,MAAxC,EAAgD,eAAhD,EAAiEgS,SAAjE;AAEA,WAAOO,KAAKN,KAAL,CAAW,IAAX,EAAiBD,SAAjB,CAAP;AACA,GAJM,CAAP;AAKA,CAND;;AAQAQ,OAAOC,kBAAP,CAA0BC,GAA1B,CAA8B,UAASC,GAAT,EAAcC,GAAd,EAAmBnI,IAAnB,EAAyB;AACtDmI,MAAIC,SAAJ,CAAc,eAAd,EAA+BC,eAAelU,EAAf,EAA/B;AACA,SAAO6L,MAAP;AACA,CAHD,E;;;;;;;;;;;AC1CA,IAAIsI,OAAJ;AAAYpW,OAAOC,KAAP,CAAaC,QAAQ,SAAR,CAAb,EAAgC;AAACC,UAAQC,CAAR,EAAU;AAACgW,cAAQhW,CAAR;AAAU;;AAAtB,CAAhC,EAAwD,CAAxD;AAEZC,WAAW+V,OAAX,GAAqBA,OAArB;AAEA/V,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,iBAAxB,EAA2C,CAAC6C,GAAD,EAAMC,KAAN,KAAgB;AAC1D,MAAIA,KAAJ,EAAW;AACV4N,YAAQC,QAAR,CAAiB7N,KAAjB;AACA;AACD,CAJD;;AAMA,MAAM8N,SAAS,UAASjF,OAAT,EAAkB1G,KAAlB,EAAyB;AACvC,MAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC9B0G,eAAY,IAAI1G,KAAO,EAAvB;AACA;;AACD,MAAIyF,UAAU,EAAd;;AACA,MAAI/P,WAAWkW,IAAf,EAAqB;AACpBnG,cAAU;AAAEoG,WAAK;AAAEC,iBAASpW,WAAWkW,IAAX,CAAgBE,OAA3B;AAAoCC,cAAMrW,WAAWkW;AAArD;AAAP,KAAV;AACA;;AACD,QAAM5I,QAAQ,IAAI/L,KAAJ,CAAUyP,OAAV,CAAd;AACA1D,QAAMhD,KAAN,GAAcA,KAAd;AACAtK,aAAW+V,OAAX,CAAmBE,MAAnB,CAA0B3I,KAA1B,EAAiCyC,OAAjC;AACA,CAXD;;AAaAmE,QAAQoC,EAAR,CAAW,mBAAX,EAAgC1T,OAAO2T,eAAP,CAAwBjJ,KAAD,IAAW;AACjE2I,SAAO3I,MAAM0D,OAAb,EAAsB1D,MAAMhD,KAA5B;AACA,QAAMgD,KAAN;AACA,CAH+B,CAAhC;AAKA,MAAMkJ,sBAAsB5T,OAAO6T,MAAnC;;AACA7T,OAAO6T,MAAP,GAAgB,YAAW;AAC1BR,SAAO,GAAGjB,SAAV;AACA,SAAOwB,oBAAoB,GAAGxB,SAAvB,CAAP;AACA,CAHD,C;;;;;;;;;;;AC7BA,IAAI0B,MAAJ;AAAW/W,OAAOC,KAAP,CAAaC,QAAQ,aAAR,CAAb,EAAoC;AAACC,UAAQC,CAAR,EAAU;AAAC2W,aAAO3W,CAAP;AAAS;;AAArB,CAApC,EAA2D,CAA3D;AAEXC,WAAW2W,UAAX,GAAwBD,MAAxB;AAEA1W,WAAW4W,OAAX,GAAqB,EAArB,C,CAEA;;AAEA5W,WAAW4W,OAAX,CAAmBC,YAAnB,GAAkC,IAAIH,OAAOI,OAAX,CAAmB;AAAC,UAAQ,cAAT;AAAyB,UAAQ;AAAjC,CAAnB,CAAlC,C;;;;;;;;;;;ACRA,IAAItP,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAGNC,WAAW+W,WAAX,GAAyB,IAAI,MAAM;AAClCC,gBAAcC,EAAd,EAAkBC,WAAlB,EAA+BC,YAA/B,EAA6CC,QAA7C,EAAuD;AACtD,QAAIlD,QAAQC,GAAR,CAAYkD,SAAZ,KAA0B,MAA9B,EAAsC;AACrC,aAAOJ,EAAP;AACA;;AACD,UAAMK,cAAc,IAAIP,WAAJ,EAApB;AACAO,gBAAYC,OAAZ,CAAoBH,QAApB,EAA8BF,WAA9B,EAA2CC,YAA3C;AACA,WAAO,UAAS,GAAGvC,IAAZ,EAAkB;AACxB,YAAMpJ,QAAQ,EAAd;;AACAhE,QAAE4N,IAAF,CAAOgC,QAAP,EAAiB,UAASI,OAAT,EAAkBtP,GAAlB,EAAuB;AACvC,eAAOsD,MAAMtD,GAAN,IAAa0M,KAAK1M,GAAL,CAApB;AACA,OAFD;;AAGAoP,kBAAYG,SAAZ,CAAsBjM,KAAtB;AACA,YAAMkM,kBAAkBJ,YAAYK,KAAZ,CAAkBnM,KAAlB,CAAxB;;AACA,UAAIkM,gBAAgBE,OAApB,EAA6B;AAC5B,eAAOX,GAAGhC,KAAH,CAAS,IAAT,EAAeD,SAAf,CAAP;AACA,OAFD,MAEO;AACN,cAAM,IAAIpS,OAAOrB,KAAX,CAAiB,yBAAjB,EAA6C,6DAA6DsW,KAAKC,IAAL,CAAUJ,gBAAgBK,WAAhB,GAA8B,IAAxC,CAA+C,+BAAzJ,EAAyL;AAC9LA,uBAAaL,gBAAgBK,WADiK;AAE9LC,mBAASH,KAAKC,IAAL,CAAUJ,gBAAgBK,WAAhB,GAA8B,IAAxC;AAFqL,SAAzL,CAAN;AAIA;AACD,KAfD;AAgBA;;AAEDE,cAAYC,UAAZ,EAAwBhB,WAAxB,EAAqCC,YAArC,EAAmDC,QAAnD,EAA6D;AAC5D,QAAIlD,QAAQC,GAAR,CAAYkD,SAAZ,KAA0B,MAA9B,EAAsC;AACrC;AACA;;AACD,UAAM7L,QAAQ;AACbS,YAAM,QADO;AAEb7K,YAAM8W;AAFO,KAAd;;AAIA1Q,MAAE4N,IAAF,CAAOgC,QAAP,EAAiB,UAASI,OAAT,EAAkBtP,GAAlB,EAAuB;AACvC,aAAOsD,MAAMtD,GAAN,IAAakP,SAASlP,GAAT,CAApB;AACA,KAFD;;AAGA,WAAOiQ,eAAeZ,OAAf,CAAuB/L,KAAvB,EAA8B0L,WAA9B,EAA2CC,YAA3C,CAAP;AACA;;AArCiC,CAAV,EAAzB,C;;;;;;;;;;;ACHA;AACAnX,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,aAAxB,EAAuC,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AAC3D,SAAOiQ,cAAcC,WAAd,GAA4BlQ,KAAnC;AACA,CAFD;AAIAnI,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,EAAoC,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AACxD,SAAOiQ,cAAcE,eAAd,GAAgCnQ,KAAvC;AACA,CAFD;AAIAnI,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,WAAxB,EAAqC,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AACzD,MAAIA,SAAS,IAAb,EAAmB;AAClBiQ,kBAAcG,QAAd,GAAyBC,SAASrQ,KAAT,CAAzB;AACAvF,WAAO6V,UAAP,CAAkB,MAAM;AACvB,aAAOL,cAAcM,MAAd,CAAqB,IAArB,CAAP;AACA,KAFD,EAEG,GAFH;AAGA;AACD,CAPD,E;;;;;;;;;;;ACTA;AACA,MAAMC,gBAAN,CAAuB;AACtBC,oBAAkBnT,MAAlB,EAA0B;AACzB,UAAMoT,WAAW7Y,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,CAAjB;AACA,WAAO,KAAKyT,IAAL,CAAW,GAAGD,QAAU,IAAIpT,MAAQ,EAApC,CAAP,CAFyB,CAEsB;AAC/C;;AAEDqT,OAAKlL,GAAL,EAAU;AACT,QAAIkL,OAAO,CAAX;AACA,QAAIC,IAAInL,IAAItM,MAAZ;;AAEA,WAAOyX,CAAP,EAAU;AACTD,aAAQ,CAACA,QAAQ,CAAT,IAAcA,IAAf,GAAuBlL,IAAIoL,UAAJ,CAAe,EAAED,CAAjB,CAA9B;AACAD,aAAOA,OAAOA,IAAd,CAFS,CAEW;AACpB;;AACD,WAAOA,IAAP;AACA;;AAEDG,OAAK;AAAEjU,YAAF;AAAYS,UAAZ;AAAoBnB,YAApB;AAA8B0M,WAA9B;AAAuCkI,WAAvC;AAAgDC,WAAhD;AAAyDC,YAAQ,CAAjE;AAAoEC;AAApE,GAAL,EAAqF;AACpF,QAAIC,KAAJ;;AACA,QAAItU,YAAYA,aAAa,EAA7B,EAAiC;AAChCsU,cAAS,GAAGtU,QAAU,EAAtB;AACAgM,gBAAW,GAAG1M,QAAU,KAAK0M,OAAS,EAAtC;AACA,KAHD,MAGO;AACNsI,cAAS,GAAGhV,QAAU,EAAtB;AACA;;AACD,UAAMxC,OAAO9B,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oBAAxB,EAA8CkU,GAA9C,IAAqDvZ,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oBAAxB,EAA8CmU,UAAhH;AACA,UAAM9H,SAAS;AACd+H,YAAM,MADQ;AAEdL,WAFc;AAGdM,aAAO,SAHO;AAIdJ,WAJc;AAKdK,YAAM3I,OALQ;AAMdmI,aANc;AAOdzU,aAAOwU,OAPO;AAQdU,aAAO,KAAKhB,iBAAL,CAAuBnT,MAAvB,CARO;AASdoU,WAAK;AACJC,eAAO,OADH;AAEJC,qBAAa,kBAFT;AAGJC,eAAOha,WAAW0G,MAAX,CAAkB5E,IAAlB,EAAwB;AAAE8E,gBAAM;AAAR,SAAxB;AAHH;AATS,KAAf;;AAgBA,QAAIyS,aAAa,EAAjB,EAAqB;AACpB3H,aAAOuI,GAAP,GAAa;AACZZ;AADY,OAAb;AAGA;;AAED,WAAOa,KAAKjB,IAAL,CAAUvH,MAAV,CAAP;AACA;;AAjDqB;;AAoDvB1R,WAAW2Y,gBAAX,GAA8B,IAAIA,gBAAJ,EAA9B,C;;;;;;;;;;;ACrDA3Y,WAAWma,2BAAX,GAAyC,CACxC,YADwC,EAExC,SAFwC,EAGxC,SAHwC,EAIxC,iBAJwC,EAKxC,UALwC,EAMxC,UANwC,EAOxC,YAPwC,EAQxC,gBARwC,EASxC,oBATwC,EAUxC,kBAVwC,EAWxC,iBAXwC,EAYxC,WAZwC,EAaxC,YAbwC,EAcxC,gBAdwC,EAexC,SAfwC,EAgBxC,YAhBwC,EAiBxC,YAjBwC,EAkBxC,WAlBwC,EAmBxC,WAnBwC,EAoBxC,kBApBwC,EAqBxC,UArBwC,EAsBxC,iBAtBwC,EAuBxC,YAvBwC,EAwBxC,kBAxBwC,EAyBxC,YAzBwC,EA0BxC,iBA1BwC,EA2BxC,iBA3BwC,EA4BxC,gBA5BwC,EA6BxC,cA7BwC,EA8BxC,cA9BwC,EA+BxC,cA/BwC,EAgCxC,iBAhCwC,EAiCxC,kBAjCwC,EAkCxC,gBAlCwC,EAmCxC,gBAnCwC,EAoCxC,gBApCwC,EAqCxC,iBArCwC,EAsCxC,QAtCwC,EAuCxC,UAvCwC,EAwCxC,UAxCwC,EAyCxC,eAzCwC,EA0CxC,eA1CwC,EA2CxC,eA3CwC,EA4CxC,oBA5CwC,EA6CxC,WA7CwC,EA8CxC,eA9CwC,EA+CxC,SA/CwC,EAgDxC,UAhDwC,EAiDxC,QAjDwC,EAkDxC,eAlDwC,EAmDxC,eAnDwC,EAoDxC,aApDwC,EAqDxC,eArDwC,EAsDxC,eAtDwC,EAuDxC,UAvDwC,EAwDxC,cAxDwC,EAyDxC,QAzDwC,EA0DxC,aA1DwC,EA2DxC,cA3DwC,EA4DxC,cA5DwC,EA6DxC,WA7DwC,EA8DxC,cA9DwC,EA+DxC,WA/DwC,EAgExC,qBAhEwC,EAiExC,eAjEwC,EAkExC,cAlEwC,EAmExC,aAnEwC,EAoExC,cApEwC,EAqExC,cArEwC,EAsExC,eAtEwC,EAuExC,cAvEwC,EAwExC,cAxEwC,EAyExC,YAzEwC,EA0ExC,aA1EwC,EA2ExC,iBA3EwC,EA4ExC,aA5EwC,EA6ExC,aA7EwC,EA8ExC,uBA9EwC,EA+ExC,UA/EwC,EAgFxC,WAhFwC,EAiFxC,gBAjFwC,EAkFxC,YAlFwC,EAmFxC,cAnFwC,EAoFxC,iBApFwC,EAqFxC,eArFwC,EAsFxC,cAtFwC,EAuFxC,gBAvFwC,EAwFxC,eAxFwC,EAyFxC,cAzFwC,EA0FxC,aA1FwC,EA2FxC,aA3FwC,EA4FxC,SA5FwC,EA6FxC,YA7FwC,EA8FxC,eA9FwC,EA+FxC,eA/FwC,EAgGxC,cAhGwC,EAiGxC,oBAjGwC,EAkGxC,oBAlGwC,EAmGxC,WAnGwC,EAoGxC,eApGwC,EAqGxC,kBArGwC,EAsGxC,eAtGwC,EAuGxC,cAvGwC,EAwGxC,eAxGwC,EAyGxC,SAzGwC,EA0GxC,cA1GwC,EA2GxC,kBA3GwC,EA4GxC,gBA5GwC,EA6GxC,kBA7GwC,EA8GxC,yBA9GwC,EA+GxC,SA/GwC,EAgHxC,OAhHwC,EAiHxC,cAjHwC,EAkHxC,YAlHwC,EAmHxC,cAnHwC,EAoHxC,WApHwC,EAqHxC,QArHwC,EAsHxC,aAtHwC,EAuHxC,gBAvHwC,EAwHxC,gBAxHwC,EAyHxC,aAzHwC,EA0HxC,cA1HwC,EA2HxC,oBA3HwC,EA4HxC,cA5HwC,EA6HxC,iBA7HwC,EA8HxC,gBA9HwC,EA+HxC,gBA/HwC,EAgIxC,gBAhIwC,EAiIxC,aAjIwC,EAkIxC,WAlIwC,EAmIxC,WAnIwC,EAoIxC,WApIwC,EAqIxC,gBArIwC,EAsIxC,kBAtIwC,EAuIxC,YAvIwC,EAwIxC,mBAxIwC,EAyIxC,cAzIwC,EA0IxC,gBA1IwC,EA2IxC,wBA3IwC,EA4IxC,cA5IwC,EA6IxC,kBA7IwC,EA8IxC,eA9IwC,EA+IxC,eA/IwC,EAgJxC,SAhJwC,EAiJxC,UAjJwC,EAkJxC,QAlJwC,EAmJxC,eAnJwC,EAoJxC,aApJwC,EAqJxC,gBArJwC,EAsJxC,YAtJwC,EAuJxC,aAvJwC,EAwJxC,aAxJwC,EAyJxC,iBAzJwC,EA0JxC,cA1JwC,EA2JxC,YA3JwC,EA4JxC,YA5JwC,EA6JxC,YA7JwC,EA8JxC,WA9JwC,EA+JxC,eA/JwC,EAgKxC,iBAhKwC,EAiKxC,UAjKwC,EAkKxC,sBAlKwC,EAmKxC,cAnKwC,EAoKxC,eApKwC,EAqKxC,iBArKwC,EAsKxC,gBAtKwC,EAuKxC,uBAvKwC,EAwKxC,8BAxKwC,EAyKxC,yCAzKwC,EA0KxC,qBA1KwC,EA2KxC,YA3KwC,EA4KxC,kBA5KwC,EA6KxC,iBA7KwC,EA8KxC,iBA9KwC,EA+KxC,YA/KwC,EAgLxC,qBAhLwC,EAiLxC,gCAjLwC,EAkLxC,aAlLwC,EAmLxC,YAnLwC,EAoLxC,YApLwC,EAqLxC,WArLwC,EAsLxC,eAtLwC,EAuLxC,aAvLwC,EAwLxC,aAxLwC,EAyLxC,mBAzLwC,EA0LxC,YA1LwC,EA2LxC,WA3LwC,EA4LxC,WA5LwC,EA6LxC,aA7LwC,EA8LxC,aA9LwC,EA+LxC,QA/LwC,EAgMxC,UAhMwC,EAiMxC,aAjMwC,EAkMxC,iBAlMwC,EAmMxC,iBAnMwC,EAoMxC,aApMwC,EAqMxC,gBArMwC,EAsMxC,cAtMwC,EAuMxC,YAvMwC,EAwMxC,YAxMwC,EAyMxC,YAzMwC,EA0MxC,mBA1MwC,EA2MxC,eA3MwC,EA4MxC,YA5MwC,EA6MxC,WA7MwC,EA8MxC,gBA9MwC,EA+MxC,aA/MwC,EAgNxC,gBAhNwC,EAiNxC,YAjNwC,EAkNxC,cAlNwC,EAmNxC,aAnNwC,EAoNxC,iBApNwC,EAqNxC,eArNwC,EAsNxC,gBAtNwC,EAuNxC,iBAvNwC,EAwNxC,iBAxNwC,EAyNxC,qBAzNwC,EA0NxC,qBA1NwC,EA2NxC,kBA3NwC,EA4NxC,wBA5NwC,EA6NxC,cA7NwC,EA8NxC,cA9NwC,EA+NxC,YA/NwC,EAgOxC,iBAhOwC,EAiOxC,cAjOwC,EAkOxC,eAlOwC,EAmOxC,UAnOwC,EAoOxC,UApOwC,EAqOxC,UArOwC,EAsOxC,SAtOwC,EAuOxC,aAvOwC,EAwOxC,cAxOwC,EAyOxC,cAzOwC,EA0OxC,eA1OwC,EA2OxC,eA3OwC,EA4OxC,eA5OwC,EA6OxC,WA7OwC,EA8OxC,iBA9OwC,EA+OxC,gBA/OwC,EAgPxC,cAhPwC,EAiPxC,eAjPwC,EAkPxC,qBAlPwC,EAmPxC,aAnPwC,EAoPxC,eApPwC,EAqPxC,YArPwC,EAsPxC,kBAtPwC,EAuPxC,gBAvPwC,EAwPxC,eAxPwC,EAyPxC,eAzPwC,EA0PxC,kBA1PwC,EA2PxC,kBA3PwC,EA4PxC,eA5PwC,EA6PxC,oBA7PwC,EA8PxC,gBA9PwC,EA+PxC,gBA/PwC,EAgQxC,gBAhQwC,EAiQxC,gBAjQwC,EAkQxC,gBAlQwC,EAmQxC,aAnQwC,EAoQxC,cApQwC,EAqQxC,kBArQwC,EAsQxC,WAtQwC,EAuQxC,WAvQwC,EAwQxC,cAxQwC,EAyQxC,aAzQwC,EA0QxC,YA1QwC,EA2QxC,aA3QwC,EA4QxC,aA5QwC,EA6QxC,YA7QwC,EA8QxC,aA9QwC,EA+QxC,aA/QwC,EAgRxC,gBAhRwC,EAiRxC,eAjRwC,EAkRxC,cAlRwC,EAmRxC,aAnRwC,EAoRxC,oBApRwC,EAqRxC,aArRwC,EAsRxC,gBAtRwC,EAuRxC,cAvRwC,EAwRxC,iBAxRwC,EAyRxC,SAzRwC,EA0RxC,gBA1RwC,EA2RxC,+BA3RwC,EA4RxC,YA5RwC,EA6RxC,cA7RwC,EA8RxC,aA9RwC,EA+RxC,gBA/RwC,EAgSxC,aAhSwC,EAiSxC,gBAjSwC,EAkSxC,gBAlSwC,EAmSxC,gBAnSwC,EAoSxC,cApSwC,EAqSxC,4BArSwC,EAsSxC,eAtSwC,EAuSxC,WAvSwC,EAwSxC,eAxSwC,EAySxC,8BAzSwC,EA0SxC,aA1SwC,EA2SxC,aA3SwC,EA4SxC,aA5SwC,EA6SxC,sBA7SwC,EA8SxC,iBA9SwC,EA+SxC,kBA/SwC,EAgTxC,gBAhTwC,EAiTxC,iBAjTwC,EAkTxC,iBAlTwC,EAmTxC,iBAnTwC,EAoTxC,2BApTwC,EAqTxC,mBArTwC,EAsTxC,kBAtTwC,EAuTxC,cAvTwC,EAwTxC,iBAxTwC,EAyTxC,kBAzTwC,EA0TxC,eA1TwC,EA2TxC,gBA3TwC,EA4TxC,QA5TwC,EA6TxC,YA7TwC,EA8TxC,kBA9TwC,EA+TxC,kBA/TwC,EAgUxC,kBAhUwC,EAiUxC,kBAjUwC,EAkUxC,mBAlUwC,EAmUxC,mBAnUwC,EAoUxC,kBApUwC,EAqUxC,oBArUwC,EAsUxC,mBAtUwC,EAuUxC,mBAvUwC,EAwUxC,wBAxUwC,EAyUxC,WAzUwC,EA0UxC,iBA1UwC,EA2UxC,SA3UwC,EA4UxC,YA5UwC,EA6UxC,eA7UwC,EA8UxC,kBA9UwC,EA+UxC,YA/UwC,EAgVxC,aAhVwC,EAiVxC,cAjVwC,EAkVxC,iBAlVwC,EAmVxC,SAnVwC,EAoVxC,aApVwC,EAqVxC,WArVwC,EAsVxC,aAtVwC,EAuVxC,eAvVwC,EAwVxC,cAxVwC,EAyVxC,YAzVwC,EA0VxC,YA1VwC,EA2VxC,WA3VwC,EA4VxC,aA5VwC,EA6VxC,eA7VwC,EA8VxC,aA9VwC,EA+VxC,mBA/VwC,EAgWxC,gBAhWwC,EAiWxC,kBAjWwC,EAkWxC,aAlWwC,EAmWxC,WAnWwC,EAoWxC,gBApWwC,EAqWxC,UArWwC,EAsWxC,UAtWwC,EAuWxC,gBAvWwC,EAwWxC,gBAxWwC,EAyWxC,gBAzWwC,EA0WxC,gBA1WwC,EA2WxC,mBA3WwC,EA4WxC,mBA5WwC,EA6WxC,mBA7WwC,EA8WxC,eA9WwC,EA+WxC,cA/WwC,EAgXxC,cAhXwC,EAiXxC,gBAjXwC,EAkXxC,eAlXwC,EAmXxC,kBAnXwC,EAoXxC,iBApXwC,EAqXxC,QArXwC,EAsXxC,UAtXwC,EAuXxC,cAvXwC,EAwXxC,SAxXwC,EAyXxC,cAzXwC,EA0XxC,aA1XwC,EA2XxC,eA3XwC,EA4XxC,aA5XwC,EA6XxC,aA7XwC,EA8XxC,WA9XwC,EA+XxC,gBA/XwC,EAgYxC,kBAhYwC,EAiYxC,YAjYwC,EAkYxC,aAlYwC,EAmYxC,YAnYwC,EAoYxC,gBApYwC,EAqYxC,cArYwC,EAsYxC,cAtYwC,EAuYxC,cAvYwC,EAwYxC,WAxYwC,EAyYxC,WAzYwC,EA0YxC,iBA1YwC,EA2YxC,iBA3YwC,EA4YxC,WA5YwC,EA6YxC,SA7YwC,EA8YxC,aA9YwC,EA+YxC,oBA/YwC,EAgZxC,cAhZwC,EAiZxC,SAjZwC,EAkZxC,cAlZwC,EAmZxC,SAnZwC,EAoZxC,aApZwC,EAqZxC,eArZwC,EAsZxC,oBAtZwC,EAuZxC,WAvZwC,EAwZxC,gBAxZwC,EAyZxC,eAzZwC,EA0ZxC,cA1ZwC,EA2ZxC,WA3ZwC,EA4ZxC,gBA5ZwC,EA6ZxC,aA7ZwC,EA8ZxC,cA9ZwC,EA+ZxC,cA/ZwC,EAgaxC,YAhawC,EAiaxC,cAjawC,EAkaxC,mBAlawC,EAmaxC,UAnawC,EAoaxC,WApawC,EAqaxC,UArawC,EAsaxC,QAtawC,EAuaxC,cAvawC,EAwaxC,aAxawC,EAyaxC,iBAzawC,EA0axC,oBA1awC,EA2axC,SA3awC,EA4axC,oBA5awC,EA6axC,YA7awC,EA8axC,aA9awC,EA+axC,WA/awC,EAgbxC,WAhbwC,EAibxC,cAjbwC,EAkbxC,aAlbwC,EAmbxC,gBAnbwC,EAobxC,eApbwC,EAqbxC,aArbwC,EAsbxC,gBAtbwC,EAubxC,gBAvbwC,EAwbxC,aAxbwC,EAybxC,eAzbwC,EA0bxC,WA1bwC,EA2bxC,aA3bwC,EA4bxC,aA5bwC,EA6bxC,YA7bwC,EA8bxC,eA9bwC,EA+bxC,WA/bwC,EAgcxC,cAhcwC,EAicxC,gBAjcwC,EAkcxC,WAlcwC,EAmcxC,iBAncwC,EAocxC,oBApcwC,EAqcxC,YArcwC,EAscxC,cAtcwC,EAucxC,eAvcwC,EAwcxC,cAxcwC,EAycxC,gBAzcwC,EA0cxC,gBA1cwC,EA2cxC,gBA3cwC,EA4cxC,gBA5cwC,EA6cxC,eA7cwC,EA8cxC,iBA9cwC,EA+cxC,mBA/cwC,EAgdxC,iBAhdwC,EAidxC,cAjdwC,EAkdxC,WAldwC,EAmdxC,WAndwC,EAodxC,cApdwC,EAqdxC,iBArdwC,EAsdxC,4BAtdwC,EAudxC,cAvdwC,EAwdxC,YAxdwC,EAydxC,eAzdwC,EA0dxC,eA1dwC,EA2dxC,cA3dwC,EA4dxC,aA5dwC,EA6dxC,cA7dwC,EA8dxC,gBA9dwC,EA+dxC,eA/dwC,EAgexC,cAhewC,EAiexC,eAjewC,EAkexC,eAlewC,EAmexC,gBAnewC,EAoexC,kBApewC,EAqexC,eArewC,EAsexC,eAtewC,EAuexC,aAvewC,EAwexC,gBAxewC,EAyexC,eAzewC,EA0exC,YA1ewC,EA2exC,WA3ewC,EA4exC,eA5ewC,EA6exC,eA7ewC,EA8exC,qBA9ewC,EA+exC,mBA/ewC,EAgfxC,uBAhfwC,EAifxC,eAjfwC,EAkfxC,QAlfwC,EAmfxC,aAnfwC,EAofxC,mBApfwC,EAqfxC,cArfwC,EAsfxC,kBAtfwC,EAufxC,eAvfwC,EAwfxC,gBAxfwC,EAyfxC,cAzfwC,EA0fxC,4BA1fwC,EA2fxC,eA3fwC,EA4fxC,kBA5fwC,EA6fxC,cA7fwC,EA8fxC,iBA9fwC,EA+fxC,WA/fwC,EAggBxC,aAhgBwC,EAigBxC,mBAjgBwC,EAkgBxC,YAlgBwC,EAmgBxC,YAngBwC,EAogBxC,mBApgBwC,EAqgBxC,gBArgBwC,EAsgBxC,eAtgBwC,EAugBxC,kBAvgBwC,EAwgBxC,kBAxgBwC,EAygBxC,YAzgBwC,EA0gBxC,YA1gBwC,EA2gBxC,eA3gBwC,EA4gBxC,oBA5gBwC,EA6gBxC,eA7gBwC,EA8gBxC,kBA9gBwC,EA+gBxC,iBA/gBwC,EAghBxC,eAhhBwC,EAihBxC,iBAjhBwC,EAkhBxC,eAlhBwC,EAmhBxC,aAnhBwC,EAohBxC,gBAphBwC,EAqhBxC,oBArhBwC,EAshBxC,WAthBwC,EAuhBxC,gBAvhBwC,EAwhBxC,gBAxhBwC,EAyhBxC,gBAzhBwC,EA0hBxC,qBA1hBwC,EA2hBxC,gBA3hBwC,EA4hBxC,cA5hBwC,EA6hBxC,iBA7hBwC,EA8hBxC,gBA9hBwC,EA+hBxC,iBA/hBwC,EAgiBxC,YAhiBwC,EAiiBxC,gBAjiBwC,EAkiBxC,WAliBwC,EAmiBxC,cAniBwC,EAoiBxC,eApiBwC,EAqiBxC,cAriBwC,EAsiBxC,cAtiBwC,EAuiBxC,cAviBwC,EAwiBxC,cAxiBwC,EAyiBxC,aAziBwC,EA0iBxC,eA1iBwC,EA2iBxC,cA3iBwC,EA4iBxC,SA5iBwC,EA6iBxC,YA7iBwC,EA8iBxC,kBA9iBwC,EA+iBxC,YA/iBwC,EAgjBxC,kBAhjBwC,EAijBxC,kBAjjBwC,EAkjBxC,WAljBwC,EAmjBxC,cAnjBwC,EAojBxC,eApjBwC,EAqjBxC,sBArjBwC,EAsjBxC,YAtjBwC,EAujBxC,eAvjBwC,EAwjBxC,UAxjBwC,EAyjBxC,cAzjBwC,EA0jBxC,YA1jBwC,EA2jBxC,cA3jBwC,EA4jBxC,gBA5jBwC,EA6jBxC,mBA7jBwC,EA8jBxC,mBA9jBwC,EA+jBxC,mBA/jBwC,EAgkBxC,aAhkBwC,EAikBxC,eAjkBwC,EAkkBxC,gBAlkBwC,EAmkBxC,YAnkBwC,EAokBxC,WApkBwC,EAqkBxC,gBArkBwC,EAskBxC,YAtkBwC,EAukBxC,cAvkBwC,EAwkBxC,gBAxkBwC,EAykBxC,gBAzkBwC,EA0kBxC,iBA1kBwC,EA2kBxC,gBA3kBwC,EA4kBxC,gBA5kBwC,EA6kBxC,mBA7kBwC,EA8kBxC,WA9kBwC,EA+kBxC,UA/kBwC,EAglBxC,WAhlBwC,EAilBxC,sBAjlBwC,EAklBxC,6BAllBwC,EAmlBxC,gBAnlBwC,EAolBxC,cAplBwC,EAqlBxC,gBArlBwC,EAslBxC,SAtlBwC,EAulBxC,YAvlBwC,EAwlBxC,iBAxlBwC,EAylBxC,cAzlBwC,EA0lBxC,wBA1lBwC,EA2lBxC,YA3lBwC,EA4lBxC,SA5lBwC,EA6lBxC,qBA7lBwC,EA8lBxC,WA9lBwC,EA+lBxC,aA/lBwC,EAgmBxC,gBAhmBwC,EAimBxC,kBAjmBwC,EAkmBxC,WAlmBwC,EAmmBxC,WAnmBwC,EAomBxC,cApmBwC,EAqmBxC,aArmBwC,EAsmBxC,kBAtmBwC,EAumBxC,gBAvmBwC,EAwmBxC,cAxmBwC,EAymBxC,cAzmBwC,EA0mBxC,WA1mBwC,EA2mBxC,SA3mBwC,EA4mBxC,aA5mBwC,EA6mBxC,+BA7mBwC,EA8mBxC,WA9mBwC,EA+mBxC,gBA/mBwC,EAgnBxC,cAhnBwC,EAinBxC,SAjnBwC,EAknBxC,kBAlnBwC,EAmnBxC,iBAnnBwC,EAonBxC,WApnBwC,EAqnBxC,cArnBwC,EAsnBxC,gBAtnBwC,EAunBxC,eAvnBwC,EAwnBxC,4BAxnBwC,EAynBxC,gBAznBwC,EA0nBxC,mBA1nBwC,EA2nBxC,WA3nBwC,EA4nBxC,YA5nBwC,EA6nBxC,WA7nBwC,EA8nBxC,WA9nBwC,EA+nBxC,WA/nBwC,EAgoBxC,WAhoBwC,EAioBxC,UAjoBwC,EAkoBxC,eAloBwC,EAmoBxC,gBAnoBwC,EAooBxC,iBApoBwC,EAqoBxC,eAroBwC,EAsoBxC,YAtoBwC,EAuoBxC,kBAvoBwC,EAwoBxC,cAxoBwC,EAyoBxC,kBAzoBwC,EA0oBxC,gBA1oBwC,EA2oBxC,iBA3oBwC,EA4oBxC,yBA5oBwC,EA6oBxC,yBA7oBwC,EA8oBxC,kBA9oBwC,EA+oBxC,kBA/oBwC,EAgpBxC,6BAhpBwC,EAipBxC,iBAjpBwC,EAkpBxC,mBAlpBwC,EAmpBxC,iBAnpBwC,EAopBxC,kBAppBwC,EAqpBxC,iBArpBwC,EAspBxC,eAtpBwC,EAupBxC,aAvpBwC,EAwpBxC,cAxpBwC,EAypBxC,aAzpBwC,EA0pBxC,iBA1pBwC,EA2pBxC,eA3pBwC,EA4pBxC,aA5pBwC,EA6pBxC,aA7pBwC,EA8pBxC,aA9pBwC,EA+pBxC,iBA/pBwC,EAgqBxC,gBAhqBwC,EAiqBxC,eAjqBwC,EAkqBxC,wBAlqBwC,EAmqBxC,cAnqBwC,EAoqBxC,YApqBwC,EAqqBxC,cArqBwC,EAsqBxC,eAtqBwC,EAuqBxC,cAvqBwC,EAwqBxC,eAxqBwC,EAyqBxC,eAzqBwC,EA0qBxC,eA1qBwC,EA2qBxC,gBA3qBwC,EA4qBxC,cA5qBwC,EA6qBxC,aA7qBwC,EA8qBxC,cA9qBwC,EA+qBxC,gBA/qBwC,EAgrBxC,cAhrBwC,EAirBxC,eAjrBwC,EAkrBxC,UAlrBwC,EAmrBxC,gBAnrBwC,EAorBxC,eAprBwC,EAqrBxC,SArrBwC,EAsrBxC,kBAtrBwC,EAurBxC,SAvrBwC,EAwrBxC,SAxrBwC,EAyrBxC,UAzrBwC,EA0rBxC,YA1rBwC,EA2rBxC,gBA3rBwC,EA4rBxC,eA5rBwC,EA6rBxC,aA7rBwC,EA8rBxC,aA9rBwC,EA+rBxC,aA/rBwC,EAgsBxC,aAhsBwC,EAisBxC,YAjsBwC,EAksBxC,aAlsBwC,EAmsBxC,YAnsBwC,EAosBxC,cApsBwC,EAqsBxC,+BArsBwC,EAssBxC,YAtsBwC,EAusBxC,gBAvsBwC,EAwsBxC,gBAxsBwC,EAysBxC,cAzsBwC,EA0sBxC,aA1sBwC,EA2sBxC,oBA3sBwC,EA4sBxC,gBA5sBwC,EA6sBxC,gBA7sBwC,EA8sBxC,gBA9sBwC,EA+sBxC,aA/sBwC,EAgtBxC,YAhtBwC,EAitBxC,aAjtBwC,EAktBxC,gBAltBwC,EAmtBxC,eAntBwC,EAotBxC,eAptBwC,EAqtBxC,iBArtBwC,EAstBxC,gBAttBwC,EAutBxC,gBAvtBwC,EAwtBxC,aAxtBwC,EAytBxC,iBAztBwC,EA0tBxC,iBA1tBwC,EA2tBxC,iBA3tBwC,EA4tBxC,kBA5tBwC,EA6tBxC,oBA7tBwC,EA8tBxC,cA9tBwC,EA+tBxC,aA/tBwC,EAguBxC,eAhuBwC,EAiuBxC,eAjuBwC,EAkuBxC,WAluBwC,EAmuBxC,UAnuBwC,EAouBxC,eApuBwC,EAquBxC,cAruBwC,EAsuBxC,YAtuBwC,EAuuBxC,cAvuBwC,EAwuBxC,gBAxuBwC,EAyuBxC,cAzuBwC,EA0uBxC,eA1uBwC,EA2uBxC,gBA3uBwC,EA4uBxC,oBA5uBwC,EA6uBxC,eA7uBwC,EA8uBxC,eA9uBwC,EA+uBxC,aA/uBwC,EAgvBxC,YAhvBwC,EAivBxC,cAjvBwC,EAkvBxC,YAlvBwC,EAmvBxC,WAnvBwC,EAovBxC,eApvBwC,EAqvBxC,kBArvBwC,EAsvBxC,kBAtvBwC,EAuvBxC,cAvvBwC,EAwvBxC,kBAxvBwC,EAyvBxC,oBAzvBwC,EA0vBxC,gBA1vBwC,EA2vBxC,eA3vBwC,EA4vBxC,iBA5vBwC,EA6vBxC,eA7vBwC,EA8vBxC,QA9vBwC,EA+vBxC,aA/vBwC,EAgwBxC,iBAhwBwC,EAiwBxC,gBAjwBwC,EAkwBxC,mBAlwBwC,EAmwBxC,aAnwBwC,EAowBxC,gBApwBwC,EAqwBxC,cArwBwC,EAswBxC,aAtwBwC,EAuwBxC,eAvwBwC,EAwwBxC,cAxwBwC,EAywBxC,yBAzwBwC,EA0wBxC,oBA1wBwC,EA2wBxC,eA3wBwC,EA4wBxC,gBA5wBwC,EA6wBxC,eA7wBwC,EA8wBxC,iBA9wBwC,EA+wBxC,eA/wBwC,EAgxBxC,eAhxBwC,EAixBxC,eAjxBwC,EAkxBxC,iBAlxBwC,EAmxBxC,eAnxBwC,EAoxBxC,aApxBwC,EAqxBxC,aArxBwC,EAsxBxC,eAtxBwC,EAuxBxC,kBAvxBwC,EAwxBxC,gBAxxBwC,EAyxBxC,eAzxBwC,EA0xBxC,cA1xBwC,EA2xBxC,gBA3xBwC,EA4xBxC,wBA5xBwC,EA6xBxC,oBA7xBwC,EA8xBxC,mBA9xBwC,EA+xBxC,yBA/xBwC,EAgyBxC,oBAhyBwC,EAiyBxC,0BAjyBwC,EAkyBxC,aAlyBwC,EAmyBxC,aAnyBwC,EAoyBxC,eApyBwC,EAqyBxC,mBAryBwC,EAsyBxC,kBAtyBwC,EAuyBxC,QAvyBwC,EAwyBxC,mBAxyBwC,EAyyBxC,mBAzyBwC,EA0yBxC,0BA1yBwC,EA2yBxC,cA3yBwC,EA4yBxC,WA5yBwC,EA6yBxC,2BA7yBwC,EA8yBxC,YA9yBwC,EA+yBxC,YA/yBwC,EAgzBxC,UAhzBwC,EAizBxC,UAjzBwC,EAkzBxC,iBAlzBwC,EAmzBxC,WAnzBwC,EAozBxC,aApzBwC,EAqzBxC,gBArzBwC,EAszBxC,iBAtzBwC,EAuzBxC,gBAvzBwC,EAwzBxC,eAxzBwC,EAyzBxC,gBAzzBwC,EA0zBxC,eA1zBwC,EA2zBxC,eA3zBwC,EA4zBxC,eA5zBwC,EA6zBxC,eA7zBwC,EA8zBxC,gBA9zBwC,EA+zBxC,eA/zBwC,EAg0BxC,eAh0BwC,EAi0BxC,cAj0BwC,EAk0BxC,eAl0BwC,EAm0BxC,cAn0BwC,EAo0BxC,cAp0BwC,EAq0BxC,eAr0BwC,EAs0BxC,eAt0BwC,EAu0BxC,cAv0BwC,EAw0BxC,iBAx0BwC,EAy0BxC,gBAz0BwC,EA00BxC,gBA10BwC,EA20BxC,WA30BwC,EA40BxC,WA50BwC,EA60BxC,cA70BwC,EA80BxC,iBA90BwC,EA+0BxC,cA/0BwC,EAg1BxC,YAh1BwC,EAi1BxC,aAj1BwC,EAk1BxC,oBAl1BwC,EAm1BxC,WAn1BwC,EAo1BxC,cAp1BwC,EAq1BxC,WAr1BwC,EAs1BxC,eAt1BwC,EAu1BxC,aAv1BwC,EAw1BxC,WAx1BwC,EAy1BxC,OAz1BwC,EA01BxC,qBA11BwC,EA21BxC,cA31BwC,EA41BxC,mBA51BwC,EA61BxC,cA71BwC,EA81BxC,aA91BwC,EA+1BxC,mBA/1BwC,EAg2BxC,mBAh2BwC,EAi2BxC,mBAj2BwC,EAk2BxC,gBAl2BwC,EAm2BxC,gBAn2BwC,EAo2BxC,WAp2BwC,EAq2BxC,YAr2BwC,EAs2BxC,QAt2BwC,EAu2BxC,cAv2BwC,EAw2BxC,WAx2BwC,EAy2BxC,YAz2BwC,EA02BxC,cA12BwC,EA22BxC,aA32BwC,EA42BxC,sBA52BwC,EA62BxC,aA72BwC,EA82BxC,cA92BwC,EA+2BxC,YA/2BwC,EAg3BxC,QAh3BwC,EAi3BxC,mBAj3BwC,EAk3BxC,4BAl3BwC,EAm3BxC,mBAn3BwC,EAo3BxC,mBAp3BwC,EAq3BxC,kBAr3BwC,EAs3BxC,iBAt3BwC,EAu3BxC,gBAv3BwC,EAw3BxC,kBAx3BwC,EAy3BxC,iBAz3BwC,EA03BxC,iBA13BwC,EA23BxC,oBA33BwC,EA43BxC,oBA53BwC,EA63BxC,UA73BwC,EA83BxC,cA93BwC,EA+3BxC,cA/3BwC,EAg4BxC,cAh4BwC,EAi4BxC,WAj4BwC,EAk4BxC,oBAl4BwC,EAm4BxC,YAn4BwC,EAo4BxC,cAp4BwC,EAq4BxC,qBAr4BwC,EAs4BxC,sBAt4BwC,EAu4BxC,gBAv4BwC,EAw4BxC,eAx4BwC,EAy4BxC,WAz4BwC,EA04BxC,eA14BwC,EA24BxC,gBA34BwC,EA44BxC,mBA54BwC,EA64BxC,oBA74BwC,EA84BxC,WA94BwC,EA+4BxC,UA/4BwC,EAg5BxC,YAh5BwC,EAi5BxC,YAj5BwC,EAk5BxC,WAl5BwC,EAm5BxC,YAn5BwC,EAo5BxC,UAp5BwC,EAq5BxC,aAr5BwC,EAs5BxC,YAt5BwC,EAu5BxC,UAv5BwC,EAw5BxC,QAx5BwC,EAy5BxC,eAz5BwC,EA05BxC,aA15BwC,EA25BxC,aA35BwC,EA45BxC,YA55BwC,EA65BxC,aA75BwC,EA85BxC,gBA95BwC,EA+5BxC,2BA/5BwC,EAg6BxC,YAh6BwC,EAi6BxC,SAj6BwC,EAk6BxC,QAl6BwC,EAm6BxC,gBAn6BwC,EAo6BxC,oBAp6BwC,EAq6BxC,aAr6BwC,EAs6BxC,gBAt6BwC,EAu6BxC,WAv6BwC,EAw6BxC,aAx6BwC,EAy6BxC,aAz6BwC,EA06BxC,aA16BwC,EA26BxC,WA36BwC,EA46BxC,UA56BwC,EA66BxC,aA76BwC,EA86BxC,SA96BwC,CAAzC,C;;;;;;;;;;;ACAAxa,OAAOO,MAAP,CAAc;AAACka,mBAAgB,MAAIA,eAArB;AAAqCC,mBAAgB,MAAIA,eAAzD;AAAyEC,cAAW,MAAIA;AAAxF,CAAd;AAAmH,IAAIC,IAAJ;AAAS5a,OAAOC,KAAP,CAAaC,QAAQ,MAAR,CAAb,EAA6B;AAACC,UAAQC,CAAR,EAAU;AAACwa,WAAKxa,CAAL;AAAO;;AAAnB,CAA7B,EAAkD,CAAlD;AAAqD,IAAIya,IAAJ;AAAS7a,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAACya,WAAKza,CAAL;AAAO;;AAAnB,CAA/B,EAAoD,CAApD;AAAuD,IAAI0a,YAAJ;AAAiB9a,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAAC4a,eAAa1a,CAAb,EAAe;AAAC0a,mBAAa1a,CAAb;AAAe;;AAAhC,CAAnC,EAAqE,CAArE;;AAI3P,MAAMqa,eAAN,CAAsB;AAC5BjZ,gBAAc;AACb,SAAKuZ,IAAL,GAAY,IAAIH,IAAJ,CAAS;AACpBxW,YAAM/D,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CADc;AAEpB4I,gBAAUjO,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAFU;AAGpBwO,YAAM7T,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,mBAAxB,CAHc;AAIpBsV,YAAM3a,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,mBAAxB,CAJc;AAKpBgO,aAAOrT,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oBAAxB,IAAgDoG,QAAQC,GAAxD,GAA8D,KALjD;AAMpBkP,WAAK,CAAC5a,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wBAAxB,CANc;AAOpBwV,mBAAa,KAPO;AAQpBC,iBAAW;AARS,KAAT,CAAZ;AAWA,SAAKC,MAAL,GAAc/a,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,qBAAxB,IAAiDrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,qBAAxB,CAAjD,GAAkG,IAAhH,CAZa,CAcb;;AACA,SAAKqV,IAAL,CAAUpE,EAAV,CAAa,OAAb,EAAsB1T,OAAO2T,eAAP,CAAuB,MAAM;AAClD,UAAI,KAAKmE,IAAL,CAAUM,KAAV,KAAoB,cAAxB,EAAwC;AACvC,aAAKC,SAAL,CAAerY,OAAO2T,eAAP,CAAwBrN,GAAD,IAAS;AAC9C,cAAIA,GAAJ,EAAS;AACR,kBAAMA,GAAN;AACA,WAH6C,CAI9C;;;AACA,eAAKgS,SAAL,GAL8C,CAO9C;;AACA,eAAKR,IAAL,CAAUpE,EAAV,CAAa,MAAb,EAAqB1T,OAAO2T,eAAP,CAAuB,MAAM;AACjD,iBAAK2E,SAAL;AACA,WAFoB,CAArB;AAGA,SAXc,CAAf;AAYA,OAbD,MAaO;AACNzP,gBAAQC,GAAR,CAAY,wBAAZ;AACA,aAAKgP,IAAL,CAAUS,GAAV;AACA;AACD,KAlBqB,CAAtB;AAoBA,SAAKT,IAAL,CAAUpE,EAAV,CAAa,OAAb,EAAuBpN,GAAD,IAAS;AAC9BuC,cAAQC,GAAR,CAAY,oBAAZ;AACA,YAAMxC,GAAN;AACA,KAHD;AAIA;;AAED+R,YAAUzQ,EAAV,EAAc;AACb,SAAKkQ,IAAL,CAAUU,OAAV,CAAkB,OAAlB,EAA2B,KAA3B,EAAkC5Q,EAAlC;AACA;;AAED6Q,UAAQ;AACP,SAAKX,IAAL,CAAUY,OAAV;AACA;;AAEDC,aAAW;AACV,QAAI,KAAKb,IAAL,IAAa,KAAKA,IAAL,CAAUM,KAAvB,IAAgC,KAAKN,IAAL,CAAUM,KAAV,KAAoB,cAAxD,EAAwE;AACvE,aAAO,KAAP;AACA;;AAED,WAAO,IAAP;AACA;;AAEDQ,OAAK3T,WAAW,IAAI4T,QAAJ,EAAhB,EAA8B;AAC7B,SAAKf,IAAL,CAAUS,GAAV;AACA,SAAKT,IAAL,CAAUgB,IAAV,CAAe,KAAf,EAAsB7T,QAAtB;AACA;;AAED8T,YAAU;AACT,SAAKH,IAAL,CAAU,MAAM;AACf/P,cAAQC,GAAR,CAAY,sBAAZ;AACA,WAAK2P,KAAL;AACA,KAHD;AAIA,GApE2B,CAsE5B;;;AACAH,cAAY;AACX,SAAKR,IAAL,CAAUkB,MAAV,CAAiB,CAAC,QAAD,CAAjB,EAA6BhZ,OAAO2T,eAAP,CAAuB,CAACrN,GAAD,EAAM2S,SAAN,KAAoB;AACvE,UAAI3S,GAAJ,EAAS;AACRuC,gBAAQC,GAAR,CAAYxC,GAAZ;AACA,cAAMA,GAAN;AACA,OAJsE,CAMvE;;;AACA,UAAI2S,UAAUva,MAAV,GAAmB,CAAvB,EAA0B;AACzB,cAAMwa,IAAI,KAAKpB,IAAL,CAAUqB,KAAV,CAAgBF,SAAhB,EAA2B;AACpC;AACAG,kBAAQ,CAAC,yCAAD,EAA4C,GAA5C,CAF4B;AAGpCC,kBAAQ,IAH4B;AAIpCC,oBAAU;AAJ0B,SAA3B,CAAV;AAOAJ,UAAExF,EAAF,CAAK,SAAL,EAAgB1T,OAAO2T,eAAP,CAAuB,CAAChG,GAAD,EAAM4L,KAAN,KAAgB;AACtD,gBAAMnO,QAAQ,EAAd;AAEAuC,cAAI+F,EAAJ,CAAO,MAAP,EAAe,CAAC8F,MAAD,EAAS/F,IAAT,KAAkB;AAChC,gBAAIgG,eAAe,EAAnB;AACA,gBAAIC,aAAa,EAAjB;AAEAF,mBAAO9F,EAAP,CAAU,MAAV,EAAmBiG,KAAD,IAAW;AAC5B,kBAAIlG,KAAKmG,KAAL,KAAe,GAAnB,EAAwB;AACvBF,8BAAcC,MAAME,QAAN,CAAe,MAAf,CAAd;AACA,eAFD,MAEO;AACNJ,gCAAgBE,MAAME,QAAN,CAAe,MAAf,CAAhB;AACA;AACD,aAND;AAQAL,mBAAOV,IAAP,CAAY,KAAZ,EAAmB,MAAM;AACxB,kBAAIrF,KAAKmG,KAAL,KAAe,GAAnB,EAAwB;AACvBxO,sBAAM0O,IAAN,GAAaJ,UAAb;AACA,eAFD,MAEO;AACN;AACAtO,sBAAM2O,OAAN,GAAgBpC,KAAKqC,WAAL,CAAiBP,YAAjB,CAAhB;AAEArO,sBAAM2O,OAAN,CAAcE,EAAd,GAAmB7O,MAAM2O,OAAN,CAAcE,EAAd,CAAiB,CAAjB,CAAnB;AACA7O,sBAAM2O,OAAN,CAAcG,IAAd,GAAqB9O,MAAM2O,OAAN,CAAcG,IAAd,CAAmB,CAAnB,CAArB;AACA9O,sBAAM2O,OAAN,CAAclD,IAAd,GAAqBzL,MAAM2O,OAAN,CAAclD,IAAd,CAAmB,CAAnB,CAArB;AACA;AACD,aAXD;AAYA,WAxBD,EAHsD,CA6BtD;;AACAlJ,cAAImL,IAAJ,CAAS,KAAT,EAAgB9Y,OAAO2T,eAAP,CAAuB,MAAM;AAC5C;AACA,gBAAI,KAAKwE,MAAT,EAAiB;AAChB,mBAAKL,IAAL,CAAUqC,GAAV,CAAcC,QAAd,CAAuBb,KAAvB,EAA8B,SAA9B,EAA0CjT,GAAD,IAAS;AACjD,oBAAIA,GAAJ,EAAS;AAAEuC,0BAAQC,GAAR,CAAa,uBAAuBxC,GAAK,EAAzC;AAA8C;AACzD,eAFD;AAGA;;AACDlJ,uBAAWid,kBAAX,CAA8BjP,KAA9B;AACA,WARe,CAAhB;AASA,SAvCe,CAAhB;AAwCA8N,UAAEJ,IAAF,CAAO,OAAP,EAAiBxS,GAAD,IAAS;AACxBuC,kBAAQC,GAAR,CAAa,gBAAgBxC,GAAK,EAAlC;AACA,SAFD;AAGA;AACD,KA3D4B,CAA7B;AA4DA;;AApI2B;;AAuItB,MAAMmR,eAAN,CAAsB;AAC5BlZ,gBAAc;AACb,SAAK+b,IAAL,GAAY,IAAI1C,IAAJ,CAASxa,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,mBAAxB,CAAT,EAAuDrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,mBAAxB,CAAvD,EAAqG;AAChH8X,iBAAW,CAACnd,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wBAAxB,CADoG;AAEhHgO,aAAOrT,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oBAAxB,IAAgDoG,QAAQC,GAAxD,GAA8D;AAF2C,KAArG,CAAZ;AAKA,SAAK0R,aAAL,GAAqB,CAArB;AACA,SAAKC,eAAL,GAAuB,CAAvB;AAEA,SAAKH,IAAL,CAAU5G,EAAV,CAAa,SAAb,EAAwB1T,OAAO2T,eAAP,CAAuB,MAAM;AACpD,WAAK2G,IAAL,CAAUI,KAAV,CAAgBtd,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAhB,EAAkErF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAlE;AACA,KAFuB,CAAxB;AAIA,SAAK6X,IAAL,CAAU5G,EAAV,CAAa,OAAb,EAAsB1T,OAAO2T,eAAP,CAAwBgH,MAAD,IAAY;AACxD,UAAIA,MAAJ,EAAY;AACX;AACA,aAAKL,IAAL,CAAUhR,IAAV;AACA,OAHD,MAGO;AACNT,gBAAQC,GAAR,CAAY,uBAAZ;AACA;AACD,KAPqB,CAAtB,EAba,CAsBb;;AACA,SAAKwR,IAAL,CAAU5G,EAAV,CAAa,MAAb,EAAqB1T,OAAO2T,eAAP,CAAuB,CAACgH,MAAD,EAASC,QAAT,KAAsB;AACjE,UAAID,MAAJ,EAAY;AACX,YAAIC,WAAW,CAAf,EAAkB;AACjB,eAAKJ,aAAL,GAAqBI,QAArB;AACA,eAAKH,eAAL,GAAuB,CAAvB,CAFiB,CAGjB;;AACA,eAAKH,IAAL,CAAUO,IAAV,CAAe,KAAKJ,eAApB;AACA,SALD,MAKO;AACN,eAAKH,IAAL,CAAUQ,IAAV;AACA;AACD,OATD,MASO;AACNjS,gBAAQC,GAAR,CAAY,wBAAZ;AACA;AACD,KAboB,CAArB,EAvBa,CAsCb;;AACA,SAAKwR,IAAL,CAAU5G,EAAV,CAAa,MAAb,EAAqB1T,OAAO2T,eAAP,CAAuB,CAACgH,MAAD,EAASI,SAAT,EAAoB9P,IAApB,KAA6B;AACxE,UAAI0P,MAAJ,EAAY;AACX;AACA9C,qBAAa5M,IAAb,EAAmBjL,OAAO2T,eAAP,CAAuB,CAACrN,GAAD,EAAM0U,IAAN,KAAe;AACxD,eAAKC,cAAL,CAAoBD,IAApB;AACA,SAFkB,CAAnB;AAIA,aAAKP,eAAL,IAAwB,CAAxB,CANW,CAQX;;AACA,aAAKH,IAAL,CAAUY,IAAV,CAAeH,SAAf;AACA,OAVD,MAUO;AACNlS,gBAAQC,GAAR,CAAY,8BAAZ;AACA;AACD,KAdoB,CAArB,EAvCa,CAuDb;;AACA,SAAKwR,IAAL,CAAU5G,EAAV,CAAa,MAAb,EAAqB1T,OAAO2T,eAAP,CAAwBgH,MAAD,IAAY;AACvD,UAAIA,MAAJ,EAAY;AACX;AACA,YAAI,KAAKF,eAAL,IAAwB,KAAKD,aAAjC,EAAgD;AAC/C,eAAKF,IAAL,CAAUO,IAAV,CAAe,KAAKJ,eAApB;AACA,SAFD,MAEO;AACN;AACA,eAAKH,IAAL,CAAUQ,IAAV;AACA;AACD,OARD,MAQO;AACNjS,gBAAQC,GAAR,CAAY,2BAAZ;AACA;AACD,KAZoB,CAArB,EAxDa,CAsEb;;AACA,SAAKwR,IAAL,CAAU5G,EAAV,CAAa,eAAb,EAA8B,UAAShG,GAAT,EAAc;AAC3C7E,cAAQC,GAAR,CAAa,oCAAoC4E,GAAK,EAAtD;AACA,KAFD,EAvEa,CA2Eb;;AACA,SAAK4M,IAAL,CAAU5G,EAAV,CAAa,QAAb,EAAuB,UAAShG,GAAT,EAAc;AACpC7E,cAAQC,GAAR,CAAa,2DAA2D4E,GAAK,EAA7E;AACA,KAFD;AAGA;;AAEDuN,iBAAeD,IAAf,EAAqB;AACpB,UAAM5P,QAAQ;AACb2O,eAAS;AACRlD,cAAMmE,KAAKnE,IAAL,CAAUE,IADR;AAERkD,YAAIe,KAAKf,EAAL,CAAQlD,IAFJ;AAGRmD,cAAMc,KAAKd,IAHH;AAIR,sBAAcc,KAAKG;AAJX,OADI;AAObrB,YAAMkB,KAAKjE;AAPE,KAAd;AAUA3Z,eAAWid,kBAAX,CAA8BjP,KAA9B;AACA;;AA9F2B;;AAiGtB,MAAMsM,UAAN,CAAiB;AACvBnZ,gBAAc;AACb,SAAK6c,OAAL,GAAe,KAAf;AACA;;AAED3C,UAAQ;AACP;AACA,QAAIrb,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wBAAxB,CAAJ,EAAuD;AACtDrF,iBAAWwa,IAAX,GAAkB,IAAIH,eAAJ,EAAlB;AAEA,WAAK2D,OAAL,GAAepb,OAAOqb,WAAP,CAAmB,MAAM;AACvC;AACAje,mBAAWwa,IAAX,GAAkB,IAAIH,eAAJ,EAAlB;AACA,OAHc,EAGZxC,KAAKqG,GAAL,CAASle,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wBAAxB,IAAkD,EAAlD,GAAqD,IAA9D,EAAoE,IAAE,EAAF,GAAK,IAAzE,CAHY,CAAf;AAIA;AACD;;AAEDkW,aAAW;AACV,WAAO,KAAKyC,OAAZ;AACA;;AAEDxC,OAAK3T,WAAW,IAAI4T,QAAJ,EAAhB,EAA8B;AAC7B,QAAI,KAAKF,QAAL,EAAJ,EAAqB;AACpB3Y,aAAOub,aAAP,CAAqB,KAAKH,OAA1B;AACA;;AACDnW;AACA;;AA1BsB,C;;;;;;;;;;;AC5OxB;AACA,MAAMuW,oBAAoBC,SAASD,iBAAnC;;AACAC,SAASD,iBAAT,GAA6B,UAASE,gBAAT,EAA2BvO,OAA3B,EAAoC;AAChE,QAAMhF,SAASqT,kBAAkB1V,IAAlB,CAAuB2V,QAAvB,EAAiCC,gBAAjC,EAAmDvO,OAAnD,CAAf;;AAEA,MAAIhF,OAAOuC,KAAP,IAAgBvC,OAAOuC,KAAP,CAAaY,MAAb,KAAwB,oBAA5C,EAAkE;AACjEnD,WAAOuC,KAAP,GAAe,IAAI1K,OAAOrB,KAAX,CAAiB,GAAjB,EAAsB,gBAAtB,CAAf;AACA;;AAED,SAAOwJ,MAAP;AACA,CARD,C;;;;;;;;;;;ACFA,IAAIvD,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;AAA+D,IAAIwe,MAAJ;AAAW5e,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAACwe,aAAOxe,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;AAI9IC,WAAWyH,SAAX,CAAqB0C,GAArB,CAAyB,kBAAzB,EAA6C,UAAS6G,OAAT,EAAkBvO,IAAlB,EAAwB;AACpE;AACA,MAAIuO,QAAQwN,QAAR,IAAoB3G,KAAK4G,GAAL,CAASF,OAAOvN,QAAQwN,QAAf,EAAyBE,IAAzB,EAAT,IAA4C,KAApE,EAA2E;AAC1E;AACA1e,eAAWC,MAAX,CAAkB6M,KAAlB,CAAwB6R,eAAxB,CAAwC3N,QAAQlM,GAAhD,EAAqD,CAArD;AACA,WAAOkM,OAAP;AACA,GAJD,MAIO,IAAIA,QAAQwN,QAAZ,EAAsB;AAE5B;AACA,QAAIxe,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oBAAxB,MAAkD,CAAC5C,KAAKmc,WAAN,IAAqBnc,KAAKmc,WAAL,CAAiBzb,GAAjB,KAAyB6N,QAAQ7N,GAAxG,CAAJ,EAAkH;AACjHnD,iBAAWC,MAAX,CAAkB6M,KAAlB,CAAwB+R,kBAAxB,CAA2C7N,QAAQlM,GAAnD,EAAwDkM,OAAxD;AACA;;AACD,WAAOA,OAAP;AACA;;AAED,MAAIA,QAAQrJ,EAAR,IAAckQ,KAAK4G,GAAL,CAASF,OAAOvN,QAAQrJ,EAAf,EAAmB+W,IAAnB,EAAT,IAAsC,KAAxD,EAA+D;AAC9D1e,eAAWC,MAAX,CAAkB6M,KAAlB,CAAwB6R,eAAxB,CAAwC3N,QAAQlM,GAAhD,EAAqD,CAArD;AACA,WAAOkM,OAAP;AACA;AAED;;;;;;;;;;AAQA,WAAS8N,wBAAT,CAAkC9N,OAAlC,EAA2C+N,UAA3C,EAAuD;AACtD,QAAI,CAAEA,UAAF,IAAgBA,WAAWzd,MAAX,KAAsB,CAA1C,EAA6C;AAAE,aAAO,KAAP;AAAe;;AAE9D,QAAI0d,MAAM,KAAV;AACAD,eAAWE,IAAX,CAAgB,UAASC,SAAT,EAAoB;AACnC,YAAMC,SAAS,IAAI9R,MAAJ,CAAW5G,EAAE2Y,YAAF,CAAeF,SAAf,CAAX,EAAsC,GAAtC,CAAf;;AACA,UAAIC,OAAO9W,IAAP,CAAY2I,QAAQT,GAApB,CAAJ,EAA8B;AAC7ByO,cAAM,IAAN;AACA,eAAO,IAAP;AACA;AACD,KAND;AAQA,WAAOA,GAAP;AACA;;AAED,MAAIvc,QAAQ,IAAZ,EAAkB;AACjB,QAAI4c,QAAQ,KAAZ;AACA,QAAIC,SAAS,KAAb;AACA,UAAMC,aAAa,EAAnB;AACA,UAAMC,gBAAgB,EAAtB;AACA,UAAMT,aAAa/e,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBC,kCAAxB,CAA2Djd,KAAKmD,SAAhE,EAA2E;AAAEV,cAAQ;AAAE,eAAO,CAAT;AAAY,2CAAmC;AAA/C;AAAV,KAA3E,EAA0I6W,KAA1I,EAAnB;;AAEA,QAAI/K,QAAQ2O,QAAR,IAAoB,IAAxB,EAA8B;AAC7B3O,cAAQ2O,QAAR,CAAiB1X,OAAjB,CAAyB,UAAS2X,OAAT,EAAkB;AAC1C,YAAI,CAACP,KAAD,IAAUO,QAAQzc,GAAR,KAAgB,KAA9B,EAAqC;AACpCkc,kBAAQ,IAAR;AACA;;AACD,YAAI,CAACC,MAAD,IAAWM,QAAQzc,GAAR,KAAgB,MAA/B,EAAuC;AACtCmc,mBAAS,IAAT;AACA;;AACD,YAAIM,QAAQzc,GAAR,KAAgB6N,QAAQK,CAAR,CAAUlO,GAA9B,EAAmC;AAClCoc,qBAAW/W,IAAX,CAAgBoX,QAAQzc,GAAxB;AACA;AACD,OAVD;AAWA;;AAED4b,eAAW9W,OAAX,CAAmB,UAASlE,IAAT,EAAe;AACjC,YAAM8b,iBAAiB7f,WAAWgE,iBAAX,CAA6BD,IAA7B,EAAmC,YAAnC,CAAvB;;AACA,UAAI8b,kBAAkBf,yBAAyB9N,OAAzB,EAAkC6O,cAAlC,CAAtB,EAAyE;AACxE,YAAI9b,KAAKZ,GAAL,KAAa6N,QAAQK,CAAR,CAAUlO,GAA3B,EAAgC;AAC/Bqc,wBAAchX,IAAd,CAAmBzE,KAAKZ,GAAxB;AACA;AACD;AACD,KAPD;;AASA,QAAIV,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnB,YAAM4c,gBAAgB9f,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,iBAAxB,CAAtB;;AAEA,UAAIya,kBAAkB,cAAtB,EAAsC;AACrC9f,mBAAWC,MAAX,CAAkByF,aAAlB,CAAgCqa,iCAAhC,CAAkEtd,KAAKU,GAAvE,EAA4E6N,QAAQK,CAAR,CAAUlO,GAAtF;AACA,OAFD,MAEO,IAAIkc,SAASC,MAAb,EAAqB;AAC3Btf,mBAAWC,MAAX,CAAkByF,aAAlB,CAAgCsa,iDAAhC,CAAkFvd,KAAKU,GAAvF,EAA4F6N,QAAQK,CAAR,CAAUlO,GAAtG,EAA2G,CAA3G,EAA8G,CAA9G;AACA,OAFM,MAEA,IAAKoc,cAAcA,WAAWje,MAAX,GAAoB,CAAnC,IAA0Cke,iBAAiBA,cAAcle,MAAd,GAAuB,CAAtF,EAA0F;AAChGtB,mBAAWC,MAAX,CAAkByF,aAAlB,CAAgCua,2CAAhC,CAA4Exd,KAAKU,GAAjF,EAAsFqE,EAAE0Y,OAAF,CAAU1Y,EAAE2Y,MAAF,CAASZ,WAAW7V,MAAX,CAAkB8V,aAAlB,CAAT,CAAV,CAAtF,EAA6I,CAA7I,EAAgJ,CAAhJ;AACA;AACD,KAVD,MAUO;AACN,YAAMY,cAAcpgB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,cAAxB,CAApB;;AAEA,UAAIga,SAASC,MAAb,EAAqB;AACpB,YAAIe,YAAY,CAAhB;;AACA,YAAI,CAAC,cAAD,EAAiB,qBAAjB,EAAwC,8BAAxC,EAAwEC,QAAxE,CAAiFF,WAAjF,CAAJ,EAAmG;AAClGC,sBAAY,CAAZ;AACA;;AACDrgB,mBAAWC,MAAX,CAAkByF,aAAlB,CAAgCsa,iDAAhC,CAAkFvd,KAAKU,GAAvF,EAA4F6N,QAAQK,CAAR,CAAUlO,GAAtG,EAA2G,CAA3G,EAA8Gkd,SAA9G;AACA,OAND,MAMO,IAAKd,cAAcA,WAAWje,MAAX,GAAoB,CAAnC,IAA0Cke,iBAAiBA,cAAcle,MAAd,GAAuB,CAAtF,EAA0F;AAChG,YAAI+e,YAAY,CAAhB;;AACA,YAAI,CAAC,cAAD,EAAiB,oBAAjB,EAAuC,8BAAvC,EAAuEC,QAAvE,CAAgFF,WAAhF,CAAJ,EAAkG;AACjGC,sBAAY,CAAZ;AACA;;AACDrgB,mBAAWC,MAAX,CAAkByF,aAAlB,CAAgCua,2CAAhC,CAA4Exd,KAAKU,GAAjF,EAAsFqE,EAAE0Y,OAAF,CAAU1Y,EAAE2Y,MAAF,CAASZ,WAAW7V,MAAX,CAAkB8V,aAAlB,CAAT,CAAV,CAAtF,EAA6I,CAA7I,EAAgJa,SAAhJ;AACA,OANM,MAMA,IAAID,gBAAgB,cAApB,EAAoC;AAC1CpgB,mBAAWC,MAAX,CAAkByF,aAAlB,CAAgCqa,iCAAhC,CAAkEtd,KAAKU,GAAvE,EAA4E6N,QAAQK,CAAR,CAAUlO,GAAtF;AACA;AACD;AACD,GAtGmE,CAwGpE;;;AACAnD,aAAWC,MAAX,CAAkB6M,KAAlB,CAAwByT,gCAAxB,CAAyDvP,QAAQlM,GAAjE,EAAsE,CAAtE,EAAyEkM,QAAQrJ,EAAjF,EAAqF3H,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oBAAxB,KAAiD2L,OAAtI,EAzGoE,CA2GpE;AACA;;AACAhR,aAAWC,MAAX,CAAkByF,aAAlB,CAAgC8a,gCAAhC,CAAiExP,QAAQlM,GAAzE,EAA8EkM,QAAQK,CAAR,CAAUlO,GAAxF;AAEA,SAAO6N,OAAP;AAEA,CAjHD,EAiHGhR,WAAWyH,SAAX,CAAqBsC,QAArB,CAA8BG,GAjHjC,EAiHsC,sBAjHtC,E;;;;;;;;;;;ACJA,IAAIuW,KAAJ;AAAU9gB,OAAOC,KAAP,CAAaC,QAAQ,kBAAR,CAAb,EAAyC;AAAC6gB,mBAAiB3gB,CAAjB,EAAmB;AAAC0gB,YAAM1gB,CAAN;AAAQ;;AAA7B,CAAzC,EAAwE,CAAxE;AAA2E,IAAIwe,MAAJ;AAAW5e,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAACwe,aAAOxe,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;;AAGhGC,WAAWid,kBAAX,GAAgC,UAASjP,KAAT,EAAgB;AAC/C,WAAS2S,WAAT,CAAqB3S,KAArB,EAA4B;AAC3B,UAAMgD,UAAU;AACfrJ,UAAI,IAAIC,IAAJ,CAASoG,MAAM2O,OAAN,CAAcG,IAAvB,CADW;AAEfvM,WAAKvC,MAAM0O,IAFI;AAGfkE,mBAAa,IAHE;AAIfC,iBAAW;AAJI,KAAhB;;AAOA,QAAI7P,QAAQrJ,EAAZ,EAAgB;AACf,YAAMmZ,SAASjJ,KAAK4G,GAAL,CAASF,OAAOvN,QAAQrJ,EAAf,EAAmB+W,IAAnB,EAAT,CAAf;;AACA,UAAIoC,SAAS,KAAb,EAAoB;AACnB9P,gBAAQrJ,EAAR,GAAa,IAAIC,IAAJ,EAAb;AACA;AACD,KALD,MAKO;AACNoJ,cAAQrJ,EAAR,GAAa,IAAIC,IAAJ,EAAb;AACA;;AAED,QAAIoJ,QAAQT,GAAR,IAAeS,QAAQT,GAAR,CAAYjP,MAAZ,GAAqBtB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wBAAxB,CAAxC,EAA2F;AAC1F,aAAO,KAAP;AACA,KAnB0B,CAqB3B;;;AACA2L,YAAQT,GAAR,GAAcS,QAAQT,GAAR,CAAYhF,KAAZ,CAAkB,MAAlB,EAA0B1F,IAA1B,CAA+B,IAA/B,CAAd;AAEA,UAAM9B,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBsB,qBAAxB,CAA8C/S,MAAM2O,OAAN,CAAclD,IAA5D,EAAkE;AAC9EvU,cAAQ;AACPZ,kBAAU,CADH;AAEPlD,cAAM;AAFC;AADsE,KAAlE,CAAb;;AAMA,QAAI,CAAC2C,IAAL,EAAW;AACV;AACA,aAAO,KAAP;AACA;;AAED,UAAMid,cAAchhB,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2BC,WAA3B,CAAuClT,MAAM2O,OAAN,CAAcwE,GAArD,EAA0D;AAC7Erc,WAAK,CADwE;AAE7EuM,SAAG;AAF0E,KAA1D,CAApB;;AAIA,QAAI,CAAC2P,WAAL,EAAkB;AACjB;AACA,aAAO,KAAP;AACA;;AACDhQ,YAAQlM,GAAR,GAAckc,YAAYlc,GAA1B;AAEA,UAAMrC,OAAOG,OAAO8F,IAAP,CAAY,eAAZ,EAA6BsI,QAAQlM,GAArC,EAA0Cf,KAAKZ,GAA/C,CAAb;;AACA,QAAI,CAACV,IAAL,EAAW;AACV,aAAO,KAAP;AACA;;AAED,UAAM2e,WAAWphB,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoClQ,QAAQlM,GAA5C,EAAiD;AACjE5B,SAAG,CAD8D;AAEjE9B,YAAM;AAF2D,KAAjD,CAAjB,CAlD2B,CAuD3B;;AACA,QAAI4P,QAAQT,GAAR,CAAYhE,OAAZ,CAAqB,IAAIyU,YAAY3P,CAAZ,CAAc/M,QAAU,EAAjD,MAAwD,CAAC,CAAzD,IAA8D8c,SAASle,CAAT,KAAe,GAAjF,EAAsF;AACrF8N,cAAQT,GAAR,GAAe,IAAIyQ,YAAY3P,CAAZ,CAAc/M,QAAU,IAAI0M,QAAQT,GAAK,EAA5D;AACA,KA1D0B,CA4D3B;;;AACA,QAAI8Q,kBAAmB,OAAOze,OAAO2E,WAAP,GAAqBiF,OAArB,CAA6B,KAA7B,EAAoC,EAApC,CAAyC,EAAvE;;AACA,QAAI4U,SAASle,CAAT,KAAe,GAAnB,EAAwB;AACvBme,yBAAoB,YAAYD,SAAShgB,IAAM,QAAQ4M,MAAM2O,OAAN,CAAcwE,GAAK,IAA1E;AACA,KAFD,MAEO,IAAIC,SAASle,CAAT,KAAe,GAAnB,EAAwB;AAC9Bme,yBAAoB,WAAWL,YAAY3P,CAAZ,CAAc/M,QAAU,QAAQ0J,MAAM2O,OAAN,CAAcwE,GAAK,IAAlF;AACA,KAFM,MAEA,IAAIC,SAASle,CAAT,KAAe,GAAnB,EAAwB;AAC9Bme,yBAAoB,UAAUD,SAAShgB,IAAM,QAAQ4M,MAAM2O,OAAN,CAAcwE,GAAK,IAAxE;AACA,KApE0B,CAqE3B;;;AACAnQ,YAAQT,GAAR,GAAc8Q,kBAAkBrQ,QAAQT,GAAxC;AAEA,UAAM5L,eAAe3E,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyDtQ,QAAQlM,GAAjE,EAAsEf,KAAKZ,GAA3E,CAArB;;AACA,QAAIwB,gBAAgBA,aAAa4c,OAA7B,IAAwC5c,aAAa6c,OAAzD,EAAkE;AACjE;AACA,aAAO,KAAP;AACA;;AAED,QAAI,CAAC/e,KAAKgf,KAAL,IAAc,EAAf,EAAmBnB,QAAnB,CAA4Bvc,KAAKO,QAAjC,CAAJ,EAAgD;AAC/C;AACA,aAAO,KAAP;AACA;;AAED,QAAI0M,QAAQ0Q,KAAR,IAAiB,IAAjB,IAAyB1hB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,+BAAxB,CAA7B,EAAuF;AACtF2L,cAAQ0Q,KAAR,GAAgB3d,KAAK3C,IAArB;AACA;;AAEDpB,eAAW4W,OAAX,CAAmBC,YAAnB,CAAgC8K,GAAhC,GAvF2B,CAuFY;;AAEvC,WAAO3hB,WAAW2gB,WAAX,CAAuB5c,IAAvB,EAA6BiN,OAA7B,EAAsCvO,IAAtC,CAAP;AACA,GA3F8C,CA6F/C;;;AACAuL,QAAM0O,IAAN,GAAa+D,MAAMmB,WAAN,CAAkB5T,MAAM0O,IAAxB,CAAb,CA9F+C,CAgG/C;;AACA,MAAI1O,MAAM2O,OAAN,CAAcE,EAAd,CAAiBtQ,OAAjB,CAAyB,GAAzB,KAAiC,CAAjC,IAAsCyB,MAAM2O,OAAN,CAAcE,EAAd,CAAiBtQ,OAAjB,CAAyB,GAAzB,KAAiC,CAA3E,EAA8E;AAC7EyB,UAAM2O,OAAN,CAAcE,EAAd,GAAmB7O,MAAM2O,OAAN,CAAcE,EAAd,CAAiBtR,KAAjB,CAAuB,GAAvB,EAA4B,CAA5B,EAA+BA,KAA/B,CAAqC,GAArC,EAA0C,CAA1C,CAAnB;AACA,GAnG8C,CAqG/C;;;AACA,MAAIyC,MAAM2O,OAAN,CAAclD,IAAd,CAAmBlN,OAAnB,CAA2B,GAA3B,KAAmC,CAAnC,IAAwCyB,MAAM2O,OAAN,CAAclD,IAAd,CAAmBlN,OAAnB,CAA2B,GAA3B,KAAmC,CAA/E,EAAkF;AACjFyB,UAAM2O,OAAN,CAAclD,IAAd,GAAqBzL,MAAM2O,OAAN,CAAclD,IAAd,CAAmBlO,KAAnB,CAAyB,GAAzB,EAA8B,CAA9B,EAAiCA,KAAjC,CAAuC,GAAvC,EAA4C,CAA5C,CAArB;AACA,GAxG8C,CA0G/C;;;AACA,MAAIyC,MAAM2O,OAAN,CAAcE,EAAd,CAAiBtQ,OAAjB,CAAyB,GAAzB,KAAiC,CAArC,EAAwC;AACvC;AACAyB,UAAM2O,OAAN,CAAcwE,GAAd,GAAoBnT,MAAM2O,OAAN,CAAcE,EAAd,CAAiBtR,KAAjB,CAAuB,GAAvB,EAA4B,CAA5B,EAA+BA,KAA/B,CAAqC,GAArC,EAA0C,CAA1C,CAApB;AACAoV,gBAAY3S,KAAZ;AACA,GAJD,MAIO;AACNvC,YAAQC,GAAR,CAAY,4CAAZ;AACA;AACD,CAlHD,C;;;;;;;;;;;ACHA,IAAIgD,eAAJ;AAAoB/O,OAAOC,KAAP,CAAaC,QAAQ,2BAAR,CAAb,EAAkD;AAAC6O,kBAAgB3O,CAAhB,EAAkB;AAAC2O,sBAAgB3O,CAAhB;AAAkB;;AAAtC,CAAlD,EAA0F,CAA1F;AAEpBC,WAAW2O,SAAX,GAAuB,IAAI,MAAMkT,eAAN,SAA8BnT,eAA9B,CAA8C;AACxE;;;;;;AAMAoT,aAAWzS,QAAX,EAAqBxH,QAArB,EAA+B;AAC9B,QAAI,KAAK8G,SAAL,CAAeU,QAAf,KAA4B,KAAKV,SAAL,CAAeU,QAAf,EAAyBmF,OAAzB,IAAoC,IAApE,EAA0E;AACzE,YAAM,IAAI5R,OAAOrB,KAAX,CAAiB,sBAAjB,EAAyC,2CAAzC,CAAN;AACA;;AACD,QAAI,KAAKoN,SAAL,CAAeU,QAAf,KAA4B,IAAhC,EAAsC;AACrC,WAAKV,SAAL,CAAeU,QAAf,IAA2B,EAA3B;AACA;;AACD,WAAO,KAAKV,SAAL,CAAeU,QAAf,EAAyBmF,OAAzB,GAAmC3M,QAA1C;AACA;;AAEDka,cAAY1S,QAAZ,EAAsBxH,QAAtB,EAAgC;AAC/B,QAAI,KAAK8G,SAAL,CAAeU,QAAf,KAA4B,KAAKV,SAAL,CAAeU,QAAf,EAAyB2S,QAAzB,IAAqC,IAArE,EAA2E;AAC1E,YAAM,IAAIpf,OAAOrB,KAAX,CAAiB,kBAAjB,EAAqC,6CAArC,CAAN;AACA;;AACD,QAAI,KAAKoN,SAAL,CAAeU,QAAf,KAA4B,IAAhC,EAAsC;AACrC,WAAKV,SAAL,CAAeU,QAAf,IAA2B,EAA3B;AACA;;AACD,WAAO,KAAKV,SAAL,CAAeU,QAAf,EAAyB2S,QAAzB,GAAoCna,QAA3C;AACA;;AAEDoa,cAAY5S,QAAZ,EAAsB;AACrB,WAAO,KAAKV,SAAL,CAAeU,QAAf,KAA4B,KAAKV,SAAL,CAAeU,QAAf,EAAyB2S,QAA5D;AACA;AAGD;;;;;;;;;AAOAE,aAAWC,KAAX,EAAkB9S,QAAlB,EAA4B3N,UAA5B,EAAwC;AACvC,WAAO,KAAKiN,SAAL,CAAeU,QAAf,KAA4B,KAAKV,SAAL,CAAeU,QAAf,EAAyBmF,OAArD,IAAgE,KAAK7F,SAAL,CAAeU,QAAf,EAAyBmF,OAAzB,CAAiC9L,IAAjC,CAAsCyZ,KAAtC,EAA6CzgB,UAA7C,CAAvE;AACA;;AAzCuE,CAAlD,EAAvB,C;;;;;;;;;;;ACFA,IAAI6c,MAAJ;AAAW5e,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAACwe,aAAOxe,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;AAAyD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAG1E,SAASqiB,eAAT,CAAyB;AAAEC,gBAAF;AAAkBrR,SAAlB;AAA2BjN,MAA3B;AAAiCtB;AAAjC,CAAzB,EAAkE;AACjE,QAAM6f,MAAMve,QAAQA,KAAK2M,QAAb,IAAyB1Q,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,CAAzB,IAAgE,IAA5E;AAEA,QAAML,WAAY,IAAIhF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wCAAxB,IAAoE5C,KAAK0C,KAAL,IAAc1C,KAAKrB,IAAvF,GAA8FqB,KAAKrB,IAAM,EAA/H;AAEA,QAAMmhB,WAAWviB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,IAA8C2L,QAAQK,CAAR,CAAUjQ,IAAV,IAAkB4P,QAAQK,CAAR,CAAU/M,QAA1E,GAAqF0M,QAAQK,CAAR,CAAU/M,QAAhH;;AAEA,QAAMvC,SAASoP,QAAQC,EAAR,CAAW3O,KAAKS,CAAL,KAAW,GAAX,GAAiB,4BAAjB,GAAgD,gCAA3D,EAA6F;AAC3GoB,cAAUie,QADiG;AAE3GC,aAASxd,QAFkG;AAG3Gsd;AAH2G,GAA7F,CAAf;;AAMA,MAAID,cAAJ,EAAoB;AACnB,WAAQ,GAAGtgB,MAAQ,aAAasgB,cAAgB,EAAhD;AACA;;AAED,MAAIrR,QAAQyR,IAAZ,EAAkB;AACjB,UAAMC,aAAavR,QAAQC,EAAR,CAAW3O,KAAKS,CAAL,KAAW,GAAX,GAAiB,6BAAjB,GAAiD,iCAA5D,EAA+F;AACjHoB,gBAAUie,QADuG;AAEjHC,eAASxd,QAFwG;AAGjHsd;AAHiH,KAA/F,CAAnB;;AAMA,QAAIK,UAAW,GAAGxR,QAAQC,EAAR,CAAW,0BAAX,CAAwC,KAAKJ,QAAQyR,IAAR,CAAarhB,IAAM,EAAlF;;AAEA,QAAI4P,QAAQ4R,WAAR,IAAuB5R,QAAQ4R,WAAR,CAAoBthB,MAApB,KAA+B,CAAtD,IAA2D0P,QAAQ4R,WAAR,CAAoB,CAApB,EAAuB5S,WAAvB,KAAuC,EAAtG,EAA0G;AACzG2S,iBAAY,aAAa3R,QAAQ4R,WAAR,CAAoB,CAApB,EAAuB5S,WAAa,EAA7D;AACA;;AAED,WAAQ,GAAG0S,UAAY,aAAaC,OAAS,EAA7C;AACA;;AAED,MAAI3R,QAAQ4R,WAAR,CAAoBthB,MAApB,GAA6B,CAAjC,EAAoC;AACnC,UAAM,CAAEuhB,UAAF,IAAiB7R,QAAQ4R,WAA/B;AAEA,QAAID,UAAU,EAAd;;AAEA,QAAIE,WAAWvJ,KAAf,EAAsB;AACrBqJ,iBAAY,GAAGE,WAAWvJ,KAAO,OAAjC;AACA;;AACD,QAAIuJ,WAAWlJ,IAAf,EAAqB;AACpBgJ,iBAAY,GAAGE,WAAWlJ,IAAM,OAAhC;AACA;;AAED,WAAQ,GAAG5X,MAAQ,aAAa4gB,OAAS,EAAzC;AACA;;AAED,SAAO5gB,MAAP;AACA;;AAED/B,WAAWyH,SAAX,CAAqB0C,GAArB,CAAyB,kBAAzB,EAA6C,UAAS6G,OAAT,EAAkBvO,IAAlB,EAAwB;AACpE;AACA,MAAIuO,QAAQwN,QAAZ,EAAsB;AACrB,WAAOxN,OAAP;AACA;;AAED,MAAIA,QAAQrJ,EAAR,IAAckQ,KAAK4G,GAAL,CAASF,OAAOvN,QAAQrJ,EAAf,EAAmB+W,IAAnB,EAAT,IAAsC,KAAxD,EAA+D;AAC9D,WAAO1N,OAAP;AACA;;AAED,QAAM8R,iBAAiB,CAACrgB,IAAD,EAAO+B,GAAP,KAAe;AACrC,UAAMue,WAAW/iB,WAAW2O,SAAX,CAAqBW,YAArB,CAAkC7M,KAAKS,CAAvC,EAA0CsB,GAA1C,CAAjB;AACA,UAAMnD,OAAOuB,OAAO2E,WAAP,CAAmBwb,WAAWA,SAASvW,OAAT,CAAiB,KAAjB,EAAwB,EAAxB,CAAX,GAAyC,EAA5D,CAAb;AACA,UAAMsN,QAAQ,CACb,cADa,EAEb,oBAFa,EAGb,qBAHa,EAIb,4BAJa,EAKb,wBALa,EAMZjU,IANY,CAMP,GANO,CAAd;;AAOA,UAAMmL,UAAUG,QAAQC,EAAR,CAAW,sBAAX,CAAhB;;AACA,WAAQ,6DAA6D0I,KAAO,WAAWzY,IAAM,KAAK2P,OAAS,MAA3G;AACA,GAZD;;AAcA,QAAMgS,iBAAiB,iFAAvB;AAEA,MAAIC,WAAJ;;AAEA,MAAIjS,QAAQT,GAAR,KAAgB,EAApB,EAAwB;AACvB0S,kBAAcxc,EAAE8K,UAAF,CAAaP,QAAQT,GAArB,CAAd;AACAS,cAAUhR,WAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,eAAzB,EAA0CoG,OAA1C,CAAV;;AACA,QAAIA,QAAQkS,MAAR,IAAkBlS,QAAQkS,MAAR,CAAe5hB,MAAf,GAAwB,CAA9C,EAAiD;AAChD0P,cAAQkS,MAAR,CAAejb,OAAf,CAAwBkb,KAAD,IAAW;AACjCA,cAAMxJ,IAAN,GAAawJ,MAAMxJ,IAAN,CAAWnN,OAAX,CAAmB,oBAAnB,EAAyC,QAAzC,CAAb;AACAyW,sBAAcA,YAAYzW,OAAZ,CAAoB2W,MAAMA,KAA1B,EAAiCA,MAAMxJ,IAAvC,CAAd;AACA,OAHD;AAIA;;AACDsJ,kBAAcA,YAAYzW,OAAZ,CAAoB,MAApB,EAA4B,OAA5B,CAAd;AACA;;AAED,QAAMzK,SAAS/B,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,cAAxB,KAA2C,EAA3E,CAAf;AACA,MAAI+d,SAASpjB,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,cAAxB,KAA2C,EAA3E,CAAb;AAEA,QAAMge,mBAAmB,EAAzB;;AACA,MAAI5gB,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnBmgB,qBAAiBrS,QAAQlM,GAAR,CAAY0H,OAAZ,CAAoBwE,QAAQK,CAAR,CAAUlO,GAA9B,EAAmC,EAAnC,CAAjB,IAA2D,QAA3D;AACA,GAFD,MAEO;AACN,QAAImgB,eAAetS,QAAQ2O,QAAR,CAAiBpV,IAAjB,CAAsBqV,WAAWA,QAAQzc,GAAR,KAAgB,KAAjD,CAAnB;;AAEA,QAAImgB,YAAJ,EAAkB;AACjB,YAAMC,4BAA4BvjB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,gCAAxB,CAAlC;;AACA,UAAIke,8BAA8B,CAA9B,IAAmC9gB,KAAKmD,SAAL,CAAetE,MAAf,GAAwBiiB,yBAA/D,EAA0F;AACzFD,uBAAe5P,SAAf;AACA;AACD;;AAED,QAAIhP,KAAJ;;AACA,QAAI4e,YAAJ,EAAkB;AACjB;AACA5e,cAAQ1E,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC8d,YAAhC,CAA6C/gB,KAAKU,GAAlD,CAAR;AACA,KAHD,MAGO;AACN;AACA,YAAMsgB,UAAUzS,QAAQ2O,QAAR,CAAiB5W,GAAjB,CAAqB6W,WAAWA,QAAQzc,GAAxC,CAAhB;AACAuB,cAAQ1E,WAAWC,MAAX,CAAkByF,aAAlB,CAAgCge,mCAAhC,CAAoEjhB,KAAKU,GAAzE,EAA8EsgB,OAA9E,CAAR;AACA;;AAED/e,UAAMuD,OAAN,CAAezD,GAAD,IAAS;AACtB,UAAIA,IAAImf,oBAAR,EAA8B;AAC7B,eAAO,OAAON,iBAAiB7e,IAAI6M,CAAJ,CAAMlO,GAAvB,CAAd;AACA;;AAED,YAAMygB,qBAAqBpf,IAAIof,kBAA/B;;AAEA,UAAIA,uBAAuB,SAA3B,EAAsC;AACrC,eAAO,OAAOP,iBAAiB7e,IAAI6M,CAAJ,CAAMlO,GAAvB,CAAd;AACA;;AAED,YAAM0gB,gBAAgBP,gBAAgBtS,QAAQ2O,QAAR,CAAiBpV,IAAjB,CAAsBqV,WAAWA,QAAQzc,GAAR,KAAgBqB,IAAI6M,CAAJ,CAAMlO,GAAvD,CAAtC;;AAEA,UAAIygB,uBAAuB,SAAvB,IAAoCA,sBAAsB,IAA9D,EAAoE;AACnE,YAAIC,aAAJ,EAAmB;AAClB,iBAAOR,iBAAiB7e,IAAI6M,CAAJ,CAAMlO,GAAvB,IAA8B,SAArC;AACA;;AACD,eAAO,OAAOkgB,iBAAiB7e,IAAI6M,CAAJ,CAAMlO,GAAvB,CAAd;AACA;;AAED,UAAIygB,uBAAuB,UAAvB,IAAqCC,aAAzC,EAAwD;AACvD,eAAOR,iBAAiB7e,IAAI6M,CAAJ,CAAMlO,GAAvB,IAA8B,SAArC;AACA;;AAED,UAAIygB,uBAAuB,KAA3B,EAAkC;AACjC,eAAOP,iBAAiB7e,IAAI6M,CAAJ,CAAMlO,GAAvB,IAA8B,KAArC;AACA;AACD,KA3BD;AA4BA;;AACD,QAAM2gB,qBAAqB/b,OAAOC,IAAP,CAAYqb,gBAAZ,CAA3B;AAEA,MAAIU,WAAJ;AAEA,QAAMC,aAAa,EAAnB;;AACA,MAAIhkB,WAAW2O,SAAX,CAAqBS,aAArB,CAAmC3M,KAAKS,CAAxC,CAAJ,EAAgD;AAC/ClD,eAAWC,MAAX,CAAkByF,aAAlB,CAAgCue,sBAAhC,CAAuDxhB,KAAKU,GAA5D,EAAiE2gB,kBAAjE,EAAqF7b,OAArF,CAA8FzD,GAAD,IAAS;AACrGwf,iBAAWxf,IAAI6M,CAAJ,CAAMlO,GAAjB,IAAwB2f,eAAergB,IAAf,EAAqB+B,GAArB,CAAxB;AACA,KAFD;AAGA,GAJD,MAIO;AACNuf,kBAAcjB,eAAergB,IAAf,EAAqB;AAClCrB,YAAMqB,KAAKrB;AADuB,KAArB,CAAd;AAGA;;AAED,MAAI0iB,mBAAmBxiB,MAAnB,GAA4B,CAAhC,EAAmC;AAClC,UAAM4iB,iBAAiBlkB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwB0E,0BAAxB,CAAmDL,kBAAnD,EAAuE/H,KAAvE,EAAvB;;AAEA,QAAImI,kBAAkBA,eAAe5iB,MAAf,GAAwB,CAA9C,EAAiD;AAChD4iB,qBAAejc,OAAf,CAAwBlE,IAAD,IAAU;AAChC,cAAMqgB,wBAAwBpkB,WAAWgE,iBAAX,CAA6BD,IAA7B,EAAmC,uBAAnC,CAA9B;;AACA,YAAIsf,iBAAiBtf,KAAKZ,GAAtB,MAA+B,SAAnC,EAA8C;AAC7C,cAAIihB,0BAA0B,KAA9B,EAAqC;AAAE;AACtCf,6BAAiBtf,KAAKZ,GAAtB,IAA6B,SAA7B;AACA,WAFD,MAEO;AACN;AACA;AACD;;AAED,YAAIkgB,iBAAiBtf,KAAKZ,GAAtB,MAA+B,QAAnC,EAA6C;AAC5C,gBAAMkhB,gCAAgCD,0BAA0B,UAAhE;AACA,gBAAME,+BAA+BtkB,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyDtQ,QAAQlM,GAAjE,EAAsEkM,QAAQlM,GAAR,CAAY0H,OAAZ,CAAoBwE,QAAQK,CAAR,CAAUlO,GAA9B,EAAmC,EAAnC,CAAtE,EAA8GygB,kBAAnJ;;AAEA,cAAIU,iCAAiC,SAArC,EAAgD;AAC/C;AACA;;AAED,cAAI,CAACA,iCAAiC,SAAjC,IAA8CA,gCAAgC,IAA/E,KAAwFD,6BAA5F,EAA2H;AAC1H;AACA;AACD,SArB+B,CAuBhC;;;AACA,YAAI5hB,KAAKS,CAAL,KAAW,GAAX,IAAkBT,KAAKmD,SAAL,CAAe2G,OAAf,CAAuBxI,KAAKO,QAA5B,MAA0C,CAAC,CAAjE,EAAoE;AACnE;AACA,SA1B+B,CA4BhC;;;AACA,YAAItE,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,qBAAxB,CAAJ,EAAoD;AACnD+d,mBAASpjB,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,2BAAxB,KAAwD,EAAxF,CAAT;AACA;;AAED,YAAIkf,YAAJ;AACA,cAAMjgB,WAAWtE,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,IAA8C2L,QAAQK,CAAR,CAAUjQ,IAAxD,GAA+D4P,QAAQK,CAAR,CAAU/M,QAA1F;AACA,cAAMU,WAAWhF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wCAAxB,IAAoE5C,KAAK0C,KAAzE,GAAiF1C,KAAKrB,IAAvG;;AACA,gBAAQiiB,iBAAiBtf,KAAKZ,GAAtB,CAAR;AACC,eAAK,KAAL;AACCohB,2BAAevkB,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,2BAAxB,CAAhC,EAAsF;AACpGtB,oBAAMO,QAD8F;AAEpG7B,oBAAMuC,YAAYvC,KAAKT;AAF6E,aAAtF,CAAf;AAIA;;AACD,eAAK,QAAL;AACCuiB,2BAAevkB,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,CAAhC,EAA6E;AAC3FtB,oBAAMO,QADqF;AAE3F7B,oBAAMuC;AAFqF,aAA7E,CAAf;AAIA;;AACD,eAAK,SAAL;AACCuf,2BAAevkB,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAhC,EAAkF;AAChGtB,oBAAMO,QAD0F;AAEhG7B,oBAAMuC;AAF0F,aAAlF,CAAf;AAIA;AAlBF;;AAoBAjB,aAAKygB,MAAL,CAAYvF,IAAZ,CAAkBjR,KAAD,IAAW;AAC3B,cAAIA,MAAMyW,QAAV,EAAoB;AACnB,kBAAM9B,UAAUP,gBAAgB;AAC/BC,8BAAgBY,WADe;AAE/BjS,qBAF+B;AAG/BjN,kBAH+B;AAI/BtB;AAJ+B,aAAhB,CAAhB;AAMAuL,oBAAQ;AACP6O,kBAAI7O,MAAM0W,OADH;AAEPC,uBAASJ,YAFF;AAGPjT,oBAAMvP,SAAS4gB,OAAT,GAAmBK,cAAnB,IAAqCgB,WAAWjgB,KAAKZ,GAAhB,KAAwB4gB,WAA7D,IAA4EX;AAH3E,aAAR,CAPmB,CAYnB;;AACA,gBAAI3gB,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnB8K,oBAAMyL,IAAN,GAAc,GAAGzI,QAAQK,CAAR,CAAUjQ,IAAM,KAAKpB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,YAAxB,CAAuC,GAA7E;AACA,aAFD,MAEO;AACN2I,oBAAMyL,IAAN,GAAc,GAAGhX,KAAKrB,IAAM,KAAKpB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,YAAxB,CAAuC,GAAxE;AACA,aAjBkB,CAkBnB;;;AACA,gBAAIrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,qBAAxB,CAAJ,EAAoD;AACnD2I,oBAAM2O,OAAN,GAAgB;AACf;AACA,4BAAa,GAAG3c,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,EAAiDkG,KAAjD,CAAuD,GAAvD,EAA4D,CAA5D,EAA+DA,KAA/D,CAAqEvL,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wBAAxB,CAArE,EAAwH,CAAxH,CAA4H,GAAGrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wBAAxB,CAAmD,GAAG2L,QAAQ7N,GAAK,IAAInD,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,EAAiDkG,KAAjD,CAAuD,GAAvD,EAA4D,CAA5D,CAAgE;AAFvQ,eAAhB;AAIA;;AAED3I,mBAAOiJ,KAAP,CAAa,MAAM;AAClB+Y,oBAAM3L,IAAN,CAAWjL,KAAX;AACA,aAFD;AAIA,mBAAO,IAAP;AACA;AACD,SAjCD;AAkCA,OA1FD;AA2FA;AACD;;AAED,SAAOgD,OAAP;AAEA,CAlND,EAkNGhR,WAAWyH,SAAX,CAAqBsC,QAArB,CAA8BG,GAlNjC,EAkNsC,oBAlNtC,E;;;;;;;;;;;ACtDA,IAAI1C,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;AAA+D,IAAIwe,MAAJ;AAAW5e,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAACwe,aAAOxe,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;AAK9I,MAAM8kB,mBAAmB,SAAzB;AACA,MAAMC,2BAA2B,iBAAjC;AAEA;;;;;;;;;AAQA,SAASC,sCAAT,CAAgD/T,OAAhD,EAAyD2O,QAAzD,EAAmE;AAClE,MAAI,CAACA,QAAD,IAAa,CAACA,SAASre,MAA3B,EAAmC;AAClC,WAAO0P,OAAP;AACA;;AACD2O,WAAS1X,OAAT,CAAkB2X,OAAD,IAAa;AAC7B,UAAM7b,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCtB,QAAQzc,GAA5C,CAAb;;AACA,QAAIY,QAAQA,KAAK3C,IAAjB,EAAuB;AACtB4P,gBAAUA,QAAQxE,OAAR,CAAiB,IAAIoT,QAAQtb,QAAU,EAAvC,EAA0CP,KAAK3C,IAA/C,CAAV;AACA;AACD,GALD;AAMA,SAAO4P,OAAP;AACA;;AAED,SAASgU,oBAAT,CAA8BviB,IAA9B,EAAoC6B,QAApC,EAA8C;AAC7C,SAAO,CAAE,CAAC7B,KAAKgf,KAAL,IAAc,EAAf,EAAmBnB,QAAnB,CAA4Bhc,QAA5B,CAAT;AACA;AAED;;;;;;;AAKA,SAAS2gB,gBAAT,CAA0BjU,OAA1B,EAAmChO,MAAnC,EAA2C;AAC1C,QAAMe,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCle,MAApC,CAAb;AACA,QAAMsf,MAAMve,QAAQA,KAAK2M,QAAb,IAAyB1Q,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,CAAzB,IAAgE,IAA5E;;AAEA,MAAI,CAAC2L,QAAQT,GAAT,IAAgBS,QAAQ4R,WAAxB,IAAuC5R,QAAQ4R,WAAR,CAAoB,CAApB,CAA3C,EAAmE;AAClE5R,YAAQT,GAAR,GAAcS,QAAQ4R,WAAR,CAAoB,CAApB,EAAuBsC,UAAvB,GAAoC/T,QAAQC,EAAR,CAAW,qBAAX,EAAkC;AAACkR;AAAD,KAAlC,CAApC,GAA+EnR,QAAQC,EAAR,CAAW,oBAAX,EAAiC;AAACkR;AAAD,KAAjC,CAA7F;AACA;;AACDtR,UAAQT,GAAR,GAAcvQ,WAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,kBAAzB,EAA6CoG,QAAQT,GAArD,CAAd;AAEA,SAAOS,QAAQT,GAAf;AACA;AACD;;;;;;;;;;AAQA,SAAS4U,iBAAT,CAA2BniB,MAA3B,EAAmCe,IAAnC,EAAyCiN,OAAzC,EAAkDvO,IAAlD,EAAwD2iB,QAAxD,EAAkE;AAEjE,QAAMC,mBAAmBrlB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,MAAgD,IAAzE;AACA2L,UAAQT,GAAR,GAAc0U,iBAAiBjU,OAAjB,EAA0BhO,MAA1B,CAAd;;AAEA,MAAIqiB,gBAAJ,EAAsB;AACrBrU,YAAQT,GAAR,GAAcwU,uCAAuC/T,QAAQT,GAA/C,EAAoDS,QAAQ2O,QAA5D,CAAd;AACA;;AACD,MAAIrG,QAAQ+L,mBAAmBthB,KAAK3C,IAAxB,GAAgC,IAAI2C,KAAKO,QAAU,EAA/D;;AACA,MAAI7B,KAAKS,CAAL,KAAW,GAAX,IAAkBT,KAAKrB,IAA3B,EAAiC;AAChCkY,aAAU,OAAO7W,KAAKrB,IAAM,EAA5B;AACA;;AACDpB,aAAWslB,aAAX,CAAyBC,UAAzB,CAAoCviB,MAApC,EAA4C,cAA5C,EAA4D;AAC3DsW,SAD2D;AAE3DK,UAAM3I,QAAQT,GAF6C;AAG3D6U,YAH2D;AAI3DjM,aAAS;AACRhW,WAAK6N,QAAQ7N,GADL;AAER2B,WAAKkM,QAAQlM,GAFL;AAGR0gB,cAAQxU,QAAQK,CAHR;AAIRpF,YAAMxJ,KAAKS,CAJH;AAKR9B,YAAMqB,KAAKrB;AALH;AAJkD,GAA5D;AAYA;;AAED,SAASqkB,eAAT,CAAyBziB,MAAzB,EAAiCgO,OAAjC,EAA0CvO,IAA1C,EAAgD;AAC/CzC,aAAWslB,aAAX,CAAyBC,UAAzB,CAAoCviB,MAApC,EAA4C,mBAA5C,EAAiE;AAChEmW,aAAS;AACRhW,WAAK6N,QAAQ7N,GADL;AAER2B,WAAKkM,QAAQlM,GAFL;AAGR0gB,cAAQxU,QAAQK,CAHR;AAIRpF,YAAMxJ,KAAKS,CAJH;AAKR9B,YAAMqB,KAAKrB;AALH;AADuD,GAAjE;AASA;AAED;;;;;;;;;;AAQA,SAAS0d,wBAAT,CAAkC9N,OAAlC,EAA2C+N,UAA3C,EAAuD;AACtD,MAAI,CAAEA,UAAF,IAAgBA,WAAWzd,MAAX,KAAsB,CAA1C,EAA6C;AAAE,WAAO,KAAP;AAAe;;AAE9D,MAAI0d,MAAM,KAAV;AACAD,aAAWE,IAAX,CAAgB,UAASC,SAAT,EAAoB;AACnC,UAAMC,SAAS,IAAI9R,MAAJ,CAAW5G,EAAE2Y,YAAF,CAAeF,SAAf,CAAX,EAAsC,GAAtC,CAAf;;AACA,QAAIC,OAAO9W,IAAP,CAAY2I,QAAQT,GAApB,CAAJ,EAA8B;AAC7ByO,YAAM,IAAN;AACA,aAAO,IAAP;AACA;AACD,GAND;AAQA,SAAOA,GAAP;AACA;;AAED,SAAS0G,aAAT,CAAuB1iB,MAAvB,EAA+B;AAC9B,QAAM2iB,gBAAgB3lB,WAAWC,MAAX,CAAkByF,aAAlB,CAAgCkgB,kBAAhC,CAAmD5iB,MAAnD,EAA2D+Y,KAA3D,EAAtB;AAEA,SAAO4J,cAAcrd,MAAd,CAAqB,CAAC9B,MAAD,EAAShC,GAAT,KAAiB;AAC5C,WAAOA,IAAIgC,MAAJ,GAAaA,MAApB;AACA,GAFM,EAEJ,CAFI,CAAP;AAGA;;AAED,MAAMqf,wBAAwB,CAACC,sBAAsB,EAAvB,EAA2B9U,OAA3B,EAAoCvO,IAApC,EAA0CsjB,SAA1C,EAAqDC,aAArD,EAAoEC,YAApE,EAAkFC,aAAlF,KAAoG;AACjI,MAAIJ,oBAAoBxkB,MAApB,GAA6B,CAA7B,IAAkC4Y,KAAKiM,OAAL,KAAiB,IAAvD,EAA6D;AAC5D;AACAL,wBAAoB7d,OAApB,CAA6Bme,cAAD,IAAoB;AAC/CpmB,iBAAW2Y,gBAAX,CAA4BM,IAA5B,CAAiC;AAChCxT,gBAAQuL,QAAQlM,GADgB;AAEhCE,kBAAU+gB,SAFsB;AAGhCzhB,kBAAU0hB,aAHsB;AAIhChV,iBAASiV,YAJuB;AAKhC7M,eAAOsM,cAAcU,cAAd,CALyB;AAMhCjN,iBAAS;AACRtF,gBAAMjR,OAAO2E,WAAP,EADE;AAERzC,eAAKkM,QAAQlM,GAFL;AAGR0gB,kBAAQxU,QAAQK,CAHR;AAIRpF,gBAAMxJ,KAAKS,CAJH;AAKR9B,gBAAMqB,KAAKrB;AALH,SANuB;AAahC8X,iBAAS;AACRlW,kBAAQojB;AADA,SAbuB;AAgBhC/M,kBAAU2L,qBAAqBviB,IAArB,EAA2ByjB,cAAcE,cAAd,CAA3B,IAA4DvB,gBAA5D,GAA+EC;AAhBzD,OAAjC;AAkBA,KAnBD;AAoBA;AACD,CAxBD;;AA0BA,MAAMuB,WAAW,CAACtiB,IAAD,EAAOe,GAAP,KAAef,KAAKuiB,MAAL,IAAe1jB,OAAO2jB,SAAP,CAAiBxiB,KAAKZ,GAAtB,EAA2B,MAAMP,OAAO8F,IAAP,CAAY,UAAZ,EAAwB5D,GAAxB,CAAjC,CAA/C;;AACA9E,WAAWyH,SAAX,CAAqB0C,GAArB,CAAyB,kBAAzB,EAA6C,UAAS6G,OAAT,EAAkBvO,IAAlB,EAAwBO,MAAxB,EAAgC;AAE5E;AACA,MAAIgO,QAAQwN,QAAZ,EAAsB;AACrB,WAAOxN,OAAP;AACA;;AAED,MAAIA,QAAQrJ,EAAR,IAAckQ,KAAK4G,GAAL,CAASF,OAAOvN,QAAQrJ,EAAf,EAAmB+W,IAAnB,EAAT,IAAsC,KAAxD,EAA+D;AAC9D,WAAO1N,OAAP;AACA;;AAED,QAAMkV,gBAAgB,EAAtB;AAEA,QAAMniB,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoClQ,QAAQK,CAAR,CAAUlO,GAA9C,CAAb,CAb4E,CAe5E;;AACA,MAAI,CAACY,IAAL,EAAW;AACV,WAAOiN,OAAP;AACA;AAED;;;;;AAGA,QAAM5L,WAAW;AAChBohB,8BAA0B,EADV;AAEhBC,4BAAwB,EAFR;AAGhBC,6BAAyB,EAHT;AAIhBC,2BAAuB,EAJP;AAKhBC,kCAA8B,EALd;AAMhBC,4BAAwB,EANR;AAOhBC,0BAAsB,EAPN;AAQhBC,6BAAyB;AART,GAAjB;AAWA;;;;;;;;;AAQA,WAASC,aAAT,CAAuBplB,EAAvB,EAA2BqK,IAA3B,EAAiC;AAChC,UAAM8F,QAAQ;AACbkV,eAAS,CAAE,wBAAF,EAA4B,0BAA5B,CADI;AAEbC,cAAQ,CAAE,uBAAF,EAA2B,yBAA3B,CAFK;AAGbC,aAAO,CAAE,sBAAF,EAA0B,wBAA1B;AAHM,KAAd;AAMA,WAAQ/hB,SAAS2M,MAAM9F,IAAN,EAAY,CAAZ,CAAT,EAAyBM,OAAzB,CAAiC3K,EAAjC,MAAyC,CAAC,CAA1C,IAA+CwD,SAAS2M,MAAM9F,IAAN,EAAY,CAAZ,CAAT,EAAyBM,OAAzB,CAAiC3K,EAAjC,MAAyC,CAAC,CAAjG;AACA,GAlD2E,CAoD5E;;;AACA,QAAM2hB,4BAA4BvjB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,gCAAxB,CAAlC;AACA,QAAM+hB,iCAAiC3kB,KAAKmD,SAAL,CAAetE,MAAf,GAAwBiiB,yBAAxB,IAAqDA,8BAA8B,CAA1H;AACA,QAAMoC,gBAAgB3lB,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC2hB,iCAAhC,CAAkE5kB,KAAKU,GAAvE,EAA4EikB,8BAA5E,CAAtB;AACA,QAAM3D,UAAU,EAAhB;AACAkC,gBAAc1d,OAAd,CAAuBxB,CAAD,IAAO;AAC5Bgd,YAAQjb,IAAR,CAAa/B,EAAE4K,CAAF,CAAIlO,GAAjB;AACA,GAFD;AAGA,QAAMmkB,QAAQ,EAAd;AACAtnB,aAAWC,MAAX,CAAkBwf,KAAlB,CAAwB8H,cAAxB,CAAuC9D,OAAvC,EAAgD;AAAEve,YAAQ;AAAE,8BAAwB;AAA1B;AAAV,GAAhD,EAA2F+C,OAA3F,CAAoGlE,IAAD,IAAU;AAC5GujB,UAAMvjB,KAAKZ,GAAX,IAAkBY,IAAlB;AACA,GAFD;AAIA4hB,gBAAc1d,OAAd,CAAsBtD,gBAAgB;AACrC,QAAIA,aAAagf,oBAAjB,EAAuC;AACtCve,eAASqhB,sBAAT,CAAgCje,IAAhC,CAAqC7D,aAAa0M,CAAb,CAAelO,GAApD;AACAiC,eAASuhB,qBAAT,CAA+Bne,IAA/B,CAAoC7D,aAAa0M,CAAb,CAAelO,GAAnD;AACAiC,eAAS0hB,oBAAT,CAA8Bte,IAA9B,CAAmC7D,aAAa0M,CAAb,CAAelO,GAAlD;AACA;AACA;;AAED,UAAM;AACLqkB,2BAAqBxnB,WAAWgE,iBAAX,CAA6BsjB,MAAM3iB,aAAa0M,CAAb,CAAelO,GAArB,CAA7B,EAAwD,oBAAxD,CADhB;AAELskB,6BAAuBznB,WAAWgE,iBAAX,CAA6BsjB,MAAM3iB,aAAa0M,CAAb,CAAelO,GAArB,CAA7B,EAAwD,sBAAxD,CAFlB;AAGLukB,gCAA0B1nB,WAAWgE,iBAAX,CAA6BsjB,MAAM3iB,aAAa0M,CAAb,CAAelO,GAArB,CAA7B,EAAwD,qBAAxD;AAHrB,QAIFwB,YAJJ;;AAMA,QAAI6iB,uBAAuB,KAAvB,IAAgC,CAACJ,8BAArC,EAAqE;AACpEhiB,eAASyhB,sBAAT,CAAgCre,IAAhC,CAAqC7D,aAAa0M,CAAb,CAAelO,GAApD;AACA;;AACD,QAAIskB,yBAAyB,KAAzB,IAAkC,CAACL,8BAAvC,EAAuE;AACtEhiB,eAASohB,wBAAT,CAAkChe,IAAlC,CAAuC7D,aAAa0M,CAAb,CAAelO,GAAtD;AACA,KAFD,MAEO,IAAIskB,yBAAyB,SAA7B,EAAwC;AAC9CriB,eAASqhB,sBAAT,CAAgCje,IAAhC,CAAqC7D,aAAa0M,CAAb,CAAelO,GAApD;AACA;;AACD,QAAIukB,4BAA4B,KAA5B,IAAqC,CAACN,8BAA1C,EAA0E;AACzEhiB,eAASshB,uBAAT,CAAiCle,IAAjC,CAAsC7D,aAAa0M,CAAb,CAAelO,GAArD;AACA,KAFD,MAEO,IAAIukB,4BAA4B,SAAhC,EAA2C;AACjDtiB,eAASuhB,qBAAT,CAA+Bne,IAA/B,CAAoC7D,aAAa0M,CAAb,CAAelO,GAAnD;AACA;;AAEDiC,aAAS2hB,uBAAT,CAAiCpiB,aAAa0M,CAAb,CAAelO,GAAhD,IAAuDwB,aAAagjB,sBAApE;AACAviB,aAASwhB,4BAAT,CAAsCjiB,aAAa0M,CAAb,CAAelO,GAArD,IAA4DwB,aAAaijB,2BAAzE;AACA,GA9BD;AA+BA,MAAIC,kBAAkB,EAAtB;AACA,MAAIC,kBAAkB,EAAtB;AACA,MAAIhC,sBAAsB,EAA1B;AACA,QAAMnG,WAAW,EAAjB;AACA,QAAMoI,4BAA4B/nB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oCAAxB,CAAlC;AAEA,QAAM2iB,sBAAsBhoB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBC,kCAAxB,CAA2Djd,KAAKmD,SAAhE,EAA2E;AAAEV,YAAQ;AAAE,aAAO,CAAT;AAAY,yCAAmC;AAA/C;AAAV,GAA3E,EAA0I6W,KAA1I,GAC1BzP,MAD0B,CACnBvI,QAAQ+a,yBAAyB9N,OAAzB,EAAkCjN,KAAKqB,QAAL,CAAcwO,WAAd,CAA0BmL,UAA5D,CADW,CAA5B;AAGA,MAAIkH,eAAe,GAAnB,CAzG4E,CA0G5E;;AACA,MAAIjmB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,mBAAxB,CAAJ,EAAkD;AACjD4gB,mBAAehB,iBAAiBjU,OAAjB,EAA0BhO,MAA1B,CAAf;AACA;;AAED,MAAIgjB,gBAAgB,EAApB;AACA,MAAID,YAAY,EAAhB;;AACA,MAAI/lB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,yBAAxB,CAAJ,EAAwD;AACvD2gB,oBAAgBjiB,KAAKO,QAArB;AACAyhB,gBAAa,IAAItjB,KAAKrB,IAAM,EAA5B;AACA;;AAEDqK,UAAQC,GAAR,CAAajJ,KAAKU,GAAlB;AACAsI,UAAQC,GAAR,CAAasF,OAAb;;AACA,MAAIvO,KAAKS,CAAL,IAAU,IAAV,IAAkBT,KAAKS,CAAL,KAAW,GAAjC,EAAsC;AACrC,UAAM+kB,kBAAkBjX,QAAQlM,GAAR,CAAY0H,OAAZ,CAAoBwE,QAAQK,CAAR,CAAUlO,GAA9B,EAAmC,EAAnC,CAAxB;AACA,UAAM+kB,gBAAgBloB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwB5a,OAAxB,CAAgC;AACrD1B,WAAK8kB;AADgD,KAAhC,EAEnB;AACF/iB,cAAQ;AACPZ,kBAAU,CADH;AAEP6jB,0BAAkB,CAFX;AAGPC,iBAAS;AAHF;AADN,KAFmB,CAAtB,CAFqC,CAYrC;;AACA,QAAIF,iBAAiB,IAArB,EAA2B;AAC1BloB,iBAAWqoB,SAAX,CAAqBpS,MAArB,CAA4BjF,OAA5B,EAAqC,CAACkX,cAAc/kB,GAAf,CAArC,EACE,IAAIY,KAAKO,QAAU,KAAK0M,QAAQT,GAAK,EADvC,EAC0C,gBAD1C;;AAGA,UAAIyW,cAAciB,eAAd,EAA+B,SAA/B,CAAJ,EAA+C;AAC9C,cAAM7C,WAAWhgB,SAASwhB,4BAAT,CAAsCsB,cAAc/kB,GAApD,CAAjB;AACAgiB,0BAAkB+C,cAAc/kB,GAAhC,EAAqCY,IAArC,EAA2CiN,OAA3C,EAAoDvO,IAApD,EAA0D2iB,QAA1D;AACA;;AAGD3Z,cAAQC,GAAR,CAAawc,aAAb;;AACA,UAAIlB,cAAciB,eAAd,EAA+B,QAA/B,CAAJ,EAA8C;AAC7Cxc,gBAAQC,GAAR,CAAa,uBAAb;;AACA,YAAIwO,KAAKiM,OAAL,KAAiB,IAAjB,KAA0B+B,cAAcC,gBAAd,KAAmC,QAAnC,IAA+CD,cAAcE,OAAd,KAA0B3lB,KAAKU,GAA9E,IAAqF4kB,8BAA8B,IAA7I,CAAJ,EAAwJ;AACvJtc,kBAAQC,GAAR,CAAa,uBAAb;AACA1L,qBAAW2Y,gBAAX,CAA4BM,IAA5B,CAAiC;AAChCxT,oBAAQuL,QAAQlM,GADgB;AAEhCR,sBAAU0hB,aAFsB;AAGhChV,qBAASiV,YAHuB;AAIhC7M,mBAAOsM,cAAcwC,cAAc/kB,GAA5B,CAJyB;AAKhCgW,qBAAS;AACRtF,oBAAMjR,OAAO2E,WAAP,EADE;AAERzC,mBAAKkM,QAAQlM,GAFL;AAGR0gB,sBAAQxU,QAAQK,CAHR;AAIRpF,oBAAMxJ,KAAKS,CAJH;AAKR9B,oBAAMqB,KAAKrB;AALH,aALuB;AAYhC8X,qBAAS;AACRlW,sBAAQklB,cAAc/kB;AADd,aAZuB;AAehCkW,sBAAU2L,qBAAqBviB,IAArB,EAA2BylB,cAAc5jB,QAAzC,IAAqDugB,gBAArD,GAAwEC;AAflD,WAAjC;AAiBA,iBAAO9T,OAAP;AACA;AACD;AACD;AAED,GAlDD,MAkDO;AACN,UAAMuO,aAAa,CAACvO,QAAQ2O,QAAR,IAAoB,EAArB,EAAyB5W,GAAzB,CAA6B,CAAC;AAAC5F;AAAD,KAAD,KAAWA,GAAxC,CAAnB;AACA,UAAMkc,QAAQE,WAAWe,QAAX,CAAoB,KAApB,CAAd;AACA,UAAMhB,SAASC,WAAWe,QAAX,CAAoB,MAApB,CAAf;;AAEA,QAAIf,WAAWje,MAAX,GAAoB8D,SAASohB,wBAAT,CAAkCllB,MAAtD,GAA+D,CAAnE,EAAsE;AACrE,UAAIgnB,oBAAoB9gB,EAAE+gB,KAAF,CAAQhJ,UAAR,EAAoBna,SAASohB,wBAA7B,CAAxB;;AACA8B,0BAAoB9gB,EAAEghB,UAAF,CAAaF,iBAAb,EAAgCljB,SAASqhB,sBAAzC,CAApB;AAEA,UAAIgC,yBAAyBzoB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBlV,IAAxB,CAA6B;AACzDpH,aAAK;AACJulB,eAAKJ;AADD;AADoD,OAA7B,EAI1B;AACFpjB,gBAAQ;AACP/B,eAAK,CADE;AAEPmB,oBAAU,CAFH;AAGPgiB,kBAAQ;AAHD;AADN,OAJ0B,EAU1BvK,KAV0B,EAA7B;AAWA4D,eAASnX,IAAT,CAAc,GAAGigB,sBAAjB;;AACA,UAAIhmB,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnBulB,iCAAyBjhB,EAAEmD,MAAF,CAAS8d,sBAAT,EAAkCE,kBAAD,IAAwB;AACjF,iBAAOlmB,KAAKmD,SAAL,CAAe2G,OAAf,CAAuBoc,mBAAmBrkB,QAA1C,MAAwD,CAAC,CAAhE;AACA,SAFwB,CAAzB;AAGA;;AAEDwjB,wBAAkBtgB,EAAEohB,KAAF,CAAQH,sBAAR,EAAgC,KAAhC,CAAlB;AACA;;AAED,QAAIlJ,WAAWje,MAAX,GAAoB8D,SAASshB,uBAAT,CAAiCplB,MAArD,GAA8D,CAAlE,EAAqE;AACpE,UAAIunB,mBAAmBrhB,EAAE+gB,KAAF,CAAQhJ,UAAR,EAAoBna,SAASshB,uBAA7B,CAAvB;;AACAmC,yBAAmBrhB,EAAEghB,UAAF,CAAaK,gBAAb,EAA+BzjB,SAASuhB,qBAAxC,CAAnB;AAEA,YAAMmC,6BAA6B;AAClC3lB,aAAK;AACJulB,eAAKG;AADD;AAD6B,OAAnC;;AAMA,UAAId,8BAA8B,IAAlC,EAAwC;AACvC;AACAe,mCAA2B,KAA3B,IAAoC,CAAC;AAACX,4BAAkB;AAAEY,iBAAK;AAAP;AAAnB,SAAD,EAAwC;AAACX,mBAAS;AAACW,iBAAKtmB,KAAKU;AAAX;AAAV,SAAxC,CAApC;AACA;;AAED,UAAI6lB,wBAAwBhpB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBlV,IAAxB,CAA6Bue,0BAA7B,EAAyD;AACpF5jB,gBAAQ;AACP/B,eAAK,CADE;AAEPmB,oBAAU,CAFH;AAGP6jB,4BAAkB,CAHX;AAIP7B,kBAAQ;AAJD;AAD4E,OAAzD,EAOzBvK,KAPyB,EAA5B;AASA4D,eAASnX,IAAT,CAAc,GAAGwgB,qBAAjB;;AACA,UAAIvmB,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnB8lB,gCAAwBxhB,EAAEmD,MAAF,CAASqe,qBAAT,EAAgCL,sBAAsB,CAAClmB,KAAKmD,SAAL,CAAe0a,QAAf,CAAwBqI,mBAAmBrkB,QAA3C,CAAvD,CAAxB;AACA;;AAEDwhB,4BAAsBkD,sBAAsBjgB,GAAtB,CAA0BkgB,cAAc;AAC7D/C,sBAAc+C,WAAW9lB,GAAzB,IAAgC8lB,WAAW3kB,QAA3C;AACA,eAAO2kB,WAAW9lB,GAAlB;AACA,OAHqB,CAAtB;AAIA;;AAED,QAAIoc,WAAWje,MAAX,GAAoB8D,SAASyhB,sBAAT,CAAgCvlB,MAApD,GAA6D,CAAjE,EAAoE;AACnE,UAAI4nB,kBAAkB1hB,EAAE+gB,KAAF,CAAQhJ,UAAR,EAAoBna,SAASyhB,sBAA7B,CAAtB;;AACAqC,wBAAkB1hB,EAAEghB,UAAF,CAAaU,eAAb,EAA8BpB,eAA9B,CAAlB;AAEA,UAAIqB,uBAAuBnpB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBlV,IAAxB,CAA6B;AAAEpH,aAAK;AAAEulB,eAAKQ;AAAP,SAAP;AAAiCf,0BAAkB;AAC1GY,eAAI;AADsG;AAAnD,OAA7B,EAEtB;AACJ7jB,gBAAQ;AACP/B,eAAK,CADE;AAEPmB,oBAAU,CAFH;AAGPgiB,kBAAQ;AAHD;AADJ,OAFsB,EAQxBvK,KARwB,EAA3B;AASA4D,eAASnX,IAAT,CAAc,GAAG2gB,oBAAjB;;AACA,UAAI1mB,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnBimB,+BAAuB3hB,EAAEmD,MAAF,CAASwe,oBAAT,EAAgCR,kBAAD,IAAwB;AAC7E,iBAAOlmB,KAAKmD,SAAL,CAAe2G,OAAf,CAAuBoc,mBAAmBrkB,QAA1C,MAAwD,CAAC,CAAhE;AACA,SAFsB,CAAvB;AAGA;;AAEDujB,wBAAkBrgB,EAAEohB,KAAF,CAAQO,oBAAR,EAA8B,KAA9B,CAAlB;AACA;;AAED,QAAI1mB,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnByc,eAASrT,MAAT,CAAgBvI,QAAQ,CAACtB,KAAKmD,SAAL,CAAe0a,QAAf,CAAwBvc,KAAKO,QAA7B,CAAzB,EACE2D,OADF,CACUlE,QAAOsiB,SAAStiB,IAAT,EAAetB,KAAKU,GAApB,CADjB;AAEA;;AAED,QAAI,CAACkc,KAAD,EAAQC,MAAR,EAAgBL,IAAhB,CAAqBmK,KAAKA,CAA1B,KAAgC3mB,KAAKmD,SAArC,IAAkDnD,KAAKmD,SAAL,CAAetE,MAAf,GAAwB,CAA9E,EAAiF;AAChFtB,iBAAWC,MAAX,CAAkBwf,KAAlB,CAAwBlV,IAAxB,CAA6B;AAC5BjG,kBAAU;AAAEokB,eAAKjmB,KAAKmD;AAAZ,SADkB;AAE5BzC,aAAK;AAAE4lB,eAAKhlB,KAAKZ;AAAZ;AAFuB,OAA7B,EAGG;AACF+B,gBAAQ;AACP/B,eAAK,CADE;AAEPmB,oBAAU,CAFH;AAGPiZ,kBAAQ,CAHD;AAIP4K,4BAAkB;AAJX;AADN,OAHH,EAUGlgB,OAVH,CAUW,UAASlE,IAAT,EAAe;AACzB,YAAI,CAAC,QAAD,EAAW,MAAX,EAAmB,MAAnB,EAA2Buc,QAA3B,CAAoCvc,KAAKwZ,MAAzC,KAAoD,CAAC,CAACnY,SAASqhB,sBAAT,IAAmC,EAApC,EAAwCnG,QAAxC,CAAiDvc,KAAKZ,GAAtD,CAAzD,EAAqH;AACpH2kB,0BAAgBtf,IAAhB,CAAqBzE,KAAKZ,GAA1B;AACA0kB,0BAAgBrf,IAAhB,CAAqBzE,KAAKZ,GAA1B;AACA;;AACD,YAAIkc,SAAStb,KAAKokB,gBAAL,KAA0B,QAAnC,IAA+C,CAAC,CAAC/iB,SAASuhB,qBAAT,IAAkC,EAAnC,EAAuCrG,QAAvC,CAAgDvc,KAAKZ,GAArD,CAApD,EAA+G;AAC9G+iB,wBAAcniB,KAAKZ,GAAnB,IAA0BY,KAAKO,QAA/B;AACA,iBAAOwhB,oBAAoBtd,IAApB,CAAyBzE,KAAKZ,GAA9B,CAAP;AACA;;AACD,YAAIkc,SAAStb,KAAKokB,gBAAL,KAA0B,QAAvC,EAAiD;AAChDN,0BAAgBrf,IAAhB,CAAqBzE,KAAKZ,GAA1B;AACA;AACD,OAtBD;AAuBA;;AAED,QAAI6kB,oBAAoB1mB,MAApB,GAA6B,CAAjC,EAAoC;AACnC,YAAMke,gBAAgBhY,EAAEohB,KAAF,CAAQZ,mBAAR,EAA6B,KAA7B,CAAtB;;AACAH,wBAAkBA,gBAAgBne,MAAhB,CAAuB8V,aAAvB,CAAlB;AACAsI,wBAAkBA,gBAAgBpe,MAAhB,CAAuB8V,aAAvB,CAAlB;AACAsG,4BAAsBA,oBAAoBpc,MAApB,CAA2B8V,aAA3B,CAAtB;AACA;;AAEDsI,sBAAkBtgB,EAAE6hB,OAAF,CAAU7hB,EAAE0Y,OAAF,CAAU1Y,EAAE2Y,MAAF,CAAS2H,eAAT,CAAV,CAAV,EAAgD9W,QAAQK,CAAR,CAAUlO,GAA1D,CAAlB;AACA2iB,0BAAsBte,EAAE6hB,OAAF,CAAU7hB,EAAE0Y,OAAF,CAAU1Y,EAAE2Y,MAAF,CAAS2F,mBAAT,CAAV,CAAV,EAAoD9U,QAAQK,CAAR,CAAUlO,GAA9D,CAAtB;AACA0kB,sBAAkBrgB,EAAE6hB,OAAF,CAAU7hB,EAAE0Y,OAAF,CAAU1Y,EAAE2Y,MAAF,CAAS0H,eAAT,CAAV,CAAV,EAAgD7W,QAAQK,CAAR,CAAUlO,GAA1D,CAAlB;;AAEA,SAAK,MAAMmmB,gBAAX,IAA+BxB,eAA/B,EAAgD;AAC/C,YAAM1C,WAAWhgB,SAASwhB,4BAAT,CAAsC0C,gBAAtC,CAAjB;AACAnE,wBAAkBmE,gBAAlB,EAAoCvlB,IAApC,EAA0CiN,OAA1C,EAAmDvO,IAAnD,EAAyD2iB,QAAzD;AACA;;AACD,SAAK,MAAMkE,gBAAX,IAA+BzB,eAA/B,EAAgD;AAC/CpC,sBAAgB6D,gBAAhB,EAAkCtY,OAAlC,EAA2CvO,IAA3C;AACA;;AACDojB,0BAAsBC,mBAAtB,EAA2C9U,OAA3C,EAAoDvO,IAApD,EAA0DsjB,SAA1D,EAAqEC,aAArE,EAAoFC,YAApF,EAAkGC,aAAlG;;AAEA,UAAMqD,qBAAqB/hB,EAAE2Y,MAAF,CAAS2H,gBAAgBpe,MAAhB,CAAuBoc,mBAAvB,CAAT,CAA3B;;AACA9lB,eAAWqoB,SAAX,CAAqBpS,MAArB,CAA4BjF,OAA5B,EAAqCuY,kBAArC,EACE,IAAIxlB,KAAKO,QAAU,KAAK0M,QAAQT,GAAK,EADvC,EAC0C9N,KAAKS,CAAL,KAAW,GAAX,GAAiB,gBAAjB,GAAoC,SAD9E;AAEA;;AAED,SAAO8N,OAAP;AAEA,CA5TD,EA4TGhR,WAAWyH,SAAX,CAAqBsC,QAArB,CAA8BG,GA5TjC,EA4TsC,2BA5TtC,E;;;;;;;;;;;ACzJA,IAAI1C,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAIypB,GAAJ;AAAQ7pB,OAAOC,KAAP,CAAaC,QAAQ,KAAR,CAAb,EAA4B;AAACC,UAAQC,CAAR,EAAU;AAACypB,UAAIzpB,CAAJ;AAAM;;AAAlB,CAA5B,EAAgD,CAAhD;AAGtE,IAAI0pB,uBAAuB,EAA3B;AACA,IAAIC,uBAAuB,EAA3B;AACA,IAAIC,sBAAsB,KAA1B;AACA,IAAIC,oBAAoB,KAAxB;AAEA5pB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,6BAAxB,EAAuD,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AAC3EshB,yBAAuBjiB,EAAEuB,GAAF,CAAMZ,MAAMoD,KAAN,CAAY,GAAZ,CAAN,EAAyBse,MAAD,IAAYA,OAAO9iB,IAAP,EAApC,CAAvB;AACA,CAFD;AAGA/G,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,6BAAxB,EAAuD,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AAC3EuhB,yBAAuBliB,EAAEuB,GAAF,CAAMZ,MAAMoD,KAAN,CAAY,GAAZ,CAAN,EAAyBse,MAAD,IAAYA,OAAO9iB,IAAP,EAApC,CAAvB;AACA,CAFD;AAGA/G,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uCAAxB,EAAiE,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AACrFwhB,wBAAsBxhB,KAAtB;AACA,CAFD;AAGAnI,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,4BAAxB,EAAsD,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AAC1EyhB,sBAAoBzhB,KAApB;AACA,CAFD;;AAIAnI,WAAW8pB,mBAAX,GAAiC,UAAS9b,KAAT,EAAgB;AAChD,QAAM+b,kBAAkB,uIAAxB;;AACA,MAAI,CAACA,gBAAgB1hB,IAAhB,CAAqB2F,KAArB,CAAL,EAAkC;AACjC,UAAM,IAAIpL,OAAOrB,KAAX,CAAiB,qBAAjB,EAAyC,iBAAiByM,KAAO,EAAjE,EAAoE;AAAEf,gBAAU,gCAAZ;AAA8Ce;AAA9C,KAApE,CAAN;AACA;;AAED,QAAMgc,cAAchc,MAAMic,MAAN,CAAajc,MAAMkc,WAAN,CAAkB,GAAlB,IAAyB,CAAtC,CAApB,CANgD,CAQhD;;AACA,MAAIR,qBAAqBnd,OAArB,CAA6Byd,WAA7B,MAA8C,CAAC,CAAnD,EAAsD;AACrD,QAAIP,qBAAqBld,OAArB,CAA6Byd,WAA7B,MAA8C,CAAC,CAA/C,IAAqDL,uBAAuB3pB,WAAWma,2BAAX,CAAuC5N,OAAvC,CAA+Cyd,WAA/C,MAAgE,CAAC,CAAjJ,EAAqJ;AACpJ,YAAM,IAAIpnB,OAAOrB,KAAX,CAAiB,gCAAjB,EAAmD,iCAAnD,EAAsF;AAAE0L,kBAAU;AAAZ,OAAtF,CAAN;AACA;AACD;;AAED,MAAI2c,iBAAJ,EAAuB;AACtB,QAAI;AACHhnB,aAAOunB,SAAP,CAAiBX,IAAIY,SAArB,EAAgCJ,WAAhC;AACA,KAFD,CAEE,OAAOZ,CAAP,EAAU;AACX,YAAM,IAAIxmB,OAAOrB,KAAX,CAAiB,sBAAjB,EAAyC,gBAAzC,EAA2D;AAAE0L,kBAAU;AAAZ,OAA3D,CAAN;AACA;AACD;AACD,CAtBD,C;;;;;;;;;;;ACrBAtN,OAAOO,MAAP,CAAc;AAACC,oBAAiB,MAAIA,gBAAtB;AAAuCG,kBAAe,MAAIA,cAA1D;AAAyED,uBAAoB,MAAIA;AAAjG,CAAd;AAAqI,IAAIF,gBAAJ,EAAqBG,cAArB,EAAoCD,mBAApC;AAAwDV,OAAOC,KAAP,CAAaC,QAAQ,0BAAR,CAAb,EAAiD;AAACM,mBAAiBJ,CAAjB,EAAmB;AAACI,uBAAiBJ,CAAjB;AAAmB,GAAxC;;AAAyCO,iBAAeP,CAAf,EAAiB;AAACO,qBAAeP,CAAf;AAAiB,GAA5E;;AAA6EM,sBAAoBN,CAApB,EAAsB;AAACM,0BAAoBN,CAApB;AAAsB;;AAA1H,CAAjD,EAA6K,CAA7K,E;;;;;;;;;;;ACA7L,IAAIsqB,EAAJ;AAAO1qB,OAAOC,KAAP,CAAaC,QAAQ,IAAR,CAAb,EAA2B;AAACC,UAAQC,CAAR,EAAU;AAACsqB,SAAGtqB,CAAH;AAAK;;AAAjB,CAA3B,EAA8C,CAA9C;;AAEP,SAASuqB,YAAT,GAAwB;AACvB,MAAI;AACHD,OAAGE,QAAH,CAAY,aAAZ;AACA,WAAO,IAAP;AACA,GAHD,CAGE,OAAOrhB,GAAP,EAAY;AACb,WAAO,KAAP;AACA;AACD;;AAED,SAASshB,eAAT,GAA2B;AAC1B,MAAI;AACH,WAAOH,GAAGI,YAAH,CAAgB,mBAAhB,EAAqC,MAArC,EAA6Cle,OAA7C,CAAqD,QAArD,MAAmE,CAAC,CAA3E;AACA,GAFD,CAEE,OAAOrD,GAAP,EAAY;AACb,WAAO,KAAP;AACA;AACD;;AAED,SAASyO,KAAT,GAAiB;AAChB,SAAO2S,kBAAkBE,iBAAzB;AACA;;AAED,IAAIE,QAAJ;;AACA1qB,WAAW0qB,QAAX,GAAsB,YAAW;AAChC,MAAIA,aAAahX,SAAjB,EAA4B;AAC3BgX,eAAW/S,OAAX;AACA;;AAED,SAAO+S,QAAP;AACA,CAND,C;;;;;;;;;;;ACxBA1qB,WAAW2qB,wBAAX,GAAsC,UAAS5mB,IAAT,EAAe6mB,QAAf,EAAyB;AAC9D5qB,aAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,2BAAzB,EAAsD7G,IAAtD;AACA,QAAM8mB,eAAe7qB,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBge,qBAAxB,CAA8C,IAA9C,EAAoD,CAAC,GAAD,EAAM,GAAN,CAApD,EAAgE;AAAC5lB,YAAQ;AAACU,iBAAW;AAAZ;AAAT,GAAhE,EAA0FmW,KAA1F,EAArB;AACA8O,eAAa5iB,OAAb,CAAsBxF,IAAD,IAAU;AAE9B;AACA,UAAMgf,QAAQhf,KAAKsoB,EAAL,IAAW,CAAC/qB,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BjnB,KAAKZ,GAApC,EAAyC,eAAzC,CAA1B;AACAnD,eAAWC,MAAX,CAAkB6M,KAAlB,CAAwBme,eAAxB,CAAwCxoB,KAAKU,GAA7C,EAAkDY,KAAKO,QAAvD,EAAiEmd,KAAjE;;AAEA,QAAI,CAACzhB,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyD7e,KAAKU,GAA9D,EAAmEY,KAAKZ,GAAxE,CAAL,EAAmF;AAElF;AACAnD,iBAAWC,MAAX,CAAkByF,aAAlB,CAAgCwlB,qBAAhC,CAAsDzoB,IAAtD,EAA4DsB,IAA5D,EAAkE;AACjE4D,YAAI,IAAIC,IAAJ,EAD6D;AAEjEujB,cAAM,IAF2D;AAGjEC,eAAO,IAH0D;AAIjE5kB,gBAAQ,CAJyD;AAKjE6kB,sBAAc,CALmD;AAMjEC,uBAAe;AANkD,OAAlE,EAHkF,CAYlF;;AACA,UAAI,CAACV,QAAL,EAAe;AACd5qB,mBAAWC,MAAX,CAAkBghB,QAAlB,CAA2BsK,+BAA3B,CAA2D9oB,KAAKU,GAAhE,EAAqEY,IAArE;AACA;AACD;AACD,GAvBD;AAwBA,CA3BD,C;;;;;;;;;;;ACAA/D,WAAWwrB,aAAX,GAA2B,UAAS1mB,GAAT,EAAcf,IAAd,EAAoB0nB,OAApB,EAA6Bb,QAA7B,EAAuC;AACjE,QAAM1f,MAAM,IAAItD,IAAJ,EAAZ;AACA,QAAMnF,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCpc,GAApC,CAAb,CAFiE,CAIjE;;AACA,QAAMH,eAAe3E,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyDxc,GAAzD,EAA8Df,KAAKZ,GAAnE,CAArB;;AACA,MAAIwB,YAAJ,EAAkB;AACjB;AACA;;AAED,MAAIlC,KAAKS,CAAL,KAAW,GAAX,IAAkBT,KAAKS,CAAL,KAAW,GAAjC,EAAsC;AACrClD,eAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,gBAAzB,EAA2C7G,IAA3C,EAAiDtB,IAAjD;AACA;;AAED,QAAMgf,QAAQhf,KAAKsoB,EAAL,IAAW,CAAC/qB,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BjnB,KAAKZ,GAApC,EAAyC,eAAzC,CAA1B;AACAnD,aAAWC,MAAX,CAAkB6M,KAAlB,CAAwBme,eAAxB,CAAwCnmB,GAAxC,EAA6Cf,KAAKO,QAAlD,EAA4Dmd,KAA5D;AACAzhB,aAAWC,MAAX,CAAkByF,aAAlB,CAAgCwlB,qBAAhC,CAAsDzoB,IAAtD,EAA4DsB,IAA5D,EAAkE;AACjE4D,QAAIuD,GAD6D;AAEjEigB,UAAM,IAF2D;AAGjEC,WAAO,IAH0D;AAIjE5kB,YAAQ,CAJyD;AAKjE6kB,kBAAc,CALmD;AAMjEC,mBAAe;AANkD,GAAlE;;AASA,MAAI,CAACV,QAAL,EAAe;AACd,QAAIa,OAAJ,EAAa;AACZzrB,iBAAWC,MAAX,CAAkBghB,QAAlB,CAA2ByK,gCAA3B,CAA4D5mB,GAA5D,EAAiEf,IAAjE,EAAuE;AACtE4D,YAAIuD,GADkE;AAEtEmG,WAAG;AACFlO,eAAKsoB,QAAQtoB,GADX;AAEFmB,oBAAUmnB,QAAQnnB;AAFhB;AAFmE,OAAvE;AAOA,KARD,MAQO;AACNtE,iBAAWC,MAAX,CAAkBghB,QAAlB,CAA2BsK,+BAA3B,CAA2DzmB,GAA3D,EAAgEf,IAAhE,EAAsE;AAAE4D,YAAIuD;AAAN,OAAtE;AACA;AACD;;AAED,MAAIzI,KAAKS,CAAL,KAAW,GAAX,IAAkBT,KAAKS,CAAL,KAAW,GAAjC,EAAsC;AACrCN,WAAOiJ,KAAP,CAAa,YAAW;AACvB7L,iBAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,eAAzB,EAA0C7G,IAA1C,EAAgDtB,IAAhD;AACA,KAFD;AAGA;;AAED,SAAO,IAAP;AACA,CA9CD,C;;;;;;;;;;;ACAAzC,WAAW2rB,WAAX,GAAyB,UAAS7mB,GAAT,EAAc;AACtC9E,aAAWC,MAAX,CAAkB6M,KAAlB,CAAwB8e,WAAxB,CAAoC9mB,GAApC;AACA9E,aAAWC,MAAX,CAAkByF,aAAlB,CAAgCmmB,eAAhC,CAAgD/mB,GAAhD;AAEA9E,aAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,mBAAzB,EAA8C5K,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCpc,GAApC,CAA9C,EAAwFlC,OAAOmB,IAAP,EAAxF;AACA,CALD,C;;;;;;;;;;;ACAA,IAAIyD,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAGpEC,WAAW8rB,yBAAX,GAAuC,UAASxnB,QAAT,EAAmB;AACzD,SAAOtE,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,8BAAxB,EAAwD,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AACnF,UAAM4jB,oBAAoBvkB,EAAEuB,GAAF,CAAMZ,MAAMoD,KAAN,CAAY,GAAZ,CAAN,EAAwB,UAASjH,QAAT,EAAmB;AACpE,aAAOA,SAASyC,IAAT,EAAP;AACA,KAFyB,CAA1B;;AAGA,QAAIglB,kBAAkBzqB,MAAlB,KAA6B,CAAjC,EAAoC;AACnC,UAAIyqB,kBAAkBC,KAAlB,CAAwBC,sBAAsB;AACjD,cAAMxiB,QAAQ,IAAI4D,MAAJ,CAAY,IAAI5G,EAAE2Y,YAAF,CAAe6M,kBAAf,CAAoC,GAApD,EAAwD,GAAxD,CAAd;AACA,eAAO,CAACxiB,MAAMpB,IAAN,CAAW5B,EAAEM,IAAF,CAAON,EAAE2Y,YAAF,CAAe9a,QAAf,CAAP,CAAX,CAAR;AACA,OAHG,CAAJ,EAGI;AACH,eAAO,CAAC1B,OAAO0kB,KAAP,CAAaziB,OAAb,CAAqB;AAC5BP,oBAAU;AACT4nB,oBAAQ,IAAI7e,MAAJ,CAAY,IAAI5G,EAAEM,IAAF,CAAON,EAAE2Y,YAAF,CAAe9a,QAAf,CAAP,CAAkC,GAAlD,EAAsD,GAAtD;AADC;AADkB,SAArB,CAAR;AAKA;;AACD,aAAO,KAAP;AACA;AACD,GAjBM,CAAP;AAkBA,CAnBD,C;;;;;;;;;;;ACHA,IAAImC,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAENC,WAAWmsB,sBAAX,GAAoC,UAASne,KAAT,EAAgB;AACnD,SAAO,CAACpL,OAAO0kB,KAAP,CAAaziB,OAAb,CAAqB;AAAE,sBAAkB;AAAEqnB,cAAS,IAAI7e,MAAJ,CAAY,IAAI5G,EAAEM,IAAF,CAAON,EAAE2Y,YAAF,CAAepR,KAAf,CAAP,CAA+B,GAA/C,EAAmD,GAAnD;AAAX;AAApB,GAArB,CAAR;AACA,CAFD,C;;;;;;;;;;;ACFA,IAAIxG,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAIpEC,WAAWosB,UAAX,GAAwB,UAASngB,IAAT,EAAe7K,IAAf,EAAqBirB,KAArB,EAA4BC,OAA5B,EAAqCC,QAArC,EAA+CC,YAAU,EAAzD,EAA6D;AACpFprB,SAAOqF,EAAEM,IAAF,CAAO3F,IAAP,CAAP;AACAirB,UAAQ5lB,EAAEM,IAAF,CAAOslB,KAAP,CAAR;AACAC,YAAU,GAAG5iB,MAAH,CAAU4iB,OAAV,CAAV;;AAEA,MAAI,CAAClrB,IAAL,EAAW;AACV,UAAM,IAAIwB,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE0L,gBAAU;AAAZ,KAAvD,CAAN;AACA;;AAEDof,UAAQrsB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBgN,iBAAxB,CAA0CJ,KAA1C,EAAiD;AAAEnnB,YAAQ;AAAEZ,gBAAU;AAAZ;AAAV,GAAjD,CAAR;;AACA,MAAI,CAAC+nB,KAAL,EAAY;AACX,UAAM,IAAIzpB,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE0L,gBAAU;AAAZ,KAAvD,CAAN;AACA;;AAED,QAAMyf,oBAAoB1sB,WAAW2M,gBAAX,CAA4BvL,IAA5B,CAA1B;AAEA,QAAM8J,MAAM,IAAItD,IAAJ,EAAZ;;AACA,MAAI,CAACJ,EAAE2E,QAAF,CAAWmgB,OAAX,EAAoBD,MAAM/nB,QAA1B,CAAL,EAA0C;AACzCgoB,YAAQ9jB,IAAR,CAAa6jB,MAAM/nB,QAAnB;AACA;;AAED,MAAI2H,SAAS,GAAb,EAAkB;AACjBjM,eAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,qBAAzB,EAAgDyhB,KAAhD,EAAuD;AACtDnpB,SAAG,GADmD;AAEtD9B,YAAMsrB,iBAFgD;AAGtDvnB,aAAO/D,IAH+C;AAItDuG,UAAIuD,GAJkD;AAKtD6f,UAAIwB,aAAa,IALqC;AAMtDI,cAAQJ,aAAa,IANiC;AAOtD3mB,iBAAW0mB,OAP2C;AAQtDjb,SAAG;AACFlO,aAAKkpB,MAAMlpB,GADT;AAEFmB,kBAAU+nB,MAAM/nB;AAFd;AARmD,KAAvD;AAaA;;AAEDkoB,cAAYzkB,OAAO6kB,MAAP,CAAc,EAAd,EAAkBJ,SAAlB,EAA6B;AACxC7kB,QAAIuD,GADoC;AAExC6f,QAAIwB,aAAa,IAFuB;AAGxCI,YAAQJ,aAAa;AAHmB,GAA7B,CAAZ;AAMA,QAAM9pB,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwB+f,kCAAxB,CAA2D5gB,IAA3D,EAAiEygB,iBAAjE,EAAoFtrB,IAApF,EAA0FirB,KAA1F,EAAiGC,OAAjG,EAA0GE,SAA1G,CAAb;;AAEA,OAAK,MAAMloB,QAAX,IAAuBgoB,OAAvB,EAAgC;AAC/B,UAAMQ,SAAS9sB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBgN,iBAAxB,CAA0CnoB,QAA1C,EAAoD;AAAEY,cAAQ;AAAEZ,kBAAU;AAAZ;AAAV,KAApD,CAAf;;AACA,QAAI,CAACwoB,MAAL,EAAa;AACZ;AACA,KAJ8B,CAM/B;;;AACA,QAAIP,aAAa,IAAb,IAAqB,CAACvsB,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+B8B,OAAO3pB,GAAtC,EAA2C,eAA3C,CAA1B,EAAuF;AACtFnD,iBAAWC,MAAX,CAAkB6M,KAAlB,CAAwBigB,oBAAxB,CAA6CtqB,KAAKU,GAAlD,EAAuDmB,QAAvD;AACA;;AAED,UAAM0oB,QAAQ;AAAE7B,YAAM;AAAR,KAAd;;AAEA,QAAI7mB,aAAa+nB,MAAM/nB,QAAvB,EAAiC;AAChC0oB,YAAMC,EAAN,GAAW/hB,GAAX;AACA;;AAEDlL,eAAWC,MAAX,CAAkByF,aAAlB,CAAgCwlB,qBAAhC,CAAsDzoB,IAAtD,EAA4DqqB,MAA5D,EAAoEE,KAApE;AACA;;AAEDhtB,aAAW8C,KAAX,CAAiBoqB,YAAjB,CAA8Bb,MAAMlpB,GAApC,EAAyC,CAAC,OAAD,CAAzC,EAAoDV,KAAKU,GAAzD;;AAEA,MAAI8I,SAAS,GAAb,EAAkB;AACjBrJ,WAAOiJ,KAAP,CAAa,MAAM;AAClB7L,iBAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,oBAAzB,EAA+CyhB,KAA/C,EAAsD5pB,IAAtD;AACA,KAFD;AAGA,GAJD,MAIO,IAAIwJ,SAAS,GAAb,EAAkB;AACxBrJ,WAAOiJ,KAAP,CAAa,MAAM;AAClB7L,iBAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,yBAAzB,EAAoDyhB,KAApD,EAA2D5pB,IAA3D;AACA,KAFD;AAGA;;AAED,SAAO;AACNqC,SAAKrC,KAAKU,GADJ;AAEN/B,UAAMsrB;AAFA,GAAP;AAIA,CAjFD,C;;;;;;;;;;;ACJA;AACA1sB,WAAWmtB,aAAX,GAA2B,UAASnc,OAAT,EAAkBjN,IAAlB,EAAwB;AAClD,QAAMqpB,cAAcptB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,qBAAxB,CAApB;AACA,QAAMgoB,oBAAoBrtB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,2BAAxB,CAA1B;AACA,MAAIioB,UAAJ;;AAEA,MAAIF,WAAJ,EAAiB;AAChB,QAAIC,iBAAJ,EAAuB;AACtBrtB,iBAAWC,MAAX,CAAkBghB,QAAlB,CAA2BsM,yBAA3B,CAAqDvc,QAAQ7N,GAA7D;AACA,KAFD,MAEO;AACNnD,iBAAWC,MAAX,CAAkBghB,QAAlB,CAA2BuM,aAA3B,CAAyCxc,QAAQ7N,GAAjD,EAAsD,IAAtD;AACA;;AAED,QAAI6N,QAAQyR,IAAR,IAAgBzR,QAAQyR,IAAR,CAAatf,GAAjC,EAAsC;AACrCnD,iBAAWC,MAAX,CAAkBwtB,OAAlB,CAA0BC,MAA1B,CAAiC1c,QAAQyR,IAAR,CAAatf,GAA9C,EAAmD;AAAEwqB,cAAM;AAAEC,mBAAS;AAAX;AAAR,OAAnD;AACA;AACD,GAVD,MAUO;AACN,QAAI,CAACP,iBAAL,EAAwB;AACvBC,mBAAattB,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2BC,WAA3B,CAAuClQ,QAAQ7N,GAA/C,CAAb;AACAnD,iBAAWC,MAAX,CAAkBghB,QAAlB,CAA2B4M,UAA3B,CAAsC7c,QAAQ7N,GAA9C;AACA;;AAED,QAAI6N,QAAQyR,IAAR,IAAgBzR,QAAQyR,IAAR,CAAatf,GAAjC,EAAsC;AACrC2qB,iBAAWC,QAAX,CAAoB,SAApB,EAA+BC,UAA/B,CAA0Chd,QAAQyR,IAAR,CAAatf,GAAvD;AACA;;AAEDP,WAAOiJ,KAAP,CAAa,YAAW;AACvB7L,iBAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,oBAAzB,EAA+C0iB,UAA/C;AACA,KAFD;AAGA,GA5BiD,CA8BlD;;;AACA,MAAIttB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oBAAxB,CAAJ,EAAmD;AAClD,UAAM5C,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoClQ,QAAQlM,GAA5C,EAAiD;AAAEI,cAAQ;AAAE0Z,qBAAa;AAAf;AAAV,KAAjD,CAAb;;AACA,QAAI,CAACnc,KAAKmc,WAAN,IAAqBnc,KAAKmc,WAAL,CAAiBzb,GAAjB,KAAyB6N,QAAQ7N,GAA1D,EAA+D;AAC9D,YAAMyb,cAAc5e,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2BgN,2CAA3B,CAAuEjd,QAAQlM,GAA/E,EAAoFkM,QAAQ7N,GAA5F,CAApB;AACAnD,iBAAWC,MAAX,CAAkB6M,KAAlB,CAAwB+R,kBAAxB,CAA2C7N,QAAQlM,GAAnD,EAAwD8Z,WAAxD;AACA;AACD;;AAED,MAAIyO,iBAAJ,EAAuB;AACtBrtB,eAAWC,MAAX,CAAkBghB,QAAlB,CAA2BiN,uBAA3B,CAAmDld,QAAQ7N,GAA3D,EAAgEY,IAAhE;AACA,GAFD,MAEO;AACN/D,eAAWslB,aAAX,CAAyB6I,UAAzB,CAAoCnd,QAAQlM,GAA5C,EAAiD,eAAjD,EAAkE;AAAE3B,WAAK6N,QAAQ7N;AAAf,KAAlE;AACA;AACD,CA5CD,C;;;;;;;;;;;ACDAnD,WAAWouB,UAAX,GAAwB,UAASprB,MAAT,EAAiB;AACxC,QAAMe,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCle,MAApC,CAAb,CADwC,CAGxC;;AACA,MAAIe,KAAKO,QAAL,IAAiB,IAArB,EAA2B;AAC1BtE,eAAWC,MAAX,CAAkBghB,QAAlB,CAA2BoN,cAA3B,CAA0CrrB,MAA1C,EAD0B,CACyB;;AACnDhD,eAAWC,MAAX,CAAkByF,aAAlB,CAAgC4oB,EAAhC,CAAmCC,YAAnC,CAAgDvrB,MAAhD,EAAwDiF,OAAxD,CAAiEtD,YAAD,IAAkB;AACjF,YAAMlC,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCvc,aAAaG,GAAjD,CAAb;;AACA,UAAIrC,IAAJ,EAAU;AACT,YAAIA,KAAKS,CAAL,KAAW,GAAX,IAAkBT,KAAKmD,SAAL,CAAetE,MAAf,KAA0B,CAAhD,EAAmD;AAClDtB,qBAAWC,MAAX,CAAkB6M,KAAlB,CAAwB+gB,UAAxB,CAAmClpB,aAAaG,GAAhD,EADkD,CACI;AACtD;;AACD,YAAIrC,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnBlD,qBAAWC,MAAX,CAAkByF,aAAlB,CAAgC8oB,cAAhC,CAA+C7pB,aAAaG,GAA5D;AACA9E,qBAAWC,MAAX,CAAkBghB,QAAlB,CAA2BuN,cAA3B,CAA0C7pB,aAAaG,GAAvD;AACA;AACD;AACD,KAXD;AAaA9E,eAAWC,MAAX,CAAkByF,aAAlB,CAAgC2oB,cAAhC,CAA+CrrB,MAA/C,EAf0B,CAe8B;;AACxDhD,eAAWC,MAAX,CAAkB6M,KAAlB,CAAwB2hB,8BAAxB,CAAuD,GAAvD,EAA4D1qB,KAAKO,QAAjE,EAhB0B,CAgBkD;;AAC5EtE,eAAWC,MAAX,CAAkB6M,KAAlB,CAAwB4hB,qBAAxB,CAA8C3qB,KAAKO,QAAnD,EAjB0B,CAiBoC;AAE9D;;AACA,QAAIP,KAAK4qB,YAAL,KAAsB,QAAtB,IAAkC5qB,KAAK4qB,YAAL,KAAsB,KAA5D,EAAmE;AAClEb,iBAAWC,QAAX,CAAoB,SAApB,EAA+Ba,YAA/B,CAA4C7qB,KAAKO,QAAjD;AACA;;AAEDtE,eAAWC,MAAX,CAAkB4uB,YAAlB,CAA+BC,eAA/B,CAA+C9rB,MAA/C,EAxB0B,CAwB8B;AACxD;;AAEDhD,aAAWC,MAAX,CAAkBwf,KAAlB,CAAwBoO,UAAxB,CAAmC7qB,MAAnC,EA/BwC,CA+BI;AAC5C,CAhCD,C;;;;;;;;;;;ACAA,IAAIwE,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAIpEC,WAAW+uB,eAAX,GAA6B,UAAS;AAAC/rB,QAAD;AAASsJ,QAAT;AAAiB0iB;AAAjB,CAAT,EAAkC;AAC9D,MAAI9pB,SAAS;AACZ9D,UAAM,CADM;AAEZkD,cAAU,CAFE;AAGZiZ,YAAQ,CAHI;AAIZ0R,eAAW,CAJC;AAKZhjB,UAAM,CALM;AAMZqa,YAAQ,CANI;AAOZpY,YAAQ;AAPI,GAAb;;AAUA,MAAIlO,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BhoB,MAA/B,EAAuC,2BAAvC,CAAJ,EAAyE;AACxEkC,aAASsC,EAAE0nB,MAAF,CAAShqB,MAAT,EAAiB;AACzBsf,cAAQ,CADiB;AAEzB2K,aAAO,CAFkB;AAGzBhH,wBAAkB,CAHO;AAIzBiH,iBAAW,CAJc;AAKzBC,iBAAW,CALc;AAMzBC,gBAAU,CANe;AAOzBC,6BAAuB,CAPE;AAQzBC,mCAA6B,CARJ;AASzBC,aAAO,CATkB;AAUzBC,oBAAc;AAVW,KAAjB,CAAT;AAYA,GAbD,MAaO,IAAIV,UAAU,CAAd,EAAiB;AACvBA,YAAQ,CAAR;AACA;;AAED1iB,WAAS7F,EAAEM,IAAF,CAAOuF,MAAP,CAAT;;AAEA,MAAI,CAACA,MAAD,IAAW0iB,UAAU,CAAzB,EAA4B;AAC3B,WAAOtb,SAAP;AACA;;AAED,QAAM3D,UAAU;AACf7K,UADe;AAEf8pB,SAFe;AAGfW,UAAM;AAAErrB,gBAAU;AAAZ;AAHS,GAAhB;;AAMA,MAAIgI,MAAJ,EAAY;AACX,QAAI0iB,UAAU,CAAd,EAAiB;AAChB,aAAOhvB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBmQ,cAAxB,CAAuCtjB,MAAvC,EAA+CyD,OAA/C,CAAP;AACA,KAFD,MAEO;AACN,YAAM8f,YAAY,IAAIxiB,MAAJ,CAAW5G,EAAE2Y,YAAF,CAAe9S,MAAf,CAAX,EAAmC,GAAnC,CAAlB;AACA,aAAOtM,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBqQ,gCAAxB,CAAyDD,SAAzD,EAAoE9f,OAApE,CAAP;AACA;AACD;;AAED,SAAO/P,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBlV,IAAxB,CAA6B,EAA7B,EAAiCwF,OAAjC,CAAP;AACA,CAlDD,C;;;;;;;;;;;ACJA,IAAIvI,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAGNC,WAAW+vB,iCAAX,GAA+C,SAASC,kCAAT,CAA4C;AAAEC,eAAF;AAAiBC,UAAjB;AAA2BjkB,SAAK,EAAhC;AAAoCkkB,0BAAsB,KAA1D;AAAiEC,gBAAY,IAA7E;AAAmFC,iBAAa;AAAhG,CAA5C,EAAoJ;AAClM,MAAI5tB,IAAJ,CADkM,CAGlM;;AACA,MAAIytB,SAASI,UAAT,CAAoB,GAApB,CAAJ,EAA8B;AAC7BJ,eAAWA,SAASK,SAAT,CAAmB,CAAnB,CAAX;AACA9tB,WAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwB0jB,iBAAxB,CAA0CN,QAA1C,CAAP;AACA,GAHD,MAGO,IAAIA,SAASI,UAAT,CAAoB,GAApB,KAA4BrkB,SAAS,GAAzC,EAA8C;AACpD;AACAikB,eAAWA,SAAS1jB,OAAT,CAAiB,GAAjB,EAAsB,EAAtB,CAAX;AAEA,QAAIikB,QAAJ;;AACA,QAAIN,qBAAJ,EAA2B;AAC1BM,iBAAWzwB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCgP,QAApC,CAAX;AACA,KAFD,MAEO;AACNO,iBAAWzwB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwB5a,OAAxB,CAAgC;AAC1C6rB,aAAK,CAAC;AAAEvtB,eAAK+sB;AAAP,SAAD,EAAoB;AAAE5rB,oBAAU4rB;AAAZ,SAApB;AADqC,OAAhC,CAAX;AAGA;;AAED,UAAMprB,MAAM0C,EAAEmpB,QAAF,CAAWF,QAAX,IAAuB,CAACR,aAAD,EAAgBQ,SAASttB,GAAzB,EAA8BwsB,IAA9B,GAAqC9pB,IAArC,CAA0C,EAA1C,CAAvB,GAAuEqqB,QAAnF;AACAztB,WAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCpc,GAApC,CAAP,CAdoD,CAgBpD;;AACA,QAAI,CAAC0C,EAAEmpB,QAAF,CAAWluB,IAAX,CAAL,EAAuB;AACtB;AACA;AACA,UAAI,CAAC+E,EAAEmpB,QAAF,CAAWF,QAAX,CAAL,EAA2B;AAC1B,YAAIJ,YAAJ,EAAkB;AACjB,gBAAM,IAAIztB,OAAOrB,KAAX,CAAiB,iBAAjB,CAAN;AACA,SAFD,MAEO;AACN;AACA;AACD;;AAEDkB,aAAOG,OAAO2jB,SAAP,CAAiB0J,aAAjB,EAAgC,YAAW;AACjD,cAAM;AAACnrB;AAAD,YAAQlC,OAAO8F,IAAP,CAAY,qBAAZ,EAAmC+nB,SAASnsB,QAA5C,CAAd;AACA,eAAOtE,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCpc,GAApC,CAAP;AACA,OAHM,CAAP;AAIA;AACD,GAjCM,MAiCA;AACN;AACArC,WAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwB0jB,iBAAxB,CAA0CN,QAA1C,CAAP;AACA,GA3CiM,CA6ClM;;;AACA,MAAI,CAACztB,IAAD,IAAS4tB,YAAb,EAA2B;AAC1B,UAAM,IAAIztB,OAAOrB,KAAX,CAAiB,iBAAjB,CAAN;AACA,GAFD,MAEO,IAAI,CAACkB,IAAL,EAAW;AACjB;AACA,GAlDiM,CAoDlM;AACA;AACA;;;AACA,MAAIwJ,QAAQxJ,KAAKS,CAAL,KAAW+I,IAAvB,EAA6B;AAC5B,QAAIokB,YAAJ,EAAkB;AACjB,YAAM,IAAIztB,OAAOrB,KAAX,CAAiB,iBAAjB,CAAN;AACA,KAFD,MAEO;AACN;AACA;AACD,GA7DiM,CA+DlM;AACA;;;AACA,MAAIkB,KAAKS,CAAL,KAAW,GAAX,IAAkBktB,WAAtB,EAAmC;AAClC,UAAM5rB,MAAMxE,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyD7e,KAAKU,GAA9D,EAAmE8sB,aAAnE,CAAZ;;AAEA,QAAI,CAACzrB,GAAL,EAAU;AACT5B,aAAO2jB,SAAP,CAAiB0J,aAAjB,EAAgC,YAAW;AAC1C,eAAOrtB,OAAO8F,IAAP,CAAY,UAAZ,EAAwBjG,KAAKU,GAA7B,CAAP;AACA,OAFD;AAGA;AACD;;AAED,SAAOV,IAAP;AACA,CA5ED,C;;;;;;;;;;;ACHA,IAAI+E,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN,MAAM6wB,qBAAqB,EAA3B;AAEA5wB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,qBAAxB,EAA+C,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AACnE,QAAM8D,OAAO/D,IAAIsE,OAAJ,CAAY,mBAAZ,EAAiC,EAAjC,CAAb;AACA,QAAMuF,QAAQ9F,SAAS,aAAT,GAAyB,CAAC,YAAD,EAAe,cAAf,CAAzB,GAA0D,CAACA,IAAD,CAAxE;AAEA,SAAO8F,MAAM9J,OAAN,CAAegE,IAAD,IAAU;AAC9B,UAAM4kB,QAAQD,mBAAmBrkB,OAAnB,CAA2BN,IAA3B,CAAd;;AAEA,QAAI9D,UAAU,IAAV,IAAkB0oB,UAAU,CAAC,CAAjC,EAAoC;AACnC,aAAOD,mBAAmBpoB,IAAnB,CAAwByD,IAAxB,CAAP;AACA;;AAED,QAAI4kB,QAAQ,CAAC,CAAb,EAAgB;AACf,aAAOD,mBAAmBE,MAAnB,CAA0BD,KAA1B,EAAiC,CAAjC,CAAP;AACA;AACD,GAVM,CAAP;AAWA,CAfD;;AAiBA7wB,WAAW+wB,kBAAX,GAAgC,SAASA,kBAAT,CAA4B;AAAE/tB,QAAF;AAAU8B,KAAV;AAAeqW,KAAf;AAAoB6T,UAAQ,EAA5B;AAAgC/B;AAAhC,CAA5B,EAAkE;AACjG,QAAMld,UAAU;AACf4f,UAAM;AACLhoB,UAAI,CAAC;AADA,KADS;AAIfqnB;AAJe,GAAhB;;AAOA,MAAI,CAAChvB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,0BAAxB,CAAL,EAA0D;AACzD0K,YAAQ7K,MAAR,GAAiB;AAChBsZ,gBAAU;AADM,KAAjB;AAGA;;AAED,MAAIwS,OAAJ;;AACA,MAAI7V,OAAO,IAAX,EAAiB;AAChB6V,cAAUhxB,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2BgQ,oDAA3B,CAAgFnsB,GAAhF,EAAqFqW,GAArF,EAA0FyV,kBAA1F,EAA8G7gB,OAA9G,EAAuHgM,KAAvH,EAAV;AACA,GAFD,MAEO;AACNiV,cAAUhxB,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2BiQ,qCAA3B,CAAiEpsB,GAAjE,EAAsE8rB,kBAAtE,EAA0F7gB,OAA1F,EAAmGgM,KAAnG,EAAV;AACA;;AAED,QAAMsJ,mBAAmBrlB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,MAAgD,IAAzE;AAEA,QAAM8rB,WAAWH,QAAQjoB,GAAR,CAAaiI,OAAD,IAAa;AACzCA,YAAQogB,OAAR,GAAkB5pB,EAAE6pB,SAAF,CAAYrgB,QAAQogB,OAApB,EAA6B;AAC9CjuB,WAAKH;AADyC,KAA7B,CAAlB;;AAGA,QAAIgO,QAAQK,CAAR,IAAaL,QAAQK,CAAR,CAAUlO,GAAvB,IAA8BkiB,gBAAlC,EAAoD;AACnD,YAAMthB,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoClQ,QAAQK,CAAR,CAAUlO,GAA9C,CAAb;AACA6N,cAAQK,CAAR,CAAUjQ,IAAV,GAAiB2C,QAAQA,KAAK3C,IAA9B;AACA;;AACD,QAAI4P,QAAQ2O,QAAR,IAAoB3O,QAAQ2O,QAAR,CAAiBre,MAArC,IAA+C+jB,gBAAnD,EAAqE;AACpErU,cAAQ2O,QAAR,CAAiB1X,OAAjB,CAA0B2X,OAAD,IAAa;AACrC,cAAM7b,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCtB,QAAQzc,GAA5C,CAAb;AACAyc,gBAAQxe,IAAR,GAAe2C,QAAQA,KAAK3C,IAA5B;AACA,OAHD;AAIA;;AACD,WAAO4P,OAAP;AACA,GAfgB,CAAjB;AAiBA,MAAIsgB,kBAAkB,CAAtB;AACA,MAAIC,WAAJ;;AAEA,MAAItE,MAAM,IAAV,EAAgB;AACf,UAAMuE,eAAeL,SAASA,SAAS7vB,MAAT,GAAkB,CAA3B,CAArB;;AAEA,QAAI,CAACkwB,gBAAgB,IAAhB,GAAuBA,aAAa7pB,EAApC,GAAyC+L,SAA1C,IAAuDuZ,EAA3D,EAA+D;AAC9D,aAAOld,QAAQif,KAAf;AAEA,YAAMyC,iBAAiBzxB,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2ByQ,sDAA3B,CAAkF5sB,GAAlF,EAAuFmoB,EAAvF,EAA2FuE,aAAa7pB,EAAxG,EAA4GipB,kBAA5G,EAAgI;AACtJ5B,eAAO,CAD+I;AAEtJW,cAAM;AACLhoB,cAAI;AADC;AAFgJ,OAAhI,CAAvB;AAOA4pB,oBAAcE,eAAe1V,KAAf,GAAuB,CAAvB,CAAd;AACAuV,wBAAkBG,eAAeE,KAAf,EAAlB;AACA;AACD;;AAED,SAAO;AACNR,YADM;AAENI,eAFM;AAGND;AAHM,GAAP;AAKA,CAlED,C;;;;;;;;;;;ACrBAtxB,WAAW4xB,kBAAX,GAAgC,UAAS9sB,GAAT,EAAcf,IAAd,EAAoB;AACnD,QAAMtB,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCpc,GAApC,CAAb;;AAEA,MAAIrC,IAAJ,EAAU;AACTzC,eAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,iBAAzB,EAA4C7G,IAA5C,EAAkDtB,IAAlD;AACAzC,eAAWC,MAAX,CAAkB6M,KAAlB,CAAwB+kB,kBAAxB,CAA2C/sB,GAA3C,EAAgDf,KAAKO,QAArD;;AAEA,QAAI7B,KAAKmD,SAAL,CAAe2G,OAAf,CAAuBxI,KAAKO,QAA5B,MAA0C,CAAC,CAA/C,EAAkD;AACjD,YAAMwtB,cAAc/tB,IAApB;AACA/D,iBAAWC,MAAX,CAAkBghB,QAAlB,CAA2B8Q,gCAA3B,CAA4DjtB,GAA5D,EAAiEgtB,WAAjE;AACA;;AAED,QAAIrvB,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnBlD,iBAAWC,MAAX,CAAkBghB,QAAlB,CAA2B+Q,8BAA3B,CAA0D,QAA1D,EAAoEltB,GAApE,EAAyEf,IAAzE;AACA;;AAED/D,eAAWC,MAAX,CAAkByF,aAAlB,CAAgCusB,uBAAhC,CAAwDntB,GAAxD,EAA6Df,KAAKZ,GAAlE;AAEAP,WAAOiJ,KAAP,CAAa,YAAW;AACvB7L,iBAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,gBAAzB,EAA2C7G,IAA3C,EAAiDtB,IAAjD;AACA,KAFD;AAGA;AACD,CAtBD,C;;;;;;;;;;;ACAA,IAAI+E,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAIpEC,WAAWkyB,QAAX,GAAsB,UAASlvB,MAAT,EAAiBmvB,QAAjB,EAA2B;AAChD,QAAMpuB,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCle,MAApC,CAAb;;AACA,QAAMovB,gBAAgB5qB,EAAEohB,KAAF,CAAQ5oB,WAAW8C,KAAX,CAAiBuvB,QAAjB,EAAR,EAAqC,KAArC,CAAtB;;AAEA,MAAIF,SAAShvB,GAAT,IAAgBH,WAAWmvB,SAAShvB,GAApC,IAA2C,CAACnD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BhoB,MAA/B,EAAuC,sBAAvC,CAAhD,EAAgH;AAC/G,UAAM,IAAIJ,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,6BAA7C,EAA4E;AACjF8O,cAAQ,oBADyE;AAEjFlM,cAAQ;AAFyE,KAA5E,CAAN;AAIA;;AAED,MAAI,CAACguB,SAAShvB,GAAV,IAAiB,CAACnD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BhoB,MAA/B,EAAuC,aAAvC,CAAtB,EAA6E;AAC5E,UAAM,IAAIJ,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,4BAA7C,EAA2E;AAChF8O,cAAQ,oBADwE;AAEhFlM,cAAQ;AAFwE,KAA3E,CAAN;AAIA;;AAED,MAAIguB,SAAS1C,KAAT,IAAkBjoB,EAAEghB,UAAF,CAAa2J,SAAS1C,KAAtB,EAA6B2C,aAA7B,EAA4C9wB,MAA5C,GAAqD,CAA3E,EAA8E;AAC7E,UAAM,IAAIsB,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,2CAA7C,EAA0F;AAC/F8O,cAAQ,oBADuF;AAE/FlM,cAAQ;AAFuF,KAA1F,CAAN;AAIA;;AAED,MAAIguB,SAAS1C,KAAT,IAAkBjoB,EAAE+E,OAAF,CAAU4lB,SAAS1C,KAAnB,EAA0B,OAA1B,KAAsC,CAAxD,IAA6D,CAACzvB,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BhoB,MAA/B,EAAuC,mBAAvC,CAAlE,EAA+H;AAC9H,UAAM,IAAIJ,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,gCAA7C,EAA+E;AACpF8O,cAAQ,oBAD4E;AAEpFlM,cAAQ;AAF4E,KAA/E,CAAN;AAIA;;AAED,MAAI,CAACguB,SAAShvB,GAAV,IAAiB,CAACsD,EAAEM,IAAF,CAAOorB,SAAS/wB,IAAhB,CAAtB,EAA6C;AAC5C,UAAM,IAAIwB,OAAOrB,KAAX,CAAiB,6BAAjB,EAAgD,4BAAhD,EAA8E;AACnF8O,cAAQ,oBAD2E;AAEnFiiB,aAAO;AAF4E,KAA9E,CAAN;AAIA;;AAED,MAAI,CAACH,SAAShvB,GAAV,IAAiB,CAACsD,EAAEM,IAAF,CAAOorB,SAAS7tB,QAAhB,CAAtB,EAAiD;AAChD,UAAM,IAAI1B,OAAOrB,KAAX,CAAiB,6BAAjB,EAAgD,gCAAhD,EAAkF;AACvF8O,cAAQ,oBAD+E;AAEvFiiB,aAAO;AAFgF,KAAlF,CAAN;AAIA;;AAED,MAAIllB,cAAJ;;AAEA,MAAI;AACHA,qBAAiB,IAAIC,MAAJ,CAAY,IAAIrN,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAkD,GAAlE,CAAjB;AACA,GAFD,CAEE,OAAO+jB,CAAP,EAAU;AACXhc,qBAAiB,IAAIC,MAAJ,CAAW,mBAAX,CAAjB;AACA;;AAED,MAAI8kB,SAAS7tB,QAAT,IAAqB,CAAC8I,eAAe/E,IAAf,CAAoB8pB,SAAS7tB,QAA7B,CAA1B,EAAkE;AACjE,UAAM,IAAI1B,OAAOrB,KAAX,CAAiB,kCAAjB,EAAsD,GAAGiG,EAAE+qB,MAAF,CAASJ,SAAS7tB,QAAlB,CAA6B,0BAAtF,EAAiH;AACtH+L,cAAQ,oBAD8G;AAEtHmiB,aAAOL,SAAS7tB,QAFsG;AAGtHguB,aAAO;AAH+G,KAAjH,CAAN;AAKA;;AAED,MAAI,CAACH,SAAShvB,GAAV,IAAiB,CAACgvB,SAASlkB,QAA/B,EAAyC;AACxC,UAAM,IAAIrL,OAAOrB,KAAX,CAAiB,6BAAjB,EAAgD,gCAAhD,EAAkF;AACvF8O,cAAQ,oBAD+E;AAEvFiiB,aAAO;AAFgF,KAAlF,CAAN;AAIA;;AAED,MAAI,CAACH,SAAShvB,GAAd,EAAmB;AAClB,QAAI,CAACnD,WAAW8rB,yBAAX,CAAqCqG,SAAS7tB,QAA9C,CAAL,EAA8D;AAC7D,YAAM,IAAI1B,OAAOrB,KAAX,CAAiB,yBAAjB,EAA6C,GAAGiG,EAAE+qB,MAAF,CAASJ,SAAS7tB,QAAlB,CAA6B,uBAA7E,EAAqG;AAC1G+L,gBAAQ,oBADkG;AAE1GiiB,eAAOH,SAAS7tB;AAF0F,OAArG,CAAN;AAIA;;AAED,QAAI6tB,SAASnkB,KAAT,IAAkB,CAAChO,WAAWmsB,sBAAX,CAAkCgG,SAASnkB,KAA3C,CAAvB,EAA0E;AACzE,YAAM,IAAIpL,OAAOrB,KAAX,CAAiB,yBAAjB,EAA6C,GAAGiG,EAAE+qB,MAAF,CAASJ,SAASnkB,KAAlB,CAA0B,uBAA1E,EAAkG;AACvGqC,gBAAQ,oBAD+F;AAEvGiiB,eAAOH,SAASnkB;AAFuF,OAAlG,CAAN;AAIA;;AAEDhO,eAAW8pB,mBAAX,CAA+BqI,SAASnkB,KAAxC,EAfkB,CAiBlB;;AACA,UAAMykB,aAAa;AAClBnuB,gBAAU6tB,SAAS7tB,QADD;AAElB2J,gBAAUkkB,SAASlkB,QAFD;AAGlBykB,2BAAqBP,SAASO;AAHZ,KAAnB;;AAKA,QAAIP,SAASnkB,KAAb,EAAoB;AACnBykB,iBAAWzkB,KAAX,GAAmBmkB,SAASnkB,KAA5B;AACA;;AAED,UAAM7K,MAAMkb,SAASoU,UAAT,CAAoBA,UAApB,CAAZ;;AAEA,UAAME,aAAa;AAClBhF,YAAM;AACLvsB,cAAM+wB,SAAS/wB,IADV;AAELquB,eAAO0C,SAAS1C,KAAT,IAAkB,CAAC,MAAD,CAFpB;AAGLrqB,kBAAU+sB,SAAS/sB,QAAT,IAAqB;AAH1B;AADY,KAAnB;;AAQA,QAAI,OAAO+sB,SAAS5C,qBAAhB,KAA0C,WAA9C,EAA2D;AAC1DoD,iBAAWhF,IAAX,CAAgB4B,qBAAhB,GAAwC4C,SAAS5C,qBAAjD;AACA;;AAED,QAAI,OAAO4C,SAAS1N,QAAhB,KAA6B,SAAjC,EAA4C;AAC3CkO,iBAAWhF,IAAX,CAAgB,mBAAhB,IAAuCwE,SAAS1N,QAAhD;AACA;;AAED7hB,WAAO0kB,KAAP,CAAaoG,MAAb,CAAoB;AAAEvqB;AAAF,KAApB,EAA6BwvB,UAA7B;;AAEA,QAAIR,SAASS,gBAAb,EAA+B;AAC9B,YAAM7wB,SAAS/B,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,cAAxB,KAA2C,EAA3E,CAAf;AACA,YAAM+d,SAASpjB,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,cAAxB,KAA2C,EAA3E,CAAf;AAEA,UAAIsf,OAAJ;AACA,UAAIrT,IAAJ;;AAEA,UAAItR,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oCAAxB,CAAJ,EAAmE;AAClEsf,kBAAU3kB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,gCAAxB,CAAV;AACAiM,eAAOtR,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,yBAAxB,CAAP;AACA,OAHD,MAGO;AACNsf,kBAAUxT,QAAQC,EAAR,CAAW,wCAAX,EAAqD;AAAEkR,eAAKve,KAAK2M,QAAL,IAAiB1Q,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,CAAjB,IAAwD;AAA/D,SAArD,CAAV;AACAiM,eAAOH,QAAQC,EAAR,CAAW,iCAAX,EAA8C;AAAEkR,eAAKve,KAAK2M,QAAL,IAAiB1Q,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,CAAjB,IAAwD;AAA/D,SAA9C,CAAP;AACA;;AAEDsf,gBAAU3kB,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCmY,OAAhC,CAAV;AACArT,aAAOtR,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgC8E,IAAhC,EAAsC;AAC5ClQ,cAAM+wB,SAAS/wB,IAD6B;AAE5C4M,eAAOmkB,SAASnkB,KAF4B;AAG5CC,kBAAUkkB,SAASlkB;AAHyB,OAAtC,CAAP;AAMA,YAAMD,QAAQ;AACb6O,YAAIsV,SAASnkB,KADA;AAEbyL,cAAMzZ,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,YAAxB,CAFO;AAGbsf,eAHa;AAIbrT,cAAMvP,SAASuP,IAAT,GAAgB8R;AAJT,OAAd;AAOAxgB,aAAOiJ,KAAP,CAAa,YAAW;AACvB,YAAI;AACH+Y,gBAAM3L,IAAN,CAAWjL,KAAX;AACA,SAFD,CAEE,OAAOV,KAAP,EAAc;AACf,gBAAM,IAAI1K,OAAOrB,KAAX,CAAiB,yBAAjB,EAA6C,+BAA+B+L,MAAM0D,OAAS,EAA3F,EAA8F;AACnG/D,sBAAU,qBADyF;AAEnG+D,qBAAS1D,MAAM0D;AAFoF,WAA9F,CAAN;AAIA;AACD,OATD;AAUA;;AAEDmhB,aAAShvB,GAAT,GAAeA,GAAf;;AAEA,QAAInD,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,2BAAxB,MAAyD,IAAzD,IAAiE8sB,SAASnkB,KAA9E,EAAqF;AACpF,YAAM6kB,cAAcC,SAASC,QAAT,CAAkBZ,SAASnkB,KAA3B,EAAkC;AAAElO,iBAAS,KAAX;AAAkBkzB,cAAM,GAAxB;AAA6BC,gBAAQ;AAArC,OAAlC,CAApB;;AAEA,UAAI;AACHjzB,mBAAWkzB,aAAX,CAAyBf,QAAzB,EAAmCU,WAAnC,EAAgD,EAAhD,EAAoD,KAApD;AACA,OAFD,CAEE,OAAOzJ,CAAP,EAAU,CACX;AACA;AACD;;AAED,WAAOjmB,GAAP;AACA,GArGD,MAqGO;AACN;AACA,QAAIgvB,SAAS7tB,QAAb,EAAuB;AACtBtE,iBAAWmzB,WAAX,CAAuBhB,SAAShvB,GAAhC,EAAqCgvB,SAAS7tB,QAA9C;AACA;;AAED,QAAI6tB,SAAS/wB,IAAb,EAAmB;AAClBpB,iBAAWozB,WAAX,CAAuBjB,SAAShvB,GAAhC,EAAqCgvB,SAAS/wB,IAA9C;AACA;;AAED,QAAI+wB,SAASnkB,KAAb,EAAoB;AACnB,YAAMqlB,oCAAoClB,SAAS1N,QAAT,KAAsB,IAAhE;AACAzkB,iBAAWszB,QAAX,CAAoBnB,SAAShvB,GAA7B,EAAkCgvB,SAASnkB,KAA3C,EAAkDqlB,iCAAlD;AACA;;AAED,QAAIlB,SAASlkB,QAAT,IAAqBkkB,SAASlkB,QAAT,CAAkBlH,IAAlB,EAArB,IAAiD/G,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BhoB,MAA/B,EAAuC,0BAAvC,CAArD,EAAyH;AACxHqb,eAASkV,WAAT,CAAqBpB,SAAShvB,GAA9B,EAAmCgvB,SAASlkB,QAAT,CAAkBlH,IAAlB,EAAnC;AACA;;AAED,UAAM4rB,aAAa;AAClBhF,YAAM;AADY,KAAnB;;AAIA,QAAIwE,SAAS1C,KAAb,EAAoB;AACnBkD,iBAAWhF,IAAX,CAAgB8B,KAAhB,GAAwB0C,SAAS1C,KAAjC;AACA;;AAED,QAAI0C,SAAS/sB,QAAb,EAAuB;AACtButB,iBAAWhF,IAAX,CAAgBvoB,QAAhB,GAA2B;AAAEwO,qBAAaue,SAAS/sB,QAAT,CAAkBwO;AAAjC,OAA3B;AACA;;AAED,QAAI,OAAOue,SAAS5C,qBAAhB,KAA0C,WAA9C,EAA2D;AAC1DoD,iBAAWhF,IAAX,CAAgB4B,qBAAhB,GAAwC4C,SAAS5C,qBAAjD;AACA;;AAED,QAAI,OAAO4C,SAAS1N,QAAhB,KAA6B,SAAjC,EAA4C;AAC3CkO,iBAAWhF,IAAX,CAAgB,mBAAhB,IAAuCwE,SAAS1N,QAAhD;AACA;;AAED7hB,WAAO0kB,KAAP,CAAaoG,MAAb,CAAoB;AAAEvqB,WAAKgvB,SAAShvB;AAAhB,KAApB,EAA2CwvB,UAA3C;AAEA,WAAO,IAAP;AACA;AACD,CArND,C;;;;;;;;;;;ACJA,IAAIlsB,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAENC,WAAWwzB,gBAAX,GAA8B,UAASxwB,MAAT,EAAiBywB,QAAjB,EAA2B;AACxD,MAAIhtB,EAAEM,IAAF,CAAO/G,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAP,MAA6D,EAAjE,EAAqE;AACpErF,eAAW0zB,oBAAX,CAAgCD,QAAhC;AACA,WAAOzzB,WAAW2zB,iCAAX,CAA6C3wB,MAA7C,EAAqDywB,QAArD,CAAP;AACA;AACD,CALD,C;;;;;;;;;;;ACFA,IAAIhtB,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAENC,WAAW2zB,iCAAX,GAA+C,UAAS3wB,MAAT,EAAiBywB,QAAjB,EAA2B;AACzE,MAAIhtB,EAAEM,IAAF,CAAO/G,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAP,MAA6D,EAAjE,EAAqE;AACpE,QAAIuuB,gBAAJ;;AACA,QAAI;AACHA,yBAAmBC,KAAKpjB,KAAL,CAAWzQ,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAX,CAAnB;AACA,KAFD,CAEE,OAAO+jB,CAAP,EAAU;AACX,YAAM,IAAIxmB,OAAOrB,KAAX,CAAiB,gCAAjB,EAAmD,gCAAnD,CAAN;AACA;;AAED,UAAMmuB,eAAe,EAArB;AACA3nB,WAAOC,IAAP,CAAY4rB,gBAAZ,EAA8B3rB,OAA9B,CAAsCC,OAAOwnB,aAAaxnB,GAAb,IAAoBurB,SAASvrB,GAAT,CAAjE;AACAlI,eAAWC,MAAX,CAAkBwf,KAAlB,CAAwBqU,eAAxB,CAAwC9wB,MAAxC,EAAgD0sB,YAAhD,EAVoE,CAYpE;;AACA1vB,eAAWC,MAAX,CAAkByF,aAAlB,CAAgCquB,qCAAhC,CAAsE/wB,MAAtE,EAA8E0sB,YAA9E;AAEA3nB,WAAOC,IAAP,CAAY0nB,YAAZ,EAA0BznB,OAA1B,CAAmC+rB,SAAD,IAAe;AAChD,UAAI,CAACJ,iBAAiBI,SAAjB,EAA4BC,iBAAjC,EAAoD;AACnD;AACA;;AAED,YAAMA,oBAAoBL,iBAAiBI,SAAjB,EAA4BC,iBAAtD;AACA,YAAMvG,SAAS,EAAf;;AACA,UAAIuG,kBAAkBC,KAAtB,EAA6B;AAC5BxG,eAAOyG,SAAP,GAAmB,EAAnB;AACAzG,eAAOyG,SAAP,CAAiBF,kBAAkB3B,KAAnC,IAA4C5C,aAAasE,SAAb,CAA5C;AACA,OAHD,MAGO;AACNtG,eAAOC,IAAP,GAAc,EAAd;AACAD,eAAOC,IAAP,CAAYsG,kBAAkB3B,KAA9B,IAAuC5C,aAAasE,SAAb,CAAvC;AACA;;AAEDh0B,iBAAWC,MAAX,CAAkBwf,KAAlB,CAAwBiO,MAAxB,CAA+B1qB,MAA/B,EAAuC0qB,MAAvC;AACA,KAhBD;AAiBA;AACD,CAlCD,C;;;;;;;;;;;ACFA,IAAIlmB,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAENC,WAAW2gB,WAAX,GAAyB,UAAS5c,IAAT,EAAeiN,OAAf,EAAwBvO,IAAxB,EAA8B2xB,SAAS,KAAvC,EAA8C;AACtE,MAAI,CAACrwB,IAAD,IAAS,CAACiN,OAAV,IAAqB,CAACvO,KAAKU,GAA/B,EAAoC;AACnC,WAAO,KAAP;AACA;;AACD,MAAI6N,QAAQrJ,EAAR,IAAc,IAAlB,EAAwB;AACvBqJ,YAAQrJ,EAAR,GAAa,IAAIC,IAAJ,EAAb;AACA;;AACDoJ,UAAQK,CAAR,GAAY7J,EAAE6sB,IAAF,CAAOtwB,IAAP,EAAa,CAAC,KAAD,EAAQ,UAAR,EAAoB,MAApB,CAAb,CAAZ;;AACA,MAAI,CAACuwB,MAAMjsB,IAAN,CAAW2I,QAAQT,GAAnB,EAAwB5E,MAAxB,CAAL,EAAsC;AACrCqF,YAAQT,GAAR,GAAc,EAAd;AACA;;AACDS,UAAQlM,GAAR,GAAcrC,KAAKU,GAAnB;;AACA,MAAI,CAACV,KAAKmD,SAAN,IAAmBnD,KAAKmD,SAAL,CAAetE,MAAf,KAA0B,CAAjD,EAAoD;AACnD,UAAMizB,eAAev0B,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCze,KAAKU,GAAzC,CAArB;;AACA,QAAIoxB,gBAAgB,IAApB,EAA0B;AACzB9xB,aAAO8xB,YAAP;AACA,KAFD,MAEO;AACN9xB,WAAKmD,SAAL,GAAiB,EAAjB;AACA;AACD;;AACD,MAAIoL,QAAQwjB,SAAR,KAAsB,KAA1B,EAAiC;AAChC,UAAMC,OAAOzjB,QAAQT,GAAR,CAAY/E,KAAZ,CAAkB,kJAAlB,CAAb;;AAEA,QAAIipB,IAAJ,EAAU;AACTzjB,cAAQyjB,IAAR,GAAeA,KAAK1rB,GAAL,CAAS,UAASwQ,GAAT,EAAc;AACrC,eAAO;AACNA;AADM,SAAP;AAGA,OAJc,CAAf;AAKA;AACD;;AAED,MAAIvZ,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,8BAAxB,CAAJ,EAA6D;AAC5D2L,YAAQxK,MAAR,GAAiB,IAAjB;AACA;;AAEDwK,YAAUhR,WAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,mBAAzB,EAA8CoG,OAA9C,CAAV;;AACA,MAAIA,OAAJ,EAAa;AACZ;AACA,QAAI0jB,qBAAqB,IAAzB;;AACA,QAAI1jB,QAAQ0jB,kBAAZ,EAAgC;AAC/BA,2BAAqB1jB,QAAQ0jB,kBAA7B;AACA,aAAO1jB,QAAQ0jB,kBAAf;AACA;;AACD,QAAI1jB,QAAQ7N,GAAR,IAAeixB,MAAnB,EAA2B;AAC1B,YAAMjxB,MAAM6N,QAAQ7N,GAApB;AACA,aAAO6N,QAAQ7N,GAAf;AACAnD,iBAAWC,MAAX,CAAkBghB,QAAlB,CAA2BmT,MAA3B,CAAkC;AACjCjxB,WADiC;AAEjC,iBAAS6N,QAAQK,CAAR,CAAUlO;AAFc,OAAlC,EAGG6N,OAHH;AAIAA,cAAQ7N,GAAR,GAAcA,GAAd;AACA,KARD,MAQO;AACN6N,cAAQ7N,GAAR,GAAcnD,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2B0T,MAA3B,CAAkC3jB,OAAlC,CAAd;AACA;AAED;;;;;AAGApO,WAAOiJ,KAAP,CAAa,MAAM;AAClB;AACAmF,cAAQ0jB,kBAAR,GAA6BA,kBAA7B;AACA,aAAO10B,WAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,kBAAzB,EAA6CoG,OAA7C,EAAsDvO,IAAtD,EAA4DsB,KAAKZ,GAAjE,CAAP;AACA,KAJD;AAKA,WAAO6N,OAAP;AACA;AACD,CAlED,C;;;;;;;;;;;ACFA,IAAIxJ,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN,MAAM60B,kBAAkB,EAAxB;;AAEA,IAAI1gB,QAAQC,GAAR,CAAY0gB,gBAAhB,EAAkC;AACjC3gB,UAAQC,GAAR,CAAY0gB,gBAAZ,CAA6BtpB,KAA7B,CAAmC,GAAnC,EAAwCtD,OAAxC,CAAiD6sB,SAAD,IAAeF,gBAAgBE,SAAhB,IAA6B,CAA5F;AACA;;AAED,MAAMC,iBAAiB,EAAvB;;AACA,IAAI7gB,QAAQC,GAAR,CAAY6gB,eAAhB,EAAiC;AAChC9gB,UAAQC,GAAR,CAAY6gB,eAAZ,CAA4BzpB,KAA5B,CAAkC,GAAlC,EAAuCtD,OAAvC,CAAgD6sB,SAAD,IAAeC,eAAeD,SAAf,IAA4B,CAA1F;AACA;;AAED90B,WAAWoF,QAAX,CAAoB6vB,OAApB,GAA8B,EAA9B;AAGA;;;;;;;AAOAj1B,WAAWoF,QAAX,CAAoB+E,GAApB,GAA0B,UAAShH,GAAT,EAAcgF,KAAd,EAAqB4H,UAAU,EAA/B,EAAmC;AAC5D,MAAIA,WAAW,IAAf,EAAqB;AACpBA,cAAU,EAAV;AACA;;AACD,MAAI,CAAC5M,GAAD,IAAQgF,SAAS,IAArB,EAA2B;AAC1B,WAAO,KAAP;AACA;;AACD,MAAInI,WAAWoF,QAAX,CAAoB6vB,OAApB,CAA4BllB,QAAQ0B,KAApC,KAA8C,IAAlD,EAAwD;AACvDzR,eAAWoF,QAAX,CAAoB6vB,OAApB,CAA4BllB,QAAQ0B,KAApC,IAA6C,CAA7C;AACA;;AACD1B,UAAQmlB,YAAR,GAAuB/sB,KAAvB;AACA4H,UAAQolB,WAAR,GAAsB,cAAtB;AACAplB,UAAQqlB,MAAR,GAAiBrlB,QAAQqlB,MAAR,IAAkB,KAAnC;AACArlB,UAAQwR,OAAR,GAAkBxR,QAAQwR,OAAR,IAAmB,KAArC;;AACA,MAAIxR,QAAQslB,MAAR,IAAkB,IAAtB,EAA4B;AAC3BtlB,YAAQslB,MAAR,GAAiBr1B,WAAWoF,QAAX,CAAoB6vB,OAApB,CAA4BllB,QAAQ0B,KAApC,GAAjB;AACA;;AACD,MAAI1B,QAAQulB,WAAR,IAAuB,IAA3B,EAAiC;AAChCvlB,YAAQulB,WAAR,GAAsBzB,KAAK0B,SAAL,CAAexlB,QAAQulB,WAAvB,CAAtB;AACA;;AACD,MAAIvlB,QAAQylB,gBAAR,IAA4B,IAAhC,EAAsC;AACrCzlB,YAAQylB,gBAAR,GAA2B3B,KAAK0B,SAAL,CAAexlB,QAAQylB,gBAAvB,CAA3B;AACA;;AACD,MAAI,OAAOthB,OAAP,KAAmB,WAAnB,IAAkCA,QAAQC,GAA1C,IAAiDD,QAAQC,GAAR,CAAYhR,GAAZ,CAArD,EAAuE;AACtEgF,YAAQ+L,QAAQC,GAAR,CAAYhR,GAAZ,CAAR;;AACA,QAAIgF,MAAMstB,WAAN,OAAwB,MAA5B,EAAoC;AACnCttB,cAAQ,IAAR;AACA,KAFD,MAEO,IAAIA,MAAMstB,WAAN,OAAwB,OAA5B,EAAqC;AAC3CttB,cAAQ,KAAR;AACA;;AACD4H,YAAQ2lB,eAAR,GAA0BvtB,KAA1B;AACA4H,YAAQolB,WAAR,GAAsB,iBAAtB;AACA,GATD,MASO,IAAIvyB,OAAOwC,QAAP,IAAmB,OAAOxC,OAAOwC,QAAP,CAAgBjC,GAAhB,CAAP,KAAgC,WAAvD,EAAoE;AAC1E,QAAIP,OAAOwC,QAAP,CAAgBjC,GAAhB,KAAwB,IAA5B,EAAkC;AACjC,aAAO,KAAP;AACA;;AAEDgF,YAAQvF,OAAOwC,QAAP,CAAgBjC,GAAhB,CAAR;AACA4M,YAAQ4lB,mBAAR,GAA8BxtB,KAA9B;AACA4H,YAAQolB,WAAR,GAAsB,qBAAtB;AACA;;AACD,MAAIplB,QAAQ6lB,SAAR,IAAqB,IAAzB,EAA+B;AAC9B7lB,YAAQ6lB,SAAR,GAAoBzyB,GAApB;AACA;;AACD,MAAI4M,QAAQ8lB,eAAR,IAA2B,IAA/B,EAAqC;AACpC9lB,YAAQ8lB,eAAR,GAA2B,GAAG1yB,GAAK,cAAnC;AACA;;AACD,MAAIyxB,gBAAgBzxB,GAAhB,KAAwB,IAA5B,EAAkC;AACjC4M,YAAQwR,OAAR,GAAkB,IAAlB;AACA;;AACD,MAAIwT,eAAe5xB,GAAf,KAAuB,IAA3B,EAAiC;AAChC4M,YAAQqlB,MAAR,GAAiB,IAAjB;AACA;;AACD,MAAI,OAAOlhB,OAAP,KAAmB,WAAnB,IAAkCA,QAAQC,GAA1C,IAAiDD,QAAQC,GAAR,CAAa,qBAAqBhR,GAAK,EAAvC,CAArD,EAAgG;AAC/F,QAAIgF,QAAQ+L,QAAQC,GAAR,CAAa,qBAAqBhR,GAAK,EAAvC,CAAZ;;AACA,QAAIgF,MAAMstB,WAAN,OAAwB,MAA5B,EAAoC;AACnCttB,cAAQ,IAAR;AACA,KAFD,MAEO,IAAIA,MAAMstB,WAAN,OAAwB,OAA5B,EAAqC;AAC3CttB,cAAQ,KAAR;AACA;;AACD4H,YAAQ5H,KAAR,GAAgBA,KAAhB;AACA4H,YAAQ2lB,eAAR,GAA0BvtB,KAA1B;AACA4H,YAAQolB,WAAR,GAAsB,iBAAtB;AACA;;AACD,QAAMW,mBAAmB;AACxBnI,UAAM5d,OADkB;AAExBgmB,kBAAc;AACb3G,iBAAW,IAAIxnB,IAAJ;AADE;AAFU,GAAzB;;AAMA,MAAImI,QAAQlH,MAAR,IAAkB,IAAtB,EAA4B;AAC3BitB,qBAAiBC,YAAjB,CAA8BltB,MAA9B,GAAuCkH,QAAQlH,MAA/C;AACA,WAAOkH,QAAQlH,MAAf;AACA;;AACD,MAAIkH,QAAQ5H,KAAR,IAAiB,IAArB,EAA2B;AAC1B,QAAI4H,QAAQimB,KAAR,KAAkB,IAAtB,EAA4B;AAC3BF,uBAAiBnI,IAAjB,CAAsBxlB,KAAtB,GAA8B4H,QAAQmlB,YAAtC;AACA,KAFD,MAEO;AACNY,uBAAiBC,YAAjB,CAA8B5tB,KAA9B,GAAsCA,KAAtC;AACA;AACD;;AACD,QAAMzD,QAAQ8C,EAAE0nB,MAAF,CAAS;AACtB/rB;AADsB,GAAT,EAEX2yB,iBAAiBnI,IAFN,CAAd;;AAGA,MAAI5d,QAAQkmB,OAAR,IAAmB,IAAvB,EAA6B;AAC5BH,qBAAiBI,MAAjB,GAA0B;AACzBD,eAAS;AADgB,KAA1B;AAGAvxB,UAAMuxB,OAAN,GAAgB;AACfE,eAAS;AADM,KAAhB;AAGA;;AACD,QAAMC,kBAAkBp2B,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2B/H,EAA3B,CAA8BzpB,OAA9B,CAAsCH,KAAtC,CAAxB;;AACA,MAAI0xB,mBAAmB,IAAvB,EAA6B;AAC5B,QAAIA,gBAAgBvtB,MAAhB,IAA0B,IAA1B,IAAkCitB,iBAAiBC,YAAjB,CAA8BltB,MAA9B,IAAwC,IAA9E,EAAoF;AACnFitB,uBAAiBnI,IAAjB,CAAsB9kB,MAAtB,GAA+BitB,iBAAiBC,YAAjB,CAA8BltB,MAA7D;AACA,aAAOitB,iBAAiBC,YAAjB,CAA8BltB,MAArC;AACA;AACD,GALD,MAKO;AACNitB,qBAAiBnI,IAAjB,CAAsBhmB,EAAtB,GAA2B,IAAIC,IAAJ,EAA3B;AACA;;AACD,SAAO5H,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BjC,MAA3B,CAAkC;AACxCjxB;AADwC,GAAlC,EAEJ2yB,gBAFI,CAAP;AAGA,CAxGD;AA2GA;;;;;;AAKA91B,WAAWoF,QAAX,CAAoBkxB,QAApB,GAA+B,UAASnzB,GAAT,EAAc4M,UAAU,EAAxB,EAA4BvF,EAA5B,EAAgC;AAC9D,MAAI,CAACrH,GAAL,EAAU;AACT,WAAO,KAAP;AACA;;AACD,MAAIqE,EAAE+uB,UAAF,CAAaxmB,OAAb,CAAJ,EAA2B;AAC1BvF,SAAKuF,OAAL;AACAA,cAAU,EAAV;AACA;;AACD,MAAIA,QAAQ6lB,SAAR,IAAqB,IAAzB,EAA+B;AAC9B7lB,YAAQ6lB,SAAR,GAAoBzyB,GAApB;AACA;;AACD,MAAI4M,QAAQ8lB,eAAR,IAA2B,IAA/B,EAAqC;AACpC9lB,YAAQ8lB,eAAR,GAA2B,GAAG1yB,GAAK,cAAnC;AACA;;AACD4M,UAAQpI,EAAR,GAAa,IAAIC,IAAJ,EAAb;AACAmI,UAAQwR,OAAR,GAAkB,KAAlB;AACAxR,UAAQqlB,MAAR,GAAiB,KAAjB;;AACA,MAAIR,gBAAgBzxB,GAAhB,KAAwB,IAA5B,EAAkC;AACjC4M,YAAQwR,OAAR,GAAkB,IAAlB;AACA;;AACD,MAAIwT,eAAe5xB,GAAf,KAAuB,IAA3B,EAAiC;AAChC4M,YAAQqlB,MAAR,GAAiB,IAAjB;AACA;;AACDp1B,aAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BjC,MAA3B,CAAkC;AACjCjxB;AADiC,GAAlC,EAEG;AACFwqB,UAAM5d,OADJ;AAEFgmB,kBAAc;AACb9pB,YAAM,OADO;AAEbmjB,iBAAW,IAAIxnB,IAAJ;AAFE;AAFZ,GAFH;;AASA,MAAI4C,MAAM,IAAV,EAAgB;AACfA,OAAG9B,IAAH,CAAQ;AACPyB,UAAIvI,EAAJ,EAAQuG,KAAR,EAAe4H,OAAf,EAAwB;AACvB,YAAIA,WAAW,IAAf,EAAqB;AACpBA,oBAAU,EAAV;AACA;;AACDA,gBAAQ0B,KAAR,GAAgBtO,GAAhB;AACA,eAAOnD,WAAWoF,QAAX,CAAoB+E,GAApB,CAAwBvI,EAAxB,EAA4BuG,KAA5B,EAAmC4H,OAAnC,CAAP;AACA,OAPM;;AAQPkmB,cAAQA,OAAR,EAAiBzrB,EAAjB,EAAqB;AACpB,eAAOA,GAAG9B,IAAH,CAAQ;AACdyB,cAAIvI,EAAJ,EAAQuG,KAAR,EAAe4H,OAAf,EAAwB;AACvB,gBAAIA,WAAW,IAAf,EAAqB;AACpBA,wBAAU,EAAV;AACA;;AACDA,oBAAQ0B,KAAR,GAAgBtO,GAAhB;AACA4M,oBAAQkmB,OAAR,GAAkBA,OAAlB;AACA,mBAAOj2B,WAAWoF,QAAX,CAAoB+E,GAApB,CAAwBvI,EAAxB,EAA4BuG,KAA5B,EAAmC4H,OAAnC,CAAP;AACA;;AARa,SAAR,CAAP;AAUA;;AAnBM,KAAR;AAqBA;AACD,CAvDD;AA0DA;;;;;;AAKA/P,WAAWoF,QAAX,CAAoByoB,UAApB,GAAiC,UAAS1qB,GAAT,EAAc;AAC9C,MAAI,CAACA,GAAL,EAAU;AACT,WAAO,KAAP;AACA;;AACD,SAAOnD,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BxI,UAA3B,CAAsC1qB,GAAtC,CAAP;AACA,CALD;AAQA;;;;;;AAKAnD,WAAWoF,QAAX,CAAoBoxB,UAApB,GAAiC,UAASrzB,GAAT,EAAcgF,KAAd,EAAqBU,MAArB,EAA6B;AAC7D,MAAI,CAAC1F,GAAD,IAAQgF,SAAS,IAArB,EAA2B;AAC1B,WAAO,KAAP;AACA;;AACD,MAAIU,UAAU,IAAd,EAAoB;AACnB,WAAO7I,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BI,wBAA3B,CAAoDtzB,GAApD,EAAyDgF,KAAzD,EAAgEU,MAAhE,CAAP;AACA;;AACD,SAAO7I,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BK,eAA3B,CAA2CvzB,GAA3C,EAAgDgF,KAAhD,CAAP;AACA,CARD;AAWA;;;;;;AAKAnI,WAAWoF,QAAX,CAAoBuxB,iBAApB,GAAwC,UAASxzB,GAAT,EAAc4M,OAAd,EAAuB;AAC9D,MAAI,CAAC5M,GAAD,IAAQ4M,WAAW,IAAvB,EAA6B;AAC5B,WAAO,KAAP;AACA;;AACD,SAAO/P,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BM,iBAA3B,CAA6CxzB,GAA7C,EAAkD4M,OAAlD,CAAP;AACA,CALD;AAQA;;;;;;AAKA/P,WAAWoF,QAAX,CAAoBwxB,SAApB,GAAgC,UAASzzB,GAAT,EAAc;AAC7C,MAAIA,OAAO,IAAX,EAAiB;AAChB,WAAO,KAAP;AACA;;AACD,SAAOnD,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BK,eAA3B,CAA2CvzB,GAA3C,EAAgDuQ,SAAhD,CAAP;AACA,CALD;AAQA;;;;;AAIA1T,WAAWoF,QAAX,CAAoByxB,IAApB,GAA2B,YAAW;AACrC72B,aAAWoF,QAAX,CAAoBiE,WAApB,GAAkC,IAAlC;AACArJ,aAAWC,MAAX,CAAkBo2B,QAAlB,CAA2B9rB,IAA3B,GAAkCusB,OAAlC,CAA0C;AACzCC,UAAMC,MAAN,EAAc;AACbp0B,aAAOwC,QAAP,CAAgB4xB,OAAO7zB,GAAvB,IAA8B6zB,OAAO7uB,KAArC;;AACA,UAAI6uB,OAAO7iB,GAAP,KAAe,IAAnB,EAAyB;AACxBD,gBAAQC,GAAR,CAAY6iB,OAAO7zB,GAAnB,IAA0B6zB,OAAO7uB,KAAjC;AACA;;AACD,aAAOnI,WAAWoF,QAAX,CAAoBgE,IAApB,CAAyB4tB,OAAO7zB,GAAhC,EAAqC6zB,OAAO7uB,KAA5C,EAAmDnI,WAAWoF,QAAX,CAAoBiE,WAAvE,CAAP;AACA,KAPwC;;AAQzC4tB,YAAQD,MAAR,EAAgB;AACfp0B,aAAOwC,QAAP,CAAgB4xB,OAAO7zB,GAAvB,IAA8B6zB,OAAO7uB,KAArC;;AACA,UAAI6uB,OAAO7iB,GAAP,KAAe,IAAnB,EAAyB;AACxBD,gBAAQC,GAAR,CAAY6iB,OAAO7zB,GAAnB,IAA0B6zB,OAAO7uB,KAAjC;AACA;;AACD,aAAOnI,WAAWoF,QAAX,CAAoBgE,IAApB,CAAyB4tB,OAAO7zB,GAAhC,EAAqC6zB,OAAO7uB,KAA5C,EAAmDnI,WAAWoF,QAAX,CAAoBiE,WAAvE,CAAP;AACA,KAdwC;;AAezC6tB,YAAQF,MAAR,EAAgB;AACf,aAAOp0B,OAAOwC,QAAP,CAAgB4xB,OAAO7zB,GAAvB,CAAP;;AACA,UAAI6zB,OAAO7iB,GAAP,KAAe,IAAnB,EAAyB;AACxB,eAAOD,QAAQC,GAAR,CAAY6iB,OAAO7zB,GAAnB,CAAP;AACA;;AACD,aAAOnD,WAAWoF,QAAX,CAAoBgE,IAApB,CAAyB4tB,OAAO7zB,GAAhC,EAAqCuQ,SAArC,EAAgD1T,WAAWoF,QAAX,CAAoBiE,WAApE,CAAP;AACA;;AArBwC,GAA1C;AAuBArJ,aAAWoF,QAAX,CAAoBiE,WAApB,GAAkC,KAAlC;AACArJ,aAAWoF,QAAX,CAAoB+xB,gBAApB,CAAqClvB,OAArC,CAA6CgP,MAAMA,GAAGrU,OAAOwC,QAAV,CAAnD;AACA,CA3BD;;AA6BApF,WAAWoF,QAAX,CAAoB+xB,gBAApB,GAAuC,EAAvC;;AAEAn3B,WAAWoF,QAAX,CAAoBgyB,kBAApB,GAAyC,UAASngB,EAAT,EAAa;AACrDjX,aAAWoF,QAAX,CAAoB+xB,gBAApB,CAAqC3uB,IAArC,CAA0CyO,EAA1C;;AACA,MAAIjX,WAAWoF,QAAX,CAAoBiE,WAApB,KAAoC,KAAxC,EAA+C;AAC9C,WAAO4N,GAAGrU,OAAOwC,QAAV,CAAP;AACA;AACD,CALD,C;;;;;;;;;;;AC3RApF,WAAWkzB,aAAX,GAA2B,UAASnvB,IAAT,EAAeszB,OAAf,EAAwBC,WAAxB,EAAqCC,OAArC,EAA8C;AACxE,MAAIC,QAAJ;AACA,MAAIxd,KAAJ;;AAEA,MAAIud,YAAY,UAAhB,EAA4B;AAC3B,WAAOv3B,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBgY,eAAxB,CAAwC1zB,KAAKZ,GAA7C,EAAkDo0B,OAAlD,CAAP;AACA,GAFD,MAEO,IAAIA,YAAY,KAAhB,EAAuB;AAC7B,QAAIxsB,SAAS,IAAb;;AAEA,QAAI;AACHA,eAAS2sB,KAAKryB,GAAL,CAASgyB,OAAT,EAAkB;AAAEM,2BAAmB;AAACH,oBAAU;AAAX;AAArB,OAAlB,CAAT;AACA,KAFD,CAEE,OAAOlqB,KAAP,EAAc;AACf,UAAI,CAACA,MAAMsqB,QAAP,IAAmBtqB,MAAMsqB,QAAN,CAAeC,UAAf,KAA8B,GAArD,EAA0D;AACzDpsB,gBAAQC,GAAR,CAAa,8DAA8D2rB,OAAS,SAAStzB,KAAKO,QAAU,GAA5G,EAAgHgJ,KAAhH;AACA,cAAM,IAAI1K,OAAOrB,KAAX,CAAiB,2BAAjB,EAA+C,mDAAmD81B,OAAS,SAAStzB,KAAKO,QAAU,EAAnI,EAAsI;AAAE2I,oBAAU,0BAAZ;AAAwCsM,eAAK8d,OAA7C;AAAsD/yB,oBAAUP,KAAKO;AAArE,SAAtI,CAAN;AACA;AACD;;AAED,QAAIyG,OAAO8sB,UAAP,KAAsB,GAA1B,EAA+B;AAC9BpsB,cAAQC,GAAR,CAAa,yBAAyBX,OAAO8sB,UAAY,0BAA0BR,OAAS,EAA5F;AACA,YAAM,IAAIz0B,OAAOrB,KAAX,CAAiB,0BAAjB,EAA8C,uBAAuB81B,OAAS,EAA9E,EAAiF;AAAEpqB,kBAAU,0BAAZ;AAAwCsM,aAAK8d;AAA7C,OAAjF,CAAN;AACA;;AAED,QAAI,CAAC,YAAYhvB,IAAZ,CAAiB0C,OAAO4R,OAAP,CAAe,cAAf,CAAjB,CAAL,EAAuD;AACtDlR,cAAQC,GAAR,CAAa,mDAAmDX,OAAO4R,OAAP,CAAe,cAAf,CAAgC,0BAA0B0a,OAAS,EAAnI;AACA,YAAM,IAAIz0B,OAAOrB,KAAX,CAAiB,0BAAjB,EAA8C,uBAAuB81B,OAAS,EAA9E,EAAiF;AAAEpqB,kBAAU,0BAAZ;AAAwCsM,aAAK8d;AAA7C,OAAjF,CAAN;AACA;;AAEDG,eAAW,QAAX;AACAxd,YAAQjP,OAAO4X,OAAf;AACA2U,kBAAcvsB,OAAO4R,OAAP,CAAe,cAAf,CAAd;AACA,GAzBM,MAyBA,IAAI4a,YAAY,MAAhB,EAAwB;AAC9BC,eAAW,QAAX;AACAxd,YAAQqd,OAAR;AACA,GAHM,MAGA;AACN,UAAMS,WAAWC,eAAeC,YAAf,CAA4BX,OAA5B,CAAjB;AACAG,eAAW,QAAX;AACAxd,YAAQ8d,SAAS9d,KAAjB;AACAsd,kBAAcQ,SAASR,WAAvB;AACA;;AAED,QAAMW,SAAS,IAAIC,MAAJ,CAAWle,KAAX,EAAkBwd,QAAlB,CAAf;AACA,QAAMW,YAAYrK,WAAWC,QAAX,CAAoB,SAApB,CAAlB;AACAoK,YAAUvJ,YAAV,CAAuB7qB,KAAKO,QAA5B;AAEA,QAAMme,OAAO;AACZzf,YAAQe,KAAKZ,GADD;AAEZ8I,UAAMqrB,WAFM;AAGZtE,UAAMiF,OAAO32B;AAHD,GAAb;AAMA62B,YAAUxD,MAAV,CAAiBlS,IAAjB,EAAuBwV,MAAvB,EAA+B,MAAM;AACpCr1B,WAAO6V,UAAP,CAAkB,YAAW;AAC5BzY,iBAAWC,MAAX,CAAkBwf,KAAlB,CAAwBgY,eAAxB,CAAwC1zB,KAAKZ,GAA7C,EAAkDo0B,OAAlD;AACAv3B,iBAAWslB,aAAX,CAAyB8S,YAAzB,CAAsC,cAAtC,EAAsD;AAAC9zB,kBAAUP,KAAKO;AAAhB,OAAtD;AACA,KAHD,EAGG,GAHH;AAIA,GALD;AAMA,CAzDD,C;;;;;;;;;;;ACAA,IAAImC,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAENC,WAAWq4B,YAAX,GAA0B,UAASr1B,MAAT,EAAiBqO,CAAjB,EAAoB;AAC7C,QAAM/M,WAAWmC,EAAEM,IAAF,CAAOsK,CAAP,CAAjB;;AACA,MAAI,CAACrO,MAAD,IAAW,CAACsB,QAAhB,EAA0B;AACzB,WAAO,KAAP;AACA;;AACD,MAAI8I,cAAJ;;AACA,MAAI;AACHA,qBAAiB,IAAIC,MAAJ,CAAY,IAAIrN,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAkD,GAAlE,CAAjB;AACA,GAFD,CAEE,OAAOiI,KAAP,EAAc;AACfF,qBAAiB,IAAIC,MAAJ,CAAW,mBAAX,CAAjB;AACA;;AACD,MAAI,CAACD,eAAe/E,IAAf,CAAoB/D,QAApB,CAAL,EAAoC;AACnC,WAAO,KAAP;AACA;;AACD,QAAMP,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCle,MAApC,CAAb,CAd6C,CAe7C;;AACA,MAAIe,KAAKO,QAAL,KAAkBA,QAAtB,EAAgC;AAC/B,WAAOP,IAAP;AACA;;AACD,QAAMu0B,mBAAmBv0B,KAAKO,QAA9B,CAnB6C,CAoB7C;;AACA,MAAI,CAACg0B,gBAAD,IAAqB,EAAEh0B,SAASmxB,WAAT,OAA2B6C,iBAAiB7C,WAAjB,EAA7B,CAAzB,EAAuF;AACtF,QAAI,CAACz1B,WAAW8rB,yBAAX,CAAqCxnB,QAArC,CAAL,EAAqD;AACpD,aAAO,KAAP;AACA;AACD,GAzB4C,CA0B7C;;;AACA,MAAI;AACH,QAAI,CAACg0B,gBAAD,IAAqBv0B,KAAKygB,MAA1B,IAAoCzgB,KAAKygB,MAAL,CAAYljB,MAAZ,GAAqB,CAAzD,IAA8DtB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,2BAAxB,CAAlE,EAAwH;AACvHgZ,eAASka,mBAAT,CAA6Bx0B,KAAKZ,GAAlC;AACA;AACD,GAJD,CAIE,OAAOimB,CAAP,EAAU;AACX3d,YAAQ6B,KAAR,CAAc8b,CAAd;AACA;AACD;;;AACArlB,OAAKO,QAAL,GAAgBA,QAAhB;;AACA,MAAI,CAACg0B,gBAAD,IAAqBt4B,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,2BAAxB,MAAyD,IAAlF,EAAwF;AACvF,UAAMmzB,oBAAoBC,2BAA2B10B,IAA3B,CAA1B;AACA,QAAI20B,QAAJ;AACA3wB,WAAOC,IAAP,CAAYwwB,iBAAZ,EAA+BvZ,IAA/B,CAAoCsY,WAAW;AAC9C,YAAMoB,aAAaH,kBAAkBjB,OAAlB,CAAnB;;AACA,UAAIA,YAAY,UAAhB,EAA4B;AAC3Bv3B,mBAAWkzB,aAAX,CAAyBnvB,IAAzB,EAA+B40B,WAAWC,IAA1C,EAAgDD,WAAWrB,WAA3D,EAAwEC,OAAxE;AACAmB,mBAAW,IAAX;AACA,eAAO,IAAP;AACA,OAJD,MAIO;AACNA,mBAAWC,UAAX;AACA;AACD,KATD;;AAUA,QAAID,YAAY,IAAhB,EAAsB;AACrB14B,iBAAWkzB,aAAX,CAAyBnvB,IAAzB,EAA+B20B,SAASE,IAAxC,EAA8CF,SAASpB,WAAvD,EAAoE,UAApE;AACA;AACD,GApD4C,CAqD7C;;;AACA,MAAIgB,gBAAJ,EAAsB;AACrBt4B,eAAWC,MAAX,CAAkBghB,QAAlB,CAA2B4X,0BAA3B,CAAsD90B,KAAKZ,GAA3D,EAAgEmB,QAAhE;AACAtE,eAAWC,MAAX,CAAkBghB,QAAlB,CAA2B6X,4BAA3B,CAAwD/0B,KAAKZ,GAA7D,EAAkEmB,QAAlE;AACAtE,eAAWC,MAAX,CAAkBghB,QAAlB,CAA2B8X,aAA3B,CAAyCT,gBAAzC,EAA2DrwB,OAA3D,CAAmE,UAASsI,GAAT,EAAc;AAChF,YAAMyoB,aAAazoB,IAAIA,GAAJ,CAAQ/D,OAAR,CAAgB,IAAIa,MAAJ,CAAY,IAAIirB,gBAAkB,EAAlC,EAAqC,IAArC,CAAhB,EAA6D,IAAIh0B,QAAU,EAA3E,CAAnB;AACA,aAAOtE,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2BgY,mDAA3B,CAA+E1oB,IAAIpN,GAAnF,EAAwFm1B,gBAAxF,EAA0Gh0B,QAA1G,EAAoH00B,UAApH,CAAP;AACA,KAHD;AAIAh5B,eAAWC,MAAX,CAAkB6M,KAAlB,CAAwBosB,eAAxB,CAAwCZ,gBAAxC,EAA0Dh0B,QAA1D;AACAtE,eAAWC,MAAX,CAAkB6M,KAAlB,CAAwBqsB,oBAAxB,CAA6Cb,gBAA7C,EAA+Dh0B,QAA/D;AACAtE,eAAWC,MAAX,CAAkB6M,KAAlB,CAAwBssB,6BAAxB,CAAsDr1B,KAAKZ,GAA3D,EAAgEmB,QAAhE;AACAtE,eAAWC,MAAX,CAAkByF,aAAlB,CAAgC2zB,uBAAhC,CAAwDt1B,KAAKZ,GAA7D,EAAkEmB,QAAlE;AACAtE,eAAWC,MAAX,CAAkByF,aAAlB,CAAgC4zB,gCAAhC,CAAiEhB,gBAAjE,EAAmFh0B,QAAnF;AAEA,UAAM6zB,YAAYrK,WAAWC,QAAX,CAAoB,SAApB,CAAlB;AACA,UAAMtL,OAAO0V,UAAUoB,KAAV,CAAgBhsB,aAAhB,CAA8B+qB,gBAA9B,CAAb;;AACA,QAAI7V,IAAJ,EAAU;AACT0V,gBAAUoB,KAAV,CAAgBC,kBAAhB,CAAmC/W,KAAKtf,GAAxC,EAA6CmB,QAA7C;AACA;AACD,GAxE4C,CAyE7C;;;AACAtE,aAAWC,MAAX,CAAkBwf,KAAlB,CAAwB0T,WAAxB,CAAoCpvB,KAAKZ,GAAzC,EAA8CmB,QAA9C;AACA,SAAOP,IAAP;AACA,CA5ED;;AA8EA/D,WAAWmzB,WAAX,GAAyBnzB,WAAW+W,WAAX,CAAuBC,aAAvB,CAAqChX,WAAWq4B,YAAhD,EAA8D,CAA9D,EAAiE,KAAjE,EAAwE;AAChG,GAAC,CAAD,EAAIr1B,MAAJ,EAAY;AACX,WAAO,CAACA,MAAD,IAAW,CAAChD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BhoB,MAA/B,EAAuC,sBAAvC,CAAnB;AACA;;AAH+F,CAAxE,CAAzB,C;;;;;;;;;;;AChFA,IAAIyD,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAENC,WAAWy5B,YAAX,GAA0B,UAASz2B,MAAT,EAAiB5B,IAAjB,EAAuB;AAChDA,SAAOqF,EAAEM,IAAF,CAAO3F,IAAP,CAAP;;AACA,MAAI,CAAC4B,MAAD,IAAW,CAAC5B,IAAhB,EAAsB;AACrB,WAAO,KAAP;AACA;;AAED,QAAM2C,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCle,MAApC,CAAb,CANgD,CAQhD;;AACA,MAAIe,KAAK3C,IAAL,KAAcA,IAAlB,EAAwB;AACvB,WAAO2C,IAAP;AACA,GAX+C,CAahD;;;AACA/D,aAAWC,MAAX,CAAkBwf,KAAlB,CAAwBia,OAAxB,CAAgC31B,KAAKZ,GAArC,EAA0C/B,IAA1C;AACA2C,OAAK3C,IAAL,GAAYA,IAAZ;;AAEA,MAAIpB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,MAAgD,IAApD,EAA0D;AACzDrF,eAAWslB,aAAX,CAAyB8S,YAAzB,CAAsC,mBAAtC,EAA2D;AAC1Dj1B,WAAKY,KAAKZ,GADgD;AAE1D/B,YAAM2C,KAAK3C,IAF+C;AAG1DkD,gBAAUP,KAAKO;AAH2C,KAA3D;AAKA;;AAED,SAAOP,IAAP;AACA,CA1BD;;AA4BA/D,WAAWozB,WAAX,GAAyBpzB,WAAW+W,WAAX,CAAuBC,aAAvB,CAAqChX,WAAWy5B,YAAhD,EAA8D,CAA9D,EAAiE,KAAjE,EAAwE;AAChG,MAAI;AAAE,WAAO,CAAC72B,OAAOI,MAAP,EAAD,IAAoB,CAAChD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,sBAAhD,CAA5B;AAAsG,GADZ,CACa;;;AADb,CAAxE,CAAzB,C;;;;;;;;;;;AC9BA,IAAIyD,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAENC,WAAW25B,SAAX,GAAuB,UAAS32B,MAAT,EAAiBgL,KAAjB,EAAwB4rB,8BAA8B,IAAtD,EAA4D;AAClF5rB,UAAQvH,EAAEM,IAAF,CAAOiH,KAAP,CAAR;;AACA,MAAI,CAAChL,MAAL,EAAa;AACZ,UAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE0L,gBAAU;AAAZ,KAAvD,CAAN;AACA;;AAED,MAAI,CAACe,KAAL,EAAY;AACX,UAAM,IAAIpL,OAAOrB,KAAX,CAAiB,qBAAjB,EAAwC,eAAxC,EAAyD;AAAE0L,gBAAU;AAAZ,KAAzD,CAAN;AACA;;AAEDjN,aAAW8pB,mBAAX,CAA+B9b,KAA/B;AAEA,QAAMjK,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCle,MAApC,CAAb,CAZkF,CAclF;;AACA,MAAIe,KAAKygB,MAAL,IAAezgB,KAAKygB,MAAL,CAAY,CAAZ,CAAf,IAAiCzgB,KAAKygB,MAAL,CAAY,CAAZ,EAAeE,OAAf,KAA2B1W,KAAhE,EAAuE;AACtE,WAAOjK,IAAP;AACA,GAjBiF,CAmBlF;;;AACA,MAAI,CAAC/D,WAAWmsB,sBAAX,CAAkCne,KAAlC,CAAL,EAA+C;AAC9C,UAAM,IAAIpL,OAAOrB,KAAX,CAAiB,yBAAjB,EAA6C,GAAGyM,KAAO,uBAAvD,EAA+E;AAAEf,gBAAU,WAAZ;AAAyBqlB,aAAOtkB;AAAhC,KAA/E,CAAN;AACA,GAtBiF,CAwBlF;;;AACAhO,aAAWC,MAAX,CAAkBwf,KAAlB,CAAwB6T,QAAxB,CAAiCvvB,KAAKZ,GAAtC,EAA2C6K,KAA3C;AACAjK,OAAKiK,KAAL,GAAaA,KAAb;;AACA,MAAI4rB,gCAAgC,IAApC,EAA0C;AACzCh3B,WAAO8F,IAAP,CAAY,uBAAZ,EAAqC3E,KAAKiK,KAA1C;AACA;;AACD,SAAOjK,IAAP;AACA,CA/BD;;AAiCA/D,WAAWszB,QAAX,GAAsBtzB,WAAW+W,WAAX,CAAuBC,aAAvB,CAAqChX,WAAW25B,SAAhD,EAA2D,CAA3D,EAA8D,KAA9D,EAAqE;AAC1F,MAAI;AAAE,WAAO,CAAC/2B,OAAOI,MAAP,EAAD,IAAoB,CAAChD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,sBAAhD,CAA5B;AAAsG,GADlB,CACmB;;;AADnB,CAArE,CAAtB,C;;;;;;;;;;;ACnCAhD,WAAW65B,aAAX,GAA2B,UAAS/0B,GAAT,EAAc;AACxC9E,aAAWC,MAAX,CAAkB6M,KAAlB,CAAwBgtB,aAAxB,CAAsCh1B,GAAtC;AACA9E,aAAWC,MAAX,CAAkByF,aAAlB,CAAgCq0B,iBAAhC,CAAkDj1B,GAAlD;AACA,CAHD,C;;;;;;;;;;;ACAA9E,WAAWg6B,aAAX,GAA2B,UAAShpB,OAAT,EAAkBjN,IAAlB,EAAwB;AAClD;AACA,MAAI/D,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,qBAAxB,CAAJ,EAAoD;AACnDrF,eAAWC,MAAX,CAAkBghB,QAAlB,CAA2BsM,yBAA3B,CAAqDvc,QAAQ7N,GAA7D;AACA;;AAED6N,UAAQwN,QAAR,GAAmB,IAAI5W,IAAJ,EAAnB;AACAoJ,UAAQipB,QAAR,GAAmB;AAClB92B,SAAKY,KAAKZ,GADQ;AAElBmB,cAAUP,KAAKO;AAFG,GAAnB;AAKA,QAAMmwB,OAAOzjB,QAAQT,GAAR,CAAY/E,KAAZ,CAAkB,8IAAlB,CAAb;;AACA,MAAIipB,IAAJ,EAAU;AACTzjB,YAAQyjB,IAAR,GAAeA,KAAK1rB,GAAL,CAAUwQ,GAAD,IAAS;AAAE,aAAO;AAAEA;AAAF,OAAP;AAAiB,KAArC,CAAf;AACA;;AAEDvI,YAAUhR,WAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,mBAAzB,EAA8CoG,OAA9C,CAAV;AAEA,QAAMkpB,SAASlpB,QAAQ7N,GAAvB;AACA,SAAO6N,QAAQ7N,GAAf;AAEAnD,aAAWC,MAAX,CAAkBghB,QAAlB,CAA2ByM,MAA3B,CAAkC;AAAEvqB,SAAK+2B;AAAP,GAAlC,EAAmD;AAAEvM,UAAM3c;AAAR,GAAnD;AAEA,QAAMvO,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoClQ,QAAQlM,GAA5C,CAAb;AAEAlC,SAAOiJ,KAAP,CAAa,YAAW;AACvB7L,eAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,kBAAzB,EAA6C5K,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2BC,WAA3B,CAAuCgZ,MAAvC,CAA7C,EAA6Fz3B,IAA7F,EAAmGsB,KAAKZ,GAAxG;AACA,GAFD;AAGA,CA7BD,C;;;;;;;;;;;ACAA,IAAIsD,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAENC,WAAW0zB,oBAAX,GAAkC,UAASxuB,MAAT,EAAiB;AAClD;AACA;AACA,MAAIuB,EAAEM,IAAF,CAAO/G,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAP,MAA6D,EAAjE,EAAqE;AACpE;AACA;;AAED,MAAIuuB,gBAAJ;;AACA,MAAI;AACHA,uBAAmBC,KAAKpjB,KAAL,CAAWzQ,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAX,CAAnB;AACA,GAFD,CAEE,OAAO+jB,CAAP,EAAU;AACX,UAAM,IAAIxmB,OAAOrB,KAAX,CAAiB,gCAAjB,EAAmD,gCAAnD,CAAN;AACA;;AAED,QAAMmuB,eAAe,EAArB;AAEA3nB,SAAOC,IAAP,CAAY4rB,gBAAZ,EAA8B3rB,OAA9B,CAAuC+rB,SAAD,IAAe;AACpD,UAAM1B,QAAQsB,iBAAiBI,SAAjB,CAAd;AAEAtE,iBAAasE,SAAb,IAA0B9uB,OAAO8uB,SAAP,CAA1B;AACA,UAAMmG,aAAa1zB,EAAEM,IAAF,CAAO7B,OAAO8uB,SAAP,CAAP,CAAnB;;AAEA,QAAI1B,MAAM8H,QAAN,IAAkBD,eAAe,EAArC,EAAyC;AACxC,YAAM,IAAIv3B,OAAOrB,KAAX,CAAiB,sCAAjB,EAA0D,SAASyyB,SAAW,cAA9E,EAA6F;AAAC3jB,gBAAQ;AAAT,OAA7F,CAAN;AACA;;AAED,QAAIiiB,MAAMrmB,IAAN,KAAe,QAAf,IAA2BqmB,MAAMviB,OAAN,CAAcxD,OAAd,CAAsBrH,OAAO8uB,SAAP,CAAtB,MAA6C,CAAC,CAA7E,EAAgF;AAC/E,YAAM,IAAIpxB,OAAOrB,KAAX,CAAiB,sCAAjB,EAA0D,mBAAmByyB,SAAW,aAAxF,EAAsG;AAAC3jB,gBAAQ;AAAT,OAAtG,CAAN;AACA;;AAED,QAAIiiB,MAAM+H,SAAN,IAAmBF,WAAW74B,MAAX,GAAoBgxB,MAAM+H,SAAjD,EAA4D;AAC3D,YAAM,IAAIz3B,OAAOrB,KAAX,CAAiB,sCAAjB,EAA0D,uBAAuByyB,SAAW,IAAI1B,MAAM+H,SAAW,EAAjH,EAAoH;AAAChqB,gBAAQ;AAAT,OAApH,CAAN;AACA;;AAED,QAAIiiB,MAAMgI,SAAN,IAAmBH,WAAW74B,MAAX,GAAoBgxB,MAAMgI,SAAjD,EAA4D;AAC3D,YAAM,IAAI13B,OAAOrB,KAAX,CAAiB,sCAAjB,EAA0D,uBAAuByyB,SAAW,IAAI1B,MAAMgI,SAAW,EAAjH,EAAoH;AAACjqB,gBAAQ;AAAT,OAApH,CAAN;AACA;AACD,GArBD;AAsBA,CAtCD,C;;;;;;;;;;;ACFArQ,WAAWslB,aAAX,GAA2B,IAAI,MAAM;AACpCnkB,gBAAc;AACb,SAAKkS,KAAL,GAAa,KAAb;AACA,SAAKknB,SAAL,GAAiB,IAAI33B,OAAO43B,QAAX,CAAoB,YAApB,CAAjB;AACA,SAAKC,YAAL,GAAoB,IAAI73B,OAAO43B,QAAX,CAAoB,eAApB,CAApB;AACA,SAAKE,UAAL,GAAkB,IAAI93B,OAAO43B,QAAX,CAAoB,aAApB,CAAlB;AACA,SAAKG,eAAL,GAAuB,IAAI/3B,OAAO43B,QAAX,CAAoB,mBAApB,CAAvB;AACA,SAAKI,UAAL,GAAkB,IAAIh4B,OAAO43B,QAAX,CAAoB,aAApB,CAAlB;AACA,SAAKD,SAAL,CAAeM,UAAf,CAA0B,MAA1B;AACA,SAAKJ,YAAL,CAAkBI,UAAlB,CAA6B,MAA7B;AACA,SAAKH,UAAL,CAAgBG,UAAhB,CAA2B,MAA3B;AACA,SAAKF,eAAL,CAAqBE,UAArB,CAAgC,UAASC,SAAT,EAAoB,GAAGlmB,IAAvB,EAA6B;AAC5D,YAAM,CAACnP,MAAD,EAAS2jB,CAAT,IAAc0R,UAAUvvB,KAAV,CAAgB,GAAhB,CAApB,CAD4D,CAE5D;AACA;AACA;AACA;AACA;;AACA,UAAIvL,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyD7b,MAAzD,EAAiE,KAAKzC,MAAtE,KAAiF,IAArF,EAA2F;AAC1F,cAAM2iB,gBAAgB3lB,WAAWC,MAAX,CAAkByF,aAAlB,CAAgCq1B,wBAAhC,CAAyDt1B,MAAzD,EAAiE,KAAKzC,MAAtE,EAA8E+Y,KAA9E,EAAtB;AACA4J,sBAAc1d,OAAd,CAAsBtD,gBAAgB3E,WAAWslB,aAAX,CAAyBC,UAAzB,CAAoC5gB,aAAa0M,CAAb,CAAelO,GAAnD,EAAwDimB,CAAxD,EAA2D,GAAGxU,IAA9D,CAAtC;AACA;;AACD,aAAO,KAAP;AACA,KAZD;AAaA,SAAKgmB,UAAL,CAAgBC,UAAhB,CAA2B,QAA3B;AACA,SAAKN,SAAL,CAAeS,SAAf,CAAyB,KAAzB;AACA,SAAKP,YAAL,CAAkBO,SAAlB,CAA4B,QAA5B;AACA,SAAKN,UAAL,CAAgBM,SAAhB,CAA0B,UAASF,SAAT,EAAoBtO,SAApB,EAA+B;AACxD,YAAM,CAAC/mB,MAAD,IAAWq1B,UAAUvvB,KAAV,CAAgB,GAAhB,CAAjB;AACA,YAAMxH,OAAOnB,OAAO0kB,KAAP,CAAaziB,OAAb,CAAqB,KAAK7B,MAA1B,EAAkC;AAC9CkC,gBAAQ;AACPZ,oBAAU;AADH;AADsC,OAAlC,CAAb;AAKA,YAAM7B,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCzb,MAApC,CAAb;;AACA,UAAI,CAAChD,IAAL,EAAW;AACVgJ,gBAAQwvB,IAAR,CAAc,kCAAkCH,SAAW,GAA3D;AACA,eAAO,KAAP;AACA;;AACD,UAAIr4B,KAAKS,CAAL,KAAW,GAAX,IAAkBspB,SAAlB,IAA+BA,UAAUrJ,KAAzC,IAAkD1gB,KAAK1C,CAAL,CAAOojB,KAAP,KAAiBqJ,UAAUrJ,KAAjF,EAAwF;AACvF,eAAO,IAAP;AACA;;AACD,UAAI,KAAKngB,MAAL,IAAe,IAAnB,EAAyB;AACxB,eAAO,KAAP;AACA;;AACD,aAAOP,KAAKmD,SAAL,CAAe2G,OAAf,CAAuBxI,KAAKO,QAA5B,IAAwC,CAAC,CAAhD;AACA,KAnBD;AAoBA,SAAKq2B,eAAL,CAAqBK,SAArB,CAA+B,MAA/B;AACA,SAAKJ,UAAL,CAAgBI,SAAhB,CAA0B,UAASF,SAAT,EAAoB;AAC7C,YAAM,CAAC93B,MAAD,IAAW83B,UAAUvvB,KAAV,CAAgB,GAAhB,CAAjB;AACA,aAAQ,KAAKvI,MAAL,IAAe,IAAhB,IAAyB,KAAKA,MAAL,KAAgBA,MAAhD;AACA,KAHD;AAIA;;AAEDk4B,YAAUJ,SAAV,EAAqB,GAAGlmB,IAAxB,EAA8B;AAC7B,QAAI,KAAKvB,KAAL,KAAe,IAAnB,EAAyB;AACxB5H,cAAQC,GAAR,CAAY,WAAZ,EAAyBsJ,SAAzB;AACA;;AACDJ,SAAKumB,OAAL,CAAaL,SAAb;AACA,WAAO,KAAKP,SAAL,CAAea,IAAf,CAAoBnmB,KAApB,CAA0B,KAAKslB,SAA/B,EAA0C3lB,IAA1C,CAAP;AACA;;AAEDwjB,eAAa0C,SAAb,EAAwB,GAAGlmB,IAA3B,EAAiC;AAChC,QAAI,KAAKvB,KAAL,KAAe,IAAnB,EAAyB;AACxB5H,cAAQC,GAAR,CAAY,cAAZ,EAA4BsJ,SAA5B;AACA;;AACDJ,SAAKumB,OAAL,CAAaL,SAAb;AACA,WAAO,KAAKL,YAAL,CAAkBW,IAAlB,CAAuBnmB,KAAvB,CAA6B,KAAKwlB,YAAlC,EAAgD7lB,IAAhD,CAAP;AACA;;AAEDuZ,aAAW1rB,IAAX,EAAiBq4B,SAAjB,EAA4B,GAAGlmB,IAA/B,EAAqC;AACpC,QAAI,KAAKvB,KAAL,KAAe,IAAnB,EAAyB;AACxB5H,cAAQC,GAAR,CAAY,YAAZ,EAA0BsJ,SAA1B;AACA;;AACDJ,SAAKumB,OAAL,CAAc,GAAG14B,IAAM,IAAIq4B,SAAW,EAAtC;AACA,WAAO,KAAKJ,UAAL,CAAgBU,IAAhB,CAAqBnmB,KAArB,CAA2B,KAAKylB,UAAhC,EAA4C9lB,IAA5C,CAAP;AACA;;AAED2Q,aAAWviB,MAAX,EAAmB83B,SAAnB,EAA8B,GAAGlmB,IAAjC,EAAuC;AACtC,QAAI,KAAKvB,KAAL,KAAe,IAAnB,EAAyB;AACxB5H,cAAQC,GAAR,CAAY,YAAZ,EAA0BsJ,SAA1B;AACA;;AACDJ,SAAKumB,OAAL,CAAc,GAAGn4B,MAAQ,IAAI83B,SAAW,EAAxC;AACA,WAAO,KAAKF,UAAL,CAAgBQ,IAAhB,CAAqBnmB,KAArB,CAA2B,KAAK2lB,UAAhC,EAA4ChmB,IAA5C,CAAP;AACA;;AAEDymB,0BAAwBP,SAAxB,EAAmC,GAAGlmB,IAAtC,EAA4C;AAC3C,QAAI,KAAKvB,KAAL,KAAe,IAAnB,EAAyB;AACxB5H,cAAQC,GAAR,CAAY,WAAZ,EAAyBsJ,SAAzB;AACA;;AACDJ,SAAKumB,OAAL,CAAaL,SAAb;AACA,WAAO,KAAKP,SAAL,CAAee,oBAAf,CAAoCrmB,KAApC,CAA0C,KAAKslB,SAA/C,EAA0D3lB,IAA1D,CAAP;AACA;;AAED2mB,6BAA2BT,SAA3B,EAAsC,GAAGlmB,IAAzC,EAA+C;AAC9C,QAAI,KAAKvB,KAAL,KAAe,IAAnB,EAAyB;AACxB5H,cAAQC,GAAR,CAAY,cAAZ,EAA4BsJ,SAA5B;AACA;;AACDJ,SAAKumB,OAAL,CAAaL,SAAb;AACA,WAAO,KAAKL,YAAL,CAAkBa,oBAAlB,CAAuCrmB,KAAvC,CAA6C,KAAKwlB,YAAlD,EAAgE7lB,IAAhE,CAAP;AACA;;AAED4mB,2BAAyB/4B,IAAzB,EAA+Bq4B,SAA/B,EAA0C,GAAGlmB,IAA7C,EAAmD;AAClD,QAAI,KAAKvB,KAAL,KAAe,IAAnB,EAAyB;AACxB5H,cAAQC,GAAR,CAAY,wBAAZ,EAAsCsJ,SAAtC;AACA;;AACDJ,SAAKumB,OAAL,CAAc,GAAG14B,IAAM,IAAIq4B,SAAW,EAAtC;AACA,WAAO,KAAKJ,UAAL,CAAgBY,oBAAhB,CAAqCrmB,KAArC,CAA2C,KAAKylB,UAAhD,EAA4D9lB,IAA5D,CAAP;AACA;;AAED6mB,2BAAyBz4B,MAAzB,EAAiC83B,SAAjC,EAA4C,GAAGlmB,IAA/C,EAAqD;AACpD,QAAI,KAAKvB,KAAL,KAAe,IAAnB,EAAyB;AACxB5H,cAAQC,GAAR,CAAY,wBAAZ,EAAsCsJ,SAAtC;AACA;;AACDJ,SAAKumB,OAAL,CAAc,GAAGn4B,MAAQ,IAAI83B,SAAW,EAAxC;AACA,WAAO,KAAKF,UAAL,CAAgBU,oBAAhB,CAAqCrmB,KAArC,CAA2C,KAAK2lB,UAAhD,EAA4DhmB,IAA5D,CAAP;AACA;;AApHmC,CAAV,EAA3B;AAuHA5U,WAAWslB,aAAX,CAAyBoV,UAAzB,CAAoCG,UAApC,CAA+C,UAASC,SAAT,EAAoBx2B,QAApB,EAA8Bo3B,MAA9B,EAAsClP,SAAtC,EAAiD;AAC/F,QAAM,CAAC/mB,MAAD,EAAS2jB,CAAT,IAAc0R,UAAUvvB,KAAV,CAAgB,GAAhB,CAApB;;AACA,MAAI6d,MAAM,QAAV,EAAoB;AACnB,WAAO,IAAP;AACA;;AACD,MAAIA,MAAM,QAAV,EAAoB;AAEnB;AACA,QAAIoD,aAAaA,UAAUrJ,KAA3B,EAAkC;AACjC,YAAM1gB,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCzb,MAApC,CAAb;;AACA,UAAIhD,QAAQA,KAAKS,CAAL,KAAW,GAAnB,IAA0BT,KAAK1C,CAAL,CAAOojB,KAAP,KAAiBqJ,UAAUrJ,KAAzD,EAAgE;AAC/D,eAAO,IAAP;AACA;AACD;;AAED,UAAMpf,OAAOnB,OAAO0kB,KAAP,CAAaziB,OAAb,CAAqB,KAAK7B,MAA1B,EAAkC;AAC9CkC,cAAQ;AACPZ,kBAAU;AADH;AADsC,KAAlC,CAAb;;AAKA,QAAIP,QAAQ,IAAR,IAAgBA,KAAKO,QAAL,KAAkBA,QAAtC,EAAgD;AAC/C,aAAO,IAAP;AACA;AACD;;AACD,SAAO,KAAP;AACA,CAzBD,E;;;;;;;;;;;ACvHA,IAAIq3B,YAAJ;AAAiBh8B,OAAOC,KAAP,CAAaC,QAAQ,WAAR,CAAb,EAAkC;AAACC,UAAQC,CAAR,EAAU;AAAC47B,mBAAa57B,CAAb;AAAe;;AAA3B,CAAlC,EAA+D,CAA/D;AAAkE,IAAI67B,eAAJ;AAAoBj8B,OAAOC,KAAP,CAAaC,QAAQ,cAAR,CAAb,EAAqC;AAACC,UAAQC,CAAR,EAAU;AAAC67B,sBAAgB77B,CAAhB;AAAkB;;AAA9B,CAArC,EAAqE,CAArE;AAGvGC,WAAWC,MAAX,CAAkB47B,aAAlB,GAAkC,IAAIj5B,OAAOk5B,mBAAX,EAAlC;;AAEA,MAAMC,UAAN,CAAiB;AAChB56B,cAAY66B,WAAZ,EAAyBC,QAAzB,EAAmC;AAClC,SAAKC,GAAL,GAAW,IAAIP,YAAJ,CAAiBK,WAAjB,EAA8B,IAA9B,CAAX;AACA,SAAKzC,KAAL,GAAa,KAAK2C,GAAL,CAAS3C,KAAtB;AACA,SAAK4C,cAAL,GAAsB,KAAKD,GAAL,CAASC,cAA/B;AACA,SAAK/6B,IAAL,GAAY,KAAK86B,GAAL,CAAS96B,IAArB;AAEA,SAAKg7B,SAAL,GAAiBH,aAAa,IAA9B;AAEA,SAAKI,KAAL,GAAa,IAAIT,eAAJ,CAAoB,IAApB,CAAb,CARkC,CASlC;;AACA,SAAKtlB,EAAL,GAAU,KAAK+lB,KAAL,CAAW/lB,EAAX,CAAcgmB,IAAd,CAAmB,KAAKD,KAAxB,CAAV;AACA,SAAKjB,IAAL,GAAY,KAAKiB,KAAL,CAAWjB,IAAX,CAAgBkB,IAAhB,CAAqB,KAAKD,KAA1B,CAAZ;AACA,SAAKE,cAAL,GAAsB,KAAKF,KAAL,CAAWE,cAAX,CAA0BD,IAA1B,CAA+B,KAAKD,KAApC,CAAtB;AACA,SAAKG,2BAAL,GAAmC,KAAKH,KAAL,CAAWG,2BAAX,CAAuCF,IAAvC,CAA4C,KAAKD,KAAjD,CAAnC,CAbkC,CAclC;;AAEA,SAAK/N,EAAL,GAAU,IAAV;;AAEA,QAAI,KAAK8N,SAAT,EAAoB;AACnB,WAAK9N,EAAL,GAAU,IAAI,KAAKntB,WAAT,CAAqB,KAAKo4B,KAA1B,EAAiC,KAAjC,CAAV;AACA;AACD;;AAED,MAAI0C,QAAJ,GAAe;AACd,QAAIj8B,WAAWC,MAAX,CAAkB47B,aAAlB,CAAgCx2B,GAAhC,OAA0C,KAA9C,EAAqD;AACpD,aAAO,KAAP;AACA;;AAED,WAAO,KAAK+2B,SAAZ;AACA;;AAED,MAAIK,MAAJ,GAAa;AACZ,WAAO,KAAKR,QAAL,KAAkB,IAAlB,GAAyB,OAAzB,GAAmC,KAA1C;AACA;;AAEDS,gBAAc7uB,IAAd,EAAoB;AACnB,WAAO;AACNkO,cAAQ;AACP,eAAOlO,IAAP;AACA,OAHK;;AAIN8jB,cAAQ;AACP,eAAO9jB,KAAKvM,MAAZ;AACA,OANK;;AAON2G,cAAQgP,EAAR,EAAY;AACX,eAAOpJ,KAAK5F,OAAL,CAAagP,EAAb,CAAP;AACA;;AATK,KAAP;AAWA;;AAED0lB;AAAa;AAA+B;AAC3C,WAAO,KAAKT,GAAL,CAASS,YAAT,CAAsB,GAAG3nB,SAAzB,CAAP;AACA;;AAEDzK,SAAO;AACN,QAAI;AACH,aAAO,KAAK,KAAKkyB,MAAV,EAAkBlyB,IAAlB,CAAuB,GAAGyK,SAA1B,CAAP;AACA,KAFD,CAEE,OAAOoU,CAAP,EAAU;AACX3d,cAAQ6B,KAAR,CAAc,mBAAd,EAAmC8b,CAAnC,EAAsC,GAAGpU,SAAzC;AACA;AACD;;AAEDnQ,YAAU;AACT,QAAI;AACH,aAAO,KAAK,KAAK43B,MAAV,EAAkB53B,OAAlB,CAA0B,GAAGmQ,SAA7B,CAAP;AACA,KAFD,CAEE,OAAOoU,CAAP,EAAU;AACX3d,cAAQ6B,KAAR,CAAc,mBAAd,EAAmC8b,CAAnC,EAAsC,GAAGpU,SAAzC;AACA;AACD;;AAEDkM,gBAAc;AACb,QAAI;AACH,aAAO,KAAK,KAAKub,MAAV,EAAkBvb,WAAlB,CAA8B,GAAGlM,SAAjC,CAAP;AACA,KAFD,CAEE,OAAOoU,CAAP,EAAU;AACX3d,cAAQ6B,KAAR,CAAc,mBAAd,EAAmC8b,CAAnC,EAAsC,GAAGpU,SAAzC;AACA;AACD;;AAED4nB,eAAaC,GAAb,EAAkB9sB,OAAlB,EAA2B;AAC1B4H,UAAMklB,GAAN,EAAW,CAAClxB,MAAD,CAAX;;AAEA,QAAI;AACH,aAAO,KAAK,KAAK8wB,MAAV,EAAkBG,YAAlB,CAA+BC,GAA/B,EAAoC9sB,OAApC,CAAP;AACA,KAFD,CAEE,OAAOqZ,CAAP,EAAU;AACX3d,cAAQ6B,KAAR,CAAc,mBAAd,EAAmC8b,CAAnC,EAAsC,GAAGpU,SAAzC;AACA;AACD;;AAED2f;AAAO;AAAY;AAClB,WAAO,KAAKuH,GAAL,CAASvH,MAAT,CAAgB,GAAG3f,SAAnB,CAAP;AACA;;AAED0Y;AAAO;AAA4B;AAClC,WAAO,KAAKwO,GAAL,CAASxO,MAAT,CAAgB,GAAG1Y,SAAnB,CAAP;AACA;;AAEDof;AAAO;AAAmB;AACzB,WAAO,KAAK8H,GAAL,CAAS9H,MAAT,CAAgB,GAAGpf,SAAnB,CAAP;AACA;;AAEDvK;AAAO;AAAW;AACjB,WAAO,KAAKyxB,GAAL,CAASzxB,MAAT,CAAgB,GAAGuK,SAAnB,CAAP;AACA;;AAED8nB,mBAAiB;AAChB,WAAO,KAAKZ,GAAL,CAASY,cAAT,CAAwB,GAAG9nB,SAA3B,CAAP;AACA;;AAED+nB,UAAQ;AACP,WAAO,KAAKb,GAAL,CAASa,KAAT,CAAe,GAAG/nB,SAAlB,CAAP;AACA;;AAEDgoB,SAAO;AACN,WAAO,KAAKd,GAAL,CAASc,IAAT,CAAc,GAAGhoB,SAAjB,CAAP;AACA;;AAEDioB,gBAAc;AACb,WAAO,KAAKf,GAAL,CAASe,WAAT,CAAqB,GAAGjoB,SAAxB,CAAP;AACA;;AAEDkoB,cAAY;AACX,WAAO,KAAKhB,GAAL,CAASgB,SAAT,CAAmB,GAAGloB,SAAtB,CAAP;AACA;;AAEDmoB,mBAAiB;AAChB,WAAO,KAAKjB,GAAL,CAASiB,cAAT,CAAwB,GAAGnoB,SAA3B,CAAP;AACA;;AAEDooB,iBAAe;AACd,WAAO,KAAKlB,GAAL,CAASkB,YAAT,CAAsB,GAAGpoB,SAAzB,CAAP;AACA;;AAEDqoB;AAAU;AAAoB;AAC7B,WAAO,KAAKnB,GAAL,CAASmB,SAAT,CAAmB,GAAGroB,SAAtB,CAAP;AACA;;AAEDsoB;AAAsB;AAA+B;AACpD,WAAO,KAAKpB,GAAL,CAASoB,qBAAT,CAA+B,GAAGtoB,SAAlC,CAAP;AACA,GA1Ie,CA4IhB;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAjLgB;;AAqLjBhV,WAAWC,MAAX,CAAkBs9B,KAAlB,GAA0BxB,UAA1B,C;;;;;;;;;;;AC1LA,IAAIv0B,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;AAIpEC,WAAWC,MAAX,CAAkBu9B,OAAlB,GAA4B,IAAI,cAAcx9B,WAAWC,MAAX,CAAkBs9B,KAAhC,CAAsC;AACrEp8B,gBAAc;AACb,UAAM,SAAN;AAEA,SAAKo4B,KAAL,CAAWkE,MAAX,CAAkB9I,MAAlB,CAAyB,CAAC3xB,MAAD,EAAS06B,GAAT,KAAiB;AACzCA,UAAIC,UAAJ,GAAiB7nB,eAAelU,EAAf,EAAjB;AACA,KAFD;AAIA,SAAKu7B,cAAL,CAAoB;AAAE/7B,YAAM;AAAR,KAApB;AACA;;AAEDw8B,uBAAqBx8B,IAArB,EAA2B4B,MAA3B,EAAmC66B,KAAnC,EAA0Cpb,IAA1C,EAAgDuK,KAAhD,EAAuD;AACtD,UAAM8K,WAAW;AAChB30B,WAAK/B,IADW;AAEhBA,UAFgB;AAGhB4B,YAHgB;AAIhB66B,WAJgB;AAKhBC,gBAAU,KALM;AAMhBC,iBAAW,IANK;AAOhBC,gBAAU,CAPM;AAQhBC,iBAAWx3B,EAAEsH,YAAF,CAAe0U,KAAKrhB,IAApB,EAA0B,GAA1B,CARK;AAShB88B,kBAAY,IAAIt2B,IAAJ;AATI,KAAjB;;AAYAJ,MAAE0nB,MAAF,CAAS4I,QAAT,EAAmBrV,IAAnB,EAAyBuK,KAAzB;;AAEA,WAAO,KAAK8P,cAAL,CAAoBhF,QAApB,CAAP;AACA;;AAEDqG,qBAAmBC,MAAnB,EAA2Bp7B,MAA3B,EAAmCyf,IAAnC,EAAyC;AACxC,QAAI,CAAC2b,MAAL,EAAa;AACZ;AACA;;AAED,UAAM9xB,SAAS;AACdnJ,WAAKi7B,MADS;AAEdp7B;AAFc,KAAf;AAKA,UAAM0qB,SAAS;AACdC,YAAM;AACLmQ,kBAAU,IADL;AAELC,mBAAW,KAFN;AAGLC,kBAAU;AAHL;AADQ,KAAf;AAQAtQ,WAAOC,IAAP,GAAcnmB,EAAE0nB,MAAF,CAASzM,IAAT,EAAeiL,OAAOC,IAAtB,CAAd;;AAEA,QAAI,KAAK4L,KAAL,CAAW8E,MAAX,IAAqB,KAAK9E,KAAL,CAAW8E,MAAX,CAAkB3Q,MAA3C,EAAmD;AAClD,aAAO,KAAK6L,KAAL,CAAW8E,MAAX,CAAkB3Q,MAAlB,CAAyBphB,MAAzB,EAAiCohB,MAAjC,CAAP;AACA,KAFD,MAEO;AACN,aAAO,KAAKA,MAAL,CAAYphB,MAAZ,EAAoBohB,MAApB,CAAP;AACA;AACD;;AAEDngB,gBAAcnM,IAAd,EAAoB;AACnB,WAAO,KAAKyD,OAAL,CAAa;AAAEzD;AAAF,KAAb,CAAP;AACA;;AAEDo4B,qBAAmB4E,MAAnB,EAA2Bh9B,IAA3B,EAAiC;AAChC,UAAMkL,SAAS;AAAEnJ,WAAKi7B;AAAP,KAAf;AACA,UAAM1Q,SAAS;AACdC,YAAM;AACLvsB;AADK;AADQ,KAAf;;AAKA,QAAI,KAAKm4B,KAAL,CAAW8E,MAAX,IAAqB,KAAK9E,KAAL,CAAW8E,MAAX,CAAkB3Q,MAA3C,EAAmD;AAClD,aAAO,KAAK6L,KAAL,CAAW8E,MAAX,CAAkB3Q,MAAlB,CAAyBphB,MAAzB,EAAiCohB,MAAjC,CAAP;AACA,KAFD,MAEO;AACN,aAAO,KAAKA,MAAL,CAAYphB,MAAZ,EAAoBohB,MAApB,CAAP;AACA;AACD,GAxEoE,CA0ErE;;;AACA4Q,oCAAkCl9B,IAAlC,EAAwC4B,MAAxC,EAAgDuW,GAAhD,EAAqD;AACpD,QAAI,CAACnY,IAAL,EAAW;AACV;AACA;;AAED,UAAMkL,SAAS;AACdlL,UADc;AAEd4B;AAFc,KAAf;AAKA,UAAM0qB,SAAS;AACdC,YAAM;AACLmQ,kBAAU,IADL;AAELC,mBAAW,KAFN;AAGLC,kBAAU,CAHL;AAILzkB;AAJK;AADQ,KAAf;;AASA,QAAI,KAAKggB,KAAL,CAAW8E,MAAX,IAAqB,KAAK9E,KAAL,CAAW8E,MAAX,CAAkB3Q,MAA3C,EAAmD;AAClD,aAAO,KAAK6L,KAAL,CAAW8E,MAAX,CAAkB3Q,MAAlB,CAAyBphB,MAAzB,EAAiCohB,MAAjC,CAAP;AACA,KAFD,MAEO;AACN,aAAO,KAAKA,MAAL,CAAYphB,MAAZ,EAAoBohB,MAApB,CAAP;AACA;AACD;;AAED6Q,aAAWH,MAAX,EAAmB;AAClB,QAAI,KAAK7E,KAAL,CAAW8E,MAAX,IAAqB,KAAK9E,KAAL,CAAW8E,MAAX,CAAkB5zB,MAA3C,EAAmD;AAClD,aAAO,KAAK8uB,KAAL,CAAW8E,MAAX,CAAkB5zB,MAAlB,CAAyB;AAAEtH,aAAKi7B;AAAP,OAAzB,CAAP;AACA,KAFD,MAEO;AACN,aAAO,KAAK3zB,MAAL,CAAY;AAAEtH,aAAKi7B;AAAP,OAAZ,CAAP;AACA;AACD;;AA3GoE,CAA1C,EAA5B,C;;;;;;;;;;;ACJA,IAAI52B,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAENC,WAAWC,MAAX,CAAkBghB,QAAlB,GAA6B,IAAI,cAAcjhB,WAAWC,MAAX,CAAkBs9B,KAAhC,CAAsC;AACtEp8B,gBAAc;AACb,UAAM,SAAN;AAEA,SAAKg8B,cAAL,CAAoB;AAAE,aAAO,CAAT;AAAY,YAAM;AAAlB,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,YAAM;AAAR,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,eAAS;AAAX,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,kBAAY;AAAd,KAApB,EAAuC;AAAEqB,cAAQ;AAAV,KAAvC;AACA,SAAKrB,cAAL,CAAoB;AAAE,sBAAgB;AAAlB,KAApB,EAA2C;AAAEqB,cAAQ;AAAV,KAA3C;AACA,SAAKrB,cAAL,CAAoB;AAAE,aAAO,CAAT;AAAY,WAAK,CAAjB;AAAoB,eAAS;AAA7B,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,kBAAY;AAAd,KAApB,EAAuC;AAAEsB,0BAAoB;AAAtB,KAAvC;AACA,SAAKtB,cAAL,CAAoB;AAAE,aAAO;AAAT,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,kBAAY;AAAd,KAApB,EAAuC;AAAEqB,cAAQ;AAAV,KAAvC;AACA,SAAKrB,cAAL,CAAoB;AAAE,2BAAqB;AAAvB,KAApB,EAAgD;AAAEqB,cAAQ;AAAV,KAAhD;AACA,SAAKrB,cAAL,CAAoB;AAAE,gBAAU;AAAZ,KAApB,EAAqC;AAAEqB,cAAQ;AAAV,KAArC;AACA,SAAKrB,cAAL,CAAoB;AAAE,mBAAa;AAAf,KAApB,EAAwC;AAAEqB,cAAQ;AAAV,KAAxC;AACA,SAAKrB,cAAL,CAAoB;AAAE,kBAAY;AAAd,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,oBAAc,CAAhB;AAAmB,iBAAW;AAA9B,KAApB,EAAuD;AAAEqB,cAAQ;AAAV,KAAvD;AACA,GAlBqE,CAoBtE;;;AACAzF,gBAAcz0B,QAAd,EAAwByL,OAAxB,EAAiC;AAChC,UAAMrL,QAAQ;AAAC,2BAAqBJ;AAAtB,KAAd;AAEA,WAAO,KAAKiG,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED2uB,gCAA8Bp6B,QAA9B,EAAwCQ,GAAxC,EAA6CiL,OAA7C,EAAsD;AACrD,UAAMrL,QAAQ;AACbkpB,eAAS;AAAE7E,aAAK;AAAP,OADI;AAEb,2BAAqBzkB,QAFR;AAGbQ;AAHa,KAAd;AAMA,WAAO,KAAKyF,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED4uB,sBAAoBl5B,MAApB,EAA4BsK,OAA5B,EAAqC;AACpC,UAAMrL,QAAQ;AACbkpB,eAAS;AACR7E,aAAK;AADG,OADI;AAKbjkB,WAAKW;AALQ,KAAd;AAQA,WAAO,KAAK8E,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDmhB,wCAAsCzrB,MAAtC,EAA8CsM,KAA9C,EAAqDhC,OAArD,EAA8D;AAC7D,UAAMrL,QAAQ;AACbkpB,eAAS;AACR7E,aAAK;AADG,OADI;AAKbjkB,WAAKW;AALQ,KAAd;;AAQA,QAAI6uB,MAAMjsB,IAAN,CAAW0J,KAAX,EAAkB,CAACpG,MAAD,CAAlB,KAAgCoG,MAAMzQ,MAAN,GAAe,CAAnD,EAAuD;AACtDoD,YAAMxB,CAAN,GACA;AAAC07B,cAAM7sB;AAAP,OADA;AAEA;;AAED,WAAO,KAAKxH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED8uB,wBAAsBp5B,MAAtB,EAA8BsK,OAA9B,EAAuC;AACtC,UAAMrL,QAAQ;AACbkpB,eAAS,IADI;AAEb9oB,WAAKW;AAFQ,KAAd;AAKA,WAAO,KAAK8E,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED+uB,oCAAkCr5B,MAAlC,EAA0Cs5B,SAA1C,EAAqDhvB,OAArD,EAA8D;AAC7D,UAAMrL,QAAQ;AACbkpB,eAAS;AACR7E,aAAK;AADG,OADI;AAIbjkB,WAAKW,MAJQ;AAKbkC,UAAI;AACHq3B,aAAKD;AADF;AALS,KAAd;AAUA,WAAO,KAAKx0B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDkvB,iBAAex5B,MAAf,EAAuBs5B,SAAvB,EAAkChvB,OAAlC,EAA2C;AAC1C,UAAMrL,QAAQ;AACbkpB,eAAS;AACR7E,aAAK;AADG,OADI;AAIbjkB,WAAKW,MAJQ;AAKby5B,kBAAY;AACXF,aAAKD;AADM;AALC,KAAd;AASA,WAAO,KAAKx0B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDovB,qCAAmC15B,MAAnC,EAA2Cs5B,SAA3C,EAAsDhvB,OAAtD,EAA+D;AAC9D,UAAMrL,QAAQ;AACbkpB,eAAS;AACR7E,aAAK;AADG,OADI;AAIbjkB,WAAKW,MAJQ;AAKbkC,UAAI;AACHy3B,aAAKL;AADF;AALS,KAAd;AAUA,WAAO,KAAKx0B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDsvB,8CAA4C55B,MAA5C,EAAoDs5B,SAApD,EAA+DhvB,OAA/D,EAAwE;AACvE,UAAMrL,QAAQ;AACbkpB,eAAS;AACR7E,aAAK;AADG,OADI;AAIbjkB,WAAKW,MAJQ;AAKbkC,UAAI;AACH23B,cAAMP;AADH;AALS,KAAd;AAUA,WAAO,KAAKx0B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDwvB,uCAAqC95B,MAArC,EAA6C+5B,cAA7C,EAA6DC,eAA7D,EAA8E1vB,OAA9E,EAAuF;AACtF,UAAMrL,QAAQ;AACbkpB,eAAS;AACR7E,aAAK;AADG,OADI;AAIbjkB,WAAKW,MAJQ;AAKbkC,UAAI;AACHq3B,aAAKQ,cADF;AAEHJ,aAAKK;AAFF;AALS,KAAd;AAWA,WAAO,KAAKl1B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED2vB,gDAA8Cj6B,MAA9C,EAAsD+5B,cAAtD,EAAsEC,eAAtE,EAAuF1vB,OAAvF,EAAgG;AAC/F,UAAMrL,QAAQ;AACbkpB,eAAS;AACR7E,aAAK;AADG,OADI;AAIbjkB,WAAKW,MAJQ;AAKbkC,UAAI;AACHg4B,cAAMH,cADH;AAEHF,cAAMG;AAFH;AALS,KAAd;AAWA,WAAO,KAAKl1B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDkhB,uDAAqDxrB,MAArD,EAA6Ds5B,SAA7D,EAAwEhtB,KAAxE,EAA+EhC,OAA/E,EAAwF;AACvF,UAAMrL,QAAQ;AACbkpB,eAAS;AACR7E,aAAK;AADG,OADI;AAIbjkB,WAAKW,MAJQ;AAKbkC,UAAI;AACHy3B,aAAKL;AADF;AALS,KAAd;;AAUA,QAAIzK,MAAMjsB,IAAN,CAAW0J,KAAX,EAAkB,CAACpG,MAAD,CAAlB,KAAgCoG,MAAMzQ,MAAN,GAAe,CAAnD,EAAuD;AACtDoD,YAAMxB,CAAN,GACA;AAAC07B,cAAM7sB;AAAP,OADA;AAEA;;AAED,WAAO,KAAKxH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED2hB,yDAAuDjsB,MAAvD,EAA+D+5B,cAA/D,EAA+EC,eAA/E,EAAgG1tB,KAAhG,EAAuGhC,OAAvG,EAAgH;AAC/G,UAAMrL,QAAQ;AACbkpB,eAAS;AACR7E,aAAK;AADG,OADI;AAIbjkB,WAAKW,MAJQ;AAKbkC,UAAI;AACHq3B,aAAKQ,cADF;AAEHJ,aAAKK;AAFF;AALS,KAAd;;AAWA,QAAInL,MAAMjsB,IAAN,CAAW0J,KAAX,EAAkB,CAACpG,MAAD,CAAlB,KAAgCoG,MAAMzQ,MAAN,GAAe,CAAnD,EAAuD;AACtDoD,YAAMxB,CAAN,GACA;AAAC07B,cAAM7sB;AAAP,OADA;AAEA;;AAED,WAAO,KAAKxH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED6vB,2CAAyCb,SAAzC,EAAoDhvB,OAApD,EAA6D;AAC5D,UAAMrL,QAAQ;AACbkpB,eAAS;AAAE7E,aAAK;AAAP,OADI;AAEb2H,WAAK,CAAC;AACL/oB,YAAI;AACHq3B,eAAKD;AADF;AADC,OAAD,EAKL;AACC,oBAAY;AACXC,eAAKD;AADM;AADb,OALK;AAFQ,KAAd;AAeA,WAAO,KAAKx0B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED8vB,0BAAwB78B,MAAxB,EAAgCyC,MAAhC,EAAwCsK,OAAxC,EAAiD;AAChD,UAAMrL,QAAQ;AACbkpB,eAAS;AAAE7E,aAAK;AAAP,OADI;AAEb,qBAAe/lB,MAFF;AAGb8B,WAAKW;AAHQ,KAAd;AAMA,WAAO,KAAK8E,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED+vB,mBAAiBr6B,MAAjB,EAAyBsK,OAAzB,EAAkC;AACjC,UAAMrL,QAAQ;AACbxB,SAAG;AAAE6lB,aAAK;AAAP,OADU;AAEb6E,eAAS;AAAE7E,aAAK;AAAP,OAFI;AAGbgX,cAAQ,IAHK;AAIbj7B,WAAKW;AAJQ,KAAd;AAOA,WAAO,KAAK8E,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDiwB,sBAAoBv6B,MAApB,EAA4BsK,OAA5B,EAAqC;AACpC,UAAMrL,QAAQ;AACbkpB,eAAS;AAAE7E,aAAK;AAAP,OADI;AAEbkX,iBAAW,IAFE;AAGbn7B,WAAKW;AAHQ,KAAd;AAMA,WAAO,KAAK8E,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDmwB,mBAAiBnwB,OAAjB,EAA0B;AACzB,QAAIA,WAAW,IAAf,EAAqB;AAAEA,gBAAU,EAAV;AAAe;;AACtC,UAAMrL,QAAQ;AAAEiD,UAAI;AAAEwuB,iBAAS;AAAX;AAAN,KAAd;AACApmB,YAAQ4f,IAAR,GAAe;AAAEhoB,UAAI,CAAC;AAAP,KAAf;AACAoI,YAAQif,KAAR,GAAgB,CAAhB;AACA,UAAM,CAAChe,OAAD,IAAY,KAAKzG,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,EAA0BgM,KAA1B,EAAlB;AACA,WAAO/K,WAAWA,QAAQrJ,EAA1B;AACA;;AAEDw4B,4BAA0Br7B,GAA1B,EAA+Bs7B,UAA/B,EAA2CrwB,OAA3C,EAAoD;AACnD,UAAMrL,QAAQ;AACbI,SADa;AAEb3B,WAAK;AACJulB,aAAK0X;AADD;AAFQ,KAAd;AAOA,WAAO,KAAK71B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDswB,gCAA8BC,UAA9B,EAA0CC,OAA1C,EAAmD;AAClD,UAAM77B,QAAQ;AACb47B,gBADa;AAEbC;AAFa,KAAd;AAKA,WAAO,KAAK17B,OAAL,CAAaH,KAAb,CAAP;AACA;;AAED87B,mBAAiBD,OAAjB,EAA0B;AACzB,UAAM77B,QAAQ;AAAC67B;AAAD,KAAd;AAEA,WAAO,KAAK17B,OAAL,CAAaH,KAAb,CAAP;AACA;;AAEDupB,8CAA4CnpB,GAA5C,EAAiDiZ,SAAjD,EAA4D;AAC3D,UAAMrZ,QAAQ;AACbI,SADa;AAEb8oB,eAAS;AAAE7E,aAAK;AAAP,OAFI;AAGb7lB,SAAG;AAAEizB,iBAAS;AAAX;AAHU,KAAd;;AAMA,QAAIpY,SAAJ,EAAe;AACdrZ,YAAMvB,GAAN,GAAY;AAAE4lB,aAAKhL;AAAP,OAAZ;AACA;;AAED,UAAMhO,UAAU;AACf4f,YAAM;AACLhoB,YAAI,CAAC;AADA;AADS,KAAhB;AAMA,WAAO,KAAK9C,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA;;AAEDwd,4BAA0BpqB,GAA1B,EAA+B;AAC9B,UAAMs9B,KAAKzgC,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCte,OAAOI,MAAP,EAApC,CAAX;AACA,UAAMg0B,SAAS,KAAK9V,WAAL,CAAiB/d,GAAjB,CAAf;AACA6zB,WAAOpJ,OAAP,GAAiB,IAAjB;AACAoJ,WAAO0J,MAAP,GAAgB1J,OAAO7zB,GAAvB;AACA6zB,WAAOxY,QAAP,GAAkB,IAAI5W,IAAJ,EAAlB;AACAovB,WAAOiD,QAAP,GAAkB;AACjB92B,WAAKP,OAAOI,MAAP,EADY;AAEjBsB,gBAAUm8B,GAAGn8B;AAFI,KAAlB;AAIA,WAAO0yB,OAAO7zB,GAAd;AACA,WAAO,KAAKwxB,MAAL,CAAYqC,MAAZ,CAAP;AACA,GA5TqE,CA8TtE;;;AACAxJ,gBAAcrqB,GAAd,EAAmBiyB,MAAnB,EAA2B;AAC1B,QAAIA,UAAU,IAAd,EAAoB;AAAEA,eAAS,IAAT;AAAgB;;AACtC,UAAM1wB,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACLC,iBAASwH;AADJ;AADQ,KAAf;AAMA,WAAO,KAAK1H,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDQ,0BAAwB/qB,GAAxB,EAA6BY,IAA7B,EAAmC;AAClC,UAAMW,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACLpd,aAAK,EADA;AAELrN,WAAG,IAFE;AAGLuxB,cAAM,EAHD;AAIL9U,kBAAU,EAJL;AAKLiD,qBAAa,EALR;AAML+d,mBAAW,EANN;AAOLniB,kBAAU,IAAI5W,IAAJ,EAPL;AAQLqyB,kBAAU;AACT92B,eAAKY,KAAKZ,GADD;AAETmB,oBAAUP,KAAKO;AAFN;AARL;AADQ,KAAf;AAgBA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDkT,yBAAuBz9B,GAAvB,EAA4B09B,QAA5B,EAAsCd,MAAtC,EAA8Ce,QAA9C,EAAwD;AACvD,QAAIf,UAAU,IAAd,EAAoB;AAAEA,eAAS,IAAT;AAAgB;;AACtC,QAAIe,YAAY,IAAhB,EAAsB;AAAEA,iBAAW,CAAX;AAAe;;AACvC,UAAMp8B,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACLoS,cADK;AAELe,kBAAUA,YAAY,IAAIl5B,IAAJ,EAFjB;AAGLi5B;AAHK;AADQ,KAAf;AAQA,WAAO,KAAKnT,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDqT,4BAA0B/vB,OAA1B,EAAmCgwB,WAAnC,EAAgDC,WAAhD,EAA6DhB,SAA7D,EAAwEiB,WAAxE,EAAqF;AACpF,QAAIjB,aAAa,IAAjB,EAAuB;AAAEA,kBAAY,IAAZ;AAAmB;;AAC5C,QAAIiB,eAAe,IAAnB,EAAyB;AAAEA,oBAAc,CAAd;AAAkB;;AAC7C,UAAMx8B,QAAQ;AAACvB,WAAK6N,QAAQ7N;AAAd,KAAd;AAEA,UAAMoN,MAAO,SAASS,QAAQT,GAAK,QAAnC;AAEA,UAAMmd,SAAS;AACdC,YAAM;AACLpd,WADK;AAEL0vB,iBAFK;AAGLiB,qBAAaA,eAAe,IAAIt5B,IAAJ,EAHvB;AAILq5B,mBAJK;AAKLD;AALK;AADQ,KAAf;AAUA,WAAO,KAAKtT,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDyT,cAAYh+B,GAAZ,EAAiBsxB,IAAjB,EAAuB;AACtB,UAAM/vB,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACL8G;AADK;AADQ,KAAf;AAMA,WAAO,KAAK/G,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDmL,6BAA2B71B,MAA3B,EAAmCsB,QAAnC,EAA6C;AAC5C,UAAMI,QAAQ;AAAC,eAAS1B;AAAV,KAAd;AAEA,UAAM0qB,SAAS;AACdC,YAAM;AACL,sBAAcrpB;AADT;AADQ,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDtI,+BAA6B91B,MAA7B,EAAqCsB,QAArC,EAA+C;AAC9C,UAAMI,QAAQ;AAAC,sBAAgB1B;AAAjB,KAAd;AAEA,UAAM0qB,SAAS;AACdC,YAAM;AACL,6BAAqBrpB;AADhB;AADQ,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDnI,sDAAoD91B,GAApD,EAAyDk+B,WAAzD,EAAsEC,WAAtE,EAAmFC,UAAnF,EAA+F;AAC9F,UAAM78B,QAAQ;AACbvB,SADa;AAEb,2BAAqBk+B;AAFR,KAAd;AAKA,UAAM3T,SAAS;AACdC,YAAM;AACL,+BAAuB2T,WADlB;AAEL,eAAOC;AAFF;AADQ,KAAf;AAOA,WAAO,KAAK7T,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAED8T,qBAAmBr+B,GAAnB,EAAwBH,MAAxB,EAAgCouB,OAAhC,EAAyC;AACxC,QAAI1D,MAAJ;AACA,UAAMhpB,QAAQ;AAACvB;AAAD,KAAd;;AAEA,QAAIiuB,OAAJ,EAAa;AACZ1D,eAAS;AACRyG,mBAAW;AACV/C,mBAAS;AAAEjuB,iBAAKH;AAAP;AADC;AADH,OAAT;AAKA,KAND,MAMO;AACN0qB,eAAS;AACR+T,eAAO;AACNrQ,mBAAS;AAAEjuB,iBAAKP,OAAOI,MAAP;AAAP;AADH;AADC,OAAT;AAKA;;AAED,WAAO,KAAK0qB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDgU,uBAAqB;AACpB,UAAMh9B,QAAQ;AAACi9B,WAAK;AAAExL,iBAAS;AAAX;AAAN,KAAd;AAEA,UAAMzI,SAAS;AACdkU,eAAS;AACR,eAAO;AADC;AADK,KAAf;AAMA,WAAO,KAAKlU,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDS,wBAAsB1+B,GAAtB,EAA2Byf,WAA3B,EAAwC;AACvC,UAAMle,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACL/K;AADK;AADQ,KAAf;AAMA,WAAO,KAAK8K,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDoU,0BAAwB3+B,GAAxB,EAA6Bm9B,UAA7B,EAAyCC,OAAzC,EAAkD;AACjD,UAAM77B,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACL2S,kBADK;AAELC;AAFK;AADQ,KAAf;AAOA,WAAO,KAAK7S,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA,GAlfqE,CAqftE;;;AACAqU,qCAAmC91B,IAAnC,EAAyCxG,MAAzC,EAAiDuL,OAAjD,EAA0DjN,IAA1D,EAAgEyoB,SAAhE,EAA2E;AAC1E,UAAM/pB,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCzb,MAApC,EAA4C;AAAEP,cAAQ;AAAEynB,gBAAQ;AAAV;AAAV,KAA5C,CAAb;;AACA,QAAI,CAAClqB,QAAQ,IAAR,GAAeA,KAAKkqB,MAApB,GAA6BjZ,SAA9B,MAA6C,KAAjD,EAAwD;AACvD;AACA;;AACD,UAAMsjB,SAAS;AACd9zB,SAAG+I,IADW;AAEdnH,WAAKW,MAFS;AAGdkC,UAAI,IAAIC,IAAJ,EAHU;AAId2I,WAAKS,OAJS;AAKdK,SAAG;AACFlO,aAAKY,KAAKZ,GADR;AAEFmB,kBAAUP,KAAKO;AAFb,OALW;AASduc,iBAAW;AATG,KAAf;;AAYA,QAAI7gB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,8BAAxB,CAAJ,EAA6D;AAC5D2xB,aAAOxwB,MAAP,GAAgB,IAAhB;AACA;;AAEDgB,MAAE0nB,MAAF,CAAS8H,MAAT,EAAiBxK,SAAjB;;AAEAwK,WAAO7zB,GAAP,GAAa,KAAK25B,cAAL,CAAoB9F,MAApB,CAAb;AACAh3B,eAAWC,MAAX,CAAkB6M,KAAlB,CAAwB6R,eAAxB,CAAwClc,KAAKU,GAA7C,EAAkD,CAAlD;AACA,WAAO6zB,MAAP;AACA;;AAEDzL,kCAAgC9lB,MAAhC,EAAwC1B,IAAxC,EAA8CyoB,SAA9C,EAAyD;AACxD,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,IAAxC,EAA8Ct8B,MAA9C,EAAsDuL,OAAtD,EAA+DjN,IAA/D,EAAqEyoB,SAArE,CAAP;AACA;;AAEDuF,mCAAiCtsB,MAAjC,EAAyC1B,IAAzC,EAA+CyoB,SAA/C,EAA0D;AACzD,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,IAAxC,EAA8Ct8B,MAA9C,EAAsDuL,OAAtD,EAA+DjN,IAA/D,EAAqEyoB,SAArE,CAAP;AACA;;AAEDwV,qCAAmCv8B,MAAnC,EAA2C1B,IAA3C,EAAiDyoB,SAAjD,EAA4D;AAC3D,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,IAAxC,EAA8Ct8B,MAA9C,EAAsDuL,OAAtD,EAA+DjN,IAA/D,EAAqEyoB,SAArE,CAAP;AACA;;AAEDd,mCAAiCjmB,MAAjC,EAAyC1B,IAAzC,EAA+CyoB,SAA/C,EAA0D;AACzD,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,IAAxC,EAA8Ct8B,MAA9C,EAAsDuL,OAAtD,EAA+DjN,IAA/D,EAAqEyoB,SAArE,CAAP;AACA;;AAEDwF,iCAA+BliB,OAA/B,EAAwCrK,MAAxC,EAAgD1B,IAAhD,EAAsDyoB,SAAtD,EAAiE;AAChE,WAAO,KAAKuV,kCAAL,CAAwC,SAAxC,EAAmDt8B,MAAnD,EAA2DqK,OAA3D,EAAoE/L,IAApE,EAA0EyoB,SAA1E,CAAP;AACA;;AAEDyV,mCAAiCx8B,MAAjC,EAAyC1B,IAAzC,EAA+CyoB,SAA/C,EAA0D;AACzD,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,YAAxC,EAAsDt8B,MAAtD,EAA8DuL,OAA9D,EAAuEjN,IAAvE,EAA6EyoB,SAA7E,CAAP;AACA;;AAED0V,qCAAmCz8B,MAAnC,EAA2C1B,IAA3C,EAAiDyoB,SAAjD,EAA4D;AAC3D,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,cAAxC,EAAwDt8B,MAAxD,EAAgEuL,OAAhE,EAAyEjN,IAAzE,EAA+EyoB,SAA/E,CAAP;AACA;;AAED2V,sCAAoC18B,MAApC,EAA4C1B,IAA5C,EAAkDyoB,SAAlD,EAA6D;AAC5D,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,eAAxC,EAAyDt8B,MAAzD,EAAiEuL,OAAjE,EAA0EjN,IAA1E,EAAgFyoB,SAAhF,CAAP;AACA;;AAED4V,0CAAwC38B,MAAxC,EAAgD1B,IAAhD,EAAsDyoB,SAAtD,EAAiE;AAChE,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,mBAAxC,EAA6Dt8B,MAA7D,EAAqEuL,OAArE,EAA8EjN,IAA9E,EAAoFyoB,SAApF,CAAP;AACA;;AAED6V,kCAAgC58B,MAAhC,EAAwC1B,IAAxC,EAA8CyoB,SAA9C,EAAyD;AACxD,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,WAAxC,EAAqDt8B,MAArD,EAA6DuL,OAA7D,EAAsEjN,IAAtE,EAA4EyoB,SAA5E,CAAP;AACA;;AAED8V,sCAAoC78B,MAApC,EAA4C1B,IAA5C,EAAkDyoB,SAAlD,EAA6D;AAC5D,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,eAAxC,EAAyDt8B,MAAzD,EAAiEuL,OAAjE,EAA0EjN,IAA1E,EAAgFyoB,SAAhF,CAAP;AACA;;AAED+V,mCAAiC98B,MAAjC,EAAyC1B,IAAzC,EAA+CyoB,SAA/C,EAA0D;AACzD,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,YAAxC,EAAsDt8B,MAAtD,EAA8DuL,OAA9D,EAAuEjN,IAAvE,EAA6EyoB,SAA7E,CAAP;AACA;;AAEDgW,uCAAqC/8B,MAArC,EAA6C1B,IAA7C,EAAmDyoB,SAAnD,EAA8D;AAC7D,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,gBAAxC,EAA0Dt8B,MAA1D,EAAkEuL,OAAlE,EAA2EjN,IAA3E,EAAiFyoB,SAAjF,CAAP;AACA;;AAEDiW,+CAA6Ch9B,MAA7C,EAAqD1B,IAArD,EAA2DyoB,SAA3D,EAAsE;AACrE,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,yBAAxC,EAAmEt8B,MAAnE,EAA2EuL,OAA3E,EAAoFjN,IAApF,EAA0FyoB,SAA1F,CAAP;AACA;;AAEDkW,iDAA+Cj9B,MAA/C,EAAuD1B,IAAvD,EAA6DyoB,SAA7D,EAAwE;AACvE,UAAMxb,UAAUjN,KAAKO,QAArB;AACA,WAAO,KAAKy9B,kCAAL,CAAwC,2BAAxC,EAAqEt8B,MAArE,EAA6EuL,OAA7E,EAAsFjN,IAAtF,EAA4FyoB,SAA5F,CAAP;AACA,GA1lBqE,CA4lBtE;;;AACAqB,aAAW1qB,GAAX,EAAgB;AACf,UAAMuB,QAAQ;AAACvB;AAAD,KAAd;AAEA,WAAO,KAAKsH,MAAL,CAAY/F,KAAZ,CAAP;AACA;;AAED8pB,iBAAe/oB,MAAf,EAAuB;AACtB,UAAMf,QAAQ;AAACI,WAAKW;AAAN,KAAd;AAEA,WAAO,KAAKgF,MAAL,CAAY/F,KAAZ,CAAP;AACA;;AAED2pB,iBAAerrB,MAAf,EAAuB;AACtB,UAAM0B,QAAQ;AAAC,eAAS1B;AAAV,KAAd;AAEA,WAAO,KAAKyH,MAAL,CAAY/F,KAAZ,CAAP;AACA;;AAEDi+B,qBAAmBC,MAAnB,EAA2B;AAC1B,WAAO,KAAK/9B,OAAL,CAAa;AAAE,kBAAY+9B;AAAd,KAAb,CAAP;AACA;;AAEDC,YAAU/9B,GAAV,EAAeg+B,KAAf,EAAsB;AACrB,WAAO,KAAKpV,MAAL,CAAY;AAClB5oB,SADkB;AAElB0B,cAAQ,IAFU;AAGlBmB,UAAI;AAAEy3B,aAAK0D;AAAP;AAHc,KAAZ,EAIJ;AACF5M,cAAQ;AACP1vB,gBAAQ;AADD;AADN,KAJI,EAQJ;AACF46B,aAAO;AADL,KARI,CAAP;AAWA;;AAED2B,gBAAc5/B,GAAd,EAAmB;AAClB,WAAO,KAAKuqB,MAAL,CAAY;AAClBvqB;AADkB,KAAZ,EAEJ;AACF+yB,cAAQ;AACP1vB,gBAAQ;AADD;AADN,KAFI,CAAP;AAOA;;AAEDw8B,kCAAgCl+B,GAAhC,EAAqCm+B,KAArC,EAA4C;AAC3C,UAAMv+B,QAAQ;AACb8B,cAAQ,IADK;AAEb1B;AAFa,KAAd;;AAKA,QAAIm+B,KAAJ,EAAW;AACVv+B,YAAMiD,EAAN,GAAW;AAAEq3B,aAAKiE;AAAP,OAAX;AACA;;AAED,WAAO,KAAK14B,IAAL,CAAU7F,KAAV,EAAiB;AACvBQ,cAAQ;AACP/B,aAAK;AADE;AADe,KAAjB,CAAP;AAKA;;AA1pBqE,CAA1C,EAA7B,C;;;;;;;;;;;ACFA,IAAIqE,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAENC,WAAWC,MAAX,CAAkBijC,OAAlB,GAA4B,IAAI,cAAcljC,WAAWC,MAAX,CAAkBs9B,KAAhC,CAAsC;AACrEp8B,gBAAc;AACb,UAAM,SAAN;AACA;;AACDgiC,wCAAsCnyB,OAAtC,EAA+ChB,WAA/C,EAA4DhN,MAA5D,EAAoEwpB,SAApE,EAA+E;AAC9E,UAAMwK,SAAS;AACdhmB,aADc;AAEdhB,iBAFc;AAGdrI,UAAI,IAAIC,IAAJ,EAHU;AAId5E;AAJc,KAAf;;AAMAwE,MAAE0nB,MAAF,CAAS8H,MAAT,EAAiBxK,SAAjB;;AACAwK,WAAO7zB,GAAP,GAAa,KAAKwxB,MAAL,CAAYqC,MAAZ,CAAb;AACA,WAAOA,MAAP;AACA;;AAdoE,CAA1C,EAA5B,C;;;;;;;;;;;ACFA,IAAIxvB,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAGpE,MAAMqjC,UAAN,SAAyBpjC,WAAWC,MAAX,CAAkBs9B,KAA3C,CAAiD;AAChDp8B,gBAAc;AACb,UAAM,GAAG6T,SAAT;AAEA,SAAKmoB,cAAL,CAAoB;AAAE,cAAQ;AAAV,KAApB,EAAmC;AAAEhd,cAAQ,CAAV;AAAaqe,cAAQ;AAArB,KAAnC;AACA,SAAKrB,cAAL,CAAoB;AAAE,iBAAW;AAAb,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,mBAAa;AAAf,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,WAAK;AAAP,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,eAAS;AAAX,KAApB;AAEA,SAAKd,KAAL,CAAWgH,mBAAX,GAAiC,CAAC,MAAD,EAAS,IAAT,CAAjC;AACA,SAAKhH,KAAL,CAAWY,WAAX,CAAuB,CAAC,GAAD,EAAM,MAAN,CAAvB,EAAsC,QAAtC;AACA,SAAKZ,KAAL,CAAWtsB,OAAX,GAAqB;AAAC7K,cAAQ;AAACU,mBAAW;AAAZ;AAAT,KAArB;AACA;;AAED4qB,oBAAkB8S,SAAlB,EAA6BvzB,OAA7B,EAAsC;AACrC,UAAMrL,QAAQ;AACbgsB,WAAK,CAAC;AACLvtB,aAAKmgC;AADA,OAAD,EAEF;AACFliC,cAAMkiC;AADJ,OAFE;AADQ,KAAd;AAQA,WAAO,KAAKz+B,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA;;AAEDwzB,oBAAkBpgC,GAAlB,EAAuB4M,OAAvB,EAAgC;AAC/B,UAAMrL,QAAQ;AAAC8+B,iBAAWrgC;AAAZ,KAAd;AAEA,WAAO,KAAK0B,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA;;AAEDxC,gBAAcnM,IAAd,EAAoB2O,OAApB,EAA6B;AAC5B,UAAMrL,QAAQ;AAACtD;AAAD,KAAd;AAEA,WAAO,KAAKyD,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA;;AAEDrC,wBAAsBtM,IAAtB,EAA4B0D,GAA5B,EAAiC;AAChC,UAAMJ,QAAQ;AACbvB,WAAK;AAAE4lB,aAAKjkB;AAAP,OADQ;AAEb1D;AAFa,KAAd;AAKA,WAAO,KAAKyD,OAAL,CAAaH,KAAb,CAAP;AACA;;AAEDqI,uBAAqB5H,KAArB,EAA4B4K,OAA5B,EAAqC;AACpC,UAAMrL,QAAQ;AAACS;AAAD,KAAd;AAEA,WAAO,KAAKN,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA;;AAED0zB,uBAAqBriC,IAArB,EAA2B6K,IAA3B,EAAiC8D,OAAjC,EAA0C;AACzC,UAAMrL,QAAQ;AACbtD,UADa;AAEb8B,SAAG+I;AAFU,KAAd;AAKA,WAAO,KAAKpH,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA;;AAED2zB,gCAA8BvgC,GAA9B,EAAmCmB,QAAnC,EAA6CyL,OAA7C,EAAsD;AACrD,UAAMrL,QAAQ;AACbvB,SADa;AAEbyC,iBAAWtB;AAFE,KAAd;AAKA,WAAO,KAAKO,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA;;AAED4zB,4CAA0CviC,IAA1C,EAAgD6K,IAAhD,EAAsD3H,QAAtD,EAAgEyL,OAAhE,EAAyE;AACxE,UAAMrL,QAAQ;AACbtD,UADa;AAEb8B,SAAG+I,IAFU;AAGbrG,iBAAW;AACVmjB,aAAKzkB;AADK;AAHE,KAAd;AAQA,WAAO,KAAKO,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA,GAlF+C,CAqFhD;;;AAEA6zB,WAASn+B,MAAT,EAAiBsK,OAAjB,EAA0B;AACzB,WAAO,KAAKxF,IAAL,CAAU;AAAEpH,WAAKsC;AAAP,KAAV,EAA2BsK,OAA3B,CAAP;AACA;;AAED8zB,YAAUC,OAAV,EAAmB/zB,OAAnB,EAA4B;AAC3B,WAAO,KAAKxF,IAAL,CAAU;AAAEpH,WAAK;AAACulB,aAAK,GAAGhf,MAAH,CAAUo6B,OAAV;AAAN;AAAP,KAAV,EAA8C/zB,OAA9C,CAAP;AACA;;AAEDg0B,aAAW93B,IAAX,EAAiB8D,OAAjB,EAA0B;AACzB,UAAMrL,QAAQ;AAACxB,SAAG+I;AAAJ,KAAd;AAEA,WAAO,KAAK1B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDi0B,cAAYjyB,KAAZ,EAAmBhC,OAAnB,EAA4B;AAC3B,UAAMrL,QAAQ;AACbxB,SAAG;AACFwlB,aAAK3W;AADH;AADU,KAAd;AAMA,WAAO,KAAKxH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDwe,eAAavrB,MAAb,EAAqB+M,OAArB,EAA8B;AAC7B,UAAMrL,QAAQ;AAAC,eAAS1B;AAAV,KAAd;AAEA,WAAO,KAAKuH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDk0B,2BAAyBjhC,MAAzB,EAAiC+M,OAAjC,EAA0C;AACzC,QAAIlC,IAAJ;;AACA,QAAI,KAAKouB,QAAT,EAAmB;AAClBpuB,aAAO7N,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC6oB,YAAhC,CAA6CvrB,MAA7C,EAAqD+Y,KAArD,EAAP;AACAlO,aAAOA,KAAK9E,GAAL,CAAS,UAASO,IAAT,EAAe;AAC9B,YAAIA,KAAK46B,KAAT,EAAgB;AACf,iBAAO56B,KAAK46B,KAAZ;AACA;;AACDz4B,gBAAQC,GAAR,CAAY,6BAAZ,EAA2CpC,IAA3C;AACA,OALM,CAAP;AAMAuE,aAAOA,KAAKvB,MAAL,CAAYhD,QAAQA,IAApB,CAAP;AACA,aAAO,KAAKozB,aAAL,CAAmB,KAAKF,2BAAL,CAAiC3uB,IAAjC,EAAuCkC,OAAvC,CAAnB,CAAP;AACA;;AAEDlC,WAAO7N,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC6oB,YAAhC,CAA6CvrB,MAA7C,EAAqD;AAACkC,cAAQ;AAACJ,aAAK;AAAN;AAAT,KAArD,EAAyEiX,KAAzE,EAAP;AACAlO,WAAOA,KAAK9E,GAAL,CAASO,QAAQA,KAAKxE,GAAtB,CAAP;AAEA,UAAMJ,QAAQ;AACbvB,WAAK;AACJulB,aAAK7a;AADD;AADQ,KAAd;AAMA,WAAO,KAAKtD,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDo0B,uCAAqCnhC,MAArC,EAA6Ck8B,UAA7C,EAAyDnvB,OAAzD,EAAkE;AACjE,QAAI,KAAKksB,QAAT,EAAmB;AAClB,UAAIpuB,OAAO7N,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC6oB,YAAhC,CAA6CvrB,MAA7C,EAAqD+Y,KAArD,EAAX;AACAlO,aAAOA,KAAK9E,GAAL,CAAS,UAASO,IAAT,EAAe;AAC9B,YAAIA,KAAK46B,KAAT,EAAgB;AACf,iBAAO56B,KAAK46B,KAAZ;AACA;;AACDz4B,gBAAQC,GAAR,CAAY,6BAAZ,EAA2CpC,IAA3C;AACA,OALM,CAAP;AAMAuE,aAAOA,KAAKvB,MAAL,CAAYhD,QAAQA,QAAQA,KAAK41B,UAAL,GAAkBA,UAA9C,CAAP;AACA,aAAO,KAAKxC,aAAL,CAAmB,KAAKF,2BAAL,CAAiC3uB,IAAjC,EAAuCkC,OAAvC,CAAnB,CAAP;AACA;;AAED,QAAI8sB,MAAM78B,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC6oB,YAAhC,CAA6CvrB,MAA7C,EAAqD;AAACkC,cAAQ;AAACJ,aAAK;AAAN;AAAT,KAArD,EAAyEiX,KAAzE,EAAV;AACA8gB,UAAMA,IAAI9zB,GAAJ,CAAQO,QAAQA,KAAKxE,GAArB,CAAN;AAEA,UAAMJ,QAAQ;AACbvB,WAAK;AACJulB,aAAKmU;AADD,OADQ;AAIbqC,kBAAY;AACXF,aAAKE;AADM;AAJC,KAAd;AASA,WAAO,KAAK30B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDq0B,uBAAqBhjC,IAArB,EAA2B2O,OAA3B,EAAoC;AACnC,UAAMs0B,YAAY,IAAIh3B,MAAJ,CAAW5G,EAAEM,IAAF,CAAON,EAAE2Y,YAAF,CAAehe,IAAf,CAAP,CAAX,EAAyC,GAAzC,CAAlB;AAEA,UAAMsD,QAAQ;AACbgsB,WAAK,CACJ;AAACtvB,cAAMijC;AAAP,OADI,EAEJ;AACCnhC,WAAG,GADJ;AAEC0C,mBAAWy+B;AAFZ,OAFI;AADQ,KAAd;AAUA,WAAO,KAAK95B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDu0B,wCAAsCljC,IAAtC,EAA4C2Q,KAA5C,EAAmDhC,OAAnD,EAA4D;AAC3D,UAAMs0B,YAAY,IAAIh3B,MAAJ,CAAW5G,EAAEM,IAAF,CAAON,EAAE2Y,YAAF,CAAehe,IAAf,CAAP,CAAX,EAAyC,GAAzC,CAAlB;AAEA,UAAMsvB,MAAM,EAAZ;;AACA,SAAK,MAAMzkB,IAAX,IAAmB4I,MAAM4E,IAAN,CAAW1H,KAAX,CAAnB,EAAsC;AACrC,YAAMwyB,MAAM;AAACnjC,cAAMijC,SAAP;AAAkBnhC,WAAG+I,KAAKA;AAA1B,OAAZ;;AACA,UAAIA,KAAK3H,QAAL,IAAiB,IAArB,EAA2B;AAC1BigC,YAAI3+B,SAAJ,GAAgBqG,KAAK3H,QAArB;AACA;;AACD,UAAI2H,KAAK4wB,GAAL,IAAY,IAAhB,EAAsB;AACrB0H,YAAIphC,GAAJ,GAAU;AAACulB,eAAKzc,KAAK4wB;AAAX,SAAV;AACA;;AACDnM,UAAIloB,IAAJ,CAAS+7B,GAAT;AACA;;AAED,UAAM7/B,QAAQ;AAACgsB;AAAD,KAAd;AAEA,WAAO,KAAKnmB,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDy0B,kCAAgCzyB,KAAhC,EAAuChC,OAAvC,EAAgD;AAE/C,UAAM2gB,MAAM,EAAZ;;AACA,SAAK,MAAMzkB,IAAX,IAAmB4I,MAAM4E,IAAN,CAAW1H,KAAX,CAAnB,EAAsC;AACrC,YAAMwyB,MAAM;AAACrhC,WAAG+I,KAAKA;AAAT,OAAZ;;AACA,UAAIA,KAAK3H,QAAL,IAAiB,IAArB,EAA2B;AAC1BigC,YAAI3+B,SAAJ,GAAgBqG,KAAK3H,QAArB;AACA;;AACD,UAAI2H,KAAK4wB,GAAL,IAAY,IAAhB,EAAsB;AACrB0H,YAAIphC,GAAJ,GAAU;AAACulB,eAAKzc,KAAK4wB;AAAX,SAAV;AACA;;AACDnM,UAAIloB,IAAJ,CAAS+7B,GAAT;AACA;;AAED,UAAM7/B,QAAQ;AAACgsB;AAAD,KAAd;AAEA,WAAO,KAAKnmB,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED00B,+BAA6BrjC,IAA7B,EAAmC2Q,KAAnC,EAA0ChC,OAA1C,EAAmD;AAClD,UAAMs0B,YAAY,IAAIh3B,MAAJ,CAAW5G,EAAEM,IAAF,CAAON,EAAE2Y,YAAF,CAAehe,IAAf,CAAP,CAAX,EAAyC,GAAzC,CAAlB;AAEA,UAAMsD,QAAQ;AACbxB,SAAG;AACFwlB,aAAK3W;AADH,OADU;AAIb2e,WAAK,CACJ;AAACtvB,cAAMijC;AAAP,OADI,EAEJ;AACCnhC,WAAG,GADJ;AAEC0C,mBAAWy+B;AAFZ,OAFI;AAJQ,KAAd;AAaA,WAAO,KAAK95B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED20B,oBAAkBtjC,IAAlB,EAAwB6K,IAAxB,EAA8B8D,OAA9B,EAAuC;AACtC,UAAMrL,QAAQ;AACbxB,SAAG+I,IADU;AAEb7K;AAFa,KAAd,CADsC,CAMtC;;AACA,WAAO,KAAK86B,GAAL,CAAS3xB,IAAT,CAAc7F,KAAd,EAAqBqL,OAArB,CAAP;AACA;;AAED40B,8BAA4BvjC,IAA5B,EAAkC6K,IAAlC,EAAwC8D,OAAxC,EAAiD;AAChD,UAAMrL,QAAQ;AACbxB,SAAG+I,IADU;AAEb7K,UAFa;AAGbtB,eAAS;AACRipB,aAAK;AADG;AAHI,KAAd,CADgD,CAShD;;AACA,WAAO,KAAKmT,GAAL,CAAS3xB,IAAT,CAAc7F,KAAd,EAAqBqL,OAArB,CAAP;AACA;;AAED60B,0CAAwCxjC,IAAxC,EAA8C2Q,KAA9C,EAAqDzN,QAArD,EAA+DyL,OAA/D,EAAwE;AACvE,UAAMrL,QAAQ;AACbxB,SAAG;AACFwlB,aAAK3W;AADH,OADU;AAIb3Q,UAJa;AAKbwE,iBAAW;AACVmjB,aAAKzkB;AADK;AALE,KAAd,CADuE,CAWvE;;AACA,WAAO,KAAK43B,GAAL,CAAS3xB,IAAT,CAAc7F,KAAd,EAAqBqL,OAArB,CAAP;AACA;;AAED80B,6BAA2BzjC,IAA3B,EAAiC2Q,KAAjC,EAAwChC,OAAxC,EAAiD;AAChD,UAAMs0B,YAAY,IAAIh3B,MAAJ,CAAY,IAAI5G,EAAEM,IAAF,CAAON,EAAE2Y,YAAF,CAAehe,IAAf,CAAP,CAA8B,EAA9C,EAAiD,GAAjD,CAAlB;AAEA,UAAMsD,QAAQ;AACbxB,SAAG;AACFwlB,aAAK3W;AADH,OADU;AAIb2e,WAAK,CACJ;AAACtvB,cAAMijC;AAAP,OADI,EAEJ;AACCnhC,WAAG,GADJ;AAEC0C,mBAAWy+B;AAFZ,OAFI;AAJQ,KAAd;AAaA,WAAO,KAAK95B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED+a,wBAAsBrX,YAAtB,EAAoC1B,KAApC,EAA2ChC,OAA3C,EAAoD;AACnD,UAAMrL,QAAQ;AACb5E,eAAS2T,YADI;AAEbvQ,SAAG;AACFwlB,aAAK3W;AADH;AAFU,KAAd;AAOA,WAAO,KAAKxH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED+0B,+BAA6B74B,IAA7B,EAAmC3H,QAAnC,EAA6CyL,OAA7C,EAAsD;AACrD,UAAMrL,QAAQ;AACbxB,SAAG+I,IADU;AAEbrG,iBAAWtB;AAFE,KAAd;AAKA,WAAO,KAAKiG,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDg1B,gCAA8B94B,IAA9B,EAAoC3H,QAApC,EAA8CyL,OAA9C,EAAuD;AACtD,UAAMrL,QAAQ;AACbxB,SAAG+I,IADU;AAEbrG,iBAAW;AAAEo/B,cAAM,GAAGt7B,MAAH,CAAUpF,QAAV;AAAR;AAFE,KAAd;AAKA,WAAO,KAAKiG,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDk1B,4CAA0ClzB,KAA1C,EAAiD/O,MAAjD,EAAyDsB,QAAzD,EAAmEyL,OAAnE,EAA4E;AAC3E,UAAMrL,QAAQ;AACbxB,SAAG;AACFwlB,aAAK3W;AADH,OADU;AAIbmzB,WAAK;AACJnc,aAAK/lB;AADD,OAJQ;AAOb4C,iBAAWtB;AAPE,KAAd;AAUA,WAAO,KAAKiG,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDo1B,2BAAyB7gC,QAAzB,EAAmCyL,OAAnC,EAA4C;AAC3C,UAAMrL,QAAQ;AAACkB,iBAAWtB;AAAZ,KAAd;AAEA,WAAO,KAAKiG,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDq1B,oBAAkBn5B,IAAlB,EAAwB7K,IAAxB,EAA8B2O,OAA9B,EAAuC;AACtC,QAAI,KAAKksB,QAAT,EAAmB;AAClB,aAAO,KAAKI,KAAL,CAAWgJ,WAAX,CAAuB,QAAvB,EAAiC,CAACp5B,IAAD,EAAO7K,IAAP,CAAjC,EAA+C2O,OAA/C,CAAP;AACA;;AAED,UAAMrL,QAAQ;AACbtD,UADa;AAEb8B,SAAG+I;AAFU,KAAd;AAKA,WAAO,KAAK1B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDu1B,sCAAoCr5B,IAApC,EAA0C7K,IAA1C,EAAgDkD,QAAhD,EAA0DyL,OAA1D,EAAmE;AAClE,UAAMrL,QAAQ;AACbtD,UADa;AAEb8B,SAAG+I,IAFU;AAGbrG,iBAAWtB;AAHE,KAAd;AAMA,WAAO,KAAKiG,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDw1B,gCAA8Bt5B,IAA9B,EAAoCu5B,gBAApC,EAAsDz1B,OAAtD,EAA+D;AAC9D,UAAMrL,QAAQ;AAACxB,SAAG+I;AAAJ,KAAd;;AAEA,QAAIu5B,gBAAJ,EAAsB;AACrB9gC,YAAMsI,QAAN,GAAiB,IAAjB;AACA,KAFD,MAEO;AACNtI,YAAMsI,QAAN,GAAiB;AAAE+b,aAAK;AAAP,OAAjB;AACA;;AAED,WAAO,KAAKxe,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA,GAhY+C,CAkYhD;;;AACA01B,eAAatiC,GAAb,EAAkBqgC,SAAlB,EAA6B;AAC5BA,gBAAY,GAAG95B,MAAH,CAAU85B,SAAV,CAAZ;AACA,UAAM9+B,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdyG,iBAAW;AACVqP,mBAAW;AACVkC,iBAAOlC;AADG;AADD;AADG,KAAf;AAQA,WAAO,KAAK9V,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAED9B,cAAYzoB,GAAZ,EAAiB;AAChB,UAAMuB,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACL3gB,kBAAU;AADL;AADQ,KAAf;AAMA,WAAO,KAAK0gB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDoM,gBAAc32B,GAAd,EAAmB;AAClB,UAAMuB,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACL3gB,kBAAU;AADL;AADQ,KAAf;AAMA,WAAO,KAAK0gB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDzC,kBAAgB9nB,GAAhB,EAAqBmB,QAArB,EAA+Bmd,KAA/B,EAAsC;AACrC,UAAM/c,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdyG,iBAAW;AACVvuB,mBAAWtB;AADD;AADG,KAAf;;AAMA,QAAImd,KAAJ,EAAW;AACViM,aAAOyG,SAAP,CAAiB1S,KAAjB,GAAyBnd,QAAzB;AACA;;AAED,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDiY,mBAAiBxiC,GAAjB,EAAsByC,SAAtB,EAAiC;AAChC,UAAMlB,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdyG,iBAAW;AACVvuB,mBAAW;AACV8/B,iBAAO9/B;AADG;AADD;AADG,KAAf;AAQA,WAAO,KAAK8nB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDkY,oBAAkBxkC,IAAlB,EAAwBkD,QAAxB,EAAkC;AACjC,UAAMI,QAAQ;AAACtD;AAAD,KAAd;AAEA,UAAMssB,SAAS;AACdyG,iBAAW;AACVvuB,mBAAWtB;AADD;AADG,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDmE,qBAAmB1uB,GAAnB,EAAwBmB,QAAxB,EAAkC;AACjC,UAAMI,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACd+T,aAAO;AACN77B,mBAAWtB;AADL;AADO,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDmY,sBAAoB1iC,GAApB,EAAyByC,SAAzB,EAAoC;AACnC,UAAMlB,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACd+T,aAAO;AACN77B,mBAAW;AACV8iB,eAAK9iB;AADK;AADL;AADO,KAAf;AAQA,WAAO,KAAK8nB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDgB,wBAAsBpqB,QAAtB,EAAgC;AAC/B,UAAMI,QAAQ;AAACkB,iBAAWtB;AAAZ,KAAd;AAEA,UAAMopB,SAAS;AACd+T,aAAO;AACN77B,mBAAWtB;AADL;AADO,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAED0E,uBAAqB1kC,IAArB,EAA2BkD,QAA3B,EAAqC;AACpC,UAAMI,QAAQ;AAACtD;AAAD,KAAd;AAEA,UAAMssB,SAAS;AACd+T,aAAO;AACN77B,mBAAWtB;AADL;AADO,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDqY,cAAY5iC,GAAZ,EAAiB/B,IAAjB,EAAuB+D,KAAvB,EAA8B;AAC7B,UAAMT,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACLvsB,YADK;AAEL+D;AAFK;AADQ,KAAf;AAOA,WAAO,KAAKuoB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAED/O,kBAAgBxb,GAAhB,EAAqBwe,GAArB,EAA0B;AACzB,QAAIA,OAAO,IAAX,EAAiB;AAAEA,YAAM,CAAN;AAAU;;AAC7B,UAAMjd,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdsY,YAAM;AACLC,cAAMtkB;AADD;AADQ,KAAf;AAMA,WAAO,KAAK+L,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDnN,mCAAiCpd,GAAjC,EAAsCwe,GAAtC,EAA2CukB,oBAA3C,EAAiEtnB,WAAjE,EAA8E;AAC7E,QAAI+C,OAAO,IAAX,EAAiB;AAAEA,YAAM,CAAN;AAAU;;AAC7B,UAAMjd,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACLwY,YAAID;AADC,OADQ;AAIdF,YAAM;AACLC,cAAMtkB;AADD;AAJQ,KAAf;;AASA,QAAI/C,WAAJ,EAAiB;AAChB8O,aAAOC,IAAP,CAAY/O,WAAZ,GAA0BA,WAA1B;AACA;;AAED,WAAO,KAAK8O,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAED7O,qBAAmB1b,GAAnB,EAAwByb,WAAxB,EAAqC;AACpC,UAAMla,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACL/O;AADK;AADQ,KAAf;AAMA,WAAO,KAAK8O,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDwL,kBAAgBZ,gBAAhB,EAAkCh0B,QAAlC,EAA4C;AAC3C,UAAMI,QAAQ;AAACkB,iBAAW0yB;AAAZ,KAAd;AAEA,UAAM5K,SAAS;AACdC,YAAM;AACL,uBAAerpB;AADV;AADQ,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDjI,uBAAqBb,gBAArB,EAAuCh0B,QAAvC,EAAiD;AAChD,UAAMI,QAAQ;AAAC+c,aAAO6W;AAAR,KAAd;AAEA,UAAM5K,SAAS;AACdC,YAAM;AACL,mBAAWrpB;AADN;AADQ,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDhI,gCAA8Bp2B,MAA9B,EAAsCsB,QAAtC,EAAgD;AAC/C,UAAMI,QAAQ;AAAC,eAAS1B;AAAV,KAAd;AAEA,UAAM0qB,SAAS;AACdC,YAAM;AACL,sBAAcrpB;AADT;AADQ,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDgF,kBAAgBjjC,GAAhB,EAAqBkjC,QAArB,EAA+B;AAC9B,QAAI3Y,MAAJ;AACA,UAAMhpB,QAAQ;AAACvB;AAAD,KAAd;;AAEA,QAAI,CAACkjC,YAAY,IAAZ,GAAmBA,SAASt/B,IAAT,EAAnB,GAAqC2M,SAAtC,MAAqD,EAAzD,EAA6D;AAC5Dga,eAAS;AACRC,cAAM;AACL2Y,4BAAkB,IADb;AAELD;AAFK;AADE,OAAT;AAMA,KAPD,MAOO;AACN3Y,eAAS;AACRC,cAAM;AACL2Y,4BAAkB;AADb,SADE;AAIRpQ,gBAAQ;AACPmQ,oBAAU;AADH;AAJA,OAAT;AAQA;;AAED,WAAO,KAAK3Y,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAED6Y,cAAYpjC,GAAZ,EAAiBY,IAAjB,EAAuB;AACtB,UAAMW,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACLtc,WAAG;AACFlO,eAAKY,KAAKZ,GADR;AAEFmB,oBAAUP,KAAKO;AAFb;AADE;AADQ,KAAf;AASA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAED8Y,cAAYrjC,GAAZ,EAAiB8I,IAAjB,EAAuB;AACtB,UAAMvH,QAAQ;AAACvB;AAAD,KAAd;AACA,UAAMuqB,SAAS;AACdC,YAAM;AACLzqB,WAAG+I;AADE;AADQ,KAAf;;AAKA,QAAIA,SAAS,GAAb,EAAkB;AACjByhB,aAAOwI,MAAP,GAAgB;AAACp2B,iBAAS;AAAV,OAAhB;AACA;;AAED,WAAO,KAAK4tB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAED+Y,eAAatjC,GAAb,EAAkBujC,KAAlB,EAAyB;AACxB,UAAMhiC,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACL+Y;AADK;AADQ,KAAf;AAMA,WAAO,KAAKhZ,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDiZ,sBAAoBxjC,GAApB,EAAyByjC,YAAzB,EAAuC;AACtC,UAAMliC,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACLiZ;AADK;AADQ,KAAf;AAMA,WAAO,KAAKlZ,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDX,uBAAqB5pB,GAArB,EAA0BmB,QAA1B,EAAoC;AACnC,UAAMI,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdyG,iBAAW;AACV1S,eAAOnd;AADG;AADG,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDmZ,yBAAuB1jC,GAAvB,EAA4BmB,QAA5B,EAAsC;AACrC,UAAMI,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACd+T,aAAO;AACNhgB,eAAOnd;AADD;AADO,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDoZ,kBAAgB3jC,GAAhB,EAAqBsQ,YAArB,EAAmC;AAClC,UAAM/O,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdC,YAAM;AACL7tB,iBAAS2T,iBAAiB;AADrB;AADQ,KAAf;AAMA,WAAO,KAAKia,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDqZ,sBAAoB5jC,GAApB,EAAyBujC,KAAzB,EAAgCM,IAAhC,EAAsC;AACrC,UAAMC,UAAU,EAAhB;AACA,UAAMC,YAAY,EAAlB;;AAEA,QAAIR,SAAS,IAAb,EAAmB;AAClB,UAAI,CAACl/B,EAAE2/B,OAAF,CAAU1gC,EAAEM,IAAF,CAAO2/B,KAAP,CAAV,CAAL,EAA+B;AAC9BO,gBAAQP,KAAR,GAAgBjgC,EAAEM,IAAF,CAAO2/B,KAAP,CAAhB;AACA,OAFD,MAEO;AACNQ,kBAAUR,KAAV,GAAkB,CAAlB;AACA;AACD;;AAED,QAAIM,QAAQ,IAAZ,EAAkB;AACjB,UAAI,CAACx/B,EAAE2/B,OAAF,CAAU1gC,EAAEM,IAAF,CAAOigC,IAAP,CAAV,CAAL,EAA8B;AAC7BC,gBAAQD,IAAR,GAAevgC,EAAEM,IAAF,CAAOigC,IAAP,EAAaz7B,KAAb,CAAmB,GAAnB,EAAwBxC,GAAxB,CAA4Bq+B,OAAO3gC,EAAEM,IAAF,CAAOqgC,GAAP,CAAnC,CAAf;AACA,OAFD,MAEO;AACNF,kBAAUF,IAAV,GAAiB,CAAjB;AACA;AACD;;AAED,UAAMtZ,SAAS,EAAf;;AAEA,QAAI,CAAClmB,EAAE2/B,OAAF,CAAUF,OAAV,CAAL,EAAyB;AACxBvZ,aAAOC,IAAP,GAAcsZ,OAAd;AACA;;AAED,QAAI,CAACz/B,EAAE2/B,OAAF,CAAUD,SAAV,CAAL,EAA2B;AAC1BxZ,aAAOwI,MAAP,GAAgBgR,SAAhB;AACA;;AAED,QAAI1/B,EAAE2/B,OAAF,CAAUzZ,MAAV,CAAJ,EAAuB;AACtB;AACA;;AAED,WAAO,KAAKA,MAAL,CAAY;AAAEvqB;AAAF,KAAZ,EAAqBuqB,MAArB,CAAP;AACA,GAzvB+C,CA2vBhD;;;AACAb,qCAAmC5gB,IAAnC,EAAyC7K,IAAzC,EAA+C+D,KAA/C,EAAsDpB,IAAtD,EAA4D6B,SAA5D,EAAuE4mB,SAAvE,EAAkF;AACjF,UAAM/pB,OAAO;AACZrB,UADY;AAEZ+D,WAFY;AAGZjC,SAAG+I,IAHS;AAIZrG,eAJY;AAKZqgC,YAAM,CALM;AAMZ50B,SAAG;AACFlO,aAAKY,KAAKZ,GADR;AAEFmB,kBAAUP,KAAKO;AAFb;AANS,KAAb;;AAYAkD,MAAE0nB,MAAF,CAASzsB,IAAT,EAAe+pB,SAAf;;AAEA/pB,SAAKU,GAAL,GAAW,KAAKwxB,MAAL,CAAYlyB,IAAZ,CAAX;AACA,WAAOA,IAAP;AACA;;AAED4kC,0BAAwBlkC,GAAxB,EAA6B8I,IAA7B,EAAmC7K,IAAnC,EAAyCorB,SAAzC,EAAoD;AACnD,UAAM/pB,OAAO;AACZU,SADY;AAEZwE,UAAI,IAAIC,IAAJ,EAFQ;AAGZ1E,SAAG+I,IAHS;AAIZ7K,UAJY;AAKZwE,iBAAW,EALC;AAMZqgC,YAAM;AANM,KAAb;;AASAz+B,MAAE0nB,MAAF,CAASzsB,IAAT,EAAe+pB,SAAf;;AAEA,SAAKmI,MAAL,CAAYlyB,IAAZ;AACA,WAAOA,IAAP;AACA,GA7xB+C,CAgyBhD;;;AACAorB,aAAW1qB,GAAX,EAAgB;AACf,UAAMuB,QAAQ;AAACvB;AAAD,KAAd;AAEA,WAAO,KAAKsH,MAAL,CAAY/F,KAAZ,CAAP;AACA;;AAED+pB,iCAA+BxiB,IAA/B,EAAqC3H,QAArC,EAA+C;AAC9C,UAAMI,QAAQ;AACbxB,SAAG+I,IADU;AAEbrG,iBAAWtB;AAFE,KAAd;AAKA,WAAO,KAAKmG,MAAL,CAAY/F,KAAZ,CAAP;AACA;;AA9yB+C;;AAizBjD1E,WAAWC,MAAX,CAAkB6M,KAAlB,GAA0B,IAAIs2B,UAAJ,CAAe,MAAf,EAAuB,IAAvB,CAA1B,C;;;;;;;;;;;ACpzBA,MAAMkE,aAAN,SAA4BtnC,WAAWC,MAAX,CAAkBs9B,KAA9C,CAAoD;AACnDp8B,gBAAc;AACb,UAAM,GAAG6T,SAAT;AAEA,SAAKmoB,cAAL,CAAoB;AAAE,iBAAW;AAAb,KAApB,EAAsC;AAAEqB,cAAQ;AAAV,KAAtC;AACA,SAAKrB,cAAL,CAAoB;AAAE,gBAAU;AAAZ,KAApB,EAAqC;AAAEqB,cAAQ;AAAV,KAArC;AACA,GANkD,CAQnD;;;AACAoF,WAASzgC,GAAT,EAAc;AACb,UAAMuB,QAAQ;AAACvB;AAAD,KAAd;AAEA,WAAO,KAAKoH,IAAL,CAAU7F,KAAV,CAAP;AACA;;AAED6iC,uBAAqBpkC,GAArB,EAA0B;AACzB,UAAMuB,QAAQ;AACbvB,SADa;AAEbiyB,cAAQ;AAAErM,aAAK;AAAP;AAFK,KAAd;AAKA,WAAO,KAAKlkB,OAAL,CAAaH,KAAb,CAAP;AACA;;AAEDm/B,YAAU1gC,MAAM,EAAhB,EAAoB;AACnBA,UAAM,GAAGuG,MAAH,CAAUvG,GAAV,CAAN;AAEA,UAAMuB,QAAQ;AACbvB,WAAK;AACJulB,aAAKvlB;AADD;AADQ,KAAd;AAMA,WAAO,KAAKoH,IAAL,CAAU7F,KAAV,CAAP;AACA;;AAED8iC,aAAW70B,IAAX,EAAiB5C,OAAjB,EAA0B;AACzB,UAAMrL,QAAQ;AAACiO;AAAD,KAAd;AAEA,WAAO,KAAKpI,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED03B,aAAW13B,OAAX,EAAoB;AACnB,UAAMrL,QAAQ;AAACgjC,cAAQ;AAAT,KAAd;AAEA,WAAO,KAAKn9B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED43B,sBAAoB9K,MAAM,EAA1B,EAA8B;AAC7B,UAAMvwB,SAAS;AACd8oB,cAAQ;AAAErM,aAAK;AAAP,OADM;AAEd2e,cAAQ;AAFM,KAAf;;AAKA,QAAI7K,IAAIv7B,MAAJ,GAAa,CAAjB,EAAoB;AACnBgL,aAAOnJ,GAAP,GACC;AAACulB,aAAKmU;AAAN,OADD;AAEA;;AAED,WAAO,KAAKtyB,IAAL,CAAU+B,MAAV,EAAkB;AAAEpH,cAAQ;AAAC/B,aAAK,CAAN;AAASgF,eAAO;AAAhB;AAAV,KAAlB,CAAP;AACA;;AAEDy/B,kCAAgCC,SAAhC,EAA2C;AAC1C,UAAMv7B,SAAS;AACd8oB,cAAQ;AAAErM,aAAK;AAAP,OADM;AAEd2e,cAAQ,IAFM;AAGdxI,kBAAY;AACXF,aAAK6I;AADM;AAHE,KAAf;AAQA,WAAO,KAAKt9B,IAAL,CAAU+B,MAAV,EAAkB;AAAEpH,cAAQ;AAAC/B,aAAK,CAAN;AAASgF,eAAO;AAAhB;AAAV,KAAlB,CAAP;AACA;;AAED2/B,yBAAuB;AACtB,WAAO,KAAKv9B,IAAL,CAAU;AAChB6qB,cAAQ;AAAErM,aAAK;AAAP,OADQ;AAEhB2e,cAAQ;AAAE3e,aAAK;AAAP;AAFQ,KAAV,CAAP;AAIA;;AAEDgf,gBAAch4B,OAAd,EAAuB;AACtB,WAAO,KAAKxF,IAAL,CAAU;AAAE6qB,cAAQ;AAAErM,aAAK;AAAP;AAAV,KAAV,EAAqChZ,OAArC,CAAP;AACA;;AAEDi4B,4BAA0BH,SAA1B,EAAqC;AACpC,WAAO,KAAKt9B,IAAL,CAAU;AAChB6qB,cAAQ;AAAErM,aAAK;AAAP,OADQ;AAEhBmW,kBAAY;AACXF,aAAK6I;AADM;AAFI,KAAV,CAAP;AAMA,GA5FkD,CA8FnD;;;AACAnR,kBAAgBvzB,GAAhB,EAAqBgF,KAArB,EAA4B;AAC3B,UAAMzD,QAAQ;AACb6c,eAAS;AAAEwH,aAAK;AAAP,OADI;AAEb5gB,aAAO;AAAE4gB,aAAK5gB;AAAP,OAFM;AAGbhF;AAHa,KAAd;AAMA,UAAMuqB,SAAS;AACdC,YAAM;AACLxlB;AADK;AADQ,KAAf;AAMA,WAAO,KAAKulB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAED+I,2BAAyBtzB,GAAzB,EAA8BgF,KAA9B,EAAqCU,MAArC,EAA6C;AAC5C,UAAMnE,QAAQ;AACb6c,eAAS;AAAEwH,aAAK;AAAP,OADI;AAEb5gB,aAAO;AAAE4gB,aAAK5gB;AAAP,OAFM;AAGbhF;AAHa,KAAd;AAMA,UAAMuqB,SAAS;AACdC,YAAM;AACLxlB,aADK;AAELU;AAFK;AADQ,KAAf;AAOA,WAAO,KAAK6kB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDua,2BAAyB9kC,GAAzB,EAA8BgF,KAA9B,EAAqC;AACpC,UAAMzD,QAAQ;AACbvB,SADa;AAEbiyB,cAAQ;AAAErM,aAAK;AAAP,OAFK;AAGbxH,eAAS;AAAEwH,aAAK;AAAP;AAHI,KAAd;AAMA,UAAM2E,SAAS;AACdC,YAAM;AACLxlB;AADK;AADQ,KAAf;AAMA,WAAO,KAAKulB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDiJ,oBAAkBxzB,GAAlB,EAAuB4M,OAAvB,EAAgC;AAC/B,UAAMrL,QAAQ;AACb6c,eAAS;AAAEwH,aAAK;AAAP,OADI;AAEb5lB;AAFa,KAAd;AAKA,UAAMuqB,SAAS;AAACC,YAAM5d;AAAP,KAAf;AAEA,WAAO,KAAK2d,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA,GAzJkD,CA2JnD;;;AACAwa,uBAAqB/kC,GAArB,EAA0BgF,KAA1B,EAAiC;AAChC,UAAM6uB,SAAS;AACd7zB,SADc;AAEdgF,WAFc;AAGdggC,kBAAY,IAAIvgC,IAAJ;AAHE,KAAf;AAMA,WAAO,KAAK+sB,MAAL,CAAYqC,MAAZ,CAAP;AACA,GApKkD,CAsKnD;;;AACAnJ,aAAW1qB,GAAX,EAAgB;AACf,UAAMuB,QAAQ;AACb6c,eAAS;AAAEwH,aAAK;AAAP,OADI;AAEb5lB;AAFa,KAAd;AAKA,WAAO,KAAKsH,MAAL,CAAY/F,KAAZ,CAAP;AACA;;AA9KkD;;AAiLpD1E,WAAWC,MAAX,CAAkBo2B,QAAlB,GAA6B,IAAIiR,aAAJ,CAAkB,UAAlB,EAA8B,IAA9B,CAA7B,C;;;;;;;;;;;ACjLA,IAAI9/B,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAEN,MAAMqoC,kBAAN,SAAiCpoC,WAAWC,MAAX,CAAkBs9B,KAAnD,CAAyD;AACxDp8B,gBAAc;AACb,UAAM,GAAG6T,SAAT;AAEA,SAAKmoB,cAAL,CAAoB;AAAE,aAAO,CAAT;AAAY,eAAS;AAArB,KAApB,EAA8C;AAAEhd,cAAQ;AAAV,KAA9C;AACA,SAAKgd,cAAL,CAAoB;AAAE,aAAO,CAAT;AAAY,eAAS,CAArB;AAAwB,eAAS;AAAjC,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,aAAO,CAAT;AAAY,eAAS;AAArB,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,eAAS,CAAX;AAAc,cAAQ,CAAtB;AAAyB,WAAK;AAA9B,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,eAAS,CAAX;AAAc,cAAQ,CAAtB;AAAyB,WAAK,CAA9B;AAAiC,cAAQ;AAAzC,KAApB,EAAkE;AAAEhd,cAAQ;AAAV,KAAlE;AACA,SAAKgd,cAAL,CAAoB;AAAE,cAAQ;AAAV,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,eAAS;AAAX,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,gBAAU;AAAZ,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,YAAM;AAAR,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,YAAM;AAAR,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,4BAAsB;AAAxB,KAApB,EAAiD;AAAEqB,cAAQ;AAAV,KAAjD;AACA,SAAKrB,cAAL,CAAoB;AAAE,8BAAwB;AAA1B,KAApB,EAAmD;AAAEqB,cAAQ;AAAV,KAAnD;AACA,SAAKrB,cAAL,CAAoB;AAAE,iCAA2B;AAA7B,KAApB,EAAsD;AAAEqB,cAAQ;AAAV,KAAtD;AACA,SAAKrB,cAAL,CAAoB;AAAE,4BAAsB;AAAxB,KAApB,EAAiD;AAAEqB,cAAQ;AAAV,KAAjD;AACA,SAAKrB,cAAL,CAAoB;AAAE,uBAAiB;AAAnB,KAApB,EAA4C;AAAEqB,cAAQ;AAAV,KAA5C;AACA,SAAKrB,cAAL,CAAoB;AAAE,+BAAyB;AAA3B,KAApB,EAAoD;AAAEqB,cAAQ;AAAV,KAApD;AAEA,SAAKnC,KAAL,CAAWY,WAAX,CAAuB,KAAvB,EAA8B,OAA9B;AACA,SAAKZ,KAAL,CAAWY,WAAX,CAAuB,OAAvB,EAAgC,OAAhC;AACA,SAAKZ,KAAL,CAAWY,WAAX,CAAuB,MAAvB,EAA+B,OAA/B;AACA,SAAKZ,KAAL,CAAWY,WAAX,CAAuB,CAAC,KAAD,EAAQ,OAAR,CAAvB,EAAyC,QAAzC;AACA,SAAKZ,KAAL,CAAWY,WAAX,CAAuB,CAAC,MAAD,EAAS,OAAT,CAAvB,EAA0C,QAA1C;AACA,GA1BuD,CA6BxD;;;AACA3b,2BAAyB7b,MAAzB,EAAiCzC,MAAjC,EAAyC;AACxC,QAAI,KAAKi5B,QAAT,EAAmB;AAClB,aAAO,KAAKI,KAAL,CAAWgJ,WAAX,CAAuB,WAAvB,EAAoC,CAAC5/B,MAAD,EAASzC,MAAT,CAApC,EAAsD+Y,KAAtD,EAAP;AACA;;AACD,UAAMrX,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAASzC;AAFI,KAAd;AAKA,WAAO,KAAK6B,OAAL,CAAaH,KAAb,CAAP;AACA;;AAED2jC,6BAA2BrjC,QAA3B,EAAqChC,MAArC,EAA6C;AAC5C,QAAI,KAAKi5B,QAAT,EAAmB;AAClB,aAAO,KAAKI,KAAL,CAAWgJ,WAAX,CAAuB,YAAvB,EAAqC,CAACrgC,QAAD,EAAWhC,MAAX,CAArC,EAAyD+Y,KAAzD,EAAP;AACA;;AACD,UAAMrX,QAAQ;AACbtD,YAAM4D,QADO;AAEb,eAAShC;AAFI,KAAd;AAKA,WAAO,KAAK6B,OAAL,CAAaH,KAAb,CAAP;AACA,GApDuD,CAsDxD;;;AACA6pB,eAAavrB,MAAb,EAAqB+M,OAArB,EAA8B;AAC7B,QAAI,KAAKksB,QAAT,EAAmB;AAClB,aAAO,KAAKI,KAAL,CAAWgJ,WAAX,CAAuB,OAAvB,EAAgCriC,MAAhC,EAAwC+M,OAAxC,CAAP;AACA;;AAED,UAAMrL,QACL;AAAC,eAAS1B;AAAV,KADD;AAGA,WAAO,KAAKuH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDu4B,2BAAyBtlC,MAAzB,EAAiC6kC,SAAjC,EAA4C93B,OAA5C,EAAqD;AACpD,UAAMrL,QAAQ;AACb,eAAS1B,MADI;AAEbk8B,kBAAY;AACXF,aAAK6I;AADM;AAFC,KAAd;AAOA,WAAO,KAAKt9B,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA,GA3EuD,CA6ExD;;;AACAw4B,uBAAqB9iC,MAArB,EAA6BgqB,KAA7B,EAAoC1f,OAApC,EAA6C;AAC5C0f,YAAQ,GAAG/lB,MAAH,CAAU+lB,KAAV,CAAR;AACA,UAAM/qB,QAAQ;AACb,aAAOe,MADM;AAEb,eAAS;AAAEijB,aAAK+G;AAAP;AAFI,KAAd;AAKA,WAAO,KAAKllB,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDg0B,aAAWhyB,KAAX,EAAkBhC,OAAlB,EAA2B;AAC1B,UAAMrL,QAAQ;AACbxB,SAAG;AACFwlB,aAAK3W;AADH;AADU,KAAd;AAMA,WAAO,KAAKxH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDy4B,sBAAoBv8B,IAApB,EAA0BjJ,MAA1B,EAAkC+M,OAAlC,EAA2C;AAC1C,UAAMrL,QAAQ;AACbxB,SAAG+I,IADU;AAEb,eAASjJ;AAFI,KAAd;AAKA,WAAO,KAAKuH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED04B,0BAAwBx8B,IAAxB,EAA8B7K,IAA9B,EAAoC4B,MAApC,EAA4C+M,OAA5C,EAAqD;AACpD,UAAMrL,QAAQ;AACbxB,SAAG+I,IADU;AAEb7K,UAFa;AAGb,eAAS4B;AAHI,KAAd;AAMA,WAAO,KAAKuH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDyT,eAAa/d,MAAb,EAAqBsK,OAArB,EAA8B;AAC7B,QAAI,KAAKksB,QAAT,EAAmB;AAClB,aAAO,KAAKI,KAAL,CAAWgJ,WAAX,CAAuB,KAAvB,EAA8B5/B,MAA9B,EAAsCsK,OAAtC,CAAP;AACA;;AAED,UAAMrL,QACL;AAACI,WAAKW;AAAN,KADD;AAGA,WAAO,KAAK8E,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDgrB,2BAAyBt1B,MAAzB,EAAiCzC,MAAjC,EAAyC+M,OAAzC,EAAkD;AACjD,UAAMrL,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAAS;AACRsjB,aAAK/lB;AADG;AAFI,KAAd;AAOA,WAAO,KAAKuH,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED24B,cAAY34B,OAAZ,EAAqB;AACpB,QAAIA,WAAW,IAAf,EAAqB;AAAEA,gBAAU,EAAV;AAAe;;AACtC,UAAMrL,QAAQ;AAAEuoB,UAAI;AAAEkJ,iBAAS;AAAX;AAAN,KAAd;AACApmB,YAAQ4f,IAAR,GAAe;AAAE1C,UAAI,CAAC;AAAP,KAAf;AACAld,YAAQif,KAAR,GAAgB,CAAhB;AACA,UAAM,CAACrqB,YAAD,IAAiB,KAAK4F,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,EAA0BgM,KAA1B,EAAvB;AACA,WAAOpX,gBAAgBA,aAAasoB,EAApC;AACA;;AAEDhJ,yBAAuBxe,MAAvB,EAA+Bge,OAA/B,EAAwC;AACvC,UAAM/e,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAAS;AACRijB,aAAKjF;AADG;AAFI,KAAd;AAOA,WAAO,KAAKlZ,IAAL,CAAU7F,KAAV,CAAP;AACA;;AAEDgf,sCAAoCje,MAApC,EAA4Cge,OAA5C,EAAqD;AACpD,UAAM/e,QAAQ;AACbI,WAAKW,MADQ;AAEbirB,WAAK,CACJ;AAAE,iBAAS;AAAEhI,eAAKjF;AAAP;AAAX,OADI,EAEJ;AAAEG,4BAAoB;AAAtB,OAFI;AAFQ,KAAd;AAQA,WAAO,KAAKrZ,IAAL,CAAU7F,KAAV,CAAP;AACA;;AAEDkhB,qBAAmB5iB,MAAnB,EAA2B;AAC1B,UAAM0B,QAAQ;AACb,eAAS1B,MADI;AAEbwD,cAAQ;AACPw4B,aAAK;AADE;AAFK,KAAd;AAOA,WAAO,KAAKz0B,IAAL,CAAU7F,KAAV,EAAiB;AAAEQ,cAAQ;AAAEsB,gBAAQ;AAAV;AAAV,KAAjB,CAAP;AACA;;AAEDmiC,6BAA2B7jC,GAA3B,EAAgC;AAC/B,WAAO,KAAKwpB,EAAL,CAAQzpB,OAAR,CAAgB;AACtBC;AADsB,KAAhB,EAEJ;AACF6qB,YAAM;AACL1C,YAAI;AADC,OADJ;AAIF/nB,cAAQ;AACP+nB,YAAI;AADG;AAJN,KAFI,CAAP;AAUA,GAjMuD,CAmMxD;;;AACApB,kBAAgBpmB,MAAhB,EAAwB;AACvB,UAAMf,QACL;AAACI,WAAKW;AAAN,KADD;AAGA,UAAMioB,SAAS;AACdC,YAAM;AACLvC,eAAO,KADF;AAELD,cAAM,KAFD;AAGLne,kBAAU;AAHL;AADQ,KAAf;AAQA,WAAO,KAAK0gB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDrH,oBAAkBt0B,MAAlB,EAA0B;AACzB,UAAMf,QACL;AAACI,WAAKW;AAAN,KADD;AAGA,UAAMioB,SAAS;AACdC,YAAM;AACLvC,eAAO,KADF;AAELD,cAAM,IAFD;AAGLne,kBAAU;AAHL;AADQ,KAAf;AAQA,WAAO,KAAK0gB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDwH,wBAAsBnjC,MAAtB,EAA8BzC,MAA9B,EAAsC;AACrC,UAAM0B,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAASzC;AAFI,KAAd;AAKA,UAAM0qB,SAAS;AACdC,YAAM;AACLvC,eAAO,KADF;AAELD,cAAM;AAFD;AADQ,KAAf;AAOA,WAAO,KAAKuC,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDmb,wBAAsBpjC,MAAtB,EAA8BzC,MAA9B,EAAsC;AACrC,UAAM0B,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAASzC;AAFI,KAAd;AAKA,UAAM0qB,SAAS;AACdC,YAAM;AACLxC,cAAM;AADD;AADQ,KAAf;AAMA,WAAO,KAAKuC,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDob,6BAA2BrjC,MAA3B,EAAmCzC,MAAnC,EAA2C;AAC1C,UAAM0B,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAASzC;AAFI,KAAd;AAKA,UAAM0qB,SAAS;AACdC,YAAM;AACLxC,cAAM,IADD;AAELC,eAAO,KAFF;AAGL5kB,gBAAQ,CAHH;AAIL6kB,sBAAc,CAJT;AAKLC,uBAAe,CALV;AAML2B,YAAI,IAAIrlB,IAAJ;AANC;AADQ,KAAf;AAWA,WAAO,KAAK8lB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDqb,+BAA6BtjC,MAA7B,EAAqCzC,MAArC,EAA6CgmC,2BAA7C,EAA0E;AACzE,UAAMtkC,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAASzC;AAFI,KAAd;AAKA,UAAM0qB,SAAS;AACdC,YAAM;AACLxC,cAAM,IADD;AAELC,eAAO,IAFF;AAGL6B,YAAI+b;AAHC;AADQ,KAAf;AAQA,WAAO,KAAKtb,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDqG,wCAAsC/wB,MAAtC,EAA8CkC,MAA9C,EAAsD;AACrD,UAAM+jC,SAAS,EAAf;AACAlhC,WAAOC,IAAP,CAAY9C,MAAZ,EAAoB+C,OAApB,CAA4BC,OAAO;AAClC+gC,aAAQ,gBAAgB/gC,GAAK,EAA7B,IAAkChD,OAAOgD,GAAP,CAAlC;AACA,KAFD;AAIA,UAAMxD,QAAQ;AACb,eAAS1B,MADI;AAEb,WAAK;AAFQ,KAAd;AAIA,UAAM0qB,SAAS;AAAEC,YAAMsb;AAAR,KAAf;AACA,UAAMl5B,UAAU;AAAE,eAAS;AAAX,KAAhB;AAEA,WAAO,KAAK2d,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B3d,OAA3B,CAAP;AACA;;AAEDm5B,+BAA6BzjC,MAA7B,EAAqCzC,MAArC,EAA6CmmC,QAA7C,EAAuD;AACtD,QAAIA,YAAY,IAAhB,EAAsB;AAAEA,iBAAW,IAAX;AAAkB;;AAC1C,UAAMzkC,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAASzC;AAFI,KAAd;AAKA,UAAM0qB,SAAS;AACdC,YAAM;AACL7R,WAAGqtB;AADE;AADQ,KAAf;AAMA,WAAO,KAAKzb,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAED0b,6BAA2B3jC,MAA3B,EAAmCrE,IAAnC,EAAyC+D,KAAzC,EAAgD;AAC/C,UAAMT,QACL;AAACI,WAAKW;AAAN,KADD;AAGA,UAAMioB,SAAS;AACdC,YAAM;AACLvsB,YADK;AAEL+D,aAFK;AAGLimB,eAAO;AAHF;AADQ,KAAf;AAQA,WAAO,KAAKsC,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDiI,qBAAmB5jC,MAAnB,EAA2BrE,IAA3B,EAAiC;AAChC,UAAMsD,QACL;AAACI,WAAKW;AAAN,KADD;AAGA,UAAMioB,SAAS;AACdC,YAAM;AACLvsB;AADK;AADQ,KAAf;AAMA,WAAO,KAAKssB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAED/H,0BAAwBr2B,MAAxB,EAAgCsB,QAAhC,EAA0C;AACzC,UAAMI,QACL;AAAC,eAAS1B;AAAV,KADD;AAGA,UAAM0qB,SAAS;AACdC,YAAM;AACL,sBAAcrpB;AADT;AADQ,KAAf;AAMA,WAAO,KAAKopB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAED9H,mCAAiCgQ,OAAjC,EAA0CloC,IAA1C,EAAgD;AAC/C,UAAMsD,QAAQ;AACbtD,YAAMkoC,OADO;AAEbpmC,SAAG;AAFU,KAAd;AAKA,UAAMwqB,SAAS;AACdC,YAAM;AACLvsB;AADK;AADQ,KAAf;AAMA,WAAO,KAAKssB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDrhB,oCAAkCta,MAAlC,EAA0CzC,MAA1C,EAAkD2e,GAAlD,EAAuD;AACtD,QAAIA,OAAO,IAAX,EAAiB;AAAEA,YAAM,CAAN;AAAU;;AAC7B,UAAMjd,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAAS;AACRsjB,aAAK/lB;AADG;AAFI,KAAd;AAOA,UAAM0qB,SAAS;AACdC,YAAM;AACLvC,eAAO,IADF;AAELD,cAAM;AAFD,OADQ;AAKd6a,YAAM;AACLx/B,gBAAQmb;AADH;AALQ,KAAf;AAUA,WAAO,KAAK+L,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDphB,oDAAkDva,MAAlD,EAA0DzC,MAA1D,EAAkEumC,WAAW,CAA7E,EAAgFlpB,YAAY,CAA5F,EAA+F;AAC9F,UAAM3b,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAAS;AACRsjB,aAAK/lB;AADG;AAFI,KAAd;AAOA,UAAM0qB,SAAS;AACdC,YAAM;AACLvC,eAAO,IADF;AAELD,cAAM;AAFD,OADQ;AAKd6a,YAAM;AACLx/B,gBAAQ6Z,SADH;AAELiL,uBAAeie;AAFV;AALQ,KAAf;AAWA,WAAO,KAAK7b,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDnhB,8CAA4Cxa,MAA5C,EAAoDge,OAApD,EAA6D+lB,UAAU,CAAvE,EAA0EnpB,YAAY,CAAtF,EAAyF;AACxF,UAAM3b,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAAS;AACRijB,aAAKjF;AADG;AAFI,KAAd;AAOA,UAAMiK,SAAS;AACdC,YAAM;AACLvC,eAAO,IADF;AAELD,cAAM;AAFD,OADQ;AAKd6a,YAAM;AACLx/B,gBAAQ6Z,SADH;AAELgL,sBAAcme;AAFT;AALQ,KAAf;AAWA,WAAO,KAAK9b,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AACD5gB,mCAAiC/a,MAAjC,EAAyCzC,MAAzC,EAAiD;AAChD,UAAM0B,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAAS;AACRsjB,aAAK/lB;AADG,OAFI;AAKb0tB,WAAK,CACJ;AAAEtF,eAAO;AAAErC,eAAK;AAAP;AAAT,OADI,EAEJ;AAAEoC,cAAM;AAAEpC,eAAK;AAAP;AAAR,OAFI;AALQ,KAAd;AAWA,UAAM2E,SAAS;AACdC,YAAM;AACLvC,eAAO,IADF;AAELD,cAAM;AAFD;AADQ,KAAf;AAMA,WAAO,KAAKuC,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAEDqI,qBAAmB3kC,GAAnB,EAAwByc,OAAxB,EAAiCC,OAAjC,EAA0C;AACzC,UAAM9c,QAAQ;AACbI,SADa;AAEb,eAASyc;AAFI,KAAd;AAKA,UAAMmM,SAAS;AACdC,YAAM;AACLpM,iBAAS;AADJ;AADQ,KAAf;AAMA,UAAMmoB,SAAS;AACd5kC,SADc;AAEd,eAAS0c;AAFK,KAAf;AAKA,UAAMmoB,UAAU;AACfhc,YAAM;AACLnM,iBAAS;AADJ;AADS,KAAhB;AAMA,WAAO,KAAKkM,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,KAA8B,KAAKA,MAAL,CAAYgc,MAAZ,EAAoBC,OAApB,CAArC;AACA;;AAEDC,uBAAqB9kC,GAArB,EAA0Byc,OAA1B,EAAmCC,OAAnC,EAA4C;AAC3C,UAAM9c,QAAQ;AACbI,SADa;AAEb,eAASyc;AAFI,KAAd;AAKA,UAAMmM,SAAS;AACdwI,cAAQ;AACP3U,iBAAS;AADF;AADM,KAAf;AAMA,UAAMmoB,SAAS;AACd5kC,SADc;AAEd,eAAS0c;AAFK,KAAf;AAKA,UAAMmoB,UAAU;AACfzT,cAAQ;AACP1U,iBAAS;AADF;AADO,KAAhB;AAMA,WAAO,KAAKkM,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,KAA8B,KAAKA,MAAL,CAAYgc,MAAZ,EAAoBC,OAApB,CAArC;AACA;;AAEDE,qBAAmBpkC,MAAnB,EAA2BwG,IAA3B,EAAiC;AAChC,UAAMvH,QACL;AAACI,WAAKW;AAAN,KADD;AAGA,UAAMioB,SAAS;AACdC,YAAM;AACLzqB,WAAG+I;AADE;AADQ,KAAf;AAMA,WAAO,KAAKyhB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA;;AAED0I,cAAY3mC,GAAZ,EAAiBwP,IAAjB,EAAuB;AACtB,UAAMjO,QACL;AAACvB;AAAD,KADD;AAGA,UAAMuqB,SAAS;AACdyG,iBAAW;AACV1E,eAAO9c;AADG;AADG,KAAf;AAMA,WAAO,KAAK+a,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDqc,iBAAe5mC,GAAf,EAAoBwP,IAApB,EAA0B;AACzB,UAAMjO,QACL;AAACvB;AAAD,KADD;AAGA,UAAMuqB,SAAS;AACd+T,aAAO;AACNhS,eAAO9c;AADD;AADO,KAAf;AAMA,WAAO,KAAK+a,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDsc,wBAAsB1lC,QAAtB,EAAgC0I,QAAhC,EAA0C;AACzC,UAAMtI,QAAQ;AACbxB,SAAG,GADU;AAEb9B,YAAMkD;AAFO,KAAd;AAKA,UAAMopB,SAAS;AACdC,YAAM;AACL3gB;AADK;AADQ,KAAf;AAMA,WAAO,KAAK0gB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B;AAAE0T,aAAO;AAAT,KAA3B,CAAP;AACA,GA5jBuD,CA8jBxD;;;AACAlW,wBAAsBzoB,IAAtB,EAA4BsB,IAA5B,EAAkCyoB,SAAlC,EAA6C;AAC5C,UAAM7nB,eAAe;AACpBwmB,YAAM,KADc;AAEpBC,aAAO,KAFa;AAGpB5kB,cAAQ,CAHY;AAIpB6kB,oBAAc,CAJM;AAKpBC,qBAAe,CALK;AAMpB3jB,UAAIlF,KAAKkF,EANW;AAOpB7C,WAAKrC,KAAKU,GAPU;AAQpB/B,YAAMqB,KAAKrB,IARS;AASpB+D,aAAO1C,KAAK0C,KATQ;AAUpBuqB,oBAAcjtB,KAAKitB,YAVC;AAWpBxsB,SAAGT,KAAKS,CAXY;AAYpBmO,SAAG;AACFlO,aAAKY,KAAKZ,GADR;AAEFmB,kBAAUP,KAAKO,QAFb;AAGFlD,cAAM2C,KAAK3C;AAHT;AAZiB,KAArB;;AAmBAoG,MAAE0nB,MAAF,CAASvqB,YAAT,EAAuB6nB,SAAvB;;AAEA,WAAO,KAAKmI,MAAL,CAAYhwB,YAAZ,CAAP;AACA,GAtlBuD,CAylBxD;;;AACA0pB,iBAAerrB,MAAf,EAAuB;AACtB,UAAM0B,QACL;AAAC,eAAS1B;AAAV,KADD;AAGA,WAAO,KAAKyH,MAAL,CAAY/F,KAAZ,CAAP;AACA;;AAED8pB,iBAAe/oB,MAAf,EAAuB;AACtB,UAAMf,QACL;AAACI,WAAKW;AAAN,KADD;AAGA,WAAO,KAAKgF,MAAL,CAAY/F,KAAZ,CAAP;AACA;;AAEDutB,0BAAwBxsB,MAAxB,EAAgCzC,MAAhC,EAAwC;AACvC,UAAM0B,QAAQ;AACbI,WAAKW,MADQ;AAEb,eAASzC;AAFI,KAAd;AAKA,WAAO,KAAKyH,MAAL,CAAY/F,KAAZ,CAAP;AACA;;AA/mBuD;;AAknBzD1E,WAAWC,MAAX,CAAkByF,aAAlB,GAAkC,IAAI0iC,kBAAJ,CAAuB,cAAvB,EAAuC,IAAvC,CAAlC,C;;;;;;;;;;;ACpnBA,IAAI5gC,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;AAIpEC,WAAWC,MAAX,CAAkBwtB,OAAlB,GAA4B,IAAI,cAAcztB,WAAWC,MAAX,CAAkBs9B,KAAhC,CAAsC;AACrEp8B,gBAAc;AACb,UAAM,SAAN;AAEA,SAAKo4B,KAAL,CAAWkE,MAAX,CAAkB9I,MAAlB,CAAyB,CAAC3xB,MAAD,EAAS06B,GAAT,KAAiB;AACzCA,UAAIC,UAAJ,GAAiB7nB,eAAelU,EAAf,EAAjB;AACA,KAFD;AAIA,SAAKu7B,cAAL,CAAoB;AAAE,aAAO;AAAT,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,oBAAc;AAAhB,KAApB;AACA;;AAED8M,2BAAyBxkC,MAAzB,EAAiCupB,KAAjC,EAAwC;AACvC,UAAMkb,YAAY;AACjBplC,WAAKW,MADY;AAEjBq4B,gBAAU,IAFO;AAGjBC,iBAAW,KAHM;AAIjBnQ,eAAS;AACR7E,aAAK;AADG;AAJQ,KAAlB;AASA,UAAMohB,cAAc;AACnBnb,WADmB;AAEnBW,YAAM;AACLuO,oBAAY,CAAC;AADR,OAFa;AAKnBh5B,cAAQ;AACP/B,aAAK,CADE;AAEPH,gBAAQ,CAFD;AAGP8B,aAAK,CAHE;AAIP1D,cAAM,CAJC;AAKP4O,qBAAa,CALN;AAMP/D,cAAM,CANC;AAOPsN,aAAK,CAPE;AAQP2kB,oBAAY;AARL;AALW,KAApB;AAiBA,WAAO,KAAK3zB,IAAL,CAAU2/B,SAAV,EAAqBC,WAArB,CAAP;AACA;;AAEDC,iBAAepnC,MAAf,EAAuB66B,KAAvB,EAA8Bpb,IAA9B,EAAoCuK,KAApC,EAA2C;AAC1C,UAAM8K,WAAW;AAChB90B,YADgB;AAEhB66B,WAFgB;AAGhBC,gBAAU,KAHM;AAIhBC,iBAAW,IAJK;AAKhBC,gBAAU,CALM;AAMhBC,iBAAWx3B,EAAEsH,YAAF,CAAe0U,KAAKrhB,IAApB,EAA0B,GAA1B,CANK;AAOhB88B,kBAAY,IAAIt2B,IAAJ;AAPI,KAAjB;;AAUAJ,MAAE0nB,MAAF,CAAS4I,QAAT,EAAmBrV,IAAnB,EAAyBuK,KAAzB;;AAEA,QAAI,KAAKuM,KAAL,CAAW8E,MAAX,IAAqB,KAAK9E,KAAL,CAAW8E,MAAX,CAAkB1J,MAAlB,IAA4B,IAArD,EAA2D;AAC1DlS,aAAO,KAAK8W,KAAL,CAAW8E,MAAX,CAAkB1J,MAAlB,CAAyBmD,QAAzB,CAAP;AACA,KAFD,MAEO;AACNrV,aAAO,KAAKkS,MAAL,CAAYmD,QAAZ,CAAP;AACA;;AAED,WAAOrV,IAAP;AACA;;AAED0b,qBAAmBC,MAAnB,EAA2Bp7B,MAA3B,EAAmCyf,IAAnC,EAAyC;AACxC,QAAI1X,MAAJ;;AACA,QAAI,CAACqzB,MAAL,EAAa;AACZ;AACA;;AAED,UAAM9xB,SAAS;AACdnJ,WAAKi7B,MADS;AAEdp7B;AAFc,KAAf;AAKA,UAAM0qB,SAAS;AACdC,YAAM;AACLmQ,kBAAU,IADL;AAELC,mBAAW,KAFN;AAGLC,kBAAU;AAHL;AADQ,KAAf;AAQAtQ,WAAOC,IAAP,GAAcnmB,EAAE0nB,MAAF,CAASzM,IAAT,EAAeiL,OAAOC,IAAtB,CAAd;;AAEA,QAAI,KAAK4L,KAAL,CAAW8E,MAAX,IAAqB,KAAK9E,KAAL,CAAW8E,MAAX,CAAkB3Q,MAAlB,IAA4B,IAArD,EAA2D;AAC1D3iB,eAAS,KAAKwuB,KAAL,CAAW8E,MAAX,CAAkB3Q,MAAlB,CAAyBphB,MAAzB,EAAiCohB,MAAjC,CAAT;AACA,KAFD,MAEO;AACN3iB,eAAS,KAAK2iB,MAAL,CAAYphB,MAAZ,EAAoBohB,MAApB,CAAT;AACA;;AAED,WAAO3iB,MAAP;AACA;;AAEDwzB,aAAWH,MAAX,EAAmB;AAClB,QAAI,KAAK7E,KAAL,CAAW8E,MAAX,IAAqB,KAAK9E,KAAL,CAAW8E,MAAX,CAAkB5zB,MAAlB,IAA4B,IAArD,EAA2D;AAC1D,aAAO,KAAK8uB,KAAL,CAAW8E,MAAX,CAAkB5zB,MAAlB,CAAyB;AAAEtH,aAAKi7B;AAAP,OAAzB,CAAP;AACA,KAFD,MAEO;AACN,aAAO,KAAK3zB,MAAL,CAAY;AAAEtH,aAAKi7B;AAAP,OAAZ,CAAP;AACA;AACD;;AApGoE,CAA1C,EAA5B,C;;;;;;;;;;;ACJA,IAAI52B,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAI0G,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;;AAGpE,MAAMsqC,UAAN,SAAyBrqC,WAAWC,MAAX,CAAkBs9B,KAA3C,CAAiD;AAChDp8B,gBAAc;AACb,UAAM,GAAG6T,SAAT;AAEA,SAAKmoB,cAAL,CAAoB;AAAE,eAAS;AAAX,KAApB,EAAoC;AAAEqB,cAAQ;AAAV,KAApC;AACA,SAAKrB,cAAL,CAAoB;AAAE,cAAQ;AAAV,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,mBAAa;AAAf,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,gBAAU;AAAZ,KAApB;AACA,SAAKA,cAAL,CAAoB;AAAE,gBAAU;AAAZ,KAApB,EAAqC;AAAEqB,cAAQ;AAAV,KAArC;AACA,SAAKrB,cAAL,CAAoB;AAAE,0BAAoB;AAAtB,KAApB,EAA+C;AAAEqB,cAAQ;AAAV,KAA/C;AACA,SAAKrB,cAAL,CAAoB;AAAE,cAAQ;AAAV,KAApB;AAEA,SAAKd,KAAL,CAAWY,WAAX,CAAuB,UAAvB,EAAmC,QAAnC;AACA;;AAEDsG,oBAAkBpgC,GAAlB,EAAuB4M,OAAvB,EAAgC;AAC/B,WAAO,KAAKlL,OAAL,CAAa;AAAE2+B,iBAAWrgC;AAAb,KAAb,EAAiC4M,OAAjC,CAAP;AACA;;AAED0c,oBAAkBnoB,QAAlB,EAA4ByL,OAA5B,EAAqC;AACpC,QAAI,OAAOzL,QAAP,KAAoB,QAAxB,EAAkC;AACjCA,iBAAW,IAAI+I,MAAJ,CAAY,IAAI/I,QAAU,GAA1B,EAA8B,GAA9B,CAAX;AACA;;AAED,UAAMI,QAAQ;AAACJ;AAAD,KAAd;AAEA,WAAO,KAAKO,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA;;AAEDgR,wBAAsBupB,YAAtB,EAAoCv6B,OAApC,EAA6C;AAC5C,UAAMrL,QAAQ;AAAC,wBAAkB,IAAI2I,MAAJ,CAAY,IAAI5G,EAAE2Y,YAAF,CAAekrB,YAAf,CAA8B,GAA9C,EAAkD,GAAlD;AAAnB,KAAd;AAEA,WAAO,KAAKzlC,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA;;AAEDw6B,eAAaC,KAAb,EAAoBz6B,OAApB,EAA6B;AAC5B,UAAMrL,QAAQ;AAAC8lC;AAAD,KAAd;AAEA,WAAO,KAAK3lC,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA;;AAED06B,2BAAyBtnC,GAAzB,EAA8BggB,KAA9B,EAAqCpT,OAArC,EAA8C;AAC7C,UAAMrL,QAAQ;AACbvB,SADa;AAEb,iDAA4Ckb,SAASqsB,eAAT,CAAyBvnB,KAAzB;AAF/B,KAAd;AAKA,WAAO,KAAKte,OAAL,CAAaH,KAAb,EAAoBqL,OAApB,CAAP;AACA,GAhD+C,CAmDhD;;;AACA6zB,WAAS5gC,MAAT,EAAiB;AAChB,UAAM0B,QAAQ;AAACvB,WAAKH;AAAN,KAAd;AAEA,WAAO,KAAKuH,IAAL,CAAU7F,KAAV,CAAP;AACA;;AAEDimC,sBAAoB56B,OAApB,EAA6B;AAC5B,UAAMrL,QAAQ;AACbJ,gBAAU;AACT6xB,iBAAS;AADA,OADG;AAIb5Y,cAAQ;AACPmL,aAAK,CAAC,QAAD,EAAW,MAAX,EAAmB,MAAnB;AADE;AAJK,KAAd;AASA,WAAO,KAAKne,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAGD6f,iBAAetrB,QAAf,EAAyByL,OAAzB,EAAkC;AACjC,UAAMrL,QAAQ;AAACJ;AAAD,KAAd;AAEA,WAAO,KAAKiG,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED2P,qCAAmC9Z,SAAnC,EAA8CmK,OAA9C,EAAuD;AACtD,QAAI,KAAKksB,QAAT,EAAmB;AAClB,YAAMlxB,SAAS;AACdgR,gBAAQ;AACP,iBAAO/b,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwB8c,cAAxB,CAAuC,YAAvC,EAAqD1uB,IAArD,GAA4DvB,MAA5D,CAAmE0qB,UAAUpxB,UAAU2G,OAAV,CAAkByqB,OAAO1yB,QAAzB,IAAqC,CAAC,CAAnH,CAAP;AACA,SAHa;;AAIdqtB,gBAAQ;AACP,iBAAO5mB,OAAOgR,KAAP,GAAeza,MAAtB;AACA,SANa;;AAOd2G,gBAAQgP,EAAR,EAAY;AACX,iBAAOlM,OAAOgR,KAAP,GAAe9T,OAAf,CAAuBgP,EAAvB,CAAP;AACA;;AATa,OAAf;AAWA,aAAOlM,MAAP;AACA;;AAED,UAAMrG,QAAQ;AACbJ,gBAAU;AAAEokB,aAAK9iB;AAAP,OADG;AAEb,2CAAqC;AACpCuwB,iBAAS;AAD2B;AAFxB,KAAd;AAOA,WAAO,KAAK5rB,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED66B,gDAA8CC,UAA9C,EAA0DC,UAA1D,EAAsE/6B,OAAtE,EAA+E;AAC9E,QAAI+6B,cAAc,IAAlB,EAAwB;AAAEA,mBAAa,EAAb;AAAkB;;AAC5C,QAAI/6B,WAAW,IAAf,EAAqB;AAAEA,gBAAU,EAAV;AAAe;;AACtC,QAAI,CAACvI,EAAEujC,OAAF,CAAUD,UAAV,CAAL,EAA4B;AAC3BA,mBAAa,CAAEA,UAAF,CAAb;AACA;;AAED,UAAME,YAAY,IAAI39B,MAAJ,CAAW5G,EAAE2Y,YAAF,CAAeyrB,UAAf,CAAX,EAAuC,GAAvC,CAAlB;AACA,UAAMnmC,QAAQ;AACbgsB,WAAK,CAAC;AACLpsB,kBAAU0mC;AADL,OAAD,EAEF;AACF5pC,cAAM4pC;AADJ,OAFE,CADQ;AAMb1kB,cAAQ,IANK;AAObra,YAAM;AACLyc,aAAK,CAAC,MAAD,EAAS,KAAT;AADA,OAPO;AAUbuiB,YAAM,CAAC;AACN3mC,kBAAU;AACT6xB,mBAAS;AADA;AADJ,OAAD,EAIH;AACF7xB,kBAAU;AACTs6B,gBAAMkM;AADG;AADR,OAJG;AAVO,KAAd;AAqBA,WAAO,KAAKvgC,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDm7B,0BAAwBL,UAAxB,EAAoCC,UAApC,EAAgD/6B,OAAhD,EAAyD;AACxD,QAAI+6B,cAAc,IAAlB,EAAwB;AAAEA,mBAAa,EAAb;AAAkB;;AAC5C,QAAI/6B,WAAW,IAAf,EAAqB;AAAEA,gBAAU,EAAV;AAAe;;AACtC,QAAI,CAACvI,EAAEujC,OAAF,CAAUD,UAAV,CAAL,EAA4B;AAC3BA,mBAAa,CAAEA,UAAF,CAAb;AACA;;AAED,UAAME,YAAY,IAAI39B,MAAJ,CAAW5G,EAAE2Y,YAAF,CAAeyrB,UAAf,CAAX,EAAuC,GAAvC,CAAlB;;AAEA,UAAMM,SAAS3jC,EAAEc,MAAF,CAAStI,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,EAAiD0B,IAAjD,GAAwDwE,KAAxD,CAA8D,GAA9D,CAAT,EAA6E,UAAS6/B,GAAT,EAAcC,EAAd,EAAkB;AAC7GD,UAAI5iC,IAAJ,CAAS;AAAE,SAAC6iC,GAAGtkC,IAAH,EAAD,GAAaikC;AAAf,OAAT;AACA,aAAOI,GAAP;AACA,KAHc,EAGZ,EAHY,CAAf;;AAIA,UAAM1mC,QAAQ;AACbumC,YAAM,CACL;AACC3kB,gBAAQ,IADT;AAECoK,aAAKya;AAFN,OADK,EAKL;AACC7mC,kBAAU;AAAE6xB,mBAAS,IAAX;AAAiByI,gBAAMkM;AAAvB;AADX,OALK;AADO,KAAd,CAbwD,CAyBxD;;AACA,WAAO,KAAK5O,GAAL,CAAS3xB,IAAT,CAAc7F,KAAd,EAAqBqL,OAArB,CAAP;AACA;;AAEDu7B,4BAA0BC,cAA1B,EAA0Cx7B,OAA1C,EAAmD;AAClD,UAAMrL,QAAQ;AACbJ,gBAAU;AACT6xB,iBAAS;AADA,OADG;AAKbzF,WAAK,CACJ;AAACtvB,cAAMmqC;AAAP,OADI,EAEJ;AAACjnC,kBAAUinC;AAAX,OAFI,CALQ;AAUbt/B,YAAM;AACLyc,aAAK,CAAC,MAAD;AADA;AAVO,KAAd;AAeA,WAAO,KAAKne,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED+f,mCAAiC0b,0BAAjC,EAA6Dz7B,OAA7D,EAAsE;AACrE,UAAMrL,QAAQ;AACbgsB,WAAK,CACJ;AAACtvB,cAAMoqC;AAAP,OADI,EAEJ;AAAClnC,kBAAUknC;AAAX,OAFI,EAGJ;AAAC,0BAAkBA;AAAnB,OAHI,CADQ;AAMbv/B,YAAM;AACLyc,aAAK,CAAC,MAAD,EAAS,KAAT;AADA;AANO,KAAd;AAWA,WAAO,KAAKne,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED07B,gBAAc17B,OAAd,EAAuB;AACtB,UAAMrL,QAAQ;AAACgnC,YAAM;AAAP,KAAd;AAEA,WAAO,KAAKnhC,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED47B,iBAAe57B,OAAf,EAAwB;AACvB,UAAMrL,QAAQ;AAACknC,aAAO;AAAR,KAAd;AAEA,WAAO,KAAKrhC,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAED87B,eAAa97B,OAAb,EAAsB;AACrB,QAAIA,WAAW,IAAf,EAAqB;AAAEA,gBAAU,EAAV;AAAe;;AACtC,UAAMrL,QAAQ;AAAE2qB,iBAAW;AAAE8G,iBAAS;AAAX;AAAb,KAAd;AACApmB,YAAQ4f,IAAR,GAAe;AAAEN,iBAAW,CAAC;AAAd,KAAf;AACAtf,YAAQif,KAAR,GAAgB,CAAhB;AACA,UAAM,CAACjrB,IAAD,IAAS,KAAKwG,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,EAA0BgM,KAA1B,EAAf;AACA,WAAOhY,QAAQA,KAAKsrB,SAApB;AACA;;AAEDyc,uBAAqBlmC,SAArB,EAAgCmK,OAAhC,EAAyC;AACxC,UAAMrL,QAAQ;AACbJ,gBAAU;AACTokB,aAAK9iB;AADI;AADG,KAAd;AAMA,WAAO,KAAK2E,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAEDwX,iBAAesV,GAAf,EAAoB9sB,OAApB,EAA6B;AAC5B,UAAMrL,QAAQ;AACbvB,WAAK;AACJulB,aAAKmU;AADD;AADQ,KAAd;AAKA,WAAO,KAAKtyB,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA,GA7O+C,CA+OhD;;;AACA01B,eAAatiC,GAAb,EAAkBqgC,SAAlB,EAA6B;AAC5BA,gBAAY,GAAG95B,MAAH,CAAU85B,SAAV,CAAZ;AAEA,UAAM9+B,QAAQ;AAACvB;AAAD,KAAd;AAEA,UAAMuqB,SAAS;AACdyG,iBAAW;AACVqP,mBAAW;AACVkC,iBAAOlC;AADG;AADD;AADG,KAAf;AAQA,WAAO,KAAK9V,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDqe,sBAAoB5oC,GAApB,EAAyB;AACxB,UAAMuqB,SAAS;AACdC,YAAM;AACL0B,mBAAW,IAAIznB,IAAJ;AADN;AADQ,KAAf;AAMA,WAAO,KAAK8lB,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAEDse,eAAa7oC,GAAb,EAAkB8oC,WAAlB,EAA+BC,SAA/B,EAA0C;AACzC,UAAMxe,SACN;AAACC,YAAM;AAAP,KADA;AAGA,UAAMwe,eAAgB,YAAYF,WAAa,KAA/C;AACAve,WAAOC,IAAP,CAAYwe,YAAZ,IAA4BD,SAA5B;AAEA,WAAO,KAAKxe,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAEDyF,cAAYhwB,GAAZ,EAAiBmB,QAAjB,EAA2B;AAC1B,UAAMopB,SACN;AAACC,YAAM;AAACrpB;AAAD;AAAP,KADA;AAGA,WAAO,KAAKopB,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAED4F,WAASnwB,GAAT,EAAc6K,KAAd,EAAqB;AACpB,UAAM0f,SAAS;AACdC,YAAM;AACLnJ,gBAAQ,CAAC;AACRE,mBAAS1W,KADD;AAERyW,oBAAU;AAFF,SAAD;AADH;AADQ,KAAf;AAUA,WAAO,KAAKiJ,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAED0e,mBAAiBjpC,GAAjB,EAAsB6K,KAAtB,EAA6B;AAC5B,UAAMtJ,QAAQ;AACbvB,SADa;AAEbqhB,cAAQ;AACP6nB,oBAAY;AACX3nB,mBAAS1W,KADE;AAEXyW,oBAAU;AAFC;AADL;AAFK,KAAd;AAUA,UAAMiJ,SAAS;AACdC,YAAM;AACL,6BAAqB;AADhB;AADQ,KAAf;AAMA,WAAO,KAAKD,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDgM,UAAQv2B,GAAR,EAAa/B,IAAb,EAAmB;AAClB,UAAMssB,SAAS;AACdC,YAAM;AACLvsB;AADK;AADQ,KAAf;AAMA,WAAO,KAAKssB,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAEDoG,kBAAgB3wB,GAAhB,EAAqB+B,MAArB,EAA6B;AAC5B,UAAM+jC,SAAS,EAAf;AACAlhC,WAAOC,IAAP,CAAY9C,MAAZ,EAAoB+C,OAApB,CAA4BC,OAAO;AAClC+gC,aAAQ,gBAAgB/gC,GAAK,EAA7B,IAAkChD,OAAOgD,GAAP,CAAlC;AACA,KAFD;AAIA,UAAMwlB,SAAS;AAACC,YAAMsb;AAAP,KAAf;AAEA,WAAO,KAAKvb,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAED+J,kBAAgBt0B,GAAhB,EAAqBs5B,MAArB,EAA6B;AAC5B,UAAM/O,SAAS;AACdC,YAAM;AACLgB,sBAAc8N;AADT;AADQ,KAAf;AAMA,WAAO,KAAK/O,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAED4e,oBAAkBnpC,GAAlB,EAAuB;AACtB,UAAMuqB,SAAS;AACdwI,cAAQ;AACPvH,sBAAc;AADP;AADM,KAAf;AAMA,WAAO,KAAKjB,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAED6e,iBAAeppC,GAAf,EAAoBilB,OAApB,EAA6B;AAC5B,UAAMsF,SAAS;AACdC,YAAM;AACLvF;AADK;AADQ,KAAf;AAMA3c,YAAQC,GAAR,CAAagiB,MAAb;AACA,WAAO,KAAKA,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAED8e,gBAAcrpC,GAAd,EAAmBmjB,MAAnB,EAA2B;AAC1B,QAAIA,UAAU,IAAd,EAAoB;AAAEA,eAAS,IAAT;AAAgB;;AACtC,UAAMoH,SAAS;AACdC,YAAM;AACLrH;AADK;AADQ,KAAf;AAMA,WAAO,KAAKoH,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAED+e,oBAAkBnmB,MAAlB,EAA0B;AACzB,UAAMoH,SAAS;AACdC,YAAM;AACLrH;AADK;AADQ,KAAf;AAMA,WAAO,KAAKoH,MAAL,CAAY,EAAZ,EAAgBA,MAAhB,EAAwB;AAAE0T,aAAO;AAAT,KAAxB,CAAP;AACA;;AAEDsL,mBAAiBvpC,GAAjB,EAAsB;AACrB,UAAMuqB,SAAS;AACdC,YAAM;AACL,uCAAgC;AAD3B;AADQ,KAAf;AAMA,WAAO,KAAKD,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAEDif,6BAA2BxpC,GAA3B,EAAgC;AAC/B,UAAMuqB,SAAS;AACdwI,cAAQ;AACP,iCAA0B,IADnB;AAEP,uCAAgC;AAFzB;AADM,KAAf;AAOA,WAAO,KAAKxI,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAEDkf,2CAAyCzpC,GAAzC,EAA8CosB,qBAA9C,EAAqEC,2BAArE,EAAkG;AACjG,UAAM9B,SAAS;AACdwI,cAAQ;AACP,6BAAqB;AADd,OADM;AAIdvI,YAAM;AACL4B,6BADK;AAELC;AAFK;AAJQ,KAAf;AAUA,WAAO,KAAK9B,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAEDmf,cAAY1pC,GAAZ,EAAiBuN,QAAjB,EAA2B;AAC1B,UAAMgd,SAAS;AACdC,YAAM;AACLjd;AADK;AADQ,KAAf;AAMA,WAAO,KAAKgd,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAEDof,aAAW3pC,GAAX,EAAgB4pC,OAAhB,EAAyB;AACxB,UAAMrf,SAAS;AACdC,YAAM;AACL,4BAAoBof;AADf;AADQ,KAAf;AAMA,WAAO,KAAKrf,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAEDsf,gBAAc7pC,GAAd,EAAmB;AAClB,UAAMuqB,SAAS;AACdC,YAAM;AACLvoB,kBAAU;AADL;AADQ,KAAf;AAMA,WAAO,KAAKsoB,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAEDuf,iBAAe9pC,GAAf,EAAoByQ,WAApB,EAAiC;AAChC,UAAM8Z,SAAS;AACdC,YAAM;AACL,gCAAwB/Z;AADnB;AADQ,KAAf;AAMA,WAAO,KAAK8Z,MAAL,CAAYvqB,GAAZ,EAAiBuqB,MAAjB,CAAP;AACA;;AAEDwf,eAAa/pC,GAAb,EAAkB8rB,SAAlB,EAA6B;AAC5B,UAAMvqB,QAAQ;AACbvB,SADa;AAEb8rB,iBAAW;AACVlG,aAAKkG;AADK;AAFE,KAAd;AAOA,UAAMvB,SAAS;AACdC,YAAM;AACLsB;AADK;AADQ,KAAf;AAMA,WAAO,KAAKvB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,CAAP;AACA;;AAEDyf,eAAahqC,GAAb,EAAkB0K,IAAlB,EAAwB;AACvB,UAAMo5B,UAAU,EAAhB;AACA,UAAMC,YAAY,EAAlB;;AAEA,QAAIr5B,KAAKzM,IAAL,IAAa,IAAjB,EAAuB;AACtB,UAAI,CAACoG,EAAE2/B,OAAF,CAAU1gC,EAAEM,IAAF,CAAO8G,KAAKzM,IAAZ,CAAV,CAAL,EAAmC;AAClC6lC,gBAAQ7lC,IAAR,GAAeqF,EAAEM,IAAF,CAAO8G,KAAKzM,IAAZ,CAAf;AACA,OAFD,MAEO;AACN8lC,kBAAU9lC,IAAV,GAAiB,CAAjB;AACA;AACD;;AAED,QAAIyM,KAAKG,KAAL,IAAc,IAAlB,EAAwB;AACvB,UAAI,CAACxG,EAAE2/B,OAAF,CAAU1gC,EAAEM,IAAF,CAAO8G,KAAKG,KAAZ,CAAV,CAAL,EAAoC;AACnCi5B,gBAAQziB,MAAR,GAAiB,CAAC;AAACE,mBAASje,EAAEM,IAAF,CAAO8G,KAAKG,KAAZ;AAAV,SAAD,CAAjB;AACA,OAFD,MAEO;AACNk5B,kBAAU1iB,MAAV,GAAmB,CAAnB;AACA;AACD;;AAED,QAAI3W,KAAKshB,KAAL,IAAc,IAAlB,EAAwB;AACvB,UAAI,CAAC3nB,EAAE2/B,OAAF,CAAU1gC,EAAEM,IAAF,CAAO8G,KAAKshB,KAAZ,CAAV,CAAL,EAAoC;AACnC8X,gBAAQ9X,KAAR,GAAgB,CAAC;AAACie,uBAAa3mC,EAAEM,IAAF,CAAO8G,KAAKshB,KAAZ;AAAd,SAAD,CAAhB;AACA,OAFD,MAEO;AACN+X,kBAAU/X,KAAV,GAAkB,CAAlB;AACA;AACD;;AAED,UAAMzB,SAAS,EAAf;;AAEA,QAAI,CAAClmB,EAAE2/B,OAAF,CAAUF,OAAV,CAAL,EAAyB;AACxBvZ,aAAOC,IAAP,GAAcsZ,OAAd;AACA;;AAED,QAAI,CAACz/B,EAAE2/B,OAAF,CAAUD,SAAV,CAAL,EAA2B;AAC1BxZ,aAAOwI,MAAP,GAAgBgR,SAAhB;AACA;;AAED,QAAI1/B,EAAE2/B,OAAF,CAAUzZ,MAAV,CAAJ,EAAuB;AACtB,aAAO,IAAP;AACA;;AAED,WAAO,KAAKA,MAAL,CAAY;AAAEvqB;AAAF,KAAZ,EAAqBuqB,MAArB,CAAP;AACA,GA7gB+C,CA+gBhD;;;AACA2f,SAAOx/B,IAAP,EAAa;AACZ,UAAM9J,OAAO;AACZqrB,iBAAW,IAAIxnB,IAAJ,EADC;AAEZ+mB,oBAAc;AAFF,KAAb;;AAKAnnB,MAAE0nB,MAAF,CAASnrB,IAAT,EAAe8J,IAAf;;AAEA,WAAO,KAAK8mB,MAAL,CAAY5wB,IAAZ,CAAP;AACA,GAzhB+C,CA4hBhD;;;AACA8pB,aAAW1qB,GAAX,EAAgB;AACf,WAAO,KAAKsH,MAAL,CAAYtH,GAAZ,CAAP;AACA;AAED;;;;;;;;;AAOAghB,6BAA2BmpB,QAA3B,EAAqC;AACpC,UAAM5oC,QAAQ;AACbvB,WAAK;AACJulB,aAAK4kB;AADD,OADQ;AAIbhnB,cAAQ,IAJK;AAKb/I,cAAQ,SALK;AAMb4K,wBAAkB;AACjBY,aAAK;AADY,OANL;AASb,yBAAmB;AATN,KAAd;AAYA,UAAMhZ,UAAU;AACf7K,cAAQ;AACP9D,cAAM,CADC;AAEPkD,kBAAU,CAFH;AAGPkgB,gBAAQ,CAHD;AAIP,sDAA8C,CAJvC;AAKP9T,kBAAU;AALH;AADO,KAAhB;AAUA,WAAO,KAAKnG,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,CAAP;AACA;;AAhkB+C;;AAmkBjD/P,WAAWC,MAAX,CAAkBwf,KAAlB,GAA0B,IAAI4qB,UAAJ,CAAeznC,OAAO0kB,KAAtB,EAA6B,IAA7B,CAA1B,C;;;;;;;;;;;ACtkBA,IAAI9f,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAIwtC,IAAJ;AAAS5tC,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAACwtC,WAAKxtC,CAAL;AAAO;;AAAnB,CAA/B,EAAoD,CAApD;AAAuD,IAAIL,YAAJ;AAAiBC,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACH,eAAaK,CAAb,EAAe;AAACL,mBAAaK,CAAb;AAAe;;AAAhC,CAA/B,EAAiE,CAAjE;AAAoE,IAAIytC,UAAJ;AAAe7tC,OAAOC,KAAP,CAAaC,QAAQ,aAAR,CAAb,EAAoC;AAACC,UAAQC,CAAR,EAAU;AAACytC,iBAAWztC,CAAX;AAAa;;AAAzB,CAApC,EAA+D,CAA/D;AAMlO,MAAM6S,SAAS,IAAIC,MAAJ,CAAW,WAAX,CAAf;AAEA,MAAM46B,SAASF,KAAKG,OAAL,CAAaC,GAA5B;AACA,MAAMC,SAASL,KAAKG,OAAL,CAAa3kB,GAA5B;;AAEAwkB,KAAKG,OAAL,CAAaC,GAAb,GAAmB,UAASE,CAAT,EAAYC,CAAZ,EAAe;AACjC,MAAIj5B,MAAMk2B,OAAN,CAAc8C,CAAd,CAAJ,EAAsB;AACrB,WAAOA,EAAEthC,OAAF,CAAUuhC,CAAV,MAAiB,CAAC,CAAzB;AACA;;AACD,SAAOL,OAAOI,CAAP,EAAUC,CAAV,CAAP;AACA,CALD;;AAOAP,KAAKG,OAAL,CAAa3kB,GAAb,GAAmB,UAAS8kB,CAAT,EAAYC,CAAZ,EAAe;AACjC,MAAIj5B,MAAMk2B,OAAN,CAAc8C,CAAd,CAAJ,EAAsB;AACrB,WAAOA,EAAEthC,OAAF,CAAUuhC,CAAV,MAAiB,CAAC,CAAzB;AACA;;AACD,SAAOF,OAAOC,CAAP,EAAUC,CAAV,CAAP;AACA,CALD;;AAOA,MAAMC,SAASR,KAAKG,OAAL,CAAahlB,GAA5B;;AACA6kB,KAAKG,OAAL,CAAahlB,GAAb,GAAmB,UAASmlB,CAAT,EAAYC,CAAZ,EAAe;AACjC,MAAIj5B,MAAMk2B,OAAN,CAAc8C,CAAd,CAAJ,EAAsB;AACrB,WAAOA,EAAE5uB,IAAF,CAAO+uB,QAAQD,OAAOC,IAAP,EAAaF,CAAb,CAAf,CAAP;AACA;;AACD,SAAOC,OAAOF,CAAP,EAAUC,CAAV,CAAP;AACA,CALD;;AAOAP,KAAKG,OAAL,CAAa9O,IAAb,GAAoB,UAASiP,CAAT,EAAYC,CAAZ,EAAe;AAClC,SAAO,CAACP,KAAKG,OAAL,CAAahlB,GAAb,CAAiBmlB,CAAjB,EAAoBC,CAApB,CAAR;AACA,CAFD;;AAIAP,KAAKG,OAAL,CAAa1I,IAAb,GAAoB,UAAS6I,CAAT,EAAYC,CAAZ,EAAe;AAClC,SAAOA,EAAE9hB,KAAF,CAAQiiB,QAAQJ,EAAEvtB,QAAF,CAAW2tB,IAAX,CAAhB,CAAP;AACA,CAFD;;AAIAV,KAAKG,OAAL,CAAavX,OAAb,GAAuB,UAAS0X,CAAT,EAAYC,CAAZ,EAAe;AACrC,MAAIA,CAAJ,EAAO;AACN,WAAOP,KAAKG,OAAL,CAAa3kB,GAAb,CAAiB8kB,CAAjB,EAAoBn6B,SAApB,CAAP;AACA;;AAED,SAAO65B,KAAKG,OAAL,CAAaC,GAAb,CAAiBE,CAAjB,EAAoBn6B,SAApB,CAAP;AACA,CAND;;AAQA65B,KAAKG,OAAL,CAAarB,UAAb,GAA0B,UAASwB,CAAT,EAAYC,CAAZ,EAAe;AACxC,SAAOtmC,EAAE6pB,SAAF,CAAYwc,CAAZ,EAAeC,CAAf,CAAP;AACA,CAFD;;AAIA,MAAMI,SAAS,CACd,MADc,EAEd,MAFc,EAGd,IAHc,EAId,iBAJc,CAAf;;AAOA,SAASC,gBAAT,CAA0BC,MAA1B,EAAkC;AACjCA,SAAOC,MAAP,GAAgB,EAAhB;;AAEA,OAAK,MAAMC,QAAX,IAAuBF,MAAvB,EAA+B;AAC9B,QAAI,OAAOA,OAAOE,QAAP,CAAP,KAA4B,UAA5B,IAA0CJ,OAAO3hC,OAAP,CAAe+hC,QAAf,MAA6B,CAAC,CAA5E,EAA+E;AAC9EF,aAAOC,MAAP,CAAcC,QAAd,IAA0B;AACzBC,eAAO,CADkB;AAEzBtjC,cAAM,CAFmB;AAGzBujC,aAAK;AAHoB,OAA1B;AAKA,YAAMC,aAAaL,OAAOE,QAAP,CAAnB;;AACAF,aAAOE,QAAP,IAAmB,UAAS,GAAG15B,IAAZ,EAAkB;AAEpC,YAAIw5B,OAAOM,MAAP,KAAkB,IAAtB,EAA4B;AAC3B,iBAAOD,WAAWx5B,KAAX,CAAiBm5B,MAAjB,EAAyBx5B,IAAzB,CAAP;AACA;;AAED,cAAM+5B,YAAY3uC,WAAWqL,YAAX,CAAwBH,GAAxB,EAAlB;AACA,cAAMH,SAAS0jC,WAAWx5B,KAAX,CAAiBm5B,MAAjB,EAAyBx5B,IAAzB,CAAf;AACA,cAAM3J,OAAO4M,KAAK+2B,KAAL,CAAW5uC,WAAWqL,YAAX,CAAwBH,GAAxB,KAAgCyjC,SAA3C,IAAwD,IAArE;AACAP,eAAOC,MAAP,CAAcC,QAAd,EAAwBrjC,IAAxB,IAAgCA,IAAhC;AACAmjC,eAAOC,MAAP,CAAcC,QAAd,EAAwBC,KAAxB;AACAH,eAAOC,MAAP,CAAcC,QAAd,EAAwBE,GAAxB,GAA8BJ,OAAOC,MAAP,CAAcC,QAAd,EAAwBrjC,IAAxB,GAA+BmjC,OAAOC,MAAP,CAAcC,QAAd,EAAwBC,KAArF;AAEA,eAAOxjC,MAAP;AACA,OAdD;AAeA;AACD;;AAEDkT,cAAY,YAAW;AACtB,SAAK,MAAMqwB,QAAX,IAAuBF,OAAOC,MAA9B,EAAsC;AACrC,UAAID,OAAOC,MAAP,CAAcj7B,cAAd,CAA6Bk7B,QAA7B,KAA0CF,OAAOC,MAAP,CAAcC,QAAd,EAAwBrjC,IAAxB,GAA+B,CAA7E,EAAgF;AAC/E,cAAM+7B,OAAO,CAAE,YAAYsH,QAAU,EAAxB,EAA4B,cAAcF,OAAOjS,cAAgB,EAAjE,CAAb;AACAn8B,mBAAWqL,YAAX,CAAwBC,MAAxB,CAA+B,oBAA/B,EAAqD8iC,OAAOC,MAAP,CAAcC,QAAd,EAAwBE,GAA7E,EAAkFxH,IAAlF;AACAhnC,mBAAWqL,YAAX,CAAwBoM,SAAxB,CAAkC,yBAAlC,EAA6D22B,OAAOC,MAAP,CAAcC,QAAd,EAAwBrjC,IAArF,EAA2F+7B,IAA3F;AACAhnC,mBAAWqL,YAAX,CAAwBoM,SAAxB,CAAkC,qBAAlC,EAAyD22B,OAAOC,MAAP,CAAcC,QAAd,EAAwBC,KAAjF,EAAwFvH,IAAxF;AACAoH,eAAOC,MAAP,CAAcC,QAAd,EAAwBE,GAAxB,GAA8B,CAA9B;AACAJ,eAAOC,MAAP,CAAcC,QAAd,EAAwBrjC,IAAxB,GAA+B,CAA/B;AACAmjC,eAAOC,MAAP,CAAcC,QAAd,EAAwBC,KAAxB,GAAgC,CAAhC;AACA;AACD;AACD,GAZD,EAYG,KAZH;;AAcAH,SAAOS,YAAP,GAAsB,YAAW;AAChC,UAAMC,QAAQ,EAAd;;AACA,SAAK,MAAMR,QAAX,IAAuBF,OAAOC,MAA9B,EAAsC;AACrC,UAAID,OAAOC,MAAP,CAAcj7B,cAAd,CAA6Bk7B,QAA7B,CAAJ,EAA4C;AAC3CQ,cAAMtmC,IAAN,CAAW,CAACqP,KAAK+2B,KAAL,CAAWR,OAAOC,MAAP,CAAcC,QAAd,EAAwBE,GAAxB,GAA4B,GAAvC,IAA4C,GAA7C,EAAkDF,QAAlD,CAAX;AACA;AACD;;AACD,WAAO9mC,EAAEwD,MAAF,CAAS8jC,KAAT,EAAgB,UAAS9X,MAAT,EAAiB;AACvC,aAAOA,OAAO,CAAP,CAAP;AACA,KAFM,CAAP;AAGA,GAVD;AAWA;;AAED,MAAM+X,OAAN,CAAc;AACbC;AAAa;AAAsB,GAAE;;AACrCC;AAAa;AAAgC,GAAE;;AAC/CC;AAAe;AAAsB,GAAE;;AAH1B;;AAMd,MAAM5gB,KAAK,IAAIif,IAAJ,CAAS,kBAAT,EAA6B;AAAC4B,WAASJ;AAAV,CAA7B,CAAX;;AAEA,MAAMnT,eAAN,SAA8Bl8B,YAA9B,CAA2C;AAC1CyB,cAAYo4B,KAAZ,EAAmB;AAClB;AAEA4U,qBAAiB,IAAjB;AAEA,SAAKiB,OAAL,GAAe,EAAf;AACA,SAAK/L,mBAAL,GAA2B,CAAC,YAAD,CAA3B;AAEA,SAAK3+B,KAAL,GAAa,EAAb;AACA,SAAKqL,OAAL,GAAe,EAAf;AAEA,SAAKktB,WAAL,CAAiB,KAAjB,EAAwB,QAAxB;AAEA,SAAKoS,KAAL,GAAa,EAAb;AAEA,SAAK/4B,EAAL,CAAQ,UAAR,EAAoB,CAAC,GAAG1B,IAAJ,KAAa;AAAE,WAAKwmB,IAAL,CAAU,SAAV,EAAqB,UAArB,EAAiC,GAAGxmB,IAApC;AAA4C,KAA/E;AACA,SAAK0B,EAAL,CAAQ,SAAR,EAAmB,CAAC,GAAG1B,IAAJ,KAAa;AAAE,WAAKwmB,IAAL,CAAU,SAAV,EAAqB,SAArB,EAAgC,GAAGxmB,IAAnC;AAA2C,KAA7E;AACA,SAAK0B,EAAL,CAAQ,SAAR,EAAmB,CAAC,GAAG1B,IAAJ,KAAa;AAAE,WAAKwmB,IAAL,CAAU,SAAV,EAAqB,SAArB,EAAgC,GAAGxmB,IAAnC;AAA2C,KAA7E;AAEA,SAAK0B,EAAL,CAAQ,cAAR,EAAwB,CAAC,GAAG1B,IAAJ,KAAa;AAAE,WAAKwmB,IAAL,CAAU,cAAV,EAA0B,UAA1B,EAAsC,GAAGxmB,IAAzC;AAAiD,KAAxF;AACA,SAAK0B,EAAL,CAAQ,cAAR,EAAwB,CAAC,GAAG1B,IAAJ,KAAa;AAAE,WAAKwmB,IAAL,CAAU,cAAV,EAA0B,SAA1B,EAAqC,GAAGxmB,IAAxC;AAAgD,KAAvF;AACA,SAAK0B,EAAL,CAAQ,cAAR,EAAwB,CAAC,GAAG1B,IAAJ,KAAa;AAAE,WAAKwmB,IAAL,CAAU,cAAV,EAA0B,SAA1B,EAAqC,GAAGxmB,IAAxC;AAAgD,KAAvF;AAEA,SAAK0B,EAAL,CAAQ,UAAR,EAAoB,CAAC,GAAG1B,IAAJ,KAAa;AAAE,WAAKwmB,IAAL,CAAU,MAAV,EAAkB,UAAlB,EAA8B,GAAGxmB,IAAjC;AAAyC,KAA5E;AACA,SAAK0B,EAAL,CAAQ,SAAR,EAAmB,CAAC,GAAG1B,IAAJ,KAAa;AAAE,WAAKwmB,IAAL,CAAU,MAAV,EAAkB,SAAlB,EAA6B,GAAGxmB,IAAhC;AAAwC,KAA1E;AACA,SAAK0B,EAAL,CAAQ,cAAR,EAAwB,CAAC,GAAG1B,IAAJ,KAAa;AAAE,WAAKwmB,IAAL,CAAU,MAAV,EAAkB,SAAlB,EAA6B,GAAGxmB,IAAhC;AAAwC,KAA/E;AAEA,SAAK0Z,EAAL,GAAUA,EAAV;AAEA,SAAKiL,KAAL,GAAaA,KAAb;AAEA,SAAK4C,cAAL,GAAsB,KAAK5C,KAAL,CAAW2C,GAAX,CAAeC,cAArC;AACA,SAAKmT,UAAL,GAAkB,KAAKhhB,EAAL,CAAQihB,aAAR,CAAsB,KAAKpT,cAA3B,CAAlB;AACA;;AAEDqT,SAAO3pC,IAAP,EAAa;AAACysB,SAAD;AAAQ/tB;AAAR,GAAb,EAA4B;AAC3B,SAAKsB,IAAL,CAAU;AAACA,UAAD;AAAOysB,WAAP;AAAc/tB,UAAd;AAAoB68B,aAAO;AAA3B,KAAV;AACA;;AAEDqO,UAAQ5pC,IAAR,EAAc;AAACysB,SAAD;AAAQ/tB;AAAR,GAAd,EAA6B;AAC5B,SAAKsB,IAAL,CAAU;AAACA,UAAD;AAAOysB,WAAP;AAAc/tB,UAAd;AAAoB68B,aAAO;AAA3B,KAAV;AACA;;AAEDv7B,OAAK;AAACA,QAAD;AAAOysB,SAAP;AAAc/tB,QAAd;AAAoB68B;AAApB,GAAL,EAAiC;AAChC,QAAI,CAACphC,WAAWC,MAAX,CAAkB4F,IAAlB,CAAL,EAA8B;AAC7B4F,cAAQC,GAAR,CAAa,uBAAuB7F,IAAM,EAA1C;AACA;AACA;;AAED7F,eAAWC,MAAX,CAAkB4F,IAAlB,EAAwBw2B,KAAxB,CAA8B/lB,EAA9B,CAAiC,UAAjC,EAA8C0gB,MAAD,IAAY;AACxD,WAAK0Y,yBAAL,CAA+B;AAAC7pC,YAAD;AAAOysB,aAAP;AAAc/tB,YAAd;AAAoB68B,aAApB;AAA2BpK;AAA3B,OAA/B;AACA,KAFD;AAIAh3B,eAAWC,MAAX,CAAkB4F,IAAlB,EAAwBw2B,KAAxB,CAA8B/lB,EAA9B,CAAiC,cAAjC,EAAiD,CAAC0gB,MAAD,EAAStY,IAAT,KAAkB;AAClE,UAAIA,KAAKna,KAAKorC,MAAV,CAAJ,EAAuB;AACtB,aAAKC,wBAAL,CAA8B;AAAC/pC,cAAD;AAAOysB,eAAP;AAAc/tB,cAAd;AAAoB68B,eAApB;AAA2BpK;AAA3B,SAA9B;AACA;AACD,KAJD;AAMAh3B,eAAWC,MAAX,CAAkB4F,IAAlB,EAAwBw2B,KAAxB,CAA8B/lB,EAA9B,CAAiC,SAAjC,EAA4C,CAAC0gB,MAAD,EAAStY,IAAT,KAAkB;AAC7D,UAAIA,KAAKna,KAAKorC,MAAV,CAAJ,EAAuB;AACtB,aAAKD,yBAAL,CAA+B;AAAC7pC,cAAD;AAAOysB,eAAP;AAAc/tB,cAAd;AAAoB68B,eAApB;AAA2BpK;AAA3B,SAA/B;AACA;AACD,KAJD;AAMAh3B,eAAWC,MAAX,CAAkB4F,IAAlB,EAAwBw2B,KAAxB,CAA8B/lB,EAA9B,CAAiC,SAAjC,EAA6C0gB,MAAD,IAAY;AACvD,WAAK4Y,wBAAL,CAA8B;AAAC/pC,YAAD;AAAOysB,aAAP;AAAc/tB,YAAd;AAAoB68B,aAApB;AAA2BpK;AAA3B,OAA9B;AACA,KAFD;AAIA,SAAK1gB,EAAL,CAAQ,UAAR,EAAqBu5B,WAAD,IAAiB;AACpC,WAAKC,wBAAL,CAA8B;AAACjqC,YAAD;AAAOysB,aAAP;AAAc/tB,YAAd;AAAoB68B,aAApB;AAA2ByO;AAA3B,OAA9B;AACA,KAFD;AAIA,SAAKv5B,EAAL,CAAQ,cAAR,EAAwB,CAACu5B,WAAD,EAAcnxB,IAAd,KAAuB;AAC9C,UAAIA,KAAKna,KAAKwrC,KAAV,CAAJ,EAAsB;AACrB,YAAI3O,UAAU,IAAd,EAAoB;AACnByO,sBAAYvd,KAAZ,IAAqB,EAArB;AACA,SAFD,MAEO;AACNud,sBAAYvd,KAAZ,IAAqB5e,SAArB;AACA;AACD;AACD,KARD;AAUA,SAAK4C,EAAL,CAAQ,SAAR,EAAmB,CAACu5B,WAAD,EAAcnxB,IAAd,KAAuB;AACzC,UAAIA,KAAKna,KAAKwrC,KAAV,CAAJ,EAAsB;AACrB,aAAKD,wBAAL,CAA8B;AAACjqC,cAAD;AAAOysB,eAAP;AAAc/tB,cAAd;AAAoB68B,eAApB;AAA2ByO;AAA3B,SAA9B;AACA;AACD,KAJD;AAKA;;AAEDH,4BAA0B;AAACpd,SAAD;AAAQ/tB,QAAR;AAAc68B,SAAd;AAAqBpK;AAArB,GAA1B,EAAwD;AACvD,QAAIgZ,eAAe,KAAKC,YAAL,CAAkB1rC,KAAKwrC,KAAvB,EAA8BvC,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuBzyB,KAAKorC,MAA5B,CAA9B,CAAnB;;AAEA,QAAI,CAACK,YAAL,EAAmB;AAClB;AACA;;AAED,QAAI,CAACn7B,MAAMk2B,OAAN,CAAciF,YAAd,CAAL,EAAkC;AACjCA,qBAAe,CAACA,YAAD,CAAf;AACA;;AAED,SAAK,IAAIj3B,IAAI,CAAb,EAAgBA,IAAIi3B,aAAa1uC,MAAjC,EAAyCyX,GAAzC,EAA8C;AAC7C,YAAM82B,cAAcG,aAAaj3B,CAAb,CAApB;;AACA,UAAIqoB,UAAU,IAAV,IAAkB,CAACyO,YAAYvd,KAAZ,CAAvB,EAA2C;AAC1Cud,oBAAYvd,KAAZ,IAAqB,EAArB;AACA;;AAED,UAAI,OAAO/tB,KAAK2rC,KAAZ,KAAsB,UAAtB,IAAoC3rC,KAAK2rC,KAAL,CAAWL,WAAX,EAAwB7Y,MAAxB,MAAoC,KAA5E,EAAmF;AAClF;AACA;;AAED,UAAImZ,gBAAgBnZ,MAApB;;AAEA,UAAI,OAAOzyB,KAAK6rC,SAAZ,KAA0B,UAA9B,EAA0C;AACzCD,wBAAgB5rC,KAAK6rC,SAAL,CAAeP,WAAf,EAA4BM,aAA5B,CAAhB;AACA;;AAED,UAAI/O,UAAU,IAAd,EAAoB;AACnByO,oBAAYvd,KAAZ,EAAmB9pB,IAAnB,CAAwB2nC,aAAxB;AACA,OAFD,MAEO;AACNN,oBAAYvd,KAAZ,IAAqB6d,aAArB;AACA;;AAED,WAAK/U,IAAL,CAAW,QAAQ9I,KAAO,WAA1B,EAAsCud,WAAtC,EAAmDM,aAAnD;AACA,WAAK/U,IAAL,CAAW,QAAQ9I,KAAO,UAA1B,EAAqC,UAArC,EAAiDud,WAAjD,EAA8DM,aAA9D;AACA;AACD;;AAEDL,2BAAyB;AAACjqC,QAAD;AAAOysB,SAAP;AAAc/tB,QAAd;AAAoB68B,SAApB;AAA2ByO;AAA3B,GAAzB,EAAkE;AACjE,QAAI7e,UAAUhxB,WAAWC,MAAX,CAAkB4F,IAAlB,EAAwBw2B,KAAxB,CAA8B4T,YAA9B,CAA2C1rC,KAAKorC,MAAhD,EAAwDnC,WAAWnoC,GAAX,CAAewqC,WAAf,EAA4BtrC,KAAKwrC,KAAjC,CAAxD,CAAd;;AAEA,QAAI,CAACl7B,MAAMk2B,OAAN,CAAc/Z,OAAd,CAAL,EAA6B;AAC5BA,gBAAU,CAACA,OAAD,CAAV;AACA;;AAED,SAAK,IAAIjY,IAAI,CAAb,EAAgBA,IAAIiY,QAAQ1vB,MAA5B,EAAoCyX,GAApC,EAAyC;AACxC,UAAIie,SAAShG,QAAQjY,CAAR,CAAb;;AAEA,UAAI,OAAOxU,KAAK2rC,KAAZ,KAAsB,UAAtB,IAAoC3rC,KAAK2rC,KAAL,CAAWL,WAAX,EAAwB7Y,MAAxB,MAAoC,KAA5E,EAAmF;AAClF;AACA;;AAED,UAAI,OAAOzyB,KAAK6rC,SAAZ,KAA0B,UAA9B,EAA0C;AACzCpZ,iBAASzyB,KAAK6rC,SAAL,CAAeP,WAAf,EAA4B7Y,MAA5B,CAAT;AACA;;AAED,UAAIoK,UAAU,IAAd,EAAoB;AACnByO,oBAAYvd,KAAZ,EAAmB9pB,IAAnB,CAAwBwuB,MAAxB;AACA,OAFD,MAEO;AACN6Y,oBAAYvd,KAAZ,IAAqB0E,MAArB;AACA;;AAED,WAAKoE,IAAL,CAAW,QAAQ9I,KAAO,WAA1B,EAAsCud,WAAtC,EAAmD7Y,MAAnD;AACA,WAAKoE,IAAL,CAAW,QAAQ9I,KAAO,UAA1B,EAAqC,UAArC,EAAiDud,WAAjD,EAA8D7Y,MAA9D;AACA;AACD;;AAED4Y,2BAAyB;AAACtd,SAAD;AAAQ/tB,QAAR;AAAc68B,SAAd;AAAqBpK;AAArB,GAAzB,EAAuD;AACtD,QAAIgZ,eAAe,KAAKC,YAAL,CAAkB1rC,KAAKwrC,KAAvB,EAA8BvC,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuBzyB,KAAKorC,MAA5B,CAA9B,CAAnB;;AAEA,QAAI,CAACK,YAAL,EAAmB;AAClB;AACA;;AAED,QAAI,CAACn7B,MAAMk2B,OAAN,CAAciF,YAAd,CAAL,EAAkC;AACjCA,qBAAe,CAACA,YAAD,CAAf;AACA;;AAED,SAAK,IAAIj3B,IAAI,CAAb,EAAgBA,IAAIi3B,aAAa1uC,MAAjC,EAAyCyX,GAAzC,EAA8C;AAC7C,YAAM82B,cAAcG,aAAaj3B,CAAb,CAApB;;AAEA,UAAIqoB,UAAU,IAAd,EAAoB;AACnB,YAAIvsB,MAAMk2B,OAAN,CAAc8E,YAAYvd,KAAZ,CAAd,CAAJ,EAAuC;AACtC,cAAI,OAAO/tB,KAAKkG,MAAZ,KAAuB,UAA3B,EAAuC;AACtClG,iBAAKkG,MAAL,CAAYolC,YAAYvd,KAAZ,CAAZ,EAAgC0E,MAAhC;AACA,WAFD,MAEO,IAAI6Y,YAAYvd,KAAZ,EAAmB/lB,OAAnB,CAA2ByqB,MAA3B,IAAqC,CAAC,CAA1C,EAA6C;AACnD6Y,wBAAYvd,KAAZ,EAAmBxB,MAAnB,CAA0B+e,YAAYvd,KAAZ,EAAmB/lB,OAAnB,CAA2ByqB,MAA3B,CAA1B,EAA8D,CAA9D;AACA;AACD;AACD,OARD,MAQO;AACN6Y,oBAAYvd,KAAZ,IAAqB5e,SAArB;AACA;;AAED,WAAK0nB,IAAL,CAAW,QAAQ9I,KAAO,UAA1B,EAAqCud,WAArC,EAAkD7Y,MAAlD;AACA,WAAKoE,IAAL,CAAW,QAAQ9I,KAAO,UAA1B,EAAqC,SAArC,EAAgDud,WAAhD,EAA6D7Y,MAA7D;AACA;AACD;;AAEDiG,cAAY/3B,MAAZ,EAAoB+G,OAAK,OAAzB,EAAkC;AACjC,QAAI,CAAC4I,MAAMk2B,OAAN,CAAc7lC,MAAd,CAAL,EAA4B;AAC3BA,eAAS,CAACA,MAAD,CAAT;AACA;;AAED,SAAKkqC,OAAL,CAAalqC,OAAOW,IAAP,CAAY,GAAZ,CAAb,IAAiC;AAChCoG,UADgC;AAEhC/G,YAFgC;AAGhC2I,YAAM;AAH0B,KAAjC;AAKA;;AAEDwiC,kBAAgBrZ,MAAhB,EAAwB;AACvB,SAAK,MAAMsZ,SAAX,IAAwB,KAAKlB,OAA7B,EAAsC;AACrC,UAAI,KAAKA,OAAL,CAAah8B,cAAb,CAA4Bk9B,SAA5B,CAAJ,EAA4C;AAC3C,aAAKC,UAAL,CAAgBD,SAAhB,EAA2BtZ,MAA3B;AACA;AACD;AACD;;AAEDuZ,aAAWD,SAAX,EAAsBtZ,MAAtB,EAA8B;AAC7B,UAAMnG,QAAQ,KAAKue,OAAL,CAAakB,SAAb,CAAd;;AACA,QAAI,CAACzf,KAAL,EAAY;AACXplB,cAAQ6B,KAAR,CAAe,qBAAqBgjC,SAAW,EAA/C;AACA;AACA;;AAED,UAAMtoC,OAAO,EAAb;;AACA,SAAK,MAAMsqB,KAAX,IAAoBzB,MAAM3rB,MAA1B,EAAkC;AACjC8C,WAAKQ,IAAL,CAAUglC,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuB1E,KAAvB,CAAV;AACA;;AACD,UAAMpqB,MAAMF,KAAKnC,IAAL,CAAU,GAAV,CAAZ;;AAEA,QAAIgrB,MAAM5kB,IAAN,KAAe,QAAnB,EAA6B;AAC5B4kB,YAAMhjB,IAAN,CAAW3F,GAAX,IAAkB8uB,MAAlB;AACA;AACA;;AAED,QAAInG,MAAM5kB,IAAN,KAAe,OAAnB,EAA4B;AAC3B,UAAI,CAAC4kB,MAAMhjB,IAAN,CAAW3F,GAAX,CAAL,EAAsB;AACrB2oB,cAAMhjB,IAAN,CAAW3F,GAAX,IAAkB,EAAlB;AACA;;AACD2oB,YAAMhjB,IAAN,CAAW3F,GAAX,EAAgBM,IAAhB,CAAqBwuB,MAArB;AACA;AACA;AACD;;AAEDwZ,uBAAqBxZ,MAArB,EAA6B;AAC5B,SAAK,MAAMsZ,SAAX,IAAwB,KAAKlB,OAA7B,EAAsC;AACrC,UAAI,KAAKA,OAAL,CAAah8B,cAAb,CAA4Bk9B,SAA5B,CAAJ,EAA4C;AAC3C,aAAKG,eAAL,CAAqBH,SAArB,EAAgCtZ,MAAhC;AACA;AACD;AACD;;AAEDyZ,kBAAgBH,SAAhB,EAA2BtZ,MAA3B,EAAmC;AAClC,UAAMnG,QAAQ,KAAKue,OAAL,CAAakB,SAAb,CAAd;;AACA,QAAI,CAAC,KAAKlB,OAAL,CAAakB,SAAb,CAAL,EAA8B;AAC7B7kC,cAAQ6B,KAAR,CAAe,qBAAqBgjC,SAAW,EAA/C;AACA;AACA;;AAED,QAAI,CAACzf,MAAMhjB,IAAX,EAAiB;AAChB;AACA;;AAED,QAAI3F,MAAM,EAAV;;AACA,SAAK,MAAMoqB,KAAX,IAAoBzB,MAAM3rB,MAA1B,EAAkC;AACjCgD,UAAIM,IAAJ,CAASglC,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuB1E,KAAvB,CAAT;AACA;;AACDpqB,UAAMA,IAAIrC,IAAJ,CAAS,GAAT,CAAN;;AAEA,QAAIgrB,MAAM5kB,IAAN,KAAe,QAAnB,EAA6B;AAC5B4kB,YAAMhjB,IAAN,CAAW3F,GAAX,IAAkBwL,SAAlB;AACA;AACA;;AAED,QAAImd,MAAM5kB,IAAN,KAAe,OAAnB,EAA4B;AAC3B,UAAI,CAAC4kB,MAAMhjB,IAAN,CAAW3F,GAAX,CAAL,EAAsB;AACrB;AACA;;AACD,YAAM6Q,IAAI8X,MAAMhjB,IAAN,CAAW3F,GAAX,EAAgBqE,OAAhB,CAAwByqB,MAAxB,CAAV;;AACA,UAAIje,IAAI,CAAC,CAAT,EAAY;AACX8X,cAAMhjB,IAAN,CAAW3F,GAAX,EAAgB4oB,MAAhB,CAAuB/X,CAAvB,EAA0B,CAA1B;AACA;;AACD;AACA;AACD;;AAEDk3B,eAAapf,KAAb,EAAoB7oB,IAApB,EAA0B;AACzB,UAAME,MAAM,GAAGwB,MAAH,CAAU1B,IAAV,EAAgBnC,IAAhB,CAAqB,GAArB,CAAZ;;AACA,QAAI,CAAC,KAAKupC,OAAL,CAAave,KAAb,CAAL,EAA0B;AACzB;AACA;;AAED,QAAI,KAAKue,OAAL,CAAave,KAAb,EAAoBhjB,IAAxB,EAA8B;AAC7B,YAAM9C,SAAS,KAAKqkC,OAAL,CAAave,KAAb,EAAoBhjB,IAApB,CAAyB3F,GAAzB,CAAf;;AACA,UAAI6C,MAAJ,EAAY;AACX,eAAOA,MAAP;AACA;AACD;;AAED,QAAI,KAAKqkC,OAAL,CAAave,KAAb,EAAoB5kB,IAApB,KAA6B,OAAjC,EAA0C;AACzC,aAAO,EAAP;AACA;AACD;;AAEDo5B,cAAYxU,KAAZ,EAAmB7oB,IAAnB,EAAyB+H,UAAQ,EAAjC,EAAqC;AACpC,WAAO;AACNgM,aAAO,MAAM;AACZ,eAAO,KAAKygB,2BAAL,CAAiC,KAAKyT,YAAL,CAAkBpf,KAAlB,EAAyB7oB,IAAzB,CAAjC,EAAiE+H,OAAjE,CAAP;AACA,OAHK;AAKN4hB,aAAO,MAAM;AACZ,cAAMX,UAAU,KAAKqU,WAAL,CAAiBxU,KAAjB,EAAwB7oB,IAAxB,EAA8B+H,OAA9B,EAAuCgM,KAAvC,EAAhB;;AACA,YAAIlH,MAAMk2B,OAAN,CAAc/Z,OAAd,CAAJ,EAA4B;AAC3B,iBAAOA,QAAQ1vB,MAAf;AACA;;AACD,eAAO,CAAC0vB,OAAD,GAAW,CAAX,GAAe,CAAtB;AACA,OAXK;AAaN/oB,eAAUgP,EAAD,IAAQ;AAChB,cAAM+Z,UAAU,KAAKqU,WAAL,CAAiBxU,KAAjB,EAAwB7oB,IAAxB,EAA8B+H,OAA9B,EAAuCgM,KAAvC,EAAhB;;AACA,YAAIlH,MAAMk2B,OAAN,CAAc/Z,OAAd,CAAJ,EAA4B;AAC3B,iBAAOA,QAAQ/oB,OAAR,CAAgBgP,EAAhB,CAAP;AACA;;AACD,YAAI+Z,OAAJ,EAAa;AACZ,iBAAO/Z,GAAG+Z,OAAH,CAAP;AACA;AACD;AArBK,KAAP;AAuBA;;AAED5nB,SAAO;AACN,QAAI,KAAKmwB,KAAL,CAAW6C,SAAX,KAAyB,KAA7B,EAAoC;AACnC;AACA;;AAED3wB,YAAQC,GAAR,CAAY,qBAAZ,EAAmC,KAAKywB,cAAxC;AACA,SAAKf,IAAL,CAAU,YAAV;AACA,SAAKsT,MAAL,GAAc,KAAd;AACA,UAAMzjC,OAAOjL,WAAWqL,YAAX,CAAwBH,GAAxB,EAAb;AACA,UAAM2C,OAAO,KAAK0rB,KAAL,CAAWjL,EAAX,CAAc/jB,IAAd,CAAmB,KAAK7F,KAAxB,EAA+B,KAAKqL,OAApC,EAA6CgM,KAA7C,EAAb;;AACA,SAAK,IAAIhD,IAAE,CAAX,EAAcA,IAAIlL,KAAKvM,MAAvB,EAA+ByX,GAA/B,EAAoC;AACnC,WAAK4b,MAAL,CAAY9mB,KAAKkL,CAAL,CAAZ;AACA;;AACDtN,YAAQC,GAAR,CAAYC,OAAOkC,KAAKvM,MAAZ,CAAZ,EAAiC,mBAAjC,EAAsD,KAAK66B,cAA3D;AACAn8B,eAAWqL,YAAX,CAAwBC,MAAxB,CAA+B,YAA/B,EAA6CtL,WAAWqL,YAAX,CAAwBH,GAAxB,KAAgCD,IAA7E,EAAmF,CAAE,cAAc,KAAKkxB,cAAgB,EAArC,CAAnF;AAEA,SAAKuU,SAAL;AACA,SAAKhC,MAAL,GAAc,IAAd;AACA,SAAKtT,IAAL,CAAU,WAAV;AACA;;AAEDsV,cAAY;AACX,QAAI,KAAKnX,KAAL,CAAW6C,SAAX,KAAyB,KAA7B,EAAoC;AACnC;AACA;;AAED,SAAK7C,KAAL,CAAW2C,GAAX,CAAe5lB,EAAf,CAAkB,QAAlB,EAA4B,CAAC;AAACnS,YAAD;AAASvC,QAAT;AAAaiM;AAAI;;AAAjB,KAAD,KAAmC;AAC9D,cAAQ1J,MAAR;AACC,aAAK,QAAL;AACC0J,eAAK1K,GAAL,GAAWvB,EAAX;AACA,eAAK+yB,MAAL,CAAY9mB,IAAZ;AACA;;AAED,aAAK,QAAL;AACC,eAAKggB,UAAL,CAAgBjsB,EAAhB;AACA;;AAED,aAAK,eAAL;AACC,eAAK+uC,cAAL,CAAoB/uC,EAApB,EAAwBiM,IAAxB;AACA;;AAED,aAAK,aAAL;AACC,eAAK8iC,cAAL,CAAoB/uC,EAApB,EAAwBiM,IAAxB;AACA;;AAED,aAAK,cAAL;AACC,eAAK6f,MAAL,CAAY7f,KAAKnJ,KAAjB,EAAwBmJ,KAAK6f,MAA7B,EAAqC7f,KAAKkC,OAA1C;AACA;AApBF;AAsBA,KAvBD;AAwBA;;AAEDysB,8BAA4BzxB,MAA5B,EAAoCgF,UAAQ,EAA5C,EAAgD;AAC/C,QAAIhF,WAAW2I,SAAX,IAAwB3I,WAAW,IAAvC,EAA6C;AAC5C,aAAO2I,SAAP;AACA;;AAED,QAAImB,MAAMk2B,OAAN,CAAchgC,MAAd,CAAJ,EAA2B;AAC1B,UAAIgF,QAAQ4f,IAAZ,EAAkB;AACjB5kB,iBAASA,OAAO4kB,IAAP,CAAY,CAACke,CAAD,EAAIC,CAAJ,KAAU;AAC9B,cAAI8C,IAAI,CAAR;;AACA,eAAK,MAAMte,KAAX,IAAoBviB,QAAQ4f,IAA5B,EAAkC;AACjC,gBAAI5f,QAAQ4f,IAAR,CAAavc,cAAb,CAA4Bkf,KAA5B,CAAJ,EAAwC;AACvC,oBAAMue,YAAY9gC,QAAQ4f,IAAR,CAAa2C,KAAb,CAAlB;AACA,kBAAIwe,MAAJ;AACA,kBAAIC,MAAJ;;AACA,kBAAIze,MAAM/lB,OAAN,CAAc,GAAd,IAAqB,CAAC,CAA1B,EAA6B;AAC5BukC,yBAAStD,WAAWnoC,GAAX,CAAewoC,CAAf,EAAkBvb,KAAlB,CAAT;AACAye,yBAASvD,WAAWnoC,GAAX,CAAeyoC,CAAf,EAAkBxb,KAAlB,CAAT;AACA,eAHD,MAGO;AACNwe,yBAASjD,EAAEvb,KAAF,CAAT;AACAye,yBAASjD,EAAExb,KAAF,CAAT;AACA;;AACD,kBAAIwe,SAASC,MAAb,EAAqB;AACpBH,oBAAIC,SAAJ;AACA;AACA;;AACD,kBAAIC,SAASC,MAAb,EAAqB;AACpBH,oBAAI,CAACC,SAAL;AACA;AACA;AACD;AACD;;AACD,iBAAOD,CAAP;AACA,SAzBQ,CAAT;AA0BA;;AAED,UAAI,OAAO7gC,QAAQihC,IAAf,KAAwB,QAA5B,EAAsC;AACrCjmC,eAAO+lB,MAAP,CAAc,CAAd,EAAiB/gB,QAAQihC,IAAzB;AACA;;AAED,UAAI,OAAOjhC,QAAQif,KAAf,KAAyB,QAAzB,IAAqCjf,QAAQif,KAAR,KAAkB,CAA3D,EAA8D;AAC7DjkB,eAAO+lB,MAAP,CAAc/gB,QAAQif,KAAtB;AACA;AACD;;AAED,QAAI,CAACjf,QAAQ7K,MAAb,EAAqB;AACpB6K,cAAQ7K,MAAR,GAAiB,EAAjB;AACA;;AAED,UAAM+rC,iBAAiB,EAAvB;AACA,UAAMC,cAAc,EAApB;;AAEA,SAAK,MAAM5e,KAAX,IAAoBviB,QAAQ7K,MAA5B,EAAoC;AACnC,UAAI6K,QAAQ7K,MAAR,CAAekO,cAAf,CAA8Bkf,KAA9B,CAAJ,EAA0C;AACzC,YAAIviB,QAAQ7K,MAAR,CAAeotB,KAAf,MAA0B,CAA9B,EAAiC;AAChC2e,yBAAezoC,IAAf,CAAoB8pB,KAApB;AACA,SAFD,MAEO,IAAIviB,QAAQ7K,MAAR,CAAeotB,KAAf,MAA0B,CAA9B,EAAiC;AACvC4e,sBAAY1oC,IAAZ,CAAiB8pB,KAAjB;AACA;AACD;AACD;;AAED,QAAI2e,eAAe3vC,MAAf,GAAwB,CAAxB,IAA6B4vC,YAAY5vC,MAAZ,GAAqB,CAAtD,EAAyD;AACxDmK,cAAQwvB,IAAR,CAAa,kCAAb;AACAgW,qBAAengB,MAAf,CAAsB,CAAtB,EAAyBmgB,eAAe3vC,MAAxC;AACA;;AAED,QAAI4vC,YAAY5vC,MAAZ,GAAqB,CAArB,IAA0B4vC,YAAY3kC,OAAZ,CAAoB,KAApB,MAA+B,CAAC,CAA9D,EAAiE;AAChE2kC,kBAAY1oC,IAAZ,CAAiB,KAAjB;AACA;;AAED,UAAM2oC,aAAa,CAAC5M,GAAD,EAAMr/B,MAAN,KAAiB;AACnC,YAAMksC,SAAS,EAAf;AACAlsC,aAAO+C,OAAP,CAAgBqqB,KAAD,IAAW;AACzB,YAAIA,MAAM/lB,OAAN,CAAc,GAAd,MAAuB,CAAC,CAA5B,EAA+B;AAC9BihC,qBAAW/kC,GAAX,CAAe2oC,MAAf,EAAuB9e,KAAvB,EAA8Bkb,WAAWnoC,GAAX,CAAek/B,GAAf,EAAoBjS,KAApB,CAA9B;AACA,SAFD,MAEO;AACN8e,iBAAO9e,KAAP,IAAgBiS,IAAIjS,KAAJ,CAAhB;AACA;AACD,OAND;AAOA,aAAO8e,MAAP;AACA,KAVD;;AAYA,QAAIH,eAAe3vC,MAAf,GAAwB,CAAxB,IAA6B4vC,YAAY5vC,MAAZ,GAAqB,CAAtD,EAAyD;AACxD,UAAIuT,MAAMk2B,OAAN,CAAchgC,MAAd,CAAJ,EAA2B;AAC1BA,iBAASA,OAAOhC,GAAP,CAAYiuB,MAAD,IAAY;AAC/B,cAAIia,eAAe3vC,MAAf,GAAwB,CAA5B,EAA+B;AAC9B,mBAAOkG,EAAE6pC,IAAF,CAAOra,MAAP,EAAe,GAAGia,cAAlB,CAAP;AACA;;AAED,cAAIC,YAAY5vC,MAAZ,GAAqB,CAAzB,EAA4B;AAC3B,mBAAO6vC,WAAWna,MAAX,EAAmBka,WAAnB,CAAP;AACA;AACD,SARQ,CAAT;AASA,OAVD,MAUO;AACN,YAAID,eAAe3vC,MAAf,GAAwB,CAA5B,EAA+B;AAC9B,iBAAOkG,EAAE6pC,IAAF,CAAOtmC,MAAP,EAAe,GAAGkmC,cAAlB,CAAP;AACA;;AAED,YAAIC,YAAY5vC,MAAZ,GAAqB,CAAzB,EAA4B;AAC3B,iBAAO6vC,WAAWpmC,MAAX,EAAmBmmC,WAAnB,CAAP;AACA;AACD;AACD;;AAED,WAAOnmC,MAAP;AACA;;AAEDumC,eAAa5sC,KAAb,EAAoB6sC,WAApB,EAAiC;AAChC,QAAI,CAAC7sC,KAAL,EAAY;AACX,aAAOA,KAAP;AACA;;AAED,QAAI4vB,MAAMjsB,IAAN,CAAW3D,KAAX,EAAkBiH,MAAlB,CAAJ,EAA+B;AAC9B,aAAO;AACNxI,aAAKuB;AADC,OAAP;AAGA;;AAED,QAAIqD,OAAOC,IAAP,CAAYtD,KAAZ,EAAmBpD,MAAnB,GAA4B,CAA5B,IAAiCiwC,gBAAgB,YAArD,EAAmE;AAClE,YAAMC,MAAM,EAAZ;;AACA,WAAK,MAAMlf,KAAX,IAAoB5tB,KAApB,EAA2B;AAC1B,YAAIA,MAAM0O,cAAN,CAAqBkf,KAArB,CAAJ,EAAiC;AAChCkf,cAAIhpC,IAAJ,CAAS;AACR,aAAC8pB,KAAD,GAAS5tB,MAAM4tB,KAAN;AADD,WAAT;AAGA;AACD;;AACD5tB,cAAQ;AAACumC,cAAMuG;AAAP,OAAR;AACA;;AAED,SAAK,MAAMlf,KAAX,IAAoB5tB,KAApB,EAA2B;AAC1B,UAAIA,MAAM0O,cAAN,CAAqBkf,KAArB,CAAJ,EAAiC;AAChC,cAAMnqB,QAAQzD,MAAM4tB,KAAN,CAAd;;AACA,YAAInqB,iBAAiBkF,MAAjB,IAA2BilB,UAAU,QAAzC,EAAmD;AAClD5tB,gBAAM4tB,KAAN,IAAe;AACdpG,oBAAQ/jB;AADM,WAAf;AAGA;;AAED,YAAImqB,UAAU,MAAV,IAAoBA,UAAU,KAAlC,EAAyC;AACxC5tB,gBAAM4tB,KAAN,IAAenqB,MAAMY,GAAN,CAAW0oC,QAAD,IAAc;AACtC,mBAAO,KAAKH,YAAL,CAAkBG,QAAlB,EAA4Bnf,KAA5B,CAAP;AACA,WAFc,CAAf;AAGA;;AAED,YAAIgC,MAAMjsB,IAAN,CAAWF,KAAX,EAAkBJ,MAAlB,KAA6BA,OAAOC,IAAP,CAAYG,KAAZ,EAAmB7G,MAAnB,GAA4B,CAA7D,EAAgE;AAC/DoD,gBAAM4tB,KAAN,IAAe,KAAKgf,YAAL,CAAkBnpC,KAAlB,EAAyBmqB,KAAzB,CAAf;AACA;AACD;AACD;;AAED,WAAO5tB,KAAP;AACA;;AAED6F,OAAK7F,KAAL,EAAYqL,UAAQ,EAApB,EAAwB;AACvB,WAAO;AACNgM,aAAO,MAAM;AACZ,YAAI;AACHrX,kBAAQ,KAAK4sC,YAAL,CAAkB5sC,KAAlB,CAAR;AACA,iBAAO,KAAK83B,2BAAL,CAAiC,KAAK8S,UAAL,CAAgB/kC,IAAhB,CAAqB7F,KAArB,CAAjC,EAA8DqL,OAA9D,CAAP;AACA,SAHD,CAGE,OAAOqZ,CAAP,EAAU;AACX3d,kBAAQ6B,KAAR,CAAc,6BAAd,EAA6C,KAAK6uB,cAAlD;AACA1wB,kBAAQ6B,KAAR,CAAc,QAAd,EAAwBumB,KAAK0B,SAAL,CAAe7wB,KAAf,EAAsB,IAAtB,EAA4B,CAA5B,CAAxB;AACA+G,kBAAQ6B,KAAR,CAAc,UAAd,EAA0BumB,KAAK0B,SAAL,CAAexlB,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAA1B;AACAtE,kBAAQ6B,KAAR,CAAc8b,EAAE9e,KAAhB;AACA,gBAAM8e,CAAN;AACA;AACD,OAZK;AAcNuI,aAAO,MAAM;AACZ,YAAI;AACHjtB,kBAAQ,KAAK4sC,YAAL,CAAkB5sC,KAAlB,CAAR;AACA,gBAAM;AAAEsqB,iBAAF;AAASgiB;AAAT,cAAkBjhC,OAAxB;AACA,iBAAO,KAAKysB,2BAAL,CAAiC,KAAK8S,UAAL,CAAgB/kC,IAAhB,CAAqB7F,KAArB,CAAjC,EAA8D;AAAEsqB,iBAAF;AAASgiB;AAAT,WAA9D,EAA+E1vC,MAAtF;AACA,SAJD,CAIE,OAAO8nB,CAAP,EAAU;AACX3d,kBAAQ6B,KAAR,CAAc,6BAAd,EAA6C,KAAK6uB,cAAlD;AACA1wB,kBAAQ6B,KAAR,CAAc,QAAd,EAAwBumB,KAAK0B,SAAL,CAAe7wB,KAAf,EAAsB,IAAtB,EAA4B,CAA5B,CAAxB;AACA+G,kBAAQ6B,KAAR,CAAc,UAAd,EAA0BumB,KAAK0B,SAAL,CAAexlB,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAA1B;AACAtE,kBAAQ6B,KAAR,CAAc8b,EAAE9e,KAAhB;AACA,gBAAM8e,CAAN;AACA;AACD,OA1BK;AA4BNnhB,eAAUgP,EAAD,IAAQ;AAChB,eAAO,KAAK1M,IAAL,CAAU7F,KAAV,EAAiBqL,OAAjB,EAA0BgM,KAA1B,GAAkC9T,OAAlC,CAA0CgP,EAA1C,CAAP;AACA,OA9BK;AAgCN6f,eAAUyN,GAAD,IAAS;AACjB3xB,eAAOS,KAAP,CAAa,KAAK8oB,cAAlB,EAAkC,2CAAlC,EAA+Ez3B,KAA/E;AACA,eAAO,KAAK60B,KAAL,CAAWjL,EAAX,CAAc/jB,IAAd,CAAmB,GAAGyK,SAAtB,EAAiC8hB,OAAjC,CAAyCyN,GAAzC,CAAP;AACA,OAnCK;AAqCNmN,sBAAiBnN,GAAD,IAAS;AACxB3xB,eAAOS,KAAP,CAAa,KAAK8oB,cAAlB,EAAkC,kDAAlC,EAAsFz3B,KAAtF;AACA,eAAO,KAAK60B,KAAL,CAAWjL,EAAX,CAAc/jB,IAAd,CAAmB,GAAGyK,SAAtB,EAAiC08B,cAAjC,CAAgDnN,GAAhD,CAAP;AACA,OAxCK;AA0CNoN,sBAAgB,CAACC,MAAD,EAASptC,GAAT,EAAc8qC,UAAd,KAA6B;AAC5C18B,eAAOS,KAAP,CAAa,KAAK8oB,cAAlB,EAAkC,kDAAlC,EAAsFz3B,KAAtF;AACA,eAAO,KAAK60B,KAAL,CAAWjL,EAAX,CAAc/jB,IAAd,CAAmB,GAAGyK,SAAtB,EAAiC28B,cAAjC,CAAgDC,MAAhD,EAAwDptC,GAAxD,EAA6D8qC,UAA7D,CAAP;AACA;AA7CK,KAAP;AA+CA;;AAEDzqC,UAAQH,KAAR,EAAeqL,OAAf,EAAwB;AACvB,QAAI;AACHrL,cAAQ,KAAK4sC,YAAL,CAAkB5sC,KAAlB,CAAR;AACA,aAAO,KAAK83B,2BAAL,CAAiC,KAAK8S,UAAL,CAAgBzqC,OAAhB,CAAwBH,KAAxB,CAAjC,EAAiEqL,OAAjE,CAAP;AACA,KAHD,CAGE,OAAOqZ,CAAP,EAAU;AACX3d,cAAQ6B,KAAR,CAAc,gCAAd,EAAgD,KAAK6uB,cAArD;AACA1wB,cAAQ6B,KAAR,CAAc,QAAd,EAAwBumB,KAAK0B,SAAL,CAAe7wB,KAAf,EAAsB,IAAtB,EAA4B,CAA5B,CAAxB;AACA+G,cAAQ6B,KAAR,CAAc,UAAd,EAA0BumB,KAAK0B,SAAL,CAAexlB,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAA1B;AACAtE,cAAQ6B,KAAR,CAAc8b,EAAE9e,KAAhB;AACA,YAAM8e,CAAN;AACA;AACD;;AAEDlI,cAAY/d,GAAZ,EAAiB4M,OAAjB,EAA0B;AACzB,WAAO,KAAKs1B,WAAL,CAAiB,KAAjB,EAAwBliC,GAAxB,EAA6B4M,OAA7B,EAAsCgM,KAAtC,EAAP;AACA;;AAED6gB,eAAaC,GAAb,EAAkB9sB,OAAlB,EAA2B;AAC1B,UAAMrL,QAAQ,KAAK4sC,YAAL,CAAkB;AAAEnuC,WAAK;AAAEulB,aAAKmU;AAAP;AAAP,KAAlB,CAAd;AACA,WAAO,KAAKL,2BAAL,CAAiC,KAAK8S,UAAL,CAAgBzqC,OAAhB,CAAwBH,KAAxB,CAAjC,EAAiEqL,OAAjE,CAAP;AACA;;AAEDshB,YAAU3sB,KAAV,EAAiBqL,OAAjB,EAA0B;AACzBrL,YAAQ,KAAK4sC,YAAL,CAAkB5sC,KAAlB,CAAR;AACA,WAAO,KAAK83B,2BAAL,CAAiC,KAAK8S,UAAL,CAAgBje,SAAhB,CAA0B3sB,KAA1B,CAAjC,EAAmEqL,OAAnE,CAAP;AACA;;AAED8hC,mBAAiB;AAChB,WAAO,KAAKvC,UAAL,CAAgBuC,cAAhB,CAA+B,GAAG78B,SAAlC,CAAP;AACA;;AAEDunB,mBAAiB;AAChB,WAAO,KAAK+S,UAAL,CAAgB/S,cAAhB,CAA+B,GAAGvnB,SAAlC,CAAP;AACA;;AAED2f,SAAOqC,MAAP,EAAe;AACd,QAAIniB,MAAMk2B,OAAN,CAAc/T,MAAd,CAAJ,EAA2B;AAC1B,WAAK,MAAM1tB,IAAX,IAAmB0tB,MAAnB,EAA2B;AAC1B,aAAKrC,MAAL,CAAYrrB,IAAZ;AACA;AACD,KAJD,MAIO;AACN;AACA,UAAI,KAAK6yB,cAAL,KAAwB,iBAAxB,IAA6CnF,OAAOpxB,SAAxD,EAAmE;AAClE,eAAOoxB,OAAOpxB,SAAd;AACA;;AACD,WAAKw1B,IAAL,CAAU,cAAV,EAA0BpE,MAA1B;AACA,WAAKqZ,eAAL,CAAqBrZ,MAArB;AACA,WAAKsY,UAAL,CAAgB3a,MAAhB,CAAuBqC,MAAvB;AACA,WAAKoE,IAAL,CAAU,UAAV,EAAsBpE,MAAtB;AACA;AACD;;AAED2Z,iBAAe/uC,EAAf,EAAmB8c,IAAnB,EAAyB;AACxB;AACA,QAAI,KAAKyd,cAAL,KAAwB,iBAAxB,IAA6Czd,KAAK9Y,SAAtD,EAAiE;AAChE,aAAO8Y,KAAK9Y,SAAZ;AACA;;AAED,UAAMoxB,SAAS,KAAKiZ,YAAL,CAAkB,KAAlB,EAAyBruC,EAAzB,CAAf;;AACA,QAAI,CAACo1B,MAAL,EAAa;AACZvrB,cAAQ6B,KAAR,CAAc,iCAAd,EAAiD,KAAK6uB,cAAtD,EAAsEv6B,EAAtE,EAA0E8c,IAA1E;AACA;AACA;;AACD,SAAK8xB,oBAAL,CAA0BxZ,MAA1B;;AAEA,UAAM8a,gBAAgBtqC,EAAE6hB,OAAF,CAAUthB,OAAOC,IAAP,CAAY0W,IAAZ,CAAV,EAA6B,GAAG,KAAK2kB,mBAArC,CAAtB;;AAEA,QAAIyO,cAAcxwC,MAAd,GAAuB,CAA3B,EAA8B;AAC7B,WAAK85B,IAAL,CAAU,cAAV,EAA0BpE,MAA1B,EAAkCtY,IAAlC;AACA;;AAED,SAAK,MAAMxW,GAAX,IAAkBwW,IAAlB,EAAwB;AACvB,UAAIA,KAAKtL,cAAL,CAAoBlL,GAApB,CAAJ,EAA8B;AAC7BslC,mBAAW/kC,GAAX,CAAeuuB,MAAf,EAAuB9uB,GAAvB,EAA4BwW,KAAKxW,GAAL,CAA5B;AACA;AACD;;AAED,SAAKonC,UAAL,CAAgB5hB,MAAhB,CAAuBsJ,MAAvB;AACA,SAAKqZ,eAAL,CAAqBrZ,MAArB;;AAEA,QAAI8a,cAAcxwC,MAAd,GAAuB,CAA3B,EAA8B;AAC7B,WAAK85B,IAAL,CAAU,SAAV,EAAqBpE,MAArB,EAA6BtY,IAA7B;AACA;AACD;;AAEDqzB,eAAa/a,MAAb,EAAqBtJ,MAArB,EAA6B;AAC5B;AACA,QAAI,KAAKyO,cAAL,KAAwB,iBAAxB,KAA8CnF,OAAOpxB,SAAP,IAAqBoxB,OAAOrJ,IAAP,IAAeqJ,OAAOrJ,IAAP,CAAY/nB,SAA9F,CAAJ,EAA+G;AAC9G,aAAOoxB,OAAOpxB,SAAd;;AACA,UAAIoxB,OAAOrJ,IAAP,IAAeqJ,OAAOrJ,IAAP,CAAY/nB,SAA/B,EAA0C;AACzC,eAAOoxB,OAAOrJ,IAAP,CAAY/nB,SAAnB;AACA;AACD;;AAED,SAAK4qC,oBAAL,CAA0BxZ,MAA1B;AAEA,UAAMgb,iBAAiBjqC,OAAOC,IAAP,CAAY0lB,MAAZ,EAAoB3kB,GAApB,CAAwBupB,SAASA,MAAM/mB,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAjC,CAAvB;;AACA,UAAMumC,gBAAgBtqC,EAAE6hB,OAAF,CAAU2oB,cAAV,EAA0B,GAAG,KAAK3O,mBAAlC,CAAtB;;AAEA,QAAIyO,cAAcxwC,MAAd,GAAuB,CAA3B,EAA8B;AAC7B,WAAK85B,IAAL,CAAU,cAAV,EAA0BpE,MAA1B,EAAkCA,MAAlC;AACA;;AAED,QAAItJ,OAAOC,IAAX,EAAiB;AAChBnmB,QAAE4N,IAAF,CAAOsY,OAAOC,IAAd,EAAoB,CAACxlB,KAAD,EAAQmqB,KAAR,KAAkB;AACrCkb,mBAAW/kC,GAAX,CAAeuuB,MAAf,EAAuB1E,KAAvB,EAA8BnqB,KAA9B;AACA,OAFD;AAGA;;AAED,QAAIulB,OAAOwI,MAAX,EAAmB;AAClB1uB,QAAE4N,IAAF,CAAOsY,OAAOwI,MAAd,EAAsB,CAAC/tB,KAAD,EAAQmqB,KAAR,KAAkB;AACvCkb,mBAAWyE,GAAX,CAAejb,MAAf,EAAuB1E,KAAvB;AACA,OAFD;AAGA;;AAED,QAAI5E,OAAOwkB,IAAX,EAAiB;AAChB1qC,QAAE4N,IAAF,CAAOsY,OAAOwkB,IAAd,EAAoB,CAAC/pC,KAAD,EAAQmqB,KAAR,KAAkB;AACrC,cAAM6f,WAAW3E,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuB1E,KAAvB,CAAjB;;AACA,YAAI6f,aAAaz+B,SAAb,IAA0BvL,QAAQgqC,QAAtC,EAAgD;AAC/C3E,qBAAW/kC,GAAX,CAAeuuB,MAAf,EAAuB1E,KAAvB,EAA8BnqB,KAA9B;AACA;AACD,OALD;AAMA;;AAED,QAAIulB,OAAO0kB,IAAX,EAAiB;AAChB5qC,QAAE4N,IAAF,CAAOsY,OAAO0kB,IAAd,EAAoB,CAACjqC,KAAD,EAAQmqB,KAAR,KAAkB;AACrC,cAAM6f,WAAW3E,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuB1E,KAAvB,CAAjB;;AACA,YAAI6f,aAAaz+B,SAAb,IAA0BvL,QAAQgqC,QAAtC,EAAgD;AAC/C3E,qBAAW/kC,GAAX,CAAeuuB,MAAf,EAAuB1E,KAAvB,EAA8BnqB,KAA9B;AACA;AACD,OALD;AAMA;;AAED,QAAIulB,OAAOsY,IAAX,EAAiB;AAChBx+B,QAAE4N,IAAF,CAAOsY,OAAOsY,IAAd,EAAoB,CAAC79B,KAAD,EAAQmqB,KAAR,KAAkB;AACrC,YAAI6f,WAAW3E,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuB1E,KAAvB,CAAf;;AACA,YAAI6f,aAAaz+B,SAAjB,EAA4B;AAC3By+B,qBAAWhqC,KAAX;AACA,SAFD,MAEO;AACNgqC,sBAAYhqC,KAAZ;AACA;;AACDqlC,mBAAW/kC,GAAX,CAAeuuB,MAAf,EAAuB1E,KAAvB,EAA8B6f,QAA9B;AACA,OARD;AASA;;AAED,QAAIzkB,OAAO2kB,IAAX,EAAiB;AAChB7qC,QAAE4N,IAAF,CAAOsY,OAAO2kB,IAAd,EAAoB,CAAClqC,KAAD,EAAQmqB,KAAR,KAAkB;AACrC,YAAI6f,WAAW3E,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuB1E,KAAvB,CAAf;;AACA,YAAI6f,aAAaz+B,SAAjB,EAA4B;AAC3By+B,qBAAW,CAAX;AACA,SAFD,MAEO;AACNA,sBAAYhqC,KAAZ;AACA;;AACDqlC,mBAAW/kC,GAAX,CAAeuuB,MAAf,EAAuB1E,KAAvB,EAA8B6f,QAA9B;AACA,OARD;AASA;;AAED,QAAIzkB,OAAOkU,OAAX,EAAoB;AACnBp6B,QAAE4N,IAAF,CAAOsY,OAAOkU,OAAd,EAAuB,CAACz5B,KAAD,EAAQmqB,KAAR,KAAkB;AACxC,cAAM6f,WAAW3E,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuB1E,KAAvB,CAAjB;;AACA,YAAI6f,aAAaz+B,SAAjB,EAA4B;AAC3B85B,qBAAW/kC,GAAX,CAAeuuB,MAAf,EAAuB7uB,KAAvB,EAA8BgqC,QAA9B;AACA3E,qBAAWyE,GAAX,CAAejb,MAAf,EAAuB1E,KAAvB;AACA;AACD,OAND;AAOA;;AAED,QAAI5E,OAAO4kB,QAAX,EAAqB;AACpB9qC,QAAE4N,IAAF,CAAOsY,OAAO4kB,QAAd,EAAwB,CAACnqC,KAAD,EAAQmqB,KAAR,KAAkB;AACzC,YAAI6f,WAAW3E,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuB1E,KAAvB,CAAf;;AACA,YAAIzd,MAAMk2B,OAAN,CAAcoH,QAAd,CAAJ,EAA6B;AAC5BA,qBAAW3qC,EAAEghB,UAAF,CAAa2pB,QAAb,EAAuBhqC,KAAvB,CAAX;AACAqlC,qBAAW/kC,GAAX,CAAeuuB,MAAf,EAAuB1E,KAAvB,EAA8B6f,QAA9B;AACA;AACD,OAND;AAOA;;AAED,QAAIzkB,OAAO6kB,IAAX,EAAiB;AAChB/qC,QAAE4N,IAAF,CAAOsY,OAAO6kB,IAAd,EAAoB,CAACpqC,KAAD,EAAQmqB,KAAR,KAAkB;AACrC,cAAM6f,WAAW3E,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuB1E,KAAvB,CAAjB;;AACA,YAAIzd,MAAMk2B,OAAN,CAAcoH,QAAd,CAAJ,EAA6B;AAC5B,cAAIhqC,UAAU,CAAC,CAAf,EAAkB;AACjBgqC,qBAASK,KAAT;AACA,WAFD,MAEO;AACNL,qBAASM,GAAT;AACA;;AACDjF,qBAAW/kC,GAAX,CAAeuuB,MAAf,EAAuB1E,KAAvB,EAA8B6f,QAA9B;AACA;AACD,OAVD;AAWA;;AAED,QAAIzkB,OAAOyG,SAAX,EAAsB;AACrB3sB,QAAE4N,IAAF,CAAOsY,OAAOyG,SAAd,EAAyB,CAAChsB,KAAD,EAAQmqB,KAAR,KAAkB;AAC1C,YAAI6f,WAAW3E,WAAWnoC,GAAX,CAAe2xB,MAAf,EAAuB1E,KAAvB,CAAf;;AACA,YAAI6f,aAAaz+B,SAAjB,EAA4B;AAC3By+B,qBAAW,EAAX;AACA;;AACD,YAAIt9B,MAAMk2B,OAAN,CAAcoH,QAAd,CAAJ,EAA6B;AAC5B,gBAAM7wC,SAAS6wC,SAAS7wC,MAAxB;;AAEA,cAAI6G,SAASA,MAAMu9B,KAAf,IAAwB7wB,MAAMk2B,OAAN,CAAc5iC,MAAMu9B,KAApB,CAA5B,EAAwD;AACvD,iBAAK,MAAMgN,SAAX,IAAwBvqC,MAAMu9B,KAA9B,EAAqC;AACpC,kBAAIyM,SAAS5lC,OAAT,CAAiBmmC,SAAjB,MAAgC,CAAC,CAArC,EAAwC;AACvCP,yBAAS3pC,IAAT,CAAckqC,SAAd;AACA;AACD;AACD,WAND,MAMO,IAAIP,SAAS5lC,OAAT,CAAiBpE,KAAjB,MAA4B,CAAC,CAAjC,EAAoC;AAC1CgqC,qBAAS3pC,IAAT,CAAcL,KAAd;AACA;;AAED,cAAIgqC,SAAS7wC,MAAT,GAAkBA,MAAtB,EAA8B;AAC7BksC,uBAAW/kC,GAAX,CAAeuuB,MAAf,EAAuB1E,KAAvB,EAA8B6f,QAA9B;AACA;AACD;AACD,OAtBD;AAuBA;;AAED,SAAK7C,UAAL,CAAgB5hB,MAAhB,CAAuBsJ,MAAvB;AACA,SAAKqZ,eAAL,CAAqBrZ,MAArB;;AAEA,QAAI8a,cAAcxwC,MAAd,GAAuB,CAA3B,EAA8B;AAC7B,WAAK85B,IAAL,CAAU,SAAV,EAAqBpE,MAArB,EAA6BA,MAA7B;AACA;AACD;;AAEDtJ,SAAOhpB,KAAP,EAAcgpB,MAAd,EAAsB3d,UAAU,EAAhC,EAAoC;AACnC,QAAIihB,UAAUjhB,QAAQqxB,KAAR,GAAgB,KAAK72B,IAAL,CAAU7F,KAAV,EAAiBqX,KAAjB,EAAhB,GAA2C,KAAKlX,OAAL,CAAaH,KAAb,KAAuB,EAAhF;;AACA,QAAI,CAACmQ,MAAMk2B,OAAN,CAAc/Z,OAAd,CAAL,EAA6B;AAC5BA,gBAAU,CAACA,OAAD,CAAV;AACA;;AAED,SAAK,MAAMgG,MAAX,IAAqBhG,OAArB,EAA8B;AAC7B,WAAK+gB,YAAL,CAAkB/a,MAAlB,EAA0BtJ,MAA1B;AACA;AACD;;AAEDG,aAAWjsB,EAAX,EAAe;AACd,UAAMo1B,SAAS,KAAKiZ,YAAL,CAAkB,KAAlB,EAAyBruC,EAAzB,CAAf;;AACA,QAAIo1B,MAAJ,EAAY;AACX,WAAKoE,IAAL,CAAU,cAAV,EAA0BpE,MAA1B;AACA,WAAKsY,UAAL,CAAgBqD,WAAhB,CAA4B;AAACxvC,aAAKvB;AAAN,OAA5B;AACA,WAAK4uC,oBAAL,CAA0BxZ,MAA1B;AACA,WAAKoE,IAAL,CAAU,SAAV,EAAqBpE,MAArB;AACA;AACD;;AAtzByC;;AA5H3Cr3B,OAAOizC,aAAP,CAq7BehX,eAr7Bf,E;;;;;;;;;;;ACAA,IAAIp0B,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAIL,YAAJ;AAAiBC,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACH,eAAaK,CAAb,EAAe;AAACL,mBAAaK,CAAb;AAAe;;AAAhC,CAA/B,EAAiE,CAAjE;AAG/E,MAAM8yC,WAAW,aAAjB;AAGA,MAAMC,QAAQ,IAAIC,MAAMC,UAAV,CAAsB,GAAGH,QAAU,QAAnC,CAAd;;AACA,IAAI;AACHC,QAAMG,YAAN,CAAmB;AAAE3D,gBAAY;AAAd,GAAnB;;AACAwD,QAAMG,YAAN,CAAmB;AAAEC,gBAAY;AAAd,GAAnB,EAAsC;AAAEzU,wBAAoB,KAAK,EAAL,GAAU,EAAV,GAAe;AAArC,GAAtC;AACA,CAHD,CAGE,OAAOrV,CAAP,EAAU;AACX3d,UAAQC,GAAR,CAAY0d,CAAZ;AACA;;AAED,MAAM+pB,mBAAmBC,eAAeC,6BAAf,GAA+CC,KAA/C,CAAqDC,YAArD,IAAqE,CAAC,CAACH,eAAeC,6BAAf,GAA+CC,KAA/C,CAAqDC,YAArD,CAAkEC,YAAlK;AACA,IAAIC,iBAAiBN,gBAArB;AACAnzC,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,+BAAxB,EAAyD,CAAC6C,GAAD,EAAMC,KAAN,KAAgB;AACxEsrC,mBAAiBN,oBAAoBhrC,UAAU,KAA/C;AACA,CAFD;;AAIA,MAAMwzB,YAAN,SAA2Bj8B,YAA3B,CAAwC;AACvCyB,cAAYo4B,KAAZ,EAAmBma,SAAnB,EAA8B;AAC7B;;AAEA,QAAIpf,MAAMjsB,IAAN,CAAWkxB,KAAX,EAAkB5tB,MAAlB,CAAJ,EAA+B;AAC9B,WAAKvK,IAAL,GAAYm4B,KAAZ;AACA,WAAK4C,cAAL,GAAsB,KAAK0W,QAAL,GAAgB,KAAKzxC,IAA3C;AACA,WAAKm4B,KAAL,GAAa,IAAIwZ,MAAMC,UAAV,CAAqB,KAAK7W,cAA1B,CAAb;AACA,KAJD,MAIO;AACN,WAAK/6B,IAAL,GAAYm4B,MAAM/3B,KAAlB;AACA,WAAK26B,cAAL,GAAsB,KAAK/6B,IAA3B;AACA,WAAKm4B,KAAL,GAAaA,KAAb;AACA;;AAED,SAAKma,SAAL,GAAiBA,SAAjB;AAEA,SAAKC,SAAL,GAf6B,CAiB7B;;AACA,SAAKj4B,IAAL,CAAU,aAAV,EAAyB,CAACk4B;AAAK;AAAN,SAAyB;AACjD,UAAIA,UAAU,QAAd,EAAwB;AACvB,YAAIH,cAAJ,EAAoB;AACnB,gBAAM/uC,QAAQ;AACb4qC,wBAAY,KAAKnT;AADJ,WAAd;;AAIAiX,yBAAeC,6BAAf,GAA+CC,KAA/C,CAAqDC,YAArD,CAAkEC,YAAlE,CAA+E9uC,KAA/E,EAAsF,KAAKmvC,kBAAL,CAAwBvX,IAAxB,CAA6B,IAA7B,CAAtF;;AACA8W,yBAAeC,6BAAf,GAA+CC,KAA/C,CAAqDC,YAArD,CAAkEO,mBAAlE,CAAsFC,OAAOC,gBAA7F;AACA;AACD;AACD,KAXD;AAaA,SAAK7W,cAAL,CAAoB;AAAE,oBAAc;AAAhB,KAApB;AACA;;AAED,MAAI0V,QAAJ,GAAe;AACd,WAAOA,QAAP;AACA;;AAEDlW,eAAa3F,SAAS,EAAtB,EAA0B;AAEzB;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,QAAI,UAAU3uB,IAAV,CAAeN,OAAOC,IAAP,CAAYgvB,MAAZ,EAAoBnxB,IAApB,CAAyB,GAAzB,CAAf,CAAJ,EAAmD;AAClDmxB,aAAOrJ,IAAP,GAAcqJ,OAAOrJ,IAAP,IAAe,EAA7B;AACAqJ,aAAOrJ,IAAP,CAAYuR,UAAZ,GAAyB,IAAIt3B,IAAJ,EAAzB;AACA,KAHD,MAGO;AACNovB,aAAOkI,UAAP,GAAoB,IAAIt3B,IAAJ,EAApB;AACA;;AAED,WAAOovB,MAAP;AACA;;AAED2c,cAAY;AACX,SAAKM,SAAL,GAAiB;AAChBtf,cAAQ,KAAK4E,KAAL,CAAW5E,MAAX,CAAkB2H,IAAlB,CAAuB,KAAK/C,KAA5B,CADQ;AAEhB7L,cAAQ,KAAK6L,KAAL,CAAW7L,MAAX,CAAkB4O,IAAlB,CAAuB,KAAK/C,KAA5B,CAFQ;AAGhB9uB,cAAQ,KAAK8uB,KAAL,CAAW9uB,MAAX,CAAkB6xB,IAAlB,CAAuB,KAAK/C,KAA5B;AAHQ,KAAjB;AAKA,UAAM2a,OAAO,IAAb;;AAEA,SAAK3a,KAAL,CAAW5E,MAAX,GAAoB,YAAW;AAC9B,aAAOuf,KAAKvf,MAAL,CAAY,GAAG3f,SAAf,CAAP;AACA,KAFD;;AAIA,SAAKukB,KAAL,CAAW7L,MAAX,GAAoB,YAAW;AAC9B,aAAOwmB,KAAKxmB,MAAL,CAAY,GAAG1Y,SAAf,CAAP;AACA,KAFD;;AAIA,SAAKukB,KAAL,CAAW9uB,MAAX,GAAoB,YAAW;AAC9B,aAAOypC,KAAKzpC,MAAL,CAAY,GAAGuK,SAAf,CAAP;AACA,KAFD;AAGA;;AAEDzK,SAAO;AACN,WAAO,KAAKgvB,KAAL,CAAWhvB,IAAX,CAAgB,GAAGyK,SAAnB,CAAP;AACA;;AAEDnQ,YAAU;AACT,WAAO,KAAK00B,KAAL,CAAW10B,OAAX,CAAmB,GAAGmQ,SAAtB,CAAP;AACA;;AAEDkM,cAAY/d,GAAZ,EAAiB4M,OAAjB,EAA0B;AACzB,WAAO,KAAKwpB,KAAL,CAAW10B,OAAX,CAAmB;AAAE1B;AAAF,KAAnB,EAA4B4M,OAA5B,CAAP;AACA;;AAED6sB,eAAaC,GAAb,EAAkB9sB,OAAlB,EAA2B;AAC1B,WAAO,KAAKwpB,KAAL,CAAW10B,OAAX,CAAmB;AAAE1B,WAAK;AAAEulB,aAAKmU;AAAP;AAAP,KAAnB,EAAyC9sB,OAAzC,CAAP;AACA;;AAEDokC,qBAAmBzvC,KAAnB,EAA0B0vC,QAA1B,EAAoCrkC,OAApC,EAA6C;AAC5C,QAAI,KAAK2jC,SAAL,CAAezX,QAAf,KAA4B,KAAhC,EAAuC;AACtC,aAAO,IAAP;AACA;;AAED,QAAIlsB,QAAQqkB,MAAR,KAAmB,IAAvB,EAA6B;AAC5B,aAAO,IAAP;AACA,KAP2C,CAS5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,UAAMigB,wBAAwB,CAC7B,MAD6B,EAE7B,QAF6B,EAG7B,MAH6B,EAI7B,MAJ6B,EAK7B,MAL6B,EAM7B,MAN6B,EAO7B,SAP6B,EAQ7B,UAR6B,EAS7B,MAT6B,EAU7B,WAV6B,CAA9B;AAaA,UAAMC,sBAAsBvsC,OAAOC,IAAP,CAAYosC,QAAZ,EAAsB9nC,MAAtB,CAA6ByM,KAAKA,EAAEuX,UAAF,CAAa,GAAb,KAAqB+jB,sBAAsB/zB,QAAtB,CAA+BvH,CAA/B,MAAsC,KAA7F,CAA5B;;AAEA,QAAIu7B,oBAAoBhzC,MAApB,GAA6B,CAAjC,EAAoC;AACnC,aAAO,IAAP;AACA;;AAED,UAAMizC,oBAAoBxsC,OAAOC,IAAP,CAAYtD,KAAZ,EAAmB4H,MAAnB,CAA0BhD,QAAQA,KAAKiD,OAAL,CAAa,GAAb,IAAoB,CAAC,CAAvD,CAA1B;;AACA,QAAIgoC,kBAAkBjzC,MAAlB,GAA2B,CAA/B,EAAkC;AACjC,aAAO,IAAP;AACA;;AAED,WAAO,OAAP;AACA;;AAEDkzC,8BAA4B9mB,MAA5B,EAAoC;AACnC,WAAO3lB,OAAOC,IAAP,CAAY0lB,MAAZ,EAAoBzO,IAApB,CAAyB/W,OAAOA,IAAIoY,QAAJ,CAAa,IAAb,KAAuB,CAACgU,MAAMjsB,IAAN,CAAWqlB,OAAOxlB,GAAP,CAAX,EAAwBH,MAAxB,CAAD,IAAoC,KAAKysC,2BAAL,CAAiC9mB,OAAOxlB,GAAP,CAAjC,CAA3F,CAAP;AACA;;AAED2rC,qBAAmB1vC,MAAnB,EAA2B;AAC1B,QAAIsvC,mBAAmB,KAAvB,EAA8B;AAC7B;AACA;;AAED,QAAItvC,OAAOswC,EAAP,CAAUA,EAAV,KAAiB,GAArB,EAA0B;AACzB,WAAKrZ,IAAL,CAAU,QAAV,EAAoB;AACnBj3B,gBAAQ,QADW;AAEnBvC,YAAIuC,OAAOswC,EAAP,CAAUC,CAAV,CAAYvxC,GAFG;AAGnB0K,cAAM1J,OAAOswC,EAAP,CAAUC,CAHG;AAInBC,eAAO;AAJY,OAApB;AAMA;AACA;;AAED,QAAIxwC,OAAOswC,EAAP,CAAUA,EAAV,KAAiB,GAArB,EAA0B;AACzB,UAAI,CAACtwC,OAAOswC,EAAP,CAAUC,CAAV,CAAY/mB,IAAb,IAAqB,CAACxpB,OAAOswC,EAAP,CAAUC,CAAV,CAAYxe,MAAtC,EAA8C;AAC7C,aAAKkF,IAAL,CAAU,QAAV,EAAoB;AACnBj3B,kBAAQ,eADW;AAEnBvC,cAAIuC,OAAOvC,EAFQ;AAGnBiM,gBAAM1J,OAAOswC,EAAP,CAAUC,CAHG;AAInBC,iBAAO;AAJY,SAApB;AAMA;AACA;;AAED,YAAMj2B,OAAO,EAAb;;AACA,UAAIva,OAAOswC,EAAP,CAAUC,CAAV,CAAY/mB,IAAhB,EAAsB;AACrB,aAAK,MAAMzlB,GAAX,IAAkB/D,OAAOswC,EAAP,CAAUC,CAAV,CAAY/mB,IAA9B,EAAoC;AACnC,cAAIxpB,OAAOswC,EAAP,CAAUC,CAAV,CAAY/mB,IAAZ,CAAiBva,cAAjB,CAAgClL,GAAhC,CAAJ,EAA0C;AACzCwW,iBAAKxW,GAAL,IAAY/D,OAAOswC,EAAP,CAAUC,CAAV,CAAY/mB,IAAZ,CAAiBzlB,GAAjB,CAAZ;AACA;AACD;AACD;;AAED,UAAI/D,OAAOswC,EAAP,CAAUC,CAAV,CAAYxe,MAAhB,EAAwB;AACvB,aAAK,MAAMhuB,GAAX,IAAkB/D,OAAOswC,EAAP,CAAUC,CAAV,CAAYxe,MAA9B,EAAsC;AACrC,cAAI/xB,OAAOswC,EAAP,CAAUC,CAAV,CAAYxe,MAAZ,CAAmB9iB,cAAnB,CAAkClL,GAAlC,CAAJ,EAA4C;AAC3CwW,iBAAKxW,GAAL,IAAYwL,SAAZ;AACA;AACD;AACD;;AAED,WAAK0nB,IAAL,CAAU,QAAV,EAAoB;AACnBj3B,gBAAQ,aADW;AAEnBvC,YAAIuC,OAAOvC,EAFQ;AAGnBiM,cAAM6Q,IAHa;AAInBi2B,eAAO;AAJY,OAApB;AAMA;AACA;;AAED,QAAIxwC,OAAOswC,EAAP,CAAUA,EAAV,KAAiB,GAArB,EAA0B;AACzB,WAAKrZ,IAAL,CAAU,QAAV,EAAoB;AACnBj3B,gBAAQ,QADW;AAEnBvC,YAAIuC,OAAOvC,EAFQ;AAGnB+yC,eAAO;AAHY,OAApB;AAKA;AACA;AACD;;AAEDhgB,SAAOqC,MAAP,EAAe;AACd,SAAK2F,YAAL,CAAkB3F,MAAlB;AAEA,UAAMjsB,SAAS,KAAKkpC,SAAL,CAAetf,MAAf,CAAsB,GAAG3f,SAAzB,CAAf;;AACA,QAAI,CAACy+B,cAAD,IAAmB,KAAKmB,aAAL,CAAmB,QAAnB,IAA+B,CAAtD,EAAyD;AACxD,WAAKxZ,IAAL,CAAU,QAAV,EAAoB;AACnBj3B,gBAAQ,QADW;AAEnBvC,YAAImJ,MAFe;AAGnB8C,cAAMrG,EAAE0nB,MAAF,CAAS,EAAT,EAAa8H,MAAb,CAHa;AAInB2d,eAAO;AAJY,OAApB;AAMA;;AAED3d,WAAO7zB,GAAP,GAAa4H,MAAb;AAEA,WAAOA,MAAP;AACA;;AAED2iB,SAAOhpB,KAAP,EAAcgpB,MAAd,EAAsB3d,UAAU,EAAhC,EAAoC;AACnC,SAAK4sB,YAAL,CAAkBjP,MAAlB,EAA0B,IAA1B,EAAgChpB,KAAhC;AAEA,UAAMmwC,WAAW,KAAKV,kBAAL,CAAwBzvC,KAAxB,EAA+BgpB,MAA/B,EAAuC3d,OAAvC,CAAjB;AACA,QAAI8sB,MAAM,EAAV;;AACA,QAAI,CAAC4W,cAAD,IAAmB,KAAKmB,aAAL,CAAmB,QAAnB,IAA+B,CAAlD,IAAuDC,aAAa,IAAxE,EAA8E;AAC7E,YAAMC,cAAc;AAAC5vC,gBAAQ;AAAC/B,eAAK;AAAN;AAAT,OAApB;AACA,UAAI6tB,UAAUjhB,QAAQqxB,KAAR,GAAgB,KAAK72B,IAAL,CAAU7F,KAAV,EAAiBowC,WAAjB,EAA8B/4B,KAA9B,EAAhB,GAAwD,KAAKlX,OAAL,CAAaH,KAAb,EAAoBowC,WAApB,KAAoC,EAA1G;;AACA,UAAI,CAACjgC,MAAMk2B,OAAN,CAAc/Z,OAAd,CAAL,EAA6B;AAC5BA,kBAAU,CAACA,OAAD,CAAV;AACA;;AAED6L,YAAM7L,QAAQjoB,GAAR,CAAYO,QAAQA,KAAKnG,GAAzB,CAAN;;AACA,UAAI4M,QAAQqkB,MAAR,KAAmB,IAAnB,IAA2B,KAAKogB,2BAAL,CAAiC9mB,MAAjC,MAA6C,KAA5E,EAAmF;AAClFhpB,gBAAQ;AACPvB,eAAK;AACJulB,iBAAKmU;AADD;AADE,SAAR;AAKA;AACD;;AAED,UAAM9xB,SAAS,KAAKkpC,SAAL,CAAevmB,MAAf,CAAsBhpB,KAAtB,EAA6BgpB,MAA7B,EAAqC3d,OAArC,CAAf;;AAEA,QAAI,CAAC0jC,cAAD,IAAmB,KAAKmB,aAAL,CAAmB,QAAnB,IAA+B,CAAtD,EAAyD;AACxD,UAAIC,aAAa,IAAjB,EAAuB;AACtB,YAAI9kC,QAAQqkB,MAAR,KAAmB,IAAvB,EAA6B;AAC5B,cAAIrpB,OAAOgqC,UAAX,EAAuB;AACtB,iBAAK3Z,IAAL,CAAU,QAAV,EAAoB;AACnBj3B,sBAAQ,QADW;AAEnBvC,kBAAImJ,OAAOgqC,UAFQ;AAGnBlnC,oBAAM,KAAKhJ,OAAL,CAAa;AAAC1B,qBAAK4H,OAAOgqC;AAAb,eAAb,CAHa;AAInBJ,qBAAO;AAJY,aAApB;AAMA;AACA;;AAEDjwC,kBAAQ;AACPvB,iBAAK;AACJulB,mBAAKmU;AADD;AADE,WAAR;AAKA;;AAED,YAAI7L,UAAUjhB,QAAQqxB,KAAR,GAAgB,KAAK72B,IAAL,CAAU7F,KAAV,EAAiBqX,KAAjB,EAAhB,GAA2C,KAAKlX,OAAL,CAAaH,KAAb,KAAuB,EAAhF;;AACA,YAAI,CAACmQ,MAAMk2B,OAAN,CAAc/Z,OAAd,CAAL,EAA6B;AAC5BA,oBAAU,CAACA,OAAD,CAAV;AACA;;AACD,aAAK,MAAMgG,MAAX,IAAqBhG,OAArB,EAA8B;AAC7B,eAAKoK,IAAL,CAAU,QAAV,EAAoB;AACnBj3B,oBAAQ,eADW;AAEnBvC,gBAAIo1B,OAAO7zB,GAFQ;AAGnB0K,kBAAMmpB,MAHa;AAInB2d,mBAAO;AAJY,WAApB;AAMA;AACD,OA/BD,MA+BO;AACN,aAAKvZ,IAAL,CAAU,QAAV,EAAoB;AACnBj3B,kBAAQ,cADW;AAEnBvC,cAAI8R,SAFe;AAGnB7F,gBAAM;AACLnJ,iBADK;AAELgpB,kBAFK;AAGL3d;AAHK,WAHa;AAQnB4kC,iBAAO;AARY,SAApB;AAUA;AACD;;AACD,WAAO5pC,MAAP;AACA;;AAEDqpB,SAAO1vB,KAAP,EAAcgpB,MAAd,EAAsB3d,UAAU,EAAhC,EAAoC;AACnCA,YAAQqkB,MAAR,GAAiB,IAAjB;AACArkB,YAAQilC,aAAR,GAAwB,IAAxB;AACA,WAAO,KAAKtnB,MAAL,CAAYhpB,KAAZ,EAAmBgpB,MAAnB,EAA2B3d,OAA3B,CAAP;AACA;;AAEDtF,SAAO/F,KAAP,EAAc;AACb,UAAMssB,UAAU,KAAKuI,KAAL,CAAWhvB,IAAX,CAAgB7F,KAAhB,EAAuBqX,KAAvB,EAAhB;AAEA,UAAM8gB,MAAM,EAAZ;;AACA,SAAK,MAAM7F,MAAX,IAAqBhG,OAArB,EAA8B;AAC7B6L,UAAIr0B,IAAJ,CAASwuB,OAAO7zB,GAAhB;AAEA6zB,aAAOkc,UAAP,GAAoB,IAAItrC,IAAJ,EAApB;AACAovB,aAAOie,cAAP,GAAwB,KAAK7zC,IAA7B;AAEA0xC,YAAM1e,MAAN,CAAa;AAACjxB,aAAK6zB,OAAO7zB;AAAb,OAAb,EAAgCqE,EAAE6pC,IAAF,CAAOra,MAAP,EAAe,KAAf,CAAhC;AACA;;AAEDtyB,YAAQ;AAAEvB,WAAK;AAAEulB,aAAKmU;AAAP;AAAP,KAAR;AAEA,UAAM9xB,SAAS,KAAKkpC,SAAL,CAAexpC,MAAf,CAAsB/F,KAAtB,CAAf;;AAEA,QAAI,CAAC+uC,cAAD,IAAmB,KAAKmB,aAAL,CAAmB,QAAnB,IAA+B,CAAtD,EAAyD;AACxD,WAAK,MAAM5d,MAAX,IAAqBhG,OAArB,EAA8B;AAC7B,aAAKoK,IAAL,CAAU,QAAV,EAAoB;AACnBj3B,kBAAQ,QADW;AAEnBvC,cAAIo1B,OAAO7zB,GAFQ;AAGnB0K,gBAAMrG,EAAE0nB,MAAF,CAAS,EAAT,EAAa8H,MAAb,CAHa;AAInB2d,iBAAO;AAJY,SAApB;AAMA;AACD;;AAED,WAAO5pC,MAAP;AACA;;AAED+xB,iBAAe,GAAGloB,IAAlB,EAAwB;AACvB,QAAIA,KAAK,CAAL,KAAWA,KAAK,CAAL,EAAQzR,GAAvB,EAA4B;AAC3B,YAAMA,MAAMyR,KAAK,CAAL,EAAQzR,GAApB;AACA,aAAOyR,KAAK,CAAL,EAAQzR,GAAf;AACAyR,WAAKumB,OAAL,CAAa;AACZh4B;AADY,OAAb;AAIA,WAAKixB,MAAL,CAAY,GAAGxf,IAAf;AACA,aAAOzR,GAAP;AACA,KATD,MASO;AACN,aAAO,KAAKwxB,MAAL,CAAY,GAAG/f,IAAf,CAAP;AACA;AACD;;AAEDmoB,UAAQ;AACP,WAAO,KAAKxD,KAAL,CAAWwD,KAAX,CAAiB,GAAG/nB,SAApB,CAAP;AACA;;AAEDgoB,SAAO;AACN,WAAO,KAAKzD,KAAL,CAAWyD,IAAX,CAAgB,GAAGhoB,SAAnB,CAAP;AACA;;AAEDioB,gBAAc;AACb,WAAO,KAAK1D,KAAL,CAAW0Z,YAAX,CAAwB,GAAGj+B,SAA3B,CAAP;AACA;;AAEDkoB,cAAY;AACX,WAAO,KAAK3D,KAAL,CAAW2b,UAAX,CAAsB,GAAGlgC,SAAzB,CAAP;AACA;;AAEDmoB,mBAAiB;AAChB,QAAI;AACH,aAAO,KAAKF,WAAL,CAAiB,GAAGjoB,SAApB,CAAP;AACA,KAFD,CAEE,OAAOoU,CAAP,EAAU;AACX3d,cAAQ6B,KAAR,CAAc,uBAAd,EAAuC,KAAKlM,IAA5C,EAAkD,IAAlD,EAAwD,GAAG4T,SAA3D,EAAsEoU,CAAtE;AACA;AACD;;AAEDgU,iBAAe;AACd,QAAI;AACH,aAAO,KAAKF,SAAL,CAAe,GAAGloB,SAAlB,CAAP;AACA,KAFD,CAEE,OAAOoU,CAAP,EAAU;AACX3d,cAAQ6B,KAAR,CAAc,uBAAd,EAAuC,KAAKlM,IAA5C,EAAkD,IAAlD,EAAwD,GAAG4T,SAA3D,EAAsEoU,CAAtE;AACA;AACD;;AAEDiU,YAAU34B,KAAV,EAAiBqL,OAAjB,EAA0B;AACzBrL,UAAMuwC,cAAN,GAAuB,KAAK7zC,IAA5B;AAEA,WAAO0xC,MAAMvoC,IAAN,CAAW7F,KAAX,EAAkBqL,OAAlB,CAAP;AACA;;AAEDutB,wBAAsB6X,SAAtB,EAAiCzwC,QAAQ,EAAzC,EAA6CqL,OAA7C,EAAsD;AACrDrL,UAAMuwC,cAAN,GAAuB,KAAK7zC,IAA5B;AACAsD,UAAMwuC,UAAN,GAAmB;AAClBlU,WAAKmW;AADa,KAAnB;AAIA,WAAOrC,MAAMvoC,IAAN,CAAW7F,KAAX,EAAkBqL,OAAlB,CAAP;AACA;;AA1YsC;;AApBxCpQ,OAAOizC,aAAP,CAiaejX,YAjaf,E;;;;;;;;;;;ACAA,IAAIn0B,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN,MAAMq1C,sBAAsB,EAA5B;;AAEAp1C,WAAWq1C,0BAAX,GAAwC,UAASpJ,WAAT,EAAsBqJ,wBAAtB,EAAgD;AACvFF,sBAAoBnJ,WAApB,IAAmC;AAClCA,eADkC;AAElCqJ;AAFkC,GAAnC;AAIA,CALD,C,CAOA;AACA;;;AACAj3B,SAASk3B,oBAAT,CAA8B,UAASxlC,OAAT,EAAkB;AAC/C,MAAI,CAACA,QAAQylC,WAAb,EAA0B;AACzB,WAAO9hC,SAAP,CADyB,CACP;AAClB;;AAEDiE,QAAM5H,OAAN,EAAeukB,MAAMmhB,eAAN,CAAsB;AACpCxJ,iBAAatgC;AADuB,GAAtB,CAAf;AAIA,QAAM4rB,UAAU6d,oBAAoBrlC,QAAQk8B,WAA5B,CAAhB,CAT+C,CAW/C;;AACA,MAAI,CAAC1U,OAAL,EAAc;AACb,UAAM,IAAIh2B,KAAJ,CAAW,kCAAkCwO,QAAQk8B,WAAa,EAAlE,CAAN;AACA,GAd8C,CAgB/C;;;AACA,MAAI,CAACyJ,qBAAqBC,cAArB,CAAoC9wC,OAApC,CAA4C;AAAC0yB,aAASA,QAAQ0U;AAAlB,GAA5C,CAAL,EAAkF;AACjF,UAAM,IAAIyJ,qBAAqBE,WAAzB,EAAN;AACA;;AAED,MAAI,CAACpuC,EAAE2E,QAAF,CAAWkS,SAASw3B,KAAT,CAAeC,YAAf,EAAX,EAA0Cve,QAAQ0U,WAAlD,CAAL,EAAqE;AACpE;AACA;AACA;AACA,WAAO;AACNhgC,YAAM,OADA;AAENqB,aAAO,IAAI1K,OAAOrB,KAAX,CACN8c,SAAS03B,mBAAT,CAA6BC,YADvB,EAEL,0CAA0Cze,QAAQ0U,WAAa,EAF1D;AAFD,KAAP;AAOA;;AAED,QAAMgK,cAAc1e,QAAQ+d,wBAAR,CAAiCvlC,OAAjC,CAApB;AAEA,SAAOsO,SAAS63B,qCAAT,CAA+C3e,QAAQ0U,WAAvD,EAAoEgK,YAAYE,WAAhF,EAA6FF,YAAYlmC,OAAzG,CAAP;AACA,CArCD,E;;;;;;;;;;;ACbA,IAAIvI,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAGN,SAASq2C,WAAT,CAAqBZ,WAArB,EAAkC;AACjC,MAAI;AACH,WAAO9d,KAAKryB,GAAL,CACN,+CADM,EAEN;AAACjB,cAAQ;AAACiyC,sBAAcb;AAAf;AAAT,KAFM,EAEiC3nC,IAFxC;AAGA,GAJD,CAIE,OAAO3E,GAAP,EAAY;AACb,UAAM1B,EAAE0nB,MAAF,CAAS,IAAI3tB,KAAJ,CAAW,yCAAyC2H,IAAI8H,OAAS,EAAjE,CAAT,EAA8E;AAAC4mB,gBAAU1uB,IAAI0uB;AAAf,KAA9E,CAAN;AACA;AACD;;AAED,SAAS0e,SAAT,CAAmBd,WAAnB,EAAgC;AAC/B,MAAI;AACH,WAAO9d,KAAKryB,GAAL,CACN,gDADM,EAEN;AAACjB,cAAQ;AAACiyC,sBAAcb;AAAf;AAAT,KAFM,EAEiC3nC,IAFjC,CAEsCsU,KAFtC,CAE4C5W,KAF5C,CAEkD,GAFlD,CAAP;AAGA,GAJD,CAIE,OAAOrC,GAAP,EAAY;AACb,UAAM1B,EAAE0nB,MAAF,CAAS,IAAI3tB,KAAJ,CAAW,0CAA0C2H,IAAI8H,OAAS,EAAlE,CAAT,EAA+E;AAAC4mB,gBAAU1uB,IAAI0uB;AAAf,KAA/E,CAAN;AACA;AACD;;AAGD53B,WAAWq1C,0BAAX,CAAsC,QAAtC,EAAgD,UAAStlC,OAAT,EAAkB;AACjE4H,QAAM5H,OAAN,EAAeukB,MAAMmhB,eAAN,CAAsB;AACpCD,iBAAa7pC,MADuB;AAEpC4qC,aAAS5qC,MAF2B;AAGpC6qC,eAAWliB,MAAMmiB,OAHmB;AAIpCt0B,WAAOmS,MAAMoiB,KAAN,CAAY/qC,MAAZ,CAJ6B;AAKpCgrC,cAAUriB,MAAMoiB,KAAN,CAAY3uC,MAAZ;AAL0B,GAAtB,CAAf;AAQA,QAAM4uC,WAAW5mC,QAAQ4mC,QAAR,IAAoBP,YAAYrmC,QAAQylC,WAApB,CAArC;AAEA,QAAMW,cAAc;AACnBX,iBAAazlC,QAAQylC,WADF;AAEnBe,aAASxmC,QAAQwmC,OAFE;AAGnBK,eAAY,CAAC,IAAIhvC,IAAJ,EAAF,GAAe,OAAO4Q,SAASzI,QAAQymC,SAAjB,EAA4B,EAA5B,CAHd;AAInBr0B,WAAOpS,QAAQ8mC,MAAR,IAAkBP,UAAUvmC,QAAQylC,WAAlB;AAJN,GAApB;;AAOA,QAAMtwC,SAASsC,EAAE6sB,IAAF,CAAOsiB,QAAP,EAAiBG,OAAOC,iBAAxB,CAAf;;AACAvvC,IAAE0nB,MAAF,CAASinB,WAAT,EAAsBjxC,MAAtB,EAnBiE,CAqBjE;AACA;AACA;;;AACA,MAAI6K,QAAQinC,YAAZ,EAA0B;AACzBb,gBAAYa,YAAZ,GAA2BjnC,QAAQinC,YAAnC;AACA;;AAED,SAAO;AACNb,eADM;AAENpmC,aAAS;AACRg9B,eAAS;AACR3rC,cAAMu1C,SAASv1C;AADP;AADD;AAFH,GAAP;AAQA,CApCD,E;;;;;;;;;;;ACxBA,IAAIoG,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAGNk3C,MAAMC,YAAN,GAAqB1vC,EAAEyB,IAAF,CAAOguC,MAAMC,YAAb,EAA2B,UAAS3hC,IAAT,EAAe02B,WAAf,EAA4B,GAAGr3B,IAA/B,EAAqC;AACpF,QAAMuiC,QAAQn3C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,+BAAxB,EAAyDmH,OAAzD,CAAiE,KAAjE,EAAwE,EAAxE,EAA4EjB,KAA5E,CAAkF,GAAlF,CAAd;;AACA,MAAI4rC,MAAM72B,QAAN,CAAe2rB,WAAf,CAAJ,EAAiC;AAChC,WAAQ,GAAGjsC,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,2BAAxB,CAAsD,iBAAjE;AACA,GAFD,MAEO;AACN,WAAOkQ,KAAK02B,WAAL,EAAkB,GAAGr3B,IAArB,CAAP;AACA;AAED,CARoB,CAArB,C;;;;;;;;;;;ACHA,IAAIwiC,MAAJ;AAAWz3C,OAAOC,KAAP,CAAaC,QAAQ,gBAAR,CAAb,EAAuC;AAACu3C,SAAOr3C,CAAP,EAAS;AAACq3C,aAAOr3C,CAAP;AAAS;;AAApB,CAAvC,EAA6D,CAA7D;AAEXC,WAAWqL,YAAX,GAA0B,IAAK,MAAMgsC,YAAN,CAAmB;AACjDl2C,gBAAc;AACb,SAAKi2C,MAAL,GAAcA,MAAd;AACA,SAAKE,SAAL,GAAiB,IAAI,KAAKF,MAAT,EAAjB;AACA;;AAEDG,QAAMtrC,IAAN,EAAY6iC,KAAZ,EAAmB,GAAGl6B,IAAtB,EAA4B;AAC3B,SAAK0iC,SAAL,CAAerrC,IAAf,EAAsB,cAAc6iC,KAAO,EAA3C,EAA8C,GAAGl6B,IAAjD;AACA;;AAED1J,QAAM;AACL,UAAMssC,SAAStjC,QAAQsjC,MAAR,EAAf;AACA,WAAQA,OAAO,CAAP,IAAY,OAAZ,GAAsBA,OAAO,CAAP,IAAY,IAA1C;AACA;;AAEDlsC,SAAOwjC,KAAP,EAAc7jC,IAAd,EAAoB+7B,IAApB,EAA0B;AACzB,SAAKuQ,KAAL,CAAW,QAAX,EAAqBzI,KAArB,EAA4B7jC,IAA5B,EAAkC+7B,IAAlC;AACA;;AAEDvvB,YAAUq3B,KAAV,EAAiB7jC,IAAjB,EAAuB+7B,IAAvB,EAA6B;AAC5B,SAAKuQ,KAAL,CAAW,WAAX,EAAwBzI,KAAxB,EAA+B7jC,IAA/B,EAAqC+7B,IAArC;AACA;;AAEDyQ,YAAU3I,KAAV,EAAiB7jC,IAAjB,EAAuB+7B,IAAvB,EAA6B;AAC5B,SAAKuQ,KAAL,CAAW,WAAX,EAAwBzI,KAAxB,EAA+B7jC,IAA/B,EAAqC+7B,IAArC;AACA;;AAED0Q,YAAU5I,KAAV,EAAiB7jC,IAAjB,EAAuB+7B,IAAvB,EAA6B;AAC5B,SAAKuQ,KAAL,CAAW,WAAX,EAAwBzI,KAAxB,EAA+B7jC,IAA/B,EAAqC+7B,IAArC;AACA;;AAED2Q,QAAM7I,KAAN,EAAa7jC,IAAb,EAAmB+7B,IAAnB,EAAyB;AACxB,SAAKuQ,KAAL,CAAW,OAAX,EAAoBzI,KAApB,EAA2B7jC,IAA3B,EAAiC+7B,IAAjC;AACA;;AAED7mB,SAAO2uB,KAAP,EAAc7jC,IAAd,EAAoB+7B,IAApB,EAA0B;AACzB,SAAKuQ,KAAL,CAAW,QAAX,EAAqBzI,KAArB,EAA4B7jC,IAA5B,EAAkC+7B,IAAlC;AACA;;AAEDv+B,MAAIqmC,KAAJ,EAAW7jC,IAAX,EAAiB+7B,IAAjB,EAAuB;AACtB,SAAKuQ,KAAL,CAAW,KAAX,EAAkBzI,KAAlB,EAAyB7jC,IAAzB,EAA+B+7B,IAA/B;AACA;;AAzCgD,CAAxB,EAA1B,C;;;;;;;;;;;ACFAhnC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBuvB,KAAxB,CAA8BoT,OAA9B,CAAsC,eAAtC,EAAuD;AACtDnd,SAAO,WAD+C;AAEtD/tB,QAAM;AACLwrC,WAAO,KADF;AAELJ,YAAQ,KAFH;;AAGLS,cAAU3tC,IAAV,EAAgBkC,YAAhB,EAA8B;AAC7B,aAAOA,aAAa0M,CAAb,CAAe/M,QAAtB;AACA,KALI;;AAMLmG,WAAOmtC,GAAP,EAAYjzC,YAAZ,EAA0B;AACzB,UAAIizC,IAAIrrC,OAAJ,CAAY5H,aAAa0M,CAAb,CAAe/M,QAA3B,IAAuC,CAAC,CAA5C,EAA+C;AAC9CszC,YAAI9mB,MAAJ,CAAW8mB,IAAIrrC,OAAJ,CAAY5H,aAAa0M,CAAb,CAAe/M,QAA3B,CAAX,EAAiD,CAAjD;AACA;AACD;;AAVI;AAFgD,CAAvD;AAiBAtE,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC22B,KAAhC,CAAsCmT,MAAtC,CAA6C,OAA7C,EAAsD;AACrDld,SAAO,OAD8C;AAErD/tB,QAAM;AACLwrC,WAAO,KADF;AAELJ,YAAQ;AAFH;AAF+C,CAAtD;AASA3vC,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC22B,KAAhC,CAAsCmT,MAAtC,CAA6C,OAA7C,EAAsD;AACrDld,SAAO,OAD8C;AAErD/tB,QAAM;AACLwrC,WAAO,OADF;AAELJ,YAAQ;AAFH;AAF+C,CAAtD;AAQA3vC,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC22B,KAAhC,CAAsCmT,MAAtC,CAA6C,OAA7C,EAAsD;AACrDld,SAAO,OAD8C;AAErD/tB,QAAM;AACLwrC,WAAO,MADF;AAELJ,YAAQ,UAFH;;AAGLO,UAAMvrC;AAAY;AAAlB,MAA8B;AAC7B,aAAOA,aAAazB,CAAb,KAAmB,GAA1B;AACA,KALI;;AAMLktC,cAAUzrC,YAAV,EAAwBZ,IAAxB,EAA8B;AAC7B,UAAIA,QAAQ,IAAR,IAAgBY,gBAAgB,IAApC,EAA0C;AACzC,eAAO+O,SAAP;AACA,OAH4B,CAI7B;AACA;AACA;;;AACA,UAAI/O,aAAau6B,UAAb,GAA0Bn7B,KAAKm7B,UAAnC,EAA+C;AAC9Cv6B,qBAAau6B,UAAb,GAA0Bn7B,KAAKm7B,UAA/B;AACA;;AACD,aAAOn7B,KAAK3C,IAAZ;AACA;;AAjBI;AAF+C,CAAtD;AAuBApB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwB4c,KAAxB,CAA8BjzB,IAA9B;AACApJ,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBuvB,KAAxB,CAA8BjzB,IAA9B;AACApJ,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC22B,KAAhC,CAAsCjzB,IAAtC;AACApJ,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BgG,KAA3B,CAAiCjzB,IAAjC;AAGApJ,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwB4c,KAAxB,CAA8BwV,cAA9B,CAA6C,YAA7C,EAA2DgG,SAA3D,CAAqE;AACpE,qCAAmC;AAACC,WAAO;AAAC9Y,WAAK;AAAN;AAAR;AADiC,CAArE;AAIAh/B,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC22B,KAAhC,CAAsCwV,cAAtC,CAAqD,eAArD,EAAsEgG,SAAtE,CAAgF;AAC/EnnB,OAAK,CACJ;AAACjJ,0BAAsB;AAACiB,WAAK,CAAC,KAAD,EAAQ,SAAR;AAAN;AAAvB,GADI,EAEJ;AAAChB,6BAAyB;AAACgB,WAAK,CAAC,KAAD,EAAQ,SAAR;AAAN;AAA1B,GAFI;AAD0E,CAAhF,E;;;;;;;;;;;ACnEA,IAAIlhB,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAGN,SAASg4C,mBAAT,CAA6B9gC,EAA7B,EAAiC;AAChC,SAAO3C,eAAP,KAA2B,WAA3B,IAA0C2C,GAAG3C,eAAH,CAA1C;AACA;;AACDtU,WAAWoF,QAAX,CAAoB0C,MAApB,CAA2B,YAA3B,EAAyC,UAASI,GAAT,EAAcC,KAAd,EAAqB;AAC7D,MAAIX,EAAEwwC,QAAF,CAAW7vC,KAAX,KAAqBA,MAAMpB,IAAN,EAAzB,EAAuC;AACtC,WAAOgxC,oBAAoBzjC,mBAAmBA,gBAAgB2jC,qBAAhB,CAAsC9vC,KAAtC,CAAvC,CAAP;AACA;AACD,CAJD;AAMAvF,OAAOuP,OAAP,CAAe,YAAW;AACzB,QAAMhK,QAAQnI,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,YAAxB,CAAd;;AACA,MAAImC,EAAEwwC,QAAF,CAAW7vC,KAAX,KAAqBA,MAAMpB,IAAN,EAAzB,EAAuC;AACtC,WAAOgxC,oBAAoBzjC,mBAAmBA,gBAAgB2jC,qBAAhB,CAAsC9vC,KAAtC,CAAvC,CAAP;AACA;AACD,CALD,E;;;;;;;;;;;ACZA,IAAIX,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAAwD,IAAIqa,eAAJ;AAAoBza,OAAOC,KAAP,CAAaC,QAAQ,sCAAR,CAAb,EAA6D;AAACua,kBAAgBra,CAAhB,EAAkB;AAACqa,sBAAgBra,CAAhB;AAAkB;;AAAtC,CAA7D,EAAqG,CAArG;AAAwG,IAAIua,UAAJ;AAAe3a,OAAOC,KAAP,CAAaC,QAAQ,sCAAR,CAAb,EAA6D;AAACya,aAAWva,CAAX,EAAa;AAACua,iBAAWva,CAAX;AAAa;;AAA5B,CAA7D,EAA2F,CAA3F;;AAIzM,MAAMm4C,wBAAwB1wC,EAAE2wC,QAAF,CAAWv1C,OAAO2T,eAAP,CAAuB,YAAW;AAC1E9K,UAAQC,GAAR,CAAY,+BAAZ;;AAEA,MAAI1L,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,qBAAxB,KAAkDrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAlD,IAAsGrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,mBAAxB,CAAtG,IAAsJrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,mBAAxB,CAAtJ,IAAsMrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAtM,IAA0PrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAA9P,EAAgT;AAC/S,QAAIrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,MAAqD,MAAzD,EAAiE;AAChE;AACA,UAAIrF,WAAWua,IAAX,IAAmBva,WAAWua,IAAX,CAAgBgB,QAAhB,EAAvB,EAAmD;AAClD9P,gBAAQC,GAAR,CAAY,gDAAZ;AACA1L,mBAAWua,IAAX,CAAgBiB,IAAhB,CAAqB5Y,OAAO2T,eAAP,CAAuB,YAAW;AACtD9K,kBAAQC,GAAR,CAAY,kCAAZ;AACA1L,qBAAWua,IAAX,GAAkB,IAAIH,eAAJ,EAAlB;AACApa,qBAAWua,IAAX,CAAgBc,KAAhB;AACA,iBAAO,IAAP;AACA,SALoB,CAArB;AAMA,OARD,MAQO,IAAIrb,WAAWwa,IAAX,IAAmBxa,WAAWsa,UAA9B,IAA4Cta,WAAWsa,UAAX,CAAsBiB,QAAtB,EAAhD,EAAkF;AACxF9P,gBAAQC,GAAR,CAAY,+CAAZ;AACA1L,mBAAWsa,UAAX,CAAsBkB,IAAtB,CAA2B5Y,OAAO2T,eAAP,CAAuB,YAAW;AAC5D9K,kBAAQC,GAAR,CAAY,kCAAZ;AACA1L,qBAAWua,IAAX,GAAkB,IAAIH,eAAJ,EAAlB;AACApa,qBAAWua,IAAX,CAAgBc,KAAhB;AACA,iBAAO,IAAP;AACA,SAL0B,CAA3B;AAMA,OARM,MAQA;AACN5P,gBAAQC,GAAR,CAAY,kCAAZ;AACA1L,mBAAWua,IAAX,GAAkB,IAAIH,eAAJ,EAAlB;AACApa,mBAAWua,IAAX,CAAgBc,KAAhB;AACA,eAAO,IAAP;AACA;AACD,KAxBD,MAwBO,IAAIrb,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,MAAqD,KAAzD,EAAgE;AACtE;AACA,UAAIrF,WAAWwa,IAAX,IAAmBxa,WAAWsa,UAA9B,IAA4Cta,WAAWsa,UAAX,CAAsBiB,QAAtB,EAAhD,EAAkF;AACjF9P,gBAAQC,GAAR,CAAY,+CAAZ;AACA1L,mBAAWsa,UAAX,CAAsBkB,IAAtB,CAA2B5Y,OAAO2T,eAAP,CAAuB,YAAW;AAC5D9K,kBAAQC,GAAR,CAAY,iCAAZ;AACA1L,qBAAWsa,UAAX,GAAwB,IAAIA,UAAJ,EAAxB;AACAta,qBAAWsa,UAAX,CAAsBe,KAAtB;AACA,iBAAO,IAAP;AACA,SAL0B,CAA3B;AAMA,OARD,MAQO,IAAIrb,WAAWua,IAAX,IAAmBva,WAAWua,IAAX,CAAgBgB,QAAhB,EAAvB,EAAmD;AACzD9P,gBAAQC,GAAR,CAAY,gDAAZ;AACA1L,mBAAWua,IAAX,CAAgBiB,IAAhB,CAAqB5Y,OAAO2T,eAAP,CAAuB,YAAW;AACtD9K,kBAAQC,GAAR,CAAY,iCAAZ;AACA1L,qBAAWsa,UAAX,GAAwB,IAAIA,UAAJ,EAAxB;AACAta,qBAAWsa,UAAX,CAAsBe,KAAtB;AACA,iBAAO,IAAP;AACA,SALoB,CAArB;AAMA,OARM,MAQA;AACN5P,gBAAQC,GAAR,CAAY,iCAAZ;AACA1L,mBAAWsa,UAAX,GAAwB,IAAIA,UAAJ,EAAxB;AACAta,mBAAWsa,UAAX,CAAsBe,KAAtB;AACA,eAAO,IAAP;AACA;AACD;AACD,GAlDD,MAkDO,IAAIrb,WAAWua,IAAX,IAAmBva,WAAWua,IAAX,CAAgBgB,QAAhB,EAAvB,EAAmD;AACzD;AACAvb,eAAWua,IAAX,CAAgBiB,IAAhB;AACA,GAHM,MAGA,IAAIxb,WAAWwa,IAAX,IAAmBxa,WAAWsa,UAAX,CAAsBiB,QAAtB,EAAvB,EAAyD;AAC/D;AACAvb,eAAWsa,UAAX,CAAsBkB,IAAtB;AACA;AACD,CA5DwC,CAAX,EA4D1B,IA5D0B,CAA9B;;AA8DAxb,WAAWoF,QAAX,CAAoB0C,MAApB,CAA2B,kBAA3B,EAA+CowC,qBAA/C,E;;;;;;;;;;;AClEA,IAAI1wC,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;;AAEN,MAAMq4C,eAAe5wC,EAAE2wC,QAAF,CAAW,YAAW;AAC1C1sC,UAAQC,GAAR,CAAY,+BAAZ;;AAEA,MAAI1L,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,WAAxB,CAAJ,EAA0C;AACzC6O,YAAQC,GAAR,CAAYkkC,QAAZ,GAAwB,GAAGr4C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,eAAxB,CAA0C,KAArE;;AAEA,QAAIrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,eAAxB,KAA4CrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,eAAxB,CAAhD,EAA0F;AACzF6O,cAAQC,GAAR,CAAYkkC,QAAZ,IAAyB,GAAGC,mBAAmBt4C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,eAAxB,CAAnB,CAA8D,IAAIizC,mBAAmBt4C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,eAAxB,CAAnB,CAA8D,GAA5J;AACA;;AAED6O,YAAQC,GAAR,CAAYkkC,QAAZ,IAAwBC,mBAAmBt4C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,WAAxB,CAAnB,CAAxB;;AAEA,QAAIrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,WAAxB,CAAJ,EAA0C;AACzC6O,cAAQC,GAAR,CAAYkkC,QAAZ,IAAyB,IAAI7/B,SAASxY,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,WAAxB,CAAT,CAAgD,EAA7E;AACA;;AAED6O,YAAQC,GAAR,CAAYkkC,QAAZ,IAAyB,SAASr4C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,WAAxB,CAAsC,EAAxE;;AAEA,QAAIrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,eAAxB,MAA6C,MAA7C,IAAuDrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,gBAAxB,CAA3D,EAAsG;AACrG6O,cAAQC,GAAR,CAAYkkC,QAAZ,IAAwB,8BAAxB;AACA;;AAED,WAAOnkC,QAAQC,GAAR,CAAYkkC,QAAnB;AACA;AACD,CAxBoB,EAwBlB,GAxBkB,CAArB;;AA0BAr4C,WAAWoF,QAAX,CAAoB0C,MAApB,CAA2B,WAA3B,EAAwC,UAASI,GAAT,EAAcC,KAAd,EAAqB;AAC5D,MAAIX,EAAEwwC,QAAF,CAAW7vC,KAAX,CAAJ,EAAuB;AACtB,WAAOiwC,cAAP;AACA;AACD,CAJD;AAMAp4C,WAAWoF,QAAX,CAAoB0C,MAApB,CAA2B,WAA3B,EAAwC,YAAW;AAClD,SAAOswC,cAAP;AACA,CAFD;AAIAp4C,WAAWoF,QAAX,CAAoB0C,MAApB,CAA2B,eAA3B,EAA4C,UAASI,GAAT,EAAcC,KAAd,EAAqB;AAChE,MAAIX,EAAEwwC,QAAF,CAAW7vC,KAAX,CAAJ,EAAuB;AACtB,WAAOiwC,cAAP;AACA;AACD,CAJD;AAMAp4C,WAAWoF,QAAX,CAAoB0C,MAApB,CAA2B,eAA3B,EAA4C,UAASI,GAAT,EAAcC,KAAd,EAAqB;AAChE,MAAIX,EAAEwwC,QAAF,CAAW7vC,KAAX,CAAJ,EAAuB;AACtB,WAAOiwC,cAAP;AACA;AACD,CAJD;AAMAp4C,WAAWoF,QAAX,CAAoB0C,MAApB,CAA2B,eAA3B,EAA4C,YAAW;AACtD,SAAOswC,cAAP;AACA,CAFD;AAIAp4C,WAAWoF,QAAX,CAAoB0C,MAApB,CAA2B,WAA3B,EAAwC,YAAW;AAClD,SAAOswC,cAAP;AACA,CAFD;AAIAp4C,WAAWoF,QAAX,CAAoB0C,MAApB,CAA2B,gBAA3B,EAA6C,YAAW;AACvD,SAAOswC,cAAP;AACA,CAFD;AAIAx1C,OAAOuP,OAAP,CAAe,YAAW;AACzB,SAAOimC,cAAP;AACA,CAFD,E;;;;;;;;;;;AC9DA,IAAI5wC,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAGN,MAAM6S,SAAS,IAAIC,MAAJ,CAAW,gBAAX,EAA6B;AAC3C1C,WAAS;AACRooC,mBAAe;AACdtsC,YAAM;AADQ;AADP;AADkC,CAA7B,CAAf;;AAQA,SAASusC,oBAAT,GAAgC;AAC/B,QAAMlpB,WAAWtvB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uDAAxB,CAAjB;AACAiqB,WAASrnB,OAAT,CAAkBsvB,OAAD,IAAa;AAC7B3kB,WAAO2lC,aAAP,CAAqBhhB,QAAQrvB,GAA7B;AACA,QAAI+jC,cAAc1U,QAAQrvB,GAAR,CAAYsE,OAAZ,CAAoB,iBAApB,EAAuC,EAAvC,CAAlB;;AACA,QAAIy/B,gBAAgB,QAApB,EAA8B;AAC7BA,oBAAc,kBAAd;AACA;;AACD,QAAI,yBAAyB5jC,IAAzB,CAA8BkvB,QAAQrvB,GAAtC,CAAJ,EAAgD;AAC/C+jC,oBAAc1U,QAAQrvB,GAAR,CAAYsE,OAAZ,CAAoB,wBAApB,EAA8C,EAA9C,CAAd;AACA;;AACD,QAAI+qB,QAAQpvB,KAAR,KAAkB,IAAtB,EAA4B;AAC3B,YAAM0F,OAAO;AACZ4qC,kBAAUz4C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,KAAzC,CADE;AAEZwwC,gBAAQ14C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,SAAzC;AAFI,OAAb;;AAIA,UAAI,yBAAyBG,IAAzB,CAA8BkvB,QAAQrvB,GAAtC,CAAJ,EAAgD;AAC/C2F,aAAK8qC,MAAL,GAAc,IAAd;AACA9qC,aAAK4qC,QAAL,GAAgBz4C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,KAAzC,CAAhB;AACA2F,aAAK6qC,MAAL,GAAc14C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,SAAzC,CAAd;AACA2F,aAAK+qC,SAAL,GAAiB54C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,MAAzC,CAAjB;AACA2F,aAAKgrC,SAAL,GAAiB74C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,aAAzC,CAAjB;AACA2F,aAAKirC,YAAL,GAAoB94C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,gBAAzC,CAApB;AACA2F,aAAKkrC,aAAL,GAAqB/4C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,iBAAzC,CAArB;AACA2F,aAAKsU,KAAL,GAAaniB,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,QAAzC,CAAb;AACA2F,aAAKmrC,eAAL,GAAuBh5C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,oBAAzC,CAAvB;AACA2F,aAAKorC,gBAAL,GAAwBj5C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,qBAAzC,CAAxB;AACA2F,aAAKqrC,UAAL,GAAkBl5C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,cAAzC,CAAlB;AACA2F,aAAKsrC,WAAL,GAAmBn5C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,eAAzC,CAAnB;AACA2F,aAAKurC,YAAL,GAAoBp5C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,iBAAzC,CAApB;AACA2F,aAAKwrC,oBAAL,GAA4Br5C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,0BAAzC,CAA5B;AACA2F,aAAKyrC,aAAL,GAAqBt5C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,iBAAzC,CAArB;AACA2F,aAAK0rC,UAAL,GAAkBv5C,WAAWoF,QAAX,CAAoBC,GAApB,CAAyB,GAAGkyB,QAAQrvB,GAAK,cAAzC,CAAlB;AACA,YAAIsxC,WAAJ,CAAgBvN,YAAYxW,WAAZ,EAAhB,EAA2C;AAC1CmjB,qBAAW/qC,KAAK+qC,SAD0B;AAE1CC,qBAAWhrC,KAAKgrC,SAF0B;AAG1CC,wBAAcjrC,KAAKirC,YAHuB;AAI1CC,yBAAelrC,KAAKkrC,aAJsB;AAK1C52B,iBAAOtU,KAAKsU,KAL8B;AAM1C+2B,sBAAYrrC,KAAKqrC,UANyB;AAO1CE,wBAAcvrC,KAAKurC,YAPuB;AAQ1CC,gCAAsBxrC,KAAKwrC,oBARe;AAS1CC,yBAAezrC,KAAKyrC,aATsB;AAU1CC,sBAAY1rC,KAAK0rC;AAVyB,SAA3C;AAYA;;AACD,UAAItN,gBAAgB,UAApB,EAAgC;AAC/Bp+B,aAAK4rC,KAAL,GAAa5rC,KAAK4qC,QAAlB;AACA,eAAO5qC,KAAK4qC,QAAZ;AACA;;AACD,UAAIxM,gBAAgB,SAApB,EAA+B;AAC9Bp+B,aAAK6rC,WAAL,GAAmB7rC,KAAK4qC,QAAxB;AACA,eAAO5qC,KAAK4qC,QAAZ;AACA;;AACD/C,2BAAqBC,cAArB,CAAoCvhB,MAApC,CAA2C;AAC1CmD,iBAAS0U,YAAYxW,WAAZ;AADiC,OAA3C,EAEG;AACF9H,cAAM9f;AADJ,OAFH;AAKA,KAhDD,MAgDO;AACN6nC,2BAAqBC,cAArB,CAAoClrC,MAApC,CAA2C;AAC1C8sB,iBAAS0U,YAAYxW,WAAZ;AADiC,OAA3C;AAGA;AACD,GA9DD;AA+DA;;AAED,MAAMkkB,sBAAsBnyC,EAAE2wC,QAAF,CAAWv1C,OAAO2T,eAAP,CAAuBiiC,oBAAvB,CAAX,EAAyD,IAAzD,CAA5B;;AAEA,SAASoB,mBAAT,CAA6Bz2C,GAA7B,EAAkC;AACjC,QAAM8oC,cAAc9oC,IAAIqJ,OAAJ,CAAY,wBAAZ,EAAsC,EAAtC,CAApB;;AACA,SAAOkpC,qBAAqBC,cAArB,CAAoClrC,MAApC,CAA2C;AACjD8sB,aAAS0U,YAAYxW,WAAZ;AADwC,GAA3C,CAAP;AAGA;;AAEDz1B,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oBAAxB,EAA8C,YAAW;AACxD,SAAOs0C,qBAAP,CADwD,CAC1B;AAC9B,CAFD;AAIA35C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,mCAAxB,EAA6D,UAAS6C,GAAT,EAAcC,KAAd,EAAqB;AACjF,MAAI,CAACA,KAAL,EAAY;AACX,WAAOyxC,oBAAoB1xC,GAApB,CAAP,CADW,CACqB;AAChC;AACD,CAJD,E;;;;;;;;;;;AC3FA;AACAlI,WAAWoF,QAAX,CAAoB+E,GAApB,CAAwB,UAAxB,EAAoC+J,QAAQC,GAAR,CAAY0lC,aAAZ,IAA6Bl4C,OAAOC,EAAP,EAAjE,EAA8E;AAC7E,YAAU,IADmE;AAE7EwzB,UAAQ;AAFqE,CAA9E,E,CAKA;AACA;;AAEAp1B,WAAWoF,QAAX,CAAoBkxB,QAApB,CAA6B,UAA7B,EAAyC,YAAW;AACnD,OAAKnsB,GAAL,CAAS,6BAAT,EAAwC,KAAxC,EAA+C;AAC9C8B,UAAM,SADwC;AAE9Cy7B,YAAQ;AAFsC,GAA/C;AAIA,OAAKv9B,GAAL,CAAS,8BAAT,EAAyC,KAAzC,EAAgD;AAC/C8B,UAAM,SADyC;AAE/Cy7B,YAAQ,IAFuC;AAG/CpS,iBAAa;AACZnyB,WAAK,6BADO;AAEZgF,aAAO;AAFK;AAHkC,GAAhD;AAQA,OAAKgC,GAAL,CAAS,gCAAT,EAA2C,KAA3C,EAAkD;AACjD8B,UAAM,SAD2C;AAEjD,cAAU,IAFuC;AAGjDqpB,iBAAa;AACZnyB,WAAK,iCADO;AAEZgF,aAAO;AAFK;AAHoC,GAAlD;AAQA,OAAKgC,GAAL,CAAS,iCAAT,EAA4C,IAA5C,EAAkD;AACjD8B,UAAM,SAD2C;AAEjD,cAAU;AAFuC,GAAlD;AAIA,OAAK9B,GAAL,CAAS,gCAAT,EAA2C,IAA3C,EAAiD;AAChD8B,UAAM,SAD0C;AAEhD,cAAU;AAFsC,GAAjD;AAIA,OAAK9B,GAAL,CAAS,8BAAT,EAAyC,IAAzC,EAA+C;AAC9C8B,UAAM,SADwC;AAE9C,cAAU;AAFoC,GAA/C;AAIA,OAAK9B,GAAL,CAAS,8BAAT,EAAyC,IAAzC,EAA+C;AAC9C8B,UAAM,SADwC;AAE9C,cAAU;AAFoC,GAA/C;AAIA,OAAK9B,GAAL,CAAS,2BAAT,EAAsC,IAAtC,EAA4C;AAC3C8B,UAAM,SADqC;AAE3C,cAAU;AAFiC,GAA5C;AAIA,OAAK9B,GAAL,CAAS,8BAAT,EAAyC,IAAzC,EAA+C;AAC9C8B,UAAM,SADwC;AAE9C,cAAU;AAFoC,GAA/C;AAIA,OAAK9B,GAAL,CAAS,uCAAT,EAAkD,EAAlD,EAAsD;AACrD8B,UAAM,QAD+C;AAErDy7B,YAAQ;AAF6C,GAAtD;AAIA,OAAKv9B,GAAL,CAAS,0BAAT,EAAqC,EAArC,EAAyC;AACxC8B,UAAM,KADkC;AAExC,cAAU;AAF8B,GAAzC;AAIA,OAAK9B,GAAL,CAAS,wBAAT,EAAmC,IAAnC,EAAyC;AACxC8B,UAAM,SADkC;AAExC,cAAU;AAF8B,GAAzC;AAIA,OAAK9B,GAAL,CAAS,qCAAT,EAAgD,EAAhD,EAAoD;AACnD8B,UAAM,QAD6C;AAEnD,cAAU,IAFyC;AAGnD2pB,eAAW;AAHwC,GAApD;AAKA,OAAKzrB,GAAL,CAAS,8BAAT,EAAyC,EAAzC,EAA6C;AAC5C8B,UAAM,QADsC;AAE5C,cAAU,IAFkC;AAG5C2pB,eAAW;AAHiC,GAA7C;AAKA,OAAKzrB,GAAL,CAAS,yCAAT,EAAoD,KAApD,EAA2D;AAC1D8B,UAAM,SADoD;AAE1D,cAAU;AAFgD,GAA3D;AAIA,OAAK9B,GAAL,CAAS,uBAAT,EAAkC,gCAAlC,EAAoE;AACnE8B,UAAM,QAD6D;AAEnEy7B,YAAQ;AAF2D,GAApE;AAKA,OAAKzR,OAAL,CAAa,cAAb,EAA6B,YAAW;AACvC,SAAK9rB,GAAL,CAAS,0CAAT,EAAqD,MAArD,EAA6D;AAC5D8B,YAAM;AADsD,KAA7D;AAGA,SAAK9B,GAAL,CAAS,+BAAT,EAA0C,IAA1C,EAAgD;AAC/C8B,YAAM,SADyC;AAE/C,gBAAU;AAFqC,KAAhD;AAIA,SAAK9B,GAAL,CAAS,sCAAT,EAAiD,IAAjD,EAAuD;AACtD8B,YAAM,SADgD;AAEtD,gBAAU;AAF4C,KAAvD;AAIA,SAAK9B,GAAL,CAAS,4BAAT,EAAuC,KAAvC,EAA8C;AAC7C8B,YAAM,SADuC;AAE7C,gBAAU,IAFmC;AAG7CqpB,mBAAa;AACZnyB,aAAK,WADO;AAEZgF,eAAO;AACNguB,mBAAS,CADH;AAENpN,eAAK;AAFC;AAFK;AAHgC,KAA9C;AAWA,SAAK5e,GAAL,CAAS,kCAAT,EAA6C,KAA7C,EAAoD;AACnD,gBAAU,IADyC;AAEnD8B,YAAM;AAF6C,KAApD;AAIA,SAAK9B,GAAL,CAAS,6BAAT,EAAwC,EAAxC,EAA4C;AAC3C8B,YAAM,QADqC;AAE3C,gBAAU;AAFiC,KAA5C;AAIA,SAAK9B,GAAL,CAAS,6BAAT,EAAwC,EAAxC,EAA4C;AAC3C8B,YAAM;AADqC,KAA5C;AAGA,SAAK9B,GAAL,CAAS,8BAAT,EAAyC,EAAzC,EAA6C;AAC5C8B,YAAM;AADsC,KAA7C;AAGA,SAAK9B,GAAL,CAAS,uCAAT,EAAkD,IAAlD,EAAwD;AACvD8B,YAAM;AADiD,KAAxD;AAGA,SAAK9B,GAAL,CAAS,4BAAT,EAAuC,KAAvC,EAA8C;AAC7C8B,YAAM;AADuC,KAA9C;AAGA,SAAK9B,GAAL,CAAS,2BAAT,EAAsC,QAAtC,EAAgD;AAC/C8B,YAAM,QADyC;AAE/C,gBAAU,IAFqC;AAG/Cg9B,cAAQ,CACP;AACC/gC,aAAK,QADN;AAEC0tB,mBAAW;AAFZ,OADO,EAIJ;AACF1tB,aAAK,UADH;AAEF0tB,mBAAW;AAFT,OAJI,EAOJ;AACF1tB,aAAK,YADH;AAEF0tB,mBAAW;AAFT,OAPI;AAHuC,KAAhD;AAgBA,SAAKzrB,GAAL,CAAS,qCAAT,EAAgDxI,OAAOC,EAAP,EAAhD,EAA6D;AAC5DqK,YAAM;AADsD,KAA7D;AAGA,SAAK9B,GAAL,CAAS,+CAAT,EAA0D,6CAA1D,EAAyG;AACxG8B,YAAM,QADkG;AAExG,gBAAU;AAF8F,KAAzG;AAIA,SAAK9B,GAAL,CAAS,sDAAT,EAAiE,IAAjE,EAAuE;AACtE8B,YAAM,SADgE;AAEtE,gBAAU;AAF4D,KAAvE;AAIA,SAAK9B,GAAL,CAAS,4DAAT,EAAuE,MAAvE,EAA+E;AAC9E8B,YAAM,QADwE;AAE9EqpB,mBAAa;AACZnyB,aAAK,sDADO;AAEZgF,eAAO;AAFK;AAFiE,KAA/E;AAOA,SAAKgC,GAAL,CAAS,wBAAT,EAAmC,IAAnC,EAAyC;AACxC8B,YAAM,SADkC;AAExC,gBAAU;AAF8B,KAAzC;AAIA,SAAK9B,GAAL,CAAS,uBAAT,EAAkC,EAAlC,EAAsC;AACrC8B,YAAM,MAD+B;AAErC,gBAAU,IAF2B;AAGrC2pB,iBAAW;AAH0B,KAAtC;AAKA,GAtFD;AAwFA,OAAKK,OAAL,CAAa,mCAAb,EAAkD,YAAW;AAC5D,SAAK9rB,GAAL,CAAS,kDAAT,EAA6D,KAA7D,EAAoE;AACnE8B,YAAM,SAD6D;AAEnE,gBAAU,IAFyD;AAGnE2pB,iBAAW;AAHwD,KAApE;AAKA,SAAKzrB,GAAL,CAAS,oDAAT,EAA+D,MAA/D,EAAuE;AACtE8B,YAAM,KADgE;AAEtE,gBAAU,IAF4D;AAGtE2pB,iBAAW;AAH2D,KAAvE;AAKA,SAAKzrB,GAAL,CAAS,+DAAT,EAA0E,CAA1E,EAA6E;AAC5E8B,YAAM,KADsE;AAE5E,gBAAU,IAFkE;AAG5E2pB,iBAAW;AAHiE,KAA7E;AAKA,SAAKzrB,GAAL,CAAS,sDAAT,EAAiE,UAAjE,EAA6E;AAC5E8B,YAAM,QADsE;AAE5Eg9B,cAAQ,CACP;AACC/gC,aAAK,KADN;AAEC0tB,mBAAW;AAFZ,OADO,EAKP;AACC1tB,aAAK,UADN;AAEC0tB,mBAAW;AAFZ,OALO,EASP;AACC1tB,aAAK,SADN;AAEC0tB,mBAAW;AAFZ,OATO,CAFoE;AAgB5E8R,cAAQ;AAhBoE,KAA7E;AAkBA,SAAKv9B,GAAL,CAAS,wDAAT,EAAmE,UAAnE,EAA+E;AAC9E8B,YAAM,QADwE;AAE9Eg9B,cAAQ,CACP;AACC/gC,aAAK,KADN;AAEC0tB,mBAAW;AAFZ,OADO,EAKP;AACC1tB,aAAK,UADN;AAEC0tB,mBAAW;AAFZ,OALO,EASP;AACC1tB,aAAK,SADN;AAEC0tB,mBAAW;AAFZ,OATO,CAFsE;AAgB9E,gBAAU;AAhBoE,KAA/E;AAkBA,SAAKzrB,GAAL,CAAS,uDAAT,EAAkE,UAAlE,EAA8E;AAC7E8B,YAAM,QADuE;AAE7Eg9B,cAAQ,CACP;AACC/gC,aAAM,KADP;AAEC0tB,mBAAY;AAFb,OADO,EAKP;AACC1tB,aAAM,UADP;AAEC0tB,mBAAY;AAFb,OALO,EASP;AACC1tB,aAAM,SADP;AAEC0tB,mBAAY;AAFb,OATO,CAFqE;AAgB7E,gBAAU;AAhBmE,KAA9E;AAkBA,SAAKzrB,GAAL,CAAS,+CAAT,EAA0D,IAA1D,EAAgE;AAC/D8B,YAAM,SADyD;AAE/D,gBAAU,IAFqD;AAG/D2pB,iBAAW;AAHoD,KAAhE;AAKA,SAAKzrB,GAAL,CAAS,6CAAT,EAAwD,IAAxD,EAA8D;AAC7D8B,YAAM,SADuD;AAE7D,gBAAU,IAFmD;AAG7D2pB,iBAAW;AAHkD,KAA9D;AAKA,SAAKzrB,GAAL,CAAS,qDAAT,EAAgE,IAAhE,EAAsE;AACrE8B,YAAM,SAD+D;AAErE,gBAAU,IAF2D;AAGrE2pB,iBAAW;AAH0D,KAAtE;AAKA,SAAKzrB,GAAL,CAAS,iDAAT,EAA4D,IAA5D,EAAkE;AACjE8B,YAAM,SAD2D;AAEjE,gBAAU,IAFuD;AAGjE2pB,iBAAW;AAHsD,KAAlE;AAKA,SAAKzrB,GAAL,CAAS,uDAAT,EAAkE,IAAlE,EAAwE;AACvE8B,YAAM,SADiE;AAEvE,gBAAU,IAF6D;AAGvE2pB,iBAAW;AAH4D,KAAxE;AAKA,SAAKzrB,GAAL,CAAS,0DAAT,EAAqE,KAArE,EAA4E;AAC3E8B,YAAM,SADqE;AAE3E,gBAAU,IAFiE;AAG3E2pB,iBAAW;AAHgE,KAA5E;AAKA,SAAKzrB,GAAL,CAAS,iDAAT,EAA4D,KAA5D,EAAmE;AAClE8B,YAAM,SAD4D;AAElE,gBAAU,IAFwD;AAGlE2pB,iBAAW;AAHuD,KAAnE;AAKA,SAAKzrB,GAAL,CAAS,6CAAT,EAAwD,KAAxD,EAA+D;AAC9D8B,YAAM,SADwD;AAE9D,gBAAU,IAFoD;AAG9D2pB,iBAAW;AAHmD,KAA/D;AAKA,SAAKzrB,GAAL,CAAS,+CAAT,EAA0D,KAA1D,EAAiE;AAChE8B,YAAM,SAD0D;AAEhE,gBAAU,IAFsD;AAGhE2pB,iBAAW;AAHqD,KAAjE;AAKA,SAAKzrB,GAAL,CAAS,+CAAT,EAA0D,KAA1D,EAAiE;AAChE8B,YAAM,SAD0D;AAEhE,gBAAU,IAFsD;AAGhE2pB,iBAAW;AAHqD,KAAjE;AAKA,SAAKzrB,GAAL,CAAS,2DAAT,EAAsE,UAAtE,EAAkF;AACjF8B,YAAM,QAD2E;AAEjFg9B,cAAQ,CACP;AACC/gC,aAAK,QADN;AAEC0tB,mBAAW;AAFZ,OADO,EAKP;AACC1tB,aAAK,UADN;AAEC0tB,mBAAW;AAFZ,OALO,EASP;AACC1tB,aAAK,UADN;AAEC0tB,mBAAW;AAFZ,OATO,CAFyE;AAgBjF,gBAAU,IAhBuE;AAiBjFA,iBAAW;AAjBsE,KAAlF;AAmBA,SAAKzrB,GAAL,CAAS,iDAAT,EAA4D,KAA5D,EAAmE;AAClE8B,YAAM,SAD4D;AAElE,gBAAU,IAFwD;AAGlE2pB,iBAAW;AAHuD,KAAnE;AAKA,SAAKzrB,GAAL,CAAS,qDAAT,EAAgE,KAAhE,EAAuE;AACtE8B,YAAM,SADgE;AAEtE,gBAAU,IAF4D;AAGtE2pB,iBAAW;AAH2D,KAAvE;AAKA,SAAKzrB,GAAL,CAAS,wDAAT,EAAmE,IAAnE,EAAyE;AACxE8B,YAAM,SADkE;AAExE,gBAAU,IAF8D;AAGxE2pB,iBAAW;AAH6D,KAAzE;AAKA,SAAKzrB,GAAL,CAAS,+CAAT,EAA0D,QAA1D,EAAoE;AACnE8B,YAAM,QAD6D;AAEnEg9B,cAAQ,CACP;AACC/gC,aAAK,QADN;AAEC0tB,mBAAW;AAFZ,OADO,EAKP;AACC1tB,aAAK,aADN;AAEC0tB,mBAAW;AAFZ,OALO,EASP;AACC1tB,aAAK,SADN;AAEC0tB,mBAAW;AAFZ,OATO,CAF2D;AAgBnE,gBAAU,IAhByD;AAiBnEA,iBAAW;AAjBwD,KAApE;AAmBA,SAAKzrB,GAAL,CAAS,4CAAT,EAAuD,CAAvD,EAA0D;AACzD8B,YAAM,QADmD;AAEzDg9B,cAAQ,CACP;AACC/gC,aAAK,CADN;AAEC0tB,mBAAW;AAFZ,OADO,EAKP;AACC1tB,aAAK,CADN;AAEC0tB,mBAAW;AAFZ,OALO,EASP;AACC1tB,aAAK,CADN;AAEC0tB,mBAAW;AAFZ,OATO,CAFiD;AAgBzD,gBAAU,IAhB+C;AAiBzDA,iBAAW;AAjB8C,KAA1D;AAmBA,SAAKzrB,GAAL,CAAS,yDAAT,EAAoE,KAApE,EAA2E;AAC1E8B,YAAM,QADoE;AAE1Eg9B,cAAQ,CACP;AACC/gC,aAAK,UADN;AAEC0tB,mBAAW;AAFZ,OADO,EAKP;AACC1tB,aAAK,KADN;AAEC0tB,mBAAW;AAFZ,OALO,CAFkE;AAY1E,gBAAU,IAZgE;AAa1EA,iBAAW;AAb+D,KAA3E;AAeA,SAAKzrB,GAAL,CAAS,sDAAT,EAAiE,KAAjE,EAAwE;AACvE8B,YAAM,SADiE;AAEvE,gBAAU,IAF6D;AAGvE2pB,iBAAW;AAH4D,KAAxE;AAKA,SAAKzrB,GAAL,CAAS,uDAAT,EAAkE,MAAlE,EAA0E;AACzE8B,YAAM,QADmE;AAEzEg9B,cAAQ,CACP;AACC/gC,aAAK,MADN;AAEC0tB,mBAAW;AAFZ,OADO,EAKP;AACC1tB,aAAK,MADN;AAEC0tB,mBAAW;AAFZ,OALO,CAFiE;AAYzE,gBAAU,IAZ+D;AAazEA,iBAAW;AAb8D,KAA1E;AAeA,SAAKzrB,GAAL,CAAS,0DAAT,EAAqE,OAArE,EAA8E;AAC7E8B,YAAM,QADuE;AAE7Eg9B,cAAQ,CACP;AACC/gC,aAAK,MADN;AAEC0tB,mBAAW;AAFZ,OADO,EAKP;AACC1tB,aAAK,OADN;AAEC0tB,mBAAW;AAFZ,OALO,CAFqE;AAY7E,gBAAU,IAZmE;AAa7EA,iBAAW;AAbkE,KAA9E;AAeA,SAAKzrB,GAAL,CAAS,4DAAT,EAAuE,IAAvE,EAA6E;AAC5E8B,YAAM,SADsE;AAE5E,gBAAU,IAFkE;AAG5E2pB,iBAAW;AAHiE,KAA7E;AAKA,SAAKzrB,GAAL,CAAS,4DAAT,EAAuE,GAAvE,EAA4E;AAC3E8B,YAAM,KADqE;AAE3E,gBAAU,IAFiE;AAG3E2pB,iBAAW;AAHgE,KAA5E;AAKA,GA5PD;AA8PA,OAAKK,OAAL,CAAa,QAAb,EAAuB,YAAW;AACjC,SAAK9rB,GAAL,CAAS,uBAAT,EAAkC,IAAlC,EAAwC;AACvC8B,YAAM;AADiC,KAAxC;AAGA,SAAK9B,GAAL,CAAS,qBAAT,EAAgC,GAAhC,EAAqC;AACpC8B,YAAM,KAD8B;AAEpCqpB,mBAAa;AACZnyB,aAAK,uBADO;AAEZgF,eAAO;AAFK;AAFuB,KAArC;AAQA,WAAO,KAAKgC,GAAL,CAAS,2BAAT,EAAsC,IAAtC,EAA4C;AAClD8B,YAAM;AAD4C,KAA5C,CAAP;AAGA,GAfD;AAgBA,CAlbD;AAobAjM,WAAWoF,QAAX,CAAoBkxB,QAApB,CAA6B,OAA7B,EAAsC,YAAW;AAChD,OAAKL,OAAL,CAAa,UAAb,EAAyB,YAAW;AACnC,UAAMX,cAAc;AACnBnyB,WAAK,yBADc;AAEnBgF,aAAO;AAFY,KAApB;AAIA,SAAKgC,GAAL,CAAS,yBAAT,EAAoC,KAApC,EAA2C;AAC1C8B,YAAM,SADoC;AAE1C,gBAAU;AAFgC,KAA3C;AAIA,SAAK9B,GAAL,CAAS,4BAAT,EAAuC,EAAvC,EAA2C;AAC1C8B,YAAM,QADoC;AAE1CqpB;AAF0C,KAA3C;AAIA,SAAKnrB,GAAL,CAAS,gCAAT,EAA2C,EAA3C,EAA+C;AAC9C8B,YAAM,QADwC;AAE9CqpB;AAF8C,KAA/C;AAIA,WAAO,KAAKnrB,GAAL,CAAS,sCAAT,EAAiD,iBAAjD,EAAoE;AAC1E8B,YAAM,aADoE;AAE1E6tC,gBAAU,IAFgE;AAG1E9jB,aAAO,IAHmE;AAI1EV;AAJ0E,KAApE,CAAP;AAMA,GAvBD;AAwBA,OAAKW,OAAL,CAAa,QAAb,EAAuB,YAAW;AACjC,UAAMX,cAAc;AACnBnyB,WAAK,uBADc;AAEnBgF,aAAO;AAFY,KAApB;AAIA,SAAKgC,GAAL,CAAS,uBAAT,EAAkC,KAAlC,EAAyC;AACxC8B,YAAM,SADkC;AAExC,gBAAU;AAF8B,KAAzC;AAIA,SAAK9B,GAAL,CAAS,0BAAT,EAAqC,EAArC,EAAyC;AACxC8B,YAAM,QADkC;AAExCqpB;AAFwC,KAAzC;AAIA,SAAKnrB,GAAL,CAAS,8BAAT,EAAyC,EAAzC,EAA6C;AAC5C8B,YAAM,QADsC;AAE5CqpB;AAF4C,KAA7C;AAIA,WAAO,KAAKnrB,GAAL,CAAS,oCAAT,EAA+C,eAA/C,EAAgE;AACtE8B,YAAM,aADgE;AAEtE6tC,gBAAU,IAF4D;AAGtE9jB,aAAO,IAH+D;AAItEV;AAJsE,KAAhE,CAAP;AAMA,GAvBD;AAwBA,OAAKW,OAAL,CAAa,QAAb,EAAuB,YAAW;AACjC,UAAMX,cAAc;AACnBnyB,WAAK,uBADc;AAEnBgF,aAAO;AAFY,KAApB;AAIA,SAAKgC,GAAL,CAAS,uBAAT,EAAkC,KAAlC,EAAyC;AACxC8B,YAAM,SADkC;AAExC,gBAAU;AAF8B,KAAzC;AAIA,SAAK9B,GAAL,CAAS,0BAAT,EAAqC,EAArC,EAAyC;AACxC8B,YAAM,QADkC;AAExCqpB;AAFwC,KAAzC;AAIA,SAAKnrB,GAAL,CAAS,8BAAT,EAAyC,EAAzC,EAA6C;AAC5C8B,YAAM,QADsC;AAE5CqpB;AAF4C,KAA7C;AAIA,WAAO,KAAKnrB,GAAL,CAAS,oCAAT,EAA+C,eAA/C,EAAgE;AACtE8B,YAAM,aADgE;AAEtE6tC,gBAAU,IAF4D;AAGtE9jB,aAAO,IAH+D;AAItEV;AAJsE,KAAhE,CAAP;AAMA,GAvBD;AAwBA,OAAKW,OAAL,CAAa,UAAb,EAAyB,YAAW;AACnC,UAAMX,cAAc;AACnBnyB,WAAK,yBADc;AAEnBgF,aAAO;AAFY,KAApB;AAIA,SAAKgC,GAAL,CAAS,yBAAT,EAAoC,KAApC,EAA2C;AAC1C8B,YAAM,SADoC;AAE1C,gBAAU;AAFgC,KAA3C;AAIA,SAAK9B,GAAL,CAAS,4BAAT,EAAuC,EAAvC,EAA2C;AAC1C8B,YAAM,QADoC;AAE1CqpB;AAF0C,KAA3C;AAIA,SAAKnrB,GAAL,CAAS,gCAAT,EAA2C,EAA3C,EAA+C;AAC9C8B,YAAM,QADwC;AAE9CqpB;AAF8C,KAA/C;AAIA,WAAO,KAAKnrB,GAAL,CAAS,sCAAT,EAAiD,iBAAjD,EAAoE;AAC1E8B,YAAM,aADoE;AAE1E6tC,gBAAU,IAFgE;AAG1E9jB,aAAO,IAHmE;AAI1EV;AAJ0E,KAApE,CAAP;AAMA,GAvBD;AAwBA,OAAKW,OAAL,CAAa,QAAb,EAAuB,YAAW;AACjC,UAAMX,cAAc;AACnBnyB,WAAK,uBADc;AAEnBgF,aAAO;AAFY,KAApB;AAIA,SAAKgC,GAAL,CAAS,uBAAT,EAAkC,KAAlC,EAAyC;AACxC8B,YAAM,SADkC;AAExC,gBAAU;AAF8B,KAAzC;AAIA,SAAK9B,GAAL,CAAS,0BAAT,EAAqC,EAArC,EAAyC;AACxC8B,YAAM,QADkC;AAExCqpB;AAFwC,KAAzC;AAIA,SAAKnrB,GAAL,CAAS,8BAAT,EAAyC,EAAzC,EAA6C;AAC5C8B,YAAM,QADsC;AAE5CqpB;AAF4C,KAA7C;AAIA,WAAO,KAAKnrB,GAAL,CAAS,oCAAT,EAA+C,eAA/C,EAAgE;AACtE8B,YAAM,aADgE;AAEtE6tC,gBAAU,IAF4D;AAGtE9jB,aAAO,IAH+D;AAItEV;AAJsE,KAAhE,CAAP;AAMA,GAvBD;AAwBA,OAAKW,OAAL,CAAa,SAAb,EAAwB,YAAW;AAClC,UAAMX,cAAc;AACnBnyB,WAAK,wBADc;AAEnBgF,aAAO;AAFY,KAApB;AAIA,SAAKgC,GAAL,CAAS,wBAAT,EAAmC,KAAnC,EAA0C;AACzC8B,YAAM,SADmC;AAEzC,gBAAU;AAF+B,KAA1C;AAIA,SAAK9B,GAAL,CAAS,2BAAT,EAAsC,EAAtC,EAA0C;AACzC8B,YAAM,QADmC;AAEzCqpB;AAFyC,KAA1C;AAIA,SAAKnrB,GAAL,CAAS,+BAAT,EAA0C,EAA1C,EAA8C;AAC7C8B,YAAM,QADuC;AAE7CqpB;AAF6C,KAA9C;AAIA,WAAO,KAAKnrB,GAAL,CAAS,qCAAT,EAAgD,gBAAhD,EAAkE;AACxE8B,YAAM,aADkE;AAExE6tC,gBAAU,IAF8D;AAGxE9jB,aAAO,IAHiE;AAIxEV;AAJwE,KAAlE,CAAP;AAMA,GAvBD;AAwBA,SAAO,KAAKW,OAAL,CAAa,OAAb,EAAsB,YAAW;AACvC,SAAK9rB,GAAL,CAAS,2BAAT,EAAsC,iCAAtC,EAAyE;AACxE8B,YAAM,QADkE;AAExE,gBAAU;AAF8D,KAAzE;AAIA,WAAO,KAAK9B,GAAL,CAAS,+BAAT,EAA0C,EAA1C,EAA8C;AACpD8B,YAAM,QAD8C;AAEpD,gBAAU;AAF0C,KAA9C,CAAP;AAIA,GATM,CAAP;AAUA,CA3JD;AA6JAjM,WAAWoF,QAAX,CAAoBkxB,QAApB,CAA6B,SAA7B,EAAwC,YAAW;AAClD,OAAKnsB,GAAL,CAAS,UAAT,EAAqB,OAAOlD,yBAAP,KAAqC,WAArC,IAAoDA,8BAA8B,IAAlF,GAAyFA,0BAA0B6M,QAAnH,GAA8H,IAAnJ,EAAyJ;AACxJ7H,UAAM,QADkJ;AAExJ4pB,qBAAiB,sBAFuI;AAGxJ,cAAU;AAH8I,GAAzJ;AAKA,OAAK1rB,GAAL,CAAS,WAAT,EAAsB,aAAtB,EAAqC;AACpC8B,UAAM,QAD8B;AAEpC,cAAU;AAF0B,GAArC;AAIA,OAAK9B,GAAL,CAAS,UAAT,EAAqB,EAArB,EAAyB;AACxB8B,UAAM,UADkB;AAExB,cAAU;AAFc,GAAzB;AAIA,OAAK9B,GAAL,CAAS,gCAAT,EAA2C,KAA3C,EAAkD;AACjD8B,UAAM;AAD2C,GAAlD;AAGA,OAAK9B,GAAL,CAAS,gBAAT,EAA2B,IAA3B,EAAiC;AAChC8B,UAAM,SAD0B;AAEhC,cAAU;AAFsB,GAAjC;AAIA,OAAK9B,GAAL,CAAS,2BAAT,EAAsC,EAAtC,EAA0C;AACzC8B,UAAM,QADmC;AAEzC,cAAU;AAF+B,GAA1C;AAIA,OAAK9B,GAAL,CAAS,cAAT,EAAyB,8BAAzB,EAAyD;AACxD8B,UAAM,QADkD;AAExDg9B,YAAQ,CACP;AACC/gC,WAAK,cADN;AAEC0tB,iBAAW;AAFZ,KADO,EAIJ;AACF1tB,WAAK,oBADH;AAEF0tB,iBAAW;AAFT,KAJI,EAOJ;AACF1tB,WAAK,qBADH;AAEF0tB,iBAAW;AAFT,KAPI,EAUJ;AACF1tB,WAAK,8BADH;AAEF0tB,iBAAW;AAFT,KAVI,CAFgD;AAiBxD,cAAU;AAjB8C,GAAzD;AAmBA,OAAKzrB,GAAL,CAAS,iBAAT,EAA4B,cAA5B,EAA4C;AAC3C8B,UAAM,QADqC;AAE3Cg9B,YAAQ,CACP;AACC/gC,WAAK,cADN;AAEC0tB,iBAAW;AAFZ,KADO,EAIJ;AACF1tB,WAAK,eADH;AAEF0tB,iBAAW;AAFT,KAJI,CAFmC;AAW3C,cAAU;AAXiC,GAA5C;AAaA,OAAKzrB,GAAL,CAAS,YAAT,EAAuB,EAAvB,EAA2B;AAC1B8B,UAAM,QADoB;AAE1B,cAAU;AAFgB,GAA3B;AAIA,OAAK9B,GAAL,CAAS,WAAT,EAAsB,KAAtB,EAA6B;AAC5B8B,UAAM,SADsB;AAE5B,cAAU;AAFkB,GAA7B;AAIA,OAAK9B,GAAL,CAAS,qBAAT,EAAgC,EAAhC,EAAoC;AACnC8B,UAAM,QAD6B;AAEnC,cAAU;AAFyB,GAApC;AAIA,OAAK9B,GAAL,CAAS,iBAAT,EAA4B,EAA5B,EAAgC;AAC/B8B,UAAM,QADyB;AAE/B,cAAU;AAFqB,GAAhC;AAIA,OAAK9B,GAAL,CAAS,+BAAT,EAA0C,KAA1C,EAAiD;AAChD8B,UAAM,SAD0C;AAEhD,cAAU;AAFsC,GAAjD;AAIA,OAAK9B,GAAL,CAAS,SAAT,EAAoB,gBAApB,EAAsC;AACrC8B,UAAM,QAD+B;AAErC8tC,gBAAY;AAFyB,GAAtC;AAIA,OAAK5vC,GAAL,CAAS,oBAAT,EAA+B,KAA/B,EAAsC;AACrC8B,UAAM,SAD+B;AAErCy7B,YAAQ,IAF6B;AAGrC7R,qBAAiB;AAHoB,GAAtC;AAKA,OAAKI,OAAL,CAAa,MAAb,EAAqB,YAAW;AAC/B,SAAK9rB,GAAL,CAAS,uBAAT,EAAkC,iBAAlC,EAAqD;AACpD8B,YAAM,QAD8C;AAEpD,gBAAU,IAF0C;AAGpD4pB,uBAAiB;AAHmC,KAArD;AAKA,WAAO,KAAK1rB,GAAL,CAAS,oBAAT,EAA+B,IAA/B,EAAqC;AAC3C8B,YAAM,SADqC;AAE3C,gBAAU;AAFiC,KAArC,CAAP;AAIA,GAVD;AAWA,OAAKgqB,OAAL,CAAa,WAAb,EAA0B,YAAW;AACpC,WAAO,KAAK9rB,GAAL,CAAS,sBAAT,EAAiC,IAAjC,EAAuC;AAC7C8B,YAAM;AADuC,KAAvC,CAAP;AAGA,GAJD;AAKA,OAAKgqB,OAAL,CAAa,eAAb,EAA8B,YAAW;AACxC,SAAK9rB,GAAL,CAAS,gCAAT,EAA2C,GAA3C,EAAgD;AAC/C8B,YAAM,KADyC;AAE/Cy7B,cAAQ,IAFuC;AAG/C7R,uBAAiB;AAH8B,KAAhD;AAMA,SAAK1rB,GAAL,CAAS,oCAAT,EAA+C,KAA/C,EAAsD;AACrD8B,YAAM,SAD+C;AAErDy7B,cAAQ,IAF6C;AAGrD7R,uBAAiB;AAHoC,KAAtD;AAKA,GAZD;AAaA,OAAKI,OAAL,CAAa,UAAb,EAAyB,YAAW;AACnC,WAAO,KAAK9rB,GAAL,CAAS,gBAAT,EAA2B,GAA3B,EAAgC;AACtC8B,YAAM,KADgC;AAEtC,gBAAU,IAF4B;AAGtC4pB,uBAAiB;AAHqB,KAAhC,CAAP;AAKA,GAND;AAOA,OAAKI,OAAL,CAAa,oBAAb,EAAmC,YAAW;AAC7C,SAAK9rB,GAAL,CAAS,gCAAT,EAA2C,KAA3C,EAAkD;AACjD8B,YAAM,SAD2C;AAEjD,gBAAU;AAFuC,KAAlD;AAIA,SAAK9B,GAAL,CAAS,uCAAT,EAAkD,GAAlD,EAAuD;AACtD8B,YAAM,QADgD;AAEtD,gBAAU,IAF4C;AAGtDqpB,mBAAa;AACZnyB,aAAK,gCADO;AAEZgF,eAAO;AAFK;AAHyC,KAAvD;AAQA,SAAKgC,GAAL,CAAS,mCAAT,EAA8C,KAA9C,EAAqD;AACpD8B,YAAM,SAD8C;AAEpD,gBAAU;AAF0C,KAArD;AAIA,WAAO,KAAK9B,GAAL,CAAS,mCAAT,EAA8C,GAA9C,EAAmD;AACzD8B,YAAM,QADmD;AAEzD,gBAAU,IAF+C;AAGzDqpB,mBAAa;AACZnyB,aAAK,mCADO;AAEZgF,eAAO;AAFK;AAH4C,KAAnD,CAAP;AAQA,GAzBD;AA0BA,OAAK8tB,OAAL,CAAa,cAAb,EAA6B,YAAW;AACvC,WAAO,KAAK9rB,GAAL,CAAS,qBAAT,EAAgC,EAAhC,EAAoC;AAC1C8B,YAAM,MADoC;AAE1C,gBAAU;AAFgC,KAApC,CAAP;AAIA,GALD;AAMA,SAAO,KAAKgqB,OAAL,CAAa,aAAb,EAA4B,YAAW;AAC7C,WAAO,KAAK9rB,GAAL,CAAS,qBAAT,EAAgC,EAAhC,EAAoC;AAC1C8B,YAAM;AADoC,KAApC,CAAP;AAGA,GAJM,CAAP;AAKA,CA/JD;AAiKAjM,WAAWoF,QAAX,CAAoBkxB,QAApB,CAA6B,OAA7B,EAAsC,YAAW;AAChD,OAAKL,OAAL,CAAa,SAAb,EAAwB,YAAW;AAClC,SAAK9rB,GAAL,CAAS,kBAAT,EAA6B,uDAA7B,EAAsF;AACrF8B,YAAM,MAD+E;AAErF+tC,YAAM,MAF+E;AAGrFC,iBAAW,IAH0E;AAIrFrkB,iBAAW,kBAJ0E;AAKrFC,uBAAiB;AALoE,KAAtF;AAOA,SAAK1rB,GAAL,CAAS,uBAAT,EAAkC,4DAAlC,EAAgG;AAC/F8B,YAAM,MADyF;AAE/F+tC,YAAM,MAFyF;AAG/FC,iBAAW,IAHoF;AAI/FrkB,iBAAW,uBAJoF;AAK/FC,uBAAiB;AAL8E,KAAhG;AAOA,WAAO,KAAK1rB,GAAL,CAAS,2BAAT,EAAsC,wCAAtC,EAAgF;AACtF8B,YAAM,MADgF;AAEtF+tC,YAAM,MAFgF;AAGtFC,iBAAW,IAH2E;AAItFrkB,iBAAW,2BAJ2E;AAKtFC,uBAAiB;AALqE,KAAhF,CAAP;AAOA,GAtBD;AAuBA,OAAKI,OAAL,CAAa,mBAAb,EAAkC,YAAW;AAC5C,SAAK9rB,GAAL,CAAS,cAAT,EAAyB,o2BAAzB,EAA+3B;AAC93B8B,YAAM,MADw3B;AAE93B+tC,YAAM,WAFw3B;AAG93BC,iBAAW,IAHm3B;AAI93BrkB,iBAAW;AAJm3B,KAA/3B;AAMA,SAAKzrB,GAAL,CAAS,cAAT,EAAyB,qWAAzB,EAAgY;AAC/X8B,YAAM,MADyX;AAE/X+tC,YAAM,WAFyX;AAG/XC,iBAAW,IAHoX;AAI/XrkB,iBAAW;AAJoX,KAAhY;AAMA,WAAO,KAAKzrB,GAAL,CAAS,2BAAT,EAAsC,8bAAtC,EAAse;AAC5e8B,YAAM,MADse;AAE5e+tC,YAAM,WAFse;AAG5eC,iBAAW,IAHie;AAI5erkB,iBAAW;AAJie,KAAte,CAAP;AAMA,GAnBD;AAoBA,OAAKK,OAAL,CAAa,cAAb,EAA6B,YAAW;AACvC,SAAK9rB,GAAL,CAAS,qBAAT,EAAgC,KAAhC,EAAuC;AACtC8B,YAAM,SADgC;AAEtCkI,WAAK,IAFiC;AAGtCyhB,iBAAW;AAH2B,KAAvC;AAKA,SAAKzrB,GAAL,CAAS,oBAAT,EAA+B,KAA/B,EAAsC;AACrC8B,YAAM,SAD+B;AAErCkI,WAAK,IAFgC;AAGrCyhB,iBAAW,oBAH0B;AAIrCC,uBAAiB;AAJoB,KAAtC;AAMA,SAAK1rB,GAAL,CAAS,uBAAT,EAAkC,MAAlC,EAA0C;AACzC8B,YAAM,QADmC;AAEzCg9B,cAAQ,CACP;AACC/gC,aAAK,MADN;AAEC0tB,mBAAW;AAFZ,OADO,EAIJ;AACF1tB,aAAK,KADH;AAEF0tB,mBAAW;AAFT,OAJI,CAFiC;AAWzCzhB,WAAK,IAXoC;AAYzCyhB,iBAAW;AAZ8B,KAA1C;AAcA,SAAKzrB,GAAL,CAAS,mBAAT,EAA8B,EAA9B,EAAkC;AACjC8B,YAAM,QAD2B;AAEjCkI,WAAK,IAF4B;AAGjCyhB,iBAAW;AAHsB,KAAlC;AAKA,SAAKzrB,GAAL,CAAS,mBAAT,EAA8B,KAA9B,EAAqC;AACpC8B,YAAM,QAD8B;AAEpCg9B,cAAQ,CACP;AACC/gC,aAAK,KADN;AAEC0tB,mBAAW;AAFZ,OADO,EAIJ;AACF1tB,aAAK,KADH;AAEF0tB,mBAAW;AAFT,OAJI,EAOJ;AACF1tB,aAAK,KADH;AAEF0tB,mBAAW;AAFT,OAPI,EAUJ;AACF1tB,aAAK,KADH;AAEF0tB,mBAAW;AAFT,OAVI,CAF4B;AAiBpCzhB,WAAK,IAjB+B;AAkBpCyhB,iBAAW;AAlByB,KAArC;AAoBA,SAAKzrB,GAAL,CAAS,wBAAT,EAAmC,KAAnC,EAA0C;AACzC8B,YAAM,SADmC;AAEzCkI,WAAK,IAFoC;AAGzCyhB,iBAAW;AAH8B,KAA1C;AAKA,SAAKzrB,GAAL,CAAS,wBAAT,EAAmC,CAAnC,EAAsC;AACrC8B,YAAM,KAD+B;AAErCkI,WAAK,IAFgC;AAGrCyhB,iBAAW,wBAH0B;AAIrCN,mBAAa;AACZnyB,aAAK,uBADO;AAEZgF,eAAO;AAFK;AAJwB,KAAtC;AASA,SAAKgC,GAAL,CAAS,qBAAT,EAAgC,IAAhC,EAAsC;AACrC8B,YAAM,SAD+B;AAErCkI,WAAK,IAFgC;AAGrCyhB,iBAAW,qBAH0B;AAIrCN,mBAAa;AACZnyB,aAAK,uBADO;AAEZgF,eAAO;AAFK;AAJwB,KAAtC;AASA,SAAKgC,GAAL,CAAS,wBAAT,EAAmC,GAAnC,EAAwC;AACvC8B,YAAM,QADiC;AAEvCg9B,cAAQ,CACP;AACC/gC,aAAK,GADN;AAEC0tB,mBAAW;AAFZ,OADO,EAIJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAJI,EAOJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAPI,EAUJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAVI,EAaJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAbI,EAgBJ;AACF1tB,aAAK,IADH;AAEF0tB,mBAAW;AAFT,OAhBI,EAmBJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAnBI,EAsBJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAtBI,EAyBJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAzBI,EA4BJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OA5BI,EA+BJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OA/BI,EAkCJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAlCI,EAqCJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OArCI,EAwCJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAxCI,EA2CJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OA3CI,EA8CJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OA9CI,EAiDJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAjDI,EAoDJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OApDI,EAuDJ;AACF1tB,aAAK,GADH;AAEF0tB,mBAAW;AAFT,OAvDI,CAF+B;AA8DvCzhB,WAAK,IA9DkC;AA+DvCyhB,iBAAW;AA/D4B,KAAxC;AAiEA,SAAKzrB,GAAL,CAAS,uBAAT,EAAkC,EAAlC,EAAsC;AACrC8B,YAAM,QAD+B;AAErCkI,WAAK,IAFgC;AAGrCyhB,iBAAW,UAH0B;AAIrCskB,mBAAa;AAJwB,KAAtC;AAMA,WAAO,KAAK/vC,GAAL,CAAS,uBAAT,EAAkC,EAAlC,EAAsC;AAC5C8B,YAAM,UADsC;AAE5CkI,WAAK,IAFuC;AAG5CyhB,iBAAW;AAHiC,KAAtC,CAAP;AAKA,GAtJD;AAuJA,OAAKK,OAAL,CAAa,MAAb,EAAqB,YAAW;AAC/B,SAAK9rB,GAAL,CAAS,eAAT,EAA0B,MAA1B,EAAkC;AACjC8B,YAAM,QAD2B;AAEjCg9B,cAAQ,CACP;AACC/gC,aAAK,MADN;AAEC0tB,mBAAW;AAFZ,OADO,EAIJ;AACF1tB,aAAK,OADH;AAEF0tB,mBAAW;AAFT,OAJI,CAFyB;AAWjCzhB,WAAK,IAX4B;AAYjCyhB,iBAAW;AAZsB,KAAlC;AAcA,SAAKzrB,GAAL,CAAS,WAAT,EAAsB,EAAtB,EAA0B;AACzB8B,YAAM,QADmB;AAEzBkI,WAAK,IAFoB;AAGzByhB,iBAAW;AAHc,KAA1B;AAKA,SAAKzrB,GAAL,CAAS,WAAT,EAAsB,EAAtB,EAA0B;AACzB8B,YAAM,QADmB;AAEzBkI,WAAK,IAFoB;AAGzByhB,iBAAW;AAHc,KAA1B;AAKA,SAAKzrB,GAAL,CAAS,gBAAT,EAA2B,KAA3B,EAAkC;AACjC8B,YAAM,SAD2B;AAEjCkI,WAAK,IAF4B;AAGjCyhB,iBAAW,WAHsB;AAIjCN,mBAAa;AACZnyB,aAAK,eADO;AAEZgF,eAAO;AAFK;AAJoB,KAAlC;AASA,SAAKgC,GAAL,CAAS,WAAT,EAAsB,IAAtB,EAA4B;AAC3B8B,YAAM,SADqB;AAE3BkI,WAAK,IAFsB;AAG3ByhB,iBAAW;AAHgB,KAA5B;AAKA,SAAKzrB,GAAL,CAAS,eAAT,EAA0B,EAA1B,EAA8B;AAC7B8B,YAAM,QADuB;AAE7BkI,WAAK,IAFwB;AAG7ByhB,iBAAW;AAHkB,KAA9B;AAKA,SAAKzrB,GAAL,CAAS,eAAT,EAA0B,EAA1B,EAA8B;AAC7B8B,YAAM,UADuB;AAE7BkI,WAAK,IAFwB;AAG7ByhB,iBAAW;AAHkB,KAA9B;AAKA,SAAKzrB,GAAL,CAAS,YAAT,EAAuB,EAAvB,EAA2B;AAC1B8B,YAAM,QADoB;AAE1BiuC,mBAAa;AAFa,KAA3B;AAIA,WAAO,KAAK/vC,GAAL,CAAS,kBAAT,EAA6B,mBAA7B,EAAkD;AACxD8B,YAAM,QADkD;AAExD8tC,kBAAY;AAF4C,KAAlD,CAAP;AAIA,GAzDD;AA0DA,OAAK9jB,OAAL,CAAa,YAAb,EAA2B,YAAW;AACrC,SAAK9rB,GAAL,CAAS,uBAAT,EAAkC,KAAlC,EAAyC;AACxC8B,YAAM,SADkC;AAExC2pB,iBAAW;AAF6B,KAAzC;AAIA,SAAKzrB,GAAL,CAAS,oBAAT,EAA+B,EAA/B,EAAmC;AAClC8B,YAAM,QAD4B;AAElC2pB,iBAAW,SAFuB;AAGlCN,mBAAa;AACZnyB,aAAK,uBADO;AAEZgF,eAAO;AAFK,OAHqB;AAOlCqtB,wBAAkB;AACjBryB,aAAK,uBADY;AAEjBgF,eAAO;AAFU;AAPgB,KAAnC;AAYA,WAAO,KAAKgC,GAAL,CAAS,iBAAT,EAA4B,EAA5B,EAAgC;AACtC8B,YAAM,MADgC;AAEtC+tC,YAAM,WAFgC;AAGtCC,iBAAW,IAH2B;AAItCrkB,iBAAW,MAJ2B;AAKtCC,uBAAiB,6BALqB;AAMtCP,mBAAa;AACZnyB,aAAK,uBADO;AAEZgF,eAAO;AAFK,OANyB;AAUtCqtB,wBAAkB;AACjBryB,aAAK,uBADY;AAEjBgF,eAAO;AAFU;AAVoB,KAAhC,CAAP;AAeA,GAhCD;AAiCA,OAAK8tB,OAAL,CAAa,cAAb,EAA6B,YAAW;AACvC,SAAK9rB,GAAL,CAAS,gCAAT,EAA2C,KAA3C,EAAkD;AACjD8B,YAAM,SAD2C;AAEjD2pB,iBAAW;AAFsC,KAAlD;AAIA,SAAKzrB,GAAL,CAAS,mCAAT,EAA8C,EAA9C,EAAkD;AACjD8B,YAAM,QAD2C;AAEjD2pB,iBAAW,SAFsC;AAGjDN,mBAAa;AACZnyB,aAAK,gCADO;AAEZgF,eAAO;AAFK,OAHoC;AAOjDqtB,wBAAkB;AACjBryB,aAAK,gCADY;AAEjBgF,eAAO;AAFU;AAP+B,KAAlD;AAYA,WAAO,KAAKgC,GAAL,CAAS,2BAAT,EAAsC,EAAtC,EAA0C;AAChD8B,YAAM,MAD0C;AAEhD+tC,YAAM,WAF0C;AAGhDC,iBAAW,IAHqC;AAIhDrkB,iBAAW,MAJqC;AAKhDN,mBAAa;AACZnyB,aAAK,gCADO;AAEZgF,eAAO;AAFK,OALmC;AAShDqtB,wBAAkB;AACjBryB,aAAK,gCADY;AAEjBgF,eAAO;AAFU;AAT8B,KAA1C,CAAP;AAcA,GA/BD;AAgCA,OAAK8tB,OAAL,CAAa,wBAAb,EAAuC,YAAW;AACjD,SAAK9rB,GAAL,CAAS,oCAAT,EAA+C,KAA/C,EAAsD;AACrD8B,YAAM,SAD+C;AAErD2pB,iBAAW;AAF0C,KAAtD;AAIA,SAAKzrB,GAAL,CAAS,gCAAT,EAA2C,EAA3C,EAA+C;AAC9C8B,YAAM,QADwC;AAE9C2pB,iBAAW,SAFmC;AAG9CN,mBAAa;AACZnyB,aAAK,oCADO;AAEZgF,eAAO;AAFK,OAHiC;AAO9CqtB,wBAAkB;AACjBryB,aAAK,oCADY;AAEjBgF,eAAO;AAFU;AAP4B,KAA/C;AAYA,WAAO,KAAKgC,GAAL,CAAS,yBAAT,EAAoC,EAApC,EAAwC;AAC9C8B,YAAM,MADwC;AAE9C+tC,YAAM,WAFwC;AAG9CC,iBAAW,IAHmC;AAI9CrkB,iBAAW,MAJmC;AAK9CC,uBAAiB,qCAL6B;AAM9CP,mBAAa;AACZnyB,aAAK,oCADO;AAEZgF,eAAO;AAFK,OANiC;AAU9CqtB,wBAAkB;AACjBryB,aAAK,oCADY;AAEjBgF,eAAO;AAFU;AAV4B,KAAxC,CAAP;AAeA,GAhCD;AAiCA,OAAK8tB,OAAL,CAAa,yBAAb,EAAwC,YAAW;AAClD,SAAK9rB,GAAL,CAAS,4BAAT,EAAuC,KAAvC,EAA8C;AAC7C8B,YAAM,SADuC;AAE7C2pB,iBAAW;AAFkC,KAA9C;AAIA,SAAKzrB,GAAL,CAAS,+BAAT,EAA0C,EAA1C,EAA8C;AAC7C8B,YAAM,QADuC;AAE7C2pB,iBAAW,SAFkC;AAG7CN,mBAAa;AACZnyB,aAAK,4BADO;AAEZgF,eAAO;AAFK,OAHgC;AAO7CqtB,wBAAkB;AACjBryB,aAAK,4BADY;AAEjBgF,eAAO;AAFU;AAP2B,KAA9C;AAYA,WAAO,KAAKgC,GAAL,CAAS,uBAAT,EAAkC,EAAlC,EAAsC;AAC5C8B,YAAM,MADsC;AAE5C+tC,YAAM,WAFsC;AAG5CC,iBAAW,IAHiC;AAI5CrkB,iBAAW,MAJiC;AAK5CC,uBAAiB,6BAL2B;AAM5CP,mBAAa;AACZnyB,aAAK,4BADO;AAEZgF,eAAO;AAFK,OAN+B;AAU5CqtB,wBAAkB;AACjBryB,aAAK,4BADY;AAEjBgF,eAAO;AAFU;AAV0B,KAAtC,CAAP;AAeA,GAhCD;AAiCA,SAAO,KAAK8tB,OAAL,CAAa,cAAb,EAA6B,YAAW;AAC9C,SAAK9rB,GAAL,CAAS,yBAAT,EAAoC,KAApC,EAA2C;AAC1C8B,YAAM,SADoC;AAE1C2pB,iBAAW;AAF+B,KAA3C;AAIA,SAAKzrB,GAAL,CAAS,4BAAT,EAAuC,EAAvC,EAA2C;AAC1C8B,YAAM,QADoC;AAE1C2pB,iBAAW,SAF+B;AAG1CN,mBAAa;AACZnyB,aAAK,yBADO;AAEZgF,eAAO;AAFK,OAH6B;AAO1CqtB,wBAAkB;AACjBryB,aAAK,yBADY;AAEjBgF,eAAO;AAFU;AAPwB,KAA3C;AAYA,WAAO,KAAKgC,GAAL,CAAS,oBAAT,EAA+B,EAA/B,EAAmC;AACzC8B,YAAM,MADmC;AAEzC+tC,YAAM,WAFmC;AAGzCC,iBAAW,IAH8B;AAIzCrkB,iBAAW,MAJ8B;AAKzCC,uBAAiB,0BALwB;AAMzCP,mBAAa;AACZnyB,aAAK,yBADO;AAEZgF,eAAO;AAFK,OAN4B;AAUzCqtB,wBAAkB;AACjBryB,aAAK,yBADY;AAEjBgF,eAAO;AAFU;AAVuB,KAAnC,CAAP;AAeA,GAhCM,CAAP;AAiCA,CAjaD;AAmaAnI,WAAWoF,QAAX,CAAoBkxB,QAApB,CAA6B,SAA7B,EAAwC,YAAW;AAClD,OAAKL,OAAL,CAAa,qBAAb,EAAoC,YAAW;AAC9C,SAAK9rB,GAAL,CAAS,iCAAT,EAA4C,KAA5C,EAAmD;AAClD8B,YAAM,SAD4C;AAElD,gBAAU,IAFwC;AAGlD4pB,uBAAiB;AAHiC,KAAnD;AAKA,SAAK1rB,GAAL,CAAS,8BAAT,EAAyC,IAAzC,EAA+C;AAC9C8B,YAAM,SADwC;AAE9C,gBAAU,IAFoC;AAG9C4pB,uBAAiB;AAH6B,KAA/C;AAKA,GAXD;AAYA,OAAK1rB,GAAL,CAAS,sBAAT,EAAiC,IAAjC,EAAuC;AACtC8B,UAAM,SADgC;AAEtC,cAAU;AAF4B,GAAvC;AAIA,OAAK9B,GAAL,CAAS,yCAAT,EAAoD,CAApD,EAAuD;AACtD8B,UAAM,KADgD;AAEtD,cAAU,IAF4C;AAGtD4pB,qBAAiB;AAHqC,GAAvD;AAKA,OAAK1rB,GAAL,CAAS,uBAAT,EAAkC,IAAlC,EAAwC;AACvC8B,UAAM,SADiC;AAEvC,cAAU;AAF6B,GAAxC;AAIA,OAAK9B,GAAL,CAAS,4CAAT,EAAuD,CAAvD,EAA0D;AACzD8B,UAAM,KADmD;AAEzD,cAAU,IAF+C;AAGzD4pB,qBAAiB;AAHwC,GAA1D;AAKA,OAAK1rB,GAAL,CAAS,uCAAT,EAAkD,KAAlD,EAAyD;AACxD8B,UAAM,SADkD;AAExD,cAAU;AAF8C,GAAzD;AAIA,OAAK9B,GAAL,CAAS,uCAAT,EAAkD,IAAlD,EAAwD;AACvD8B,UAAM,SADiD;AAEvD,cAAU;AAF6C,GAAxD;AAIA,OAAK9B,GAAL,CAAS,4BAAT,EAAuC,KAAvC,EAA8C;AAC7C8B,UAAM;AADuC,GAA9C;AAGA,OAAK9B,GAAL,CAAS,0BAAT,EAAqC,IAArC,EAA2C;AAC1C8B,UAAM,SADoC;AAE1C,cAAU;AAFgC,GAA3C;AAIA,OAAK9B,GAAL,CAAS,2BAAT,EAAsC,KAAtC,EAA6C;AAC5C8B,UAAM,SADsC;AAE5C,cAAU;AAFkC,GAA7C;AAIA,OAAK9B,GAAL,CAAS,6BAAT,EAAwC,KAAxC,EAA+C;AAC9C8B,UAAM,SADwC;AAE9C,cAAU;AAFoC,GAA/C;AAIA,OAAK9B,GAAL,CAAS,4BAAT,EAAuC,EAAvC,EAA2C;AAC1C8B,UAAM,QADoC;AAE1C,cAAU;AAFgC,GAA3C;AAIA,OAAK9B,GAAL,CAAS,qBAAT,EAAgC,KAAhC,EAAuC;AACtC8B,UAAM,SADgC;AAEtC,cAAU;AAF4B,GAAvC;AAIA,OAAK9B,GAAL,CAAS,gBAAT,EAA2B,CAA3B,EAA8B;AAC7B8B,UAAM,KADuB;AAE7B,cAAU;AAFmB,GAA9B;AAIA,OAAK9B,GAAL,CAAS,wBAAT,EAAmC,IAAnC,EAAyC;AACxC8B,UAAM,KADkC;AAExC,cAAU;AAF8B,GAAzC;AAIA,OAAK9B,GAAL,CAAS,4BAAT,EAAuC,IAAvC,EAA6C;AAC5C8B,UAAM,SADsC;AAE5C,cAAU;AAFkC,GAA7C;AAIA,OAAK9B,GAAL,CAAS,+BAAT,EAA0C,KAA1C,EAAiD;AAChD8B,UAAM,SAD0C;AAEhD,cAAU,KAFsC;AAGhD4pB,qBAAiB;AAH+B,GAAjD;AAKA,OAAK1rB,GAAL,CAAS,wBAAT,EAAmC,GAAnC,EAAwC;AACvC8B,UAAM,KADiC;AAEvC,cAAU,IAF6B;AAGvC4pB,qBAAiB;AAHsB,GAAxC;AAKA,OAAK1rB,GAAL,CAAS,WAAT,EAAsB,IAAtB,EAA4B;AAC3B8B,UAAM,SADqB;AAE3B,cAAU;AAFiB,GAA5B;AAIA,OAAK9B,GAAL,CAAS,qBAAT,EAAgC,yGAAhC,EAA2I;AAC1I8B,UAAM,QADoI;AAE1I,cAAU;AAFgI,GAA3I;AAIA,OAAK9B,GAAL,CAAS,8BAAT,EAAyC,EAAzC,EAA6C;AAC5C8B,UAAM,KADsC;AAE5C,cAAU;AAFkC,GAA7C;AAIA,OAAK9B,GAAL,CAAS,2BAAT,EAAsC,oBAAtC,EAA4D;AAC3D8B,UAAM,QADqD;AAE3D8tC,gBAAY,OAF+C;AAG3DnkB,eAAW;AAHgD,GAA5D;AAKA,OAAKzrB,GAAL,CAAS,sBAAT,EAAiC,EAAjC,EAAqC;AACpC8B,UAAM,QAD8B;AAEpC,cAAU,IAF0B;AAGpC4pB,qBAAiB;AAHmB,GAArC;AAKA,OAAK1rB,GAAL,CAAS,uBAAT,EAAkC,iEAAlC,EAAqG;AACpG8B,UAAM,QAD8F;AAEpG4pB,qBAAiB;AAFmF,GAArG;AAIA,OAAK1rB,GAAL,CAAS,oBAAT,EAA+B,SAA/B,EAA0C;AACzC8B,UAAM;AADmC,GAA1C;AAGA,OAAK9B,GAAL,CAAS,oBAAT,EAA+B,IAA/B,EAAqC;AACpC8B,UAAM,QAD8B;AAEpC,cAAU,IAF0B;AAGpC4pB,qBAAiB;AAHmB,GAArC;AAKA,OAAK1rB,GAAL,CAAS,oBAAT,EAA+B,IAA/B,EAAqC;AACpC8B,UAAM,QAD8B;AAEpC,cAAU,IAF0B;AAGpC4pB,qBAAiB;AAHmB,GAArC;AAKA,OAAK1rB,GAAL,CAAS,2BAAT,EAAsC,KAAtC,EAA6C;AAC5C8B,UAAM,QADsC;AAE5C,cAAU,IAFkC;AAG5C4pB,qBAAiB;AAH2B,GAA7C;AAKA,OAAK1rB,GAAL,CAAS,yBAAT,EAAoC,CAApC,EAAuC;AACtC8B,UAAM,KADgC;AAEtC,cAAU;AAF4B,GAAvC;AAIA,OAAK9B,GAAL,CAAS,qBAAT,EAAgC,KAAhC,EAAuC;AACtC8B,UAAM,SADgC;AAEtC,cAAU;AAF4B,GAAvC;AAIA,OAAK9B,GAAL,CAAS,qBAAT,EAAgC,KAAhC,EAAuC;AACtC8B,UAAM,SADgC;AAEtC,cAAU;AAF4B,GAAvC;AAIA,OAAK9B,GAAL,CAAS,qBAAT,EAAgC,KAAhC,EAAuC;AACtC8B,UAAM,SADgC;AAEtC,cAAU;AAF4B,GAAvC;AAIA,OAAK9B,GAAL,CAAS,qBAAT,EAAgC,KAAhC,EAAuC;AACtC8B,UAAM,SADgC;AAEtC,cAAU;AAF4B,GAAvC;AAKA,OAAK9B,GAAL,CAAS,8BAAT,EAAyC,KAAzC,EAAgD;AAC/C8B,UAAM,SADyC;AAE/C,cAAU;AAFqC,GAAhD;AAKA,OAAK9B,GAAL,CAAS,sBAAT,EAAiC,KAAjC,EAAwC;AACvC8B,UAAM,SADiC;AAEvC,cAAU,IAF6B;AAGvCmf,WAAO;AAHgC,GAAxC;AAKA,CA/JD;AAiKAprB,WAAWoF,QAAX,CAAoBkxB,QAApB,CAA6B,MAA7B,EAAqC,YAAW;AAC/C,OAAKnsB,GAAL,CAAS,eAAT,EAA0B,EAA1B,EAA8B;AAC7B8B,UAAM;AADuB,GAA9B;AAGA,OAAK9B,GAAL,CAAS,gBAAT,EAA2B,EAA3B,EAA+B;AAC9B8B,UAAM;AADwB,GAA/B;AAGA,OAAK9B,GAAL,CAAS,aAAT,EAAwB,cAAxB,EAAwC;AACvC8B,UAAM;AADiC,GAAxC;AAGA,OAAK9B,GAAL,CAAS,+BAAT,EAA0C,EAA1C,EAA8C;AAC7C8B,UAAM;AADuC,GAA9C;AAGA,OAAK9B,GAAL,CAAS,mBAAT,EAA8B,EAA9B,EAAkC;AACjC8B,UAAM;AAD2B,GAAlC;AAGA,SAAO,KAAK9B,GAAL,CAAS,aAAT,EAAwB,EAAxB,EAA4B;AAClC8B,UAAM,MAD4B;AAElC+tC,UAAM,WAF4B;AAGlCC,eAAW;AAHuB,GAA5B,CAAP;AAKA,CArBD;AAuBAj6C,WAAWoF,QAAX,CAAoBkxB,QAApB,CAA6B,MAA7B,EAAqC,YAAW;AAC/C,OAAKnsB,GAAL,CAAS,aAAT,EAAwB,IAAxB,EAA8B;AAC7B8B,UAAM,SADuB;AAE7B,cAAU;AAFmB,GAA9B;AAIA,OAAK9B,GAAL,CAAS,YAAT,EAAuB,KAAvB,EAA8B;AAC7B8B,UAAM,SADuB;AAE7B,cAAU,IAFmB;AAG7BqpB,iBAAa;AACZnyB,WAAK,aADO;AAEZgF,aAAO;AAFK;AAHgB,GAA9B;AAQA,OAAKgC,GAAL,CAAS,qBAAT,EAAgC,IAAhC,EAAsC;AACrC8B,UAAM,SAD+B;AAErCqpB,iBAAa;AACZnyB,WAAK,aADO;AAEZgF,aAAO;AAFK;AAFwB,GAAtC;AAOA,OAAKgC,GAAL,CAAS,cAAT,EAAyB,6BAAzB,EAAwD;AACvD8B,UAAM,QADiD;AAEvDqpB,iBAAa,CACZ;AACCnyB,WAAK,aADN;AAECgF,aAAO;AAFR,KADY,EAIT;AACFhF,WAAK,qBADH;AAEFgF,aAAO;AAFL,KAJS;AAF0C,GAAxD;AAYA,OAAKgC,GAAL,CAAS,iBAAT,EAA4B,IAA5B,EAAkC;AACjC8B,UAAM,SAD2B;AAEjC,cAAU,IAFuB;AAGjCqpB,iBAAa,CACZ;AACCnyB,WAAK,aADN;AAECgF,aAAO;AAFR,KADY,EAIT;AACFhF,WAAK,qBADH;AAEFgF,aAAO;AAFL,KAJS;AAHoB,GAAlC;AAaA,OAAKgC,GAAL,CAAS,gBAAT,EAA2B,WAA3B,EAAwC;AACvC8B,UAAM,QADiC;AAEvC8tC,gBAAY,6BAF2B;AAGvCzkB,iBAAa;AACZnyB,WAAK,aADO;AAEZgF,aAAO;AAFK;AAH0B,GAAxC;AAQA,OAAK8tB,OAAL,CAAa,uBAAb,EAAsC,YAAW;AAChD,SAAK9rB,GAAL,CAAS,qBAAT,EAAgC,EAAhC,EAAoC;AACnC8B,YAAM;AAD6B,KAApC;AAGA,SAAK9B,GAAL,CAAS,cAAT,EAAyB,EAAzB,EAA6B;AAC5B8B,YAAM,QADsB;AAE5BguC,iBAAW;AAFiB,KAA7B;AAIA,SAAK9vC,GAAL,CAAS,eAAT,EAA0B,EAA1B,EAA8B;AAC7B8B,YAAM,QADuB;AAE7BguC,iBAAW;AAFkB,KAA9B;AAIA,SAAK9vC,GAAL,CAAS,yBAAT,EAAoC,EAApC,EAAwC;AACvC8B,YAAM;AADiC,KAAxC;AAGA,SAAK9B,GAAL,CAAS,kBAAT,EAA6B,EAA7B,EAAiC;AAChC8B,YAAM,QAD0B;AAEhCguC,iBAAW;AAFqB,KAAjC;AAIA,SAAK9vC,GAAL,CAAS,mBAAT,EAA8B,EAA9B,EAAkC;AACjC8B,YAAM,QAD2B;AAEjCguC,iBAAW;AAFsB,KAAlC;AAIA,SAAK9vC,GAAL,CAAS,kBAAT,EAA6B,EAA7B,EAAiC;AAChC8B,YAAM;AAD0B,KAAjC;AAGA,WAAO,KAAK9B,GAAL,CAAS,yBAAT,EAAoC,EAApC,EAAwC;AAC9C8B,YAAM,QADwC;AAE9C,gBAAU;AAFoC,KAAxC,CAAP;AAIA,GA9BD;AA+BA,SAAO,KAAKgqB,OAAL,CAAa,SAAb,EAAwB,YAAW;AACzC,SAAK9rB,GAAL,CAAS,yBAAT,EAAoC,IAApC,EAA0C;AACzC8B,YAAM,SADmC;AAEzC,gBAAU;AAF+B,KAA1C;AAIA,WAAO,KAAK9B,GAAL,CAAS,mBAAT,EAA8B,IAA9B,EAAoC;AAC1C8B,YAAM,SADoC;AAE1C,gBAAU;AAFgC,KAApC,CAAP;AAIA,GATM,CAAP;AAUA,CA9FD;AAgGAjM,WAAWoF,QAAX,CAAoBkxB,QAApB,CAA6B,QAA7B,EAAuC,YAAW;AACjD,OAAKL,OAAL,CAAa,SAAb,EAAwB,YAAW;AAClC,SAAK9rB,GAAL,CAAS,mBAAT,EAA8B,MAA9B,EAAsC;AACrC8B,YAAM,QAD+B;AAErC,gBAAU;AAF2B,KAAtC;AAIA,SAAK9B,GAAL,CAAS,kBAAT,EAA6B,qgCAA7B,EAAoiC;AACniC8B,YAAM,MAD6hC;AAEniC+tC,YAAM,WAF6hC;AAGniCC,iBAAW,IAHwhC;AAIniC,gBAAU;AAJyhC,KAApiC;AAMA,SAAK9vC,GAAL,CAAS,yBAAT,EAAoC,4EAApC,EAAkH;AACjH8B,YAAM,MAD2G;AAEjH+tC,YAAM,WAF2G;AAGjHC,iBAAW,IAHsG;AAIjH,gBAAU;AAJuG,KAAlH;AAMA,SAAK9vC,GAAL,CAAS,oBAAT,EAA+B,wIAA/B,EAAyK;AACxK8B,YAAM,QADkK;AAExKguC,iBAAW,IAF6J;AAGxK,gBAAU;AAH8J,KAAzK;AAKA,SAAK9vC,GAAL,CAAS,uBAAT,EAAkC,0EAAlC,EAA8G;AAC7G8B,YAAM,MADuG;AAE7G+tC,YAAM,WAFuG;AAG7GC,iBAAW,IAHkG;AAI7G,gBAAU;AAJmG,KAA9G;AAMA,WAAO,KAAK9vC,GAAL,CAAS,uBAAT,EAAkC,8CAAlC,EAAkF;AACxF8B,YAAM,MADkF;AAExF+tC,YAAM,WAFkF;AAGxF,gBAAU,IAH8E;AAIxFnkB,uBAAiB;AAJuE,KAAlF,CAAP;AAMA,GAlCD;AAmCA,OAAKI,OAAL,CAAa,gBAAb,EAA+B,YAAW;AACzC,SAAK9rB,GAAL,CAAS,0BAAT,EAAqC,mBAArC,EAA0D;AACzD8B,YAAM,MADmD;AAEzDguC,iBAAW,IAF8C;AAGzD,gBAAU;AAH+C,KAA1D;AAKA,WAAO,KAAK9vC,GAAL,CAAS,yBAAT,EAAoC,mBAApC,EAAyD;AAC/D8B,YAAM,MADyD;AAE/DguC,iBAAW,IAFoD;AAG/D,gBAAU;AAHqD,KAAzD,CAAP;AAKA,GAXD;AAYA,SAAO,KAAKhkB,OAAL,CAAa,gBAAb,EAA+B,YAAW;AAChD,SAAK9rB,GAAL,CAAS,iBAAT,EAA4B,IAA5B,EAAkC;AACjC8B,YAAM,SAD2B;AAEjC,gBAAU;AAFuB,KAAlC;AAIA,SAAK9B,GAAL,CAAS,0BAAT,EAAqC,IAArC,EAA2C;AAC1C8B,YAAM,SADoC;AAE1C,gBAAU;AAFgC,KAA3C;AAIA,SAAK9B,GAAL,CAAS,oBAAT,EAA+B,KAA/B,EAAsC;AACrC8B,YAAM,SAD+B;AAErC,gBAAU;AAF2B,KAAtC;AAIA,SAAK9B,GAAL,CAAS,kBAAT,EAA6B,KAA7B,EAAoC;AACnC8B,YAAM,SAD6B;AAEnC,gBAAU;AAFyB,KAApC;AAIA,SAAK9B,GAAL,CAAS,yBAAT,EAAoC,KAApC,EAA2C;AAC1C8B,YAAM,SADoC;AAE1C,gBAAU;AAFgC,KAA3C;AAIA,SAAK9B,GAAL,CAAS,yBAAT,EAAoC,mCAApC,EAAyE;AACxE8B,YAAM,QADkE;AAExEg9B,cAAQ,CACP;AACC/gC,aAAK,yBADN;AAEC0tB,mBAAW;AAFZ,OADO,EAIJ;AACF1tB,aAAK,mCADH;AAEF0tB,mBAAW;AAFT,OAJI,CAFgE;AAWxE,gBAAU;AAX8D,KAAzE;AAaA,SAAKzrB,GAAL,CAAS,wCAAT,EAAmD,KAAnD,EAA0D;AACzD8B,YAAM,SADmD;AAEzDy7B,cAAQ;AAFiD,KAA1D;AAIA,GAtCM,CAAP;AAuCA,CAvFD;AAyFA1nC,WAAWoF,QAAX,CAAoBkxB,QAApB,CAA6B,MAA7B,EAAqC,YAAW;AAC/C,OAAKnsB,GAAL,CAAS,WAAT,EAAsB,GAAtB,EAA2B;AAC1B8B,UAAM,QADoB;AAE1Bg9B,YAAQ,CACP;AACC/gC,WAAK,GADN;AAEC0tB,iBAAW;AAFZ,KADO,EAIJ;AACF1tB,WAAK,GADH;AAEF0tB,iBAAW;AAFT,KAJI,EAOJ;AACF1tB,WAAK,GADH;AAEF0tB,iBAAW;AAFT,KAPI,CAFkB;AAc1B,cAAU;AAdgB,GAA3B;AAgBA,OAAKzrB,GAAL,CAAS,aAAT,EAAwB,KAAxB,EAA+B;AAC9B8B,UAAM,SADwB;AAE9B,cAAU;AAFoB,GAA/B;AAIA,OAAK9B,GAAL,CAAS,UAAT,EAAqB,KAArB,EAA4B;AAC3B8B,UAAM,SADqB;AAE3B,cAAU;AAFiB,GAA5B;AAIA,SAAO,KAAK9B,GAAL,CAAS,gBAAT,EAA2B,IAA3B,EAAiC;AACvC8B,UAAM;AADiC,GAAjC,CAAP;AAGA,CA5BD;AA8BAjM,WAAWoF,QAAX,CAAoByxB,IAApB,G;;;;;;;;;;;AC7iDA,IAAIrvB,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN6C,OAAOuN,OAAP,CAAe;AACd,wBAAsB03B,SAAtB,EAAiC;AAChC,SAAKsS,OAAL;AACA,UAAMnpB,UAAUhxB,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2B9rB,IAA3B,GAAkCwR,KAAlC,GAA0CzP,MAA1C,CAAiD,UAAS0qB,MAAT,EAAiB;AACjF,aAAOA,OAAO5B,MAAP,KAAkB,IAAlB,IAA0B4B,OAAO,QAAP,MAAqB,IAAtD;AACA,KAFe,CAAhB;;AAGA,QAAI6Q,qBAAqBjgC,IAAzB,EAA+B;AAC9B,aAAO;AACN8lB,gBAAQsD,QAAQ1kB,MAAR,CAAe,UAAS0qB,MAAT,EAAiB;AACvC,iBAAOA,OAAOkI,UAAP,GAAoB2I,SAA3B;AACA,SAFO,CADF;AAINp9B,gBAAQzK,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BiH,qBAA3B,CAAiDuK,SAAjD,EAA4D;AACnEzS,kBAAQ;AACPrM,iBAAK;AADE,WAD2D;AAInE,oBAAU;AAJyD,SAA5D,EAKL;AACF7jB,kBAAQ;AACP/B,iBAAK,CADE;AAEP+vC,wBAAY;AAFL;AADN,SALK,EAULn3B,KAVK;AAJF,OAAP;AAgBA;;AACD,WAAOiV,OAAP;AACA,GAzBa;;AA0Bd,yBAAuB6W,SAAvB,EAAkC;AACjC,QAAI,CAACjlC,OAAOI,MAAP,EAAL,EAAsB;AACrB,aAAO,EAAP;AACA;;AACD,SAAKm3C,OAAL;;AACA,QAAI,CAACn6C,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,yBAAhD,CAAL,EAAiF;AAChF,aAAO,EAAP;AACA;;AACD,UAAMguB,UAAUhxB,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2B9rB,IAA3B,GAAkCwR,KAAlC,GAA0CzP,MAA1C,CAAiD,UAAS0qB,MAAT,EAAiB;AACjF,aAAOA,OAAO5B,MAAP,KAAkB,IAAzB;AACA,KAFe,CAAhB;;AAGA,QAAIyS,qBAAqBjgC,IAAzB,EAA+B;AAC9B,aAAO;AACN8lB,gBAAQsD,QAAQ1kB,MAAR,CAAe,UAAS0qB,MAAT,EAAiB;AACvC,iBAAOA,OAAOkI,UAAP,GAAoB2I,SAA3B;AACA,SAFO,CADF;AAINp9B,gBAAQzK,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BiH,qBAA3B,CAAiDuK,SAAjD,EAA4D;AACnEzS,kBAAQ;AACPrM,iBAAK;AADE;AAD2D,SAA5D,EAIL;AACF7jB,kBAAQ;AACP/B,iBAAK,CADE;AAEP+vC,wBAAY;AAFL;AADN,SAJK,EASLn3B,KATK;AAJF,OAAP;AAeA;;AACD,WAAOiV,OAAP;AACA;;AAvDa,CAAf;AA0DAhxB,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2BgG,KAA3B,CAAiC/lB,EAAjC,CAAoC,SAApC,EAA+C,UAASrK,IAAT,EAAenG,OAAf,EAAwB;AACtE,MAAIA,QAAQ,QAAR,MAAsB,IAA1B,EAAgC;AAC/B9F,eAAWslB,aAAX,CAAyB+V,uBAAzB,CAAiD,yBAAjD,EAA4EpvB,IAA5E,EAAkFzE,EAAE6sB,IAAF,CAAOvuB,OAAP,EAAgB,KAAhB,EAAuB,OAAvB,EAAgC,QAAhC,EAA0C,YAA1C,CAAlF;AACA;;AACD,SAAO9F,WAAWslB,aAAX,CAAyBiW,0BAAzB,CAAoD,0BAApD,EAAgFtvB,IAAhF,EAAsFnG,OAAtF,CAAP;AACA,CALD;AAOA9F,WAAWslB,aAAX,CAAyBiV,SAAzB,CAAmCS,SAAnC,CAA6C,0BAA7C,EAAyE,YAAW;AACnF,MAAI,KAAKh4B,MAAL,IAAe,IAAnB,EAAyB;AACxB,WAAO,KAAP;AACA;;AACD,SAAOhD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+B,KAAKhoB,MAApC,EAA4C,yBAA5C,CAAP;AACA,CALD,E;;;;;;;;;;;ACnEA,IAAIyD,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;AAIN6C,OAAOuN,OAAP,CAAe;AACdiqC,kBAAgBh5C,IAAhB,EAAsB;AAErBuW,UAAMvW,IAAN,EAAYuK,MAAZ;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAIrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,mBAAhD,MAAyE,IAA7E,EAAmF;AAClF,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,sCAA7C,EAAqF;AAAE8O,gBAAQ,iBAAV;AAA6BlM,gBAAQ;AAArC,OAArF,CAAN;AACA;;AAED/C,WAAOA,KAAKq0B,WAAL,GAAmBjpB,OAAnB,CAA2B,aAA3B,EAA0C,EAA1C,CAAP;AACApL,WAAOqF,EAAE4zC,UAAF,CAAaj5C,IAAb,CAAP;AACApB,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,EAAxD,EAAmF,KAAnF,EAAuG;AAAE6K,YAAM,SAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,8BAAlF;AAAkH0kB,kBAAY;AAA9H,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,MAAxD,EAAmF,EAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,KAAlF;AAAyF0kB,kBAAY;AAArG,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,aAAxD,EAAmF,cAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,kCAAlF;AAAsH0kB,kBAAY;AAAlI,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,iBAAxD,EAAmF,SAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,sCAAlF;AAA0H0kB,kBAAY,IAAtI;AAA4IrR,cAAQ,CAAE;AAAE/gC,aAAK,QAAP;AAAiB0tB,mBAAW;AAA5B,OAAF,EAA0C;AAAE1tB,aAAK,SAAP;AAAkB0tB,mBAAW;AAA7B,OAA1C;AAApJ,KAAvG;AACA51B,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,0BAAxD,EAAmF,SAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,+CAAlF;AAAmI0kB,kBAAY,IAA/I;AAAqJrR,cAAQ,CAAE;AAAE/gC,aAAK,SAAP;AAAkB0tB,mBAAW;AAA7B,OAAF,EAA2D;AAAE1tB,aAAK,QAAP;AAAiB0tB,mBAAW;AAA5B,OAA3D,EAAmG;AAAE1tB,aAAK,SAAP;AAAkB0tB,mBAAW;AAA7B,OAAnG;AAA7J,KAAvG;AACA51B,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,gBAAxD,EAAmF,KAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,qCAAlF;AAAyH0kB,kBAAY;AAArI,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,iBAAxD,EAAmF,kBAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,sCAAlF;AAA0H0kB,kBAAY;AAAtI,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,QAAxD,EAAmF,QAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,6BAAlF;AAAiH0kB,kBAAY;AAA7H,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,KAAxD,EAAmF,EAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,0BAAlF;AAA8G0kB,kBAAY;AAA1H,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,SAAxD,EAAmF,EAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,8BAAlF;AAAkH0kB,kBAAY;AAA9H,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,cAAxD,EAAmF,OAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,mCAAlF;AAAuH0kB,kBAAY,IAAnI;AAAyIrR,cAAQ,CAAE;AAAE/gC,aAAK,UAAP;AAAmB0tB,mBAAW;AAA9B,OAAF,EAA8C;AAAE1tB,aAAK,OAAP;AAAgB0tB,mBAAW;AAA3B,OAA9C,EAAoF;AAAE1tB,aAAK,EAAP;AAAW0tB,mBAAW;AAAtB,OAApF;AAAjJ,KAAvG;AACA51B,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,oBAAxD,EAAmF,EAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,yCAAlF;AAA6H0kB,kBAAY;AAAzI,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,qBAAxD,EAAmF,SAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,0CAAlF;AAA8H0kB,kBAAY;AAA1I,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,eAAxD,EAAmF,SAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,oCAAlF;AAAwH0kB,kBAAY;AAApI,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,iBAAxD,EAAmF,EAAnF,EAAuG;AAAE6K,YAAM,QAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,sCAAlF;AAA0H0kB,kBAAY;AAAtI,KAAvG;AACAt6C,eAAWoF,QAAX,CAAoB+E,GAApB,CAAyB,yBAAyB/I,IAAM,cAAxD,EAAmF,KAAnF,EAAuG;AAAE6K,YAAM,SAAR;AAAmBwF,aAAO,OAA1B;AAAmCwkB,eAAU,iBAAiB70B,IAAM,EAApE;AAAuEw0B,iBAAW,mCAAlF;AAAuH0kB,kBAAY;AAAnI,KAAvG;AACA;;AA/Ba,CAAf,E;;;;;;;;;;;ACJA13C,OAAOuN,OAAP,CAAe;AACdoqC,wBAAsB;AACrB,QAAI,CAAC33C,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAIrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,mBAAhD,MAAyE,IAA7E,EAAmF;AAClF,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,uCAA7C,EAAsF;AAAE8O,gBAAQ,qBAAV;AAAiClM,gBAAQ;AAAzC,OAAtF,CAAN;AACA;;AAEDuxC,yBAAqBC,cAArB,CAAoClrC,MAApC,CAA2C,EAA3C;AAEAzK,eAAWC,MAAX,CAAkBo2B,QAAlB,CAA2B3I,MAA3B,CAAkC;AAACvqB,WAAK;AAAN,KAAlC,EAA+D;AAACwqB,YAAM;AAACuR,oBAAY,IAAIt3B,IAAJ;AAAb;AAAP,KAA/D,EAA+F;AAACw5B,aAAO;AAAR,KAA/F;AACA;;AAba,CAAf,E;;;;;;;;;;;ACAAx+B,OAAOuN,OAAP,CAAe;AACdqb,gBAAc3d,IAAd,EAAoB;AACnB,WAAOjL,OAAO8F,IAAP,CAAY,gBAAZ,EAA8B;AACpC5D,WAAK+I,KAAK/I,GAD0B;AAEpCwiB,aAAO,CAAEzZ,KAAKvJ,QAAP;AAF6B,KAA9B,CAAP;AAIA;;AANa,CAAf,E;;;;;;;;;;;ACAA1B,OAAOuN,OAAP,CAAe;AACdqqC,iBAAe3sC,OAAO,EAAtB,EAA0B;AACzB;AACA,QAAI,CAACjL,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5D8O,gBAAQ;AADoD,OAAvD,CAAN;AAGA;;AAED,QAAI,CAACikB,MAAMjsB,IAAN,CAAWwF,KAAK/I,GAAhB,EAAqB6G,MAArB,CAAL,EAAmC;AAClC,YAAM,IAAI/I,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5D8O,gBAAQ;AADoD,OAAvD,CAAN;AAGA,KAZwB,CAczB;;;AACA,UAAM5N,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCrT,KAAK/I,GAAzC,CAAb;AACA,UAAM9B,SAASJ,OAAOI,MAAP,EAAf;AACA,UAAMe,OAAOnB,OAAOmB,IAAP,EAAb;AACA,UAAM02C,aAAa5lC,MAAMk2B,OAAN,CAActoC,KAAKmD,SAAnB,KAAiCnD,KAAKmD,SAAL,CAAe0a,QAAf,CAAwBvc,KAAKO,QAA7B,CAApD,CAlByB,CAoBzB;;AACA,QAAI7B,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnB,YAAM,IAAIN,OAAOrB,KAAX,CAAiB,mCAAjB,EAAsD,oCAAtD,EAA4F;AACjG8O,gBAAQ;AADyF,OAA5F,CAAN;AAGA,KAzBwB,CA2BzB;;;AACA,QAAI/M,aAAa,KAAjB;;AACA,QAAIm3C,cAAcz6C,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BhoB,MAA/B,EAAuC,yBAAvC,EAAkEP,KAAKU,GAAvE,CAAlB,EAA+F;AAC9FG,mBAAa,IAAb;AACA,KAFD,MAEO,IAAIb,KAAKS,CAAL,KAAW,GAAX,IAAkBlD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BhoB,MAA/B,EAAuC,wBAAvC,CAAtB,EAAwF;AAC9FM,mBAAa,IAAb;AACA,KAFM,MAEA,IAAIb,KAAKS,CAAL,KAAW,GAAX,IAAkBlD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BhoB,MAA/B,EAAuC,wBAAvC,CAAtB,EAAwF;AAC9FM,mBAAa,IAAb;AACA,KAnCwB,CAqCzB;;;AACA,QAAI,CAACA,UAAL,EAAiB;AAChB,YAAM,IAAIV,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAC1D8O,gBAAQ;AADkD,OAArD,CAAN;AAGA,KA1CwB,CA4CzB;;;AACA,QAAI,CAACwE,MAAMk2B,OAAN,CAAcl9B,KAAKyZ,KAAnB,CAAL,EAAgC;AAC/B,YAAM,IAAI1kB,OAAOrB,KAAX,CAAiB,yBAAjB,EAA4C,mBAA5C,EAAiE;AACtE8O,gBAAQ;AAD8D,OAAjE,CAAN;AAGA,KAjDwB,CAmDzB;;;AACAxC,SAAKyZ,KAAL,CAAWrf,OAAX,CAAoB3D,QAAD,IAAc;AAChC,YAAMo2C,UAAU16C,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBgN,iBAAxB,CAA0CnoB,QAA1C,CAAhB;;AACA,UAAI,CAACo2C,OAAL,EAAc;AACb,cAAM,IAAI93C,OAAOrB,KAAX,CAAiB,wBAAjB,EAA2C,kBAA3C,EAA+D;AACpE8O,kBAAQ;AAD4D,SAA/D,CAAN;AAGA;;AAEDrQ,iBAAWwrB,aAAX,CAAyB3d,KAAK/I,GAA9B,EAAmC41C,OAAnC,EAA4C32C,IAA5C;AACA,KATD;AAWA,WAAO,IAAP;AACA;;AAjEa,CAAf,E;;;;;;;;;;;ACAAnB,OAAOuN,OAAP,CAAe;AACdwb,cAAY7mB,GAAZ,EAAiB;AAEhB6S,UAAM7S,GAAN,EAAW6G,MAAX;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAM5N,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCpc,GAApC,CAAb;;AAEA,QAAI,CAACrC,IAAL,EAAW;AACV,YAAM,IAAIG,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAACrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,cAAhD,EAAgEP,KAAKU,GAArE,CAAL,EAAgF;AAC/E,YAAM,IAAIP,OAAOrB,KAAX,CAAiB,sBAAjB,EAAyC,gBAAzC,EAA2D;AAAE8O,gBAAQ;AAAV,OAA3D,CAAN;AACA;;AAED,QAAI5N,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnB,YAAM,IAAIN,OAAOrB,KAAX,CAAiB,2BAAjB,EAA8C,qCAA9C,EAAqF;AAAE8O,gBAAQ;AAAV,OAArF,CAAN;AACA;;AAED,WAAOrQ,WAAW2rB,WAAX,CAAuB7mB,GAAvB,CAAP;AACA;;AAxBa,CAAf,E;;;;;;;;;;;ACAAlC,OAAOuN,OAAP,CAAe;AACdwqC,YAAU;AAAC71C,OAAD;AAAMyc;AAAN,GAAV,EAA0B;AAEzB5J,UAAM7S,GAAN,EAAW6G,MAAX;AACAgM,UAAM4J,OAAN,EAAe5V,MAAf;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAM1L,eAAe3E,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyDxc,GAAzD,EAA8DlC,OAAOI,MAAP,EAA9D,CAArB;AACA,UAAM43C,gBAAgB56C,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyDxc,GAAzD,EAA8Dyc,OAA9D,CAAtB;;AAEA,QAAI,CAAC5c,YAAD,IAAiB,CAACi2C,aAAtB,EAAqC;AACpC,YAAM,IAAIh4C,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAEDrQ,eAAWC,MAAX,CAAkByF,aAAlB,CAAgC+jC,kBAAhC,CAAmD3kC,GAAnD,EAAwDyc,OAAxD,EAAiE3e,OAAOI,MAAP,EAAjE;AAEA,WAAO,IAAP;AACA;;AApBa,CAAf,E;;;;;;;;;;;ACAAJ,OAAOuN,OAAP,CAAe;AACd0qC,6BAA2B/hC,IAA3B,EAAiC;AAEhCnB,UAAMmB,IAAN,EAAYnN,MAAZ;AAEA,WAAOmN,SAAS9Y,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,qCAAxB,CAAhB;AACA;;AANa,CAAf,E;;;;;;;;;;;ACAAzC,OAAOuN,OAAP,CAAe;AACd2b,4BAA0BxnB,QAA1B,EAAoC;AACnCqT,UAAMrT,QAAN,EAAgBqH,MAAhB;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAMtM,OAAOnB,OAAOmB,IAAP,EAAb;;AAEA,QAAIA,KAAKO,QAAL,IAAiB,CAACtE,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,8BAAxB,CAAtB,EAA+E;AAC9E,YAAM,IAAIzC,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAED,QAAItM,KAAKO,QAAL,KAAkBA,QAAtB,EAAgC;AAC/B,aAAO,IAAP;AACA;;AACD,WAAOtE,WAAW8rB,yBAAX,CAAqCxnB,QAArC,CAAP;AACA;;AAlBa,CAAf;AAqBAtE,WAAW+W,WAAX,CAAuBkB,WAAvB,CAAmC,2BAAnC,EAAgE,CAAhE,EAAmE,IAAnE,EAAyE;AACxEjV,WAAS;AAAE,WAAO,IAAP;AAAc;;AAD+C,CAAzE,E;;;;;;;;;;;ACrBAJ,OAAOuN,OAAP,CAAe;AACd2qC,sBAAoB;AAACr1C,UAAD;AAASs1C,UAAT;AAAiBC,UAAjB;AAAyBC;AAAzB,GAApB,EAAyD;AACxDtjC,UAAMlS,MAAN,EAAckG,MAAd;AACAgM,UAAMojC,MAAN,EAAcnzC,IAAd;AACA+P,UAAMqjC,MAAN,EAAcpzC,IAAd;AACA+P,UAAMsjC,SAAN,EAAiBC,OAAjB;;AAEA,QAAI,CAACt4C,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAACrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,uBAAhD,CAAL,EAA+E;AAC9E,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAED,QAAI4qC,SAAJ,EAAe;AACdj7C,iBAAWC,MAAX,CAAkBghB,QAAlB,CAA2BxW,MAA3B,CAAkC;AACjC3F,aAAKW,MAD4B;AAEjCkC,YAAI;AACHg4B,gBAAMqb,MADH;AAEH1b,gBAAMyb;AAFH;AAF6B,OAAlC;AAOA,KARD,MAQO;AACN/6C,iBAAWC,MAAX,CAAkBghB,QAAlB,CAA2BxW,MAA3B,CAAkC;AACjC3F,aAAKW,MAD4B;AAEjCkC,YAAI;AACHq3B,eAAKgc,MADF;AAEH5b,eAAK2b;AAFF;AAF6B,OAAlC;AAOA;AACD;;AAhCa,CAAf,E;;;;;;;;;;;ACAAn4C,OAAOuN,OAAP,CAAe;AACdgrC,gBAAc/5C,IAAd,EAAoBkrB,OAApB,EAA6BC,WAAW,KAAxC,EAA+CmD,eAAe,EAA9D,EAAkE;AACjE/X,UAAMvW,IAAN,EAAYuK,MAAZ;AACAgM,UAAM2U,OAAN,EAAegI,MAAM8mB,QAAN,CAAe,CAACzvC,MAAD,CAAf,CAAf;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAACrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,UAAhD,CAAL,EAAkE;AACjE,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAED,WAAOrQ,WAAWosB,UAAX,CAAsB,GAAtB,EAA2BhrB,IAA3B,EAAiCwB,OAAOmB,IAAP,MAAiBnB,OAAOmB,IAAP,GAAcO,QAAhE,EAA0EgoB,OAA1E,EAAmFC,QAAnF,EAA6F;AAACmD;AAAD,KAA7F,CAAP;AACA;;AAda,CAAf,E;;;;;;;;;;;ACAA9sB,OAAOuN,OAAP,CAAe;AACdkrC,cAAYr4C,MAAZ,EAAoB;AACnB,QAAIJ,OAAOI,MAAP,OAAoBA,MAApB,IAA8B,CAAChD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,4BAAhD,CAAnC,EAAkH;AACjH,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,sBAAjB,EAAyC,gBAAzC,EAA2D;AAAE8O,gBAAQ;AAAV,OAA3D,CAAN;AACA;;AACD,UAAM8S,QAAQ9E,SAASi9B,0BAAT,EAAd;;AACAj9B,aAASk9B,iBAAT,CAA2Bv4C,MAA3B,EAAmCmgB,KAAnC;;AACA,WAAO;AACNngB,YADM;AAENw4C,iBAAWr4B,MAAMA;AAFX,KAAP;AAIA;;AAXa,CAAf,E;;;;;;;;;;;;;ACAAvgB,OAAOuN,OAAP,CAAe;AACdsrC,qBAAmBr6C,IAAnB,EAAyBkrB,OAAzB,EAAkCC,WAAW,KAA7C,EAAoDmD,eAAe,EAAnE,EAAuElD,YAAY,EAAnF,EAAuF;AACtF7U,UAAMvW,IAAN,EAAYuK,MAAZ;AACAgM,UAAM2U,OAAN,EAAegI,MAAM8mB,QAAN,CAAe,CAACzvC,MAAD,CAAf,CAAf;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAACrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,UAAhD,CAAL,EAAkE;AACjE,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA,KAVqF,CAYtF;;;AACAsH,UAAM6U,SAAN,EAAiB8H,MAAMmhB,eAAN,CAAsB;AACtCiG,iBAAWpnB,MAAMoiB,KAAN,CAAY;AACtB72C,iBAAS8L,MADa;AAEtBuX,gBAAQ,CAAC;AACRC,iBAAOxX,MADC;AAERgwC,mBAAShwC;AAFD,SAAD;AAFc,OAAZ;AAD2B,KAAtB,CAAjB;AAUA,WAAO3L,WAAWosB,UAAX,CAAsB,GAAtB,EAA2BhrB,IAA3B,EAAiCwB,OAAOmB,IAAP,MAAiBnB,OAAOmB,IAAP,GAAcO,QAAhE,EAA0EgoB,OAA1E,EAAmFC,QAAnF;AAA8FmD;AAA9F,OAA+GlD,SAA/G,EAAP;AACA;;AAzBa,CAAf,E;;;;;;;;;;;ACAA,IAAIjO,MAAJ;AAAW5e,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAACwe,aAAOxe,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;AAEX6C,OAAOuN,OAAP,CAAe;AACdgd,gBAAcnc,OAAd,EAAuB;AACtB2G,UAAM3G,OAAN,EAAesjB,MAAMmhB,eAAN,CAAsB;AACpCtyC,WAAKwI;AAD+B,KAAtB,CAAf;;AAGA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5D8O,gBAAQ;AADoD,OAAvD,CAAN;AAGA;;AACD,UAAMurC,kBAAkB57C,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2BC,WAA3B,CAAuClQ,QAAQ7N,GAA/C,EAAoD;AAC3E+B,cAAQ;AACPmM,WAAG,CADI;AAEPvM,aAAK,CAFE;AAGP2d,cAAM,CAHC;AAIP9a,YAAI;AAJG;AADmE,KAApD,CAAxB;;AAQA,QAAIi0C,mBAAmB,IAAvB,EAA6B;AAC5B,YAAM,IAAIh5C,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,aAA7C,EAA4D;AACjE8O,gBAAQ,eADyD;AAEjElM,gBAAQ;AAFyD,OAA5D,CAAN;AAIA;;AACD,UAAM03C,cAAc77C,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,sBAAhD,EAAwE44C,gBAAgB92C,GAAxF,CAApB;AACA,UAAMkmB,gBAAgBhrB,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,gBAAhD,EAAkE44C,gBAAgB92C,GAAlF,CAAtB;AACA,UAAMg3C,gBAAgB97C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAtB;AACA,UAAM02C,YAAYH,mBAAmBA,gBAAgBvqC,CAAnC,IAAwCuqC,gBAAgBvqC,CAAhB,CAAkBlO,GAAlB,KAA0BP,OAAOI,MAAP,EAApF;;AACA,QAAI,EAAEgoB,iBAAkB8wB,iBAAiBC,SAArC,KAAoD,CAAEF,WAA1D,EAAwE;AACvE,YAAM,IAAIj5C,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,aAA7C,EAA4D;AACjE8O,gBAAQ,eADyD;AAEjElM,gBAAQ;AAFyD,OAA5D,CAAN;AAIA;;AACD,UAAM63C,uBAAuBh8C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,4CAAxB,CAA7B;;AACA,QAAI22C,wBAAwB,IAAxB,IAAgCA,yBAAyB,CAAzD,IAA8D,CAACH,WAAnE,EAAgF;AAC/E,UAAID,gBAAgBj0C,EAAhB,IAAsB,IAA1B,EAAgC;AAC/B;AACA;;AACD,YAAMs0C,QAAQ19B,OAAOq9B,gBAAgBj0C,EAAvB,CAAd;;AACA,UAAIs0C,SAAS,IAAb,EAAmB;AAClB;AACA;;AACD,YAAMC,gBAAgB39B,SAASG,IAAT,CAAcu9B,KAAd,EAAqB,SAArB,CAAtB;;AACA,UAAIC,gBAAgBF,oBAApB,EAA0C;AACzC,cAAM,IAAIp5C,OAAOrB,KAAX,CAAiB,gCAAjB,EAAmD,6BAAnD,EAAkF;AACvF8O,kBAAQ;AAD+E,SAAlF,CAAN;AAGA;AACD;;AACD,WAAOrQ,WAAWmtB,aAAX,CAAyByuB,eAAzB,EAA0Ch5C,OAAOmB,IAAP,EAA1C,CAAP;AACA;;AAnDa,CAAf,E;;;;;;;;;;;ACFA,IAAI0C,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;AAEN6C,OAAOuN,OAAP,CAAe;AACdgsC,uBAAqBluC,QAArB,EAA+B;AAE9B0J,UAAM1J,QAAN,EAAgBtC,MAAhB;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAACrQ,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,gCAAxB,CAAL,EAAgE;AAC/D,YAAM,IAAIzC,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAED,UAAMrN,SAASJ,OAAOI,MAAP,EAAf;AACA,UAAMe,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCle,MAApC,CAAb;;AAEA,QAAI,CAACe,IAAL,EAAW;AACV,YAAM,IAAInB,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAItM,KAAKurB,QAAL,IAAiBvrB,KAAKurB,QAAL,CAAcrhB,QAA/B,IAA2CxH,EAAEM,IAAF,CAAOhD,KAAKurB,QAAL,CAAcrhB,QAAd,CAAuBmuC,MAA9B,CAA/C,EAAsF;AACrF,YAAMrxC,SAASsT,SAASg+B,cAAT,CAAwBt4C,IAAxB,EAA8B;AAAEu4C,gBAAQruC,QAAV;AAAoBsuC,mBAAW;AAA/B,OAA9B,CAAf;;AACA,UAAIxxC,OAAOuC,KAAX,EAAkB;AACjB,cAAM,IAAI1K,OAAOrB,KAAX,CAAiB,wBAAjB,EAA2C,kBAA3C,EAA+D;AAAE8O,kBAAQ;AAAV,SAA/D,CAAN;AACA;AACD,KALD,MAKO,IAAItM,KAAKO,QAAL,KAAkBmC,EAAEM,IAAF,CAAOkH,QAAP,CAAtB,EAAwC;AAC9C,YAAM,IAAIrL,OAAOrB,KAAX,CAAiB,wBAAjB,EAA2C,kBAA3C,EAA+D;AAAE8O,gBAAQ;AAAV,OAA/D,CAAN;AACA;;AAEDzN,WAAOiJ,KAAP,CAAa,YAAW;AACvB7L,iBAAWouB,UAAX,CAAsBprB,MAAtB;AACA,KAFD;AAIA,WAAO,IAAP;AACA;;AAlCa,CAAf,E;;;;;;;;;;;ACFA,IAAIw5C,MAAJ;AAAW78C,OAAOC,KAAP,CAAaC,QAAQ,WAAR,CAAb,EAAkC;AAACC,UAAQC,CAAR,EAAU;AAACy8C,aAAOz8C,CAAP;AAAS;;AAArB,CAAlC,EAAyD,CAAzD;AAEXC,WAAWyH,SAAX,CAAqB0C,GAArB,CAAyB,mBAAzB,EAA8C,UAAS6G,OAAT,EAAkB;AAE/D,MAAIhR,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,6BAAxB,CAAJ,EAA4D;AAC3D,UAAMo3C,eAAez8C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,4BAAxB,CAArB;AACA,QAAI0K,OAAJ,CAF2D,CAI3D;;AACA,QAAI,CAAC,CAAC0sC,YAAF,IAAkBA,aAAan7C,MAAnC,EAA2C;AAC1CyO,gBAAU;AACT7D,cAAMuwC,aAAalxC,KAAb,CAAmB,GAAnB;AADG,OAAV;AAGA;;AACD,UAAMe,SAAS,IAAIkwC,MAAJ,CAAWzsC,OAAX,CAAf;AACAiB,YAAQT,GAAR,GAAcjE,OAAOowC,KAAP,CAAa1rC,QAAQT,GAArB,CAAd;AACA;;AAED,SAAOS,OAAP;AAEA,CAlBD,EAkBG,CAlBH,EAkBM,gBAlBN,E;;;;;;;;;;;ACFA,IAAIxJ,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAENC,WAAWyH,SAAX,CAAqB0C,GAArB,CAAyB,mBAAzB,EAA8C,UAAS6G,OAAT,EAAkB;AAC/D;AACA,MAAIA,QAAQ2O,QAAR,IAAoB,IAApB,IACHnY,EAAEohB,KAAF,CAAQ5X,QAAQ2O,QAAhB,EAA0B,KAA1B,EAAiCV,IAAjC,CAAuC3V,IAAD,IAAUA,SAAS,KAAzD,CADD,EACkE;AAEjE;AACA,QAAI,CAACtJ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+Bha,QAAQK,CAAR,CAAUlO,GAAzC,EAA8C,aAA9C,CAAD,IAAiE,CAACnD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+Bha,QAAQK,CAAR,CAAUlO,GAAzC,EAA8C,aAA9C,EAA6D6N,QAAQlM,GAArE,CAAtE,EAAiJ;AAEhJ;AACA,YAAM4L,WAAW1Q,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoClQ,QAAQK,CAAR,CAAUlO,GAA9C,EAAmDuN,QAApE;;AACA,YAAMvM,SAASgN,QAAQC,EAAR,CAAW,yBAAX,EAAsC,EAAtC,EAA0CV,QAA1C,CAAf,CAJgJ,CAMhJ;AACA;;;AACA1Q,iBAAWslB,aAAX,CAAyBC,UAAzB,CAAoCvU,QAAQK,CAAR,CAAUlO,GAA9C,EAAmD,SAAnD,EAA8D;AAC7DA,aAAKxB,OAAOC,EAAP,EADwD;AAE7DkD,aAAKkM,QAAQlM,GAFgD;AAG7D6C,YAAI,IAAIC,IAAJ,EAHyD;AAI7D2I,aAAKY,QAAQC,EAAR,CAAW,0BAAX,EAAuC;AAAEjN;AAAF,SAAvC,EAAmDuM,QAAnD;AAJwD,OAA9D,EARgJ,CAehJ;;AACA,YAAM,IAAI9N,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,qCAA7C,EAAoF;AACzF8O,gBAAQ,gBADiF;AAEzFlM,gBAAQ;AAFiF,OAApF,CAAN;AAIA;AACD;;AAED,SAAO6M,OAAP;AAEA,CA/BD,EA+BG,CA/BH,EA+BM,gBA/BN,E;;;;;;;;;;;ACFA,IAAIxJ,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAENC,WAAWyH,SAAX,CAAqB0C,GAArB,CAAyB,mBAAzB,EAA8C,UAAS6G,OAAT,EAAkB;AAC/D;AACA,MAAIA,QAAQ2O,QAAR,IAAoB,IAApB,IACHnY,EAAEohB,KAAF,CAAQ5X,QAAQ2O,QAAhB,EAA0B,KAA1B,EAAiCV,IAAjC,CAAuC3V,IAAD,IAAUA,SAAS,MAAzD,CADD,EACmE;AAElE;AACA,QAAI,CAACtJ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+Bha,QAAQK,CAAR,CAAUlO,GAAzC,EAA8C,cAA9C,CAAD,IAAkE,CAACnD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+Bha,QAAQK,CAAR,CAAUlO,GAAzC,EAA8C,cAA9C,EAA8D6N,QAAQlM,GAAtE,CAAvE,EAAmJ;AAElJ;AACA,YAAM4L,WAAW1Q,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoClQ,QAAQK,CAAR,CAAUlO,GAA9C,EAAmDuN,QAApE;;AACA,YAAMvM,SAASgN,QAAQC,EAAR,CAAW,4BAAX,EAAyC,EAAzC,EAA6CV,QAA7C,CAAf,CAJkJ,CAMlJ;AACA;;;AACA1Q,iBAAWslB,aAAX,CAAyBC,UAAzB,CAAoCvU,QAAQK,CAAR,CAAUlO,GAA9C,EAAmD,SAAnD,EAA8D;AAC7DA,aAAKxB,OAAOC,EAAP,EADwD;AAE7DkD,aAAKkM,QAAQlM,GAFgD;AAG7D6C,YAAI,IAAIC,IAAJ,EAHyD;AAI7D2I,aAAKY,QAAQC,EAAR,CAAW,0BAAX,EAAuC;AAAEjN;AAAF,SAAvC,EAAmDuM,QAAnD;AAJwD,OAA9D,EARkJ,CAelJ;;AACA,YAAM,IAAI9N,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,sCAA7C,EAAqF;AAC1F8O,gBAAQ,iBADkF;AAE1FlM,gBAAQ;AAFkF,OAArF,CAAN;AAIA;AACD;;AAED,SAAO6M,OAAP;AAEA,CA/BD,EA+BG,CA/BH,EA+BM,iBA/BN,E;;;;;;;;;;;ACFA,IAAIxJ,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN6C,OAAOuN,OAAP,CAAe;AACdwsC,oBAAkB;AAAC73C,OAAD;AAAMi2C,UAAN;AAAcC,UAAd;AAAsBC,aAAtB;AAAiCtpB,YAAQ,EAAzC;AAA6CirB;AAA7C,GAAlB,EAAyE;AACxEjlC,UAAM7S,GAAN,EAAW6G,MAAX;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAMwsC,aAAaj6C,OAAOI,MAAP,EAAnB;AACA,UAAMP,OAAOG,OAAO8F,IAAP,CAAY,eAAZ,EAA6B5D,GAA7B,EAAkC+3C,UAAlC,CAAb;;AACA,QAAI,CAACp6C,IAAL,EAAW;AACV,aAAO,KAAP;AACA,KAXuE,CAaxE;;;AACA,QAAIA,KAAKS,CAAL,KAAW,GAAX,IAAkB,CAAClD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+B6xB,UAA/B,EAA2C,gBAA3C,CAAnB,IAAmFp6C,KAAKmD,SAAL,CAAe2G,OAAf,CAAuB9J,KAAK6B,QAA5B,MAA0C,CAAC,CAAlI,EAAqI;AACpI,aAAO,KAAP;AACA,KAhBuE,CAkBxE;;;AACA,QAAIkD,EAAEs1C,WAAF,CAAc/B,MAAd,CAAJ,EAA2B;AAC1BA,eAAS,IAAInzC,IAAJ,EAAT;AACA,KArBuE,CAuBxE;;;AACA,QAAI,CAACJ,EAAEs1C,WAAF,CAAc9B,MAAd,CAAD,IAA0B,CAACxzC,EAAEu1C,MAAF,CAAS/B,MAAT,CAA/B,EAAiD;AAChD,YAAM,IAAIp4C,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAMN,UAAU;AACf4f,YAAM;AACLhoB,YAAI,CAAC;AADA,OADS;AAIfqnB,aAAO2C;AAJQ,KAAhB;;AAOA,QAAI,CAAC3xB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,0BAAxB,CAAL,EAA0D;AACzD0K,cAAQ7K,MAAR,GAAiB;AAAE,oBAAY;AAAd,OAAjB;AACA;;AAED,QAAI8rB,UAAU,EAAd;;AACA,QAAIxpB,EAAEs1C,WAAF,CAAc9B,MAAd,KAAyBC,SAA7B,EAAwC;AACvCjqB,gBAAUhxB,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2Boe,2CAA3B,CAAuEv6B,GAAvE,EAA4Ei2C,MAA5E,EAAoFhrC,OAApF,EAA6FgM,KAA7F,EAAV;AACA,KAFD,MAEO,IAAIvU,EAAEs1C,WAAF,CAAc9B,MAAd,KAAyB,CAACC,SAA9B,EAAyC;AAC/CjqB,gBAAUhxB,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2Bke,kCAA3B,CAA8Dr6B,GAA9D,EAAmEi2C,MAAnE,EAA2EhrC,OAA3E,EAAoFgM,KAApF,EAAV;AACA,KAFM,MAEA,IAAI,CAACvU,EAAEs1C,WAAF,CAAc9B,MAAd,CAAD,IAA0BC,SAA9B,EAAyC;AAC/CjqB,gBAAUhxB,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2Bye,6CAA3B,CAAyE56B,GAAzE,EAA8Ek2C,MAA9E,EAAsFD,MAAtF,EAA8FhrC,OAA9F,EAAuGgM,KAAvG,EAAV;AACA,KAFM,MAEA;AACNiV,gBAAUhxB,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2Bse,oCAA3B,CAAgEz6B,GAAhE,EAAqEk2C,MAArE,EAA6ED,MAA7E,EAAqFhrC,OAArF,EAA8FgM,KAA9F,EAAV;AACA;;AAED,UAAMsJ,mBAAmBrlB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,MAAgD,IAAzE;;AAEA,UAAM8rB,WAAW3pB,EAAEuB,GAAF,CAAMioB,OAAN,EAAgBhgB,OAAD,IAAa;AAC5CA,cAAQogB,OAAR,GAAkB5pB,EAAE6pB,SAAF,CAAYrgB,QAAQogB,OAApB,EAA6B;AAAEjuB,aAAK05C;AAAP,OAA7B,CAAlB;;AACA,UAAI7rC,QAAQK,CAAR,IAAaL,QAAQK,CAAR,CAAUlO,GAAvB,IAA8BkiB,gBAAlC,EAAoD;AACnD,cAAMthB,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoClQ,QAAQK,CAAR,CAAUlO,GAA9C,CAAb;AACA6N,gBAAQK,CAAR,CAAUjQ,IAAV,GAAiB2C,QAAQA,KAAK3C,IAA9B;AACA;;AACD,UAAI4P,QAAQ2O,QAAR,IAAoB3O,QAAQ2O,QAAR,CAAiBre,MAArC,IAA+C+jB,gBAAnD,EAAqE;AACpErU,gBAAQ2O,QAAR,CAAiB1X,OAAjB,CAA0B2X,OAAD,IAAa;AACrC,gBAAM7b,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCtB,QAAQzc,GAA5C,CAAb;AACAyc,kBAAQxe,IAAR,GAAe2C,QAAQA,KAAK3C,IAA5B;AACA,SAHD;AAIA;;AACD,aAAO4P,OAAP;AACA,KAbgB,CAAjB;;AAeA,QAAI4rC,OAAJ,EAAa;AACZ,UAAItrB,kBAAkB,CAAtB;AACA,UAAIC,cAAc7d,SAAlB;;AAEA,UAAI,CAAClM,EAAEs1C,WAAF,CAAc9B,MAAd,CAAL,EAA4B;AAC3B,cAAMgC,WAAW7rB,SAASA,SAAS7vB,MAAT,GAAkB,CAA3B,CAAjB;;AACA,YAAI,CAACkG,EAAEs1C,WAAF,CAAcE,QAAd,CAAD,IAA4BA,SAASr1C,EAAT,GAAcqzC,MAA9C,EAAsD;AACrD,gBAAMvpB,iBAAiBzxB,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2Bse,oCAA3B,CAAgEz6B,GAAhE,EAAqEk2C,MAArE,EAA6EgC,SAASr1C,EAAtF,EAA0F;AAAEqnB,mBAAO,CAAT;AAAYW,kBAAM;AAAEhoB,kBAAI;AAAN;AAAlB,WAA1F,CAAvB;AACA4pB,wBAAcE,eAAe1V,KAAf,GAAuB,CAAvB,CAAd;AACAuV,4BAAkBG,eAAeE,KAAf,EAAlB;AACA;AACD;;AAED,aAAO;AACNR,kBAAUA,YAAY,EADhB;AAENI,mBAFM;AAGND;AAHM,OAAP;AAKA;;AAED,WAAO;AACNH,gBAAUA,YAAY;AADhB,KAAP;AAGA;;AA3Fa,CAAf,E;;;;;;;;;;;ACFAvuB,OAAOuN,OAAP,CAAe;AACd4e,kBAAgB;AAAEziB,aAAS,EAAX;AAAe0iB;AAAf,GAAhB,EAAwC;AACvC,UAAMjkB,SAAS/K,WAAW+uB,eAAX,CAA2B;AAAE/rB,cAAQJ,OAAOI,MAAP,EAAV;AAA2BsJ,YAA3B;AAAmC0iB;AAAnC,KAA3B,CAAf;;AAEA,QAAI,CAACjkB,MAAL,EAAa;AACZ,aAAOA,MAAP;AACA;;AAED,WAAOA,OAAOgR,KAAP,EAAP;AACA;;AATa,CAAf,E;;;;;;;;;;;ACAAnZ,OAAOuN,OAAP,CAAe;AACd8sC,kBAAgBn4C,GAAhB,EAAqB;AACpB6S,UAAM7S,GAAN,EAAW6G,MAAX;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAACrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,gBAAhD,CAAL,EAAwE;AACvE,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,sBAAjB,EAAyC,gBAAzC,EAA2D;AAAE8O,gBAAQ;AAAV,OAA3D,CAAN;AACA;;AAED,UAAM,CAAE5N,IAAF,IAAWzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwB82B,QAAxB,CAAiC9+B,GAAjC,EAAsCiX,KAAtC,EAAjB;AAEA,WAAOtZ,QAAQA,KAAK4jC,QAApB;AACA;;AAfa,CAAf,E;;;;;;;;;;;ACAA,IAAI7+B,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN6C,OAAOuN,OAAP,CAAe;AACd+sC,eAAap4C,GAAb,EAAkB;AACjB6S,UAAM7S,GAAN,EAAW6G,MAAX;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAD,IAAoBhD,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,6BAAxB,MAA2D,KAAnF,EAA0F;AACzF,YAAM,IAAIzC,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAEDsH,UAAM7S,GAAN,EAAW6G,MAAX;AAEA,UAAMoE,UAAU;AACf4f,YAAM;AACL,sBAAc;AADT,OADS;AAIfzqB,cAAQ;AACPJ,aAAK,CADE;AAEPuM,WAAG,CAFI;AAGPoe,eAAO;AAHA;AAJO,KAAhB;AAWA,UAAMpK,mBAAmBrlB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,kBAAxB,MAAgD,IAAzE;AAEA,UAAMoqB,QAAQzvB,WAAWC,MAAX,CAAkBk9C,KAAlB,CAAwB5yC,IAAxB,CAA6B;AAAE4X,aAAO,eAAT;AAA0BnS,mBAAa;AAAEmmB,iBAAS,CAAX;AAAcpN,aAAK;AAAnB;AAAvC,KAA7B,EAA+FhN,KAA/F,EAAd;AACA,UAAM4J,gBAAgB3lB,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC6iC,oBAAhC,CAAqDzjC,GAArD,EAA0D0C,EAAEohB,KAAF,CAAQ6G,KAAR,EAAe,KAAf,CAA1D,EAAiF1f,OAAjF,EAA0FgM,KAA1F,EAAtB;;AAEA,QAAI,CAACsJ,gBAAL,EAAuB;AACtB,aAAOM,aAAP;AACA,KAFD,MAEO;AACN,aAAOA,cAAc5c,GAAd,CAAkBpE,gBAAgB;AACxC,cAAMZ,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCvc,aAAa0M,CAAb,CAAelO,GAAnD,CAAb;AACAwB,qBAAa0M,CAAb,CAAejQ,IAAf,GAAsB2C,QAAQA,KAAK3C,IAAnC;AACA,eAAOuD,YAAP;AACA,OAJM,CAAP;AAKA;AACD;;AAnCa,CAAf,E;;;;;;;;;;;ACFA/B,OAAOuN,OAAP,CAAe;AACditC,kBAAgB;AACf,WAAOp9C,WAAWkW,IAAlB;AACA;;AAHa,CAAf,E;;;;;;;;;;;ACAAtT,OAAOuN,OAAP,CAAe;AACdktC,mBAAiBC,KAAjB,EAAwB;AACvB3lC,UAAM2lC,KAAN,EAAa3xC,MAAb;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAME,MAAMvQ,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2BC,WAA3B,CAAuCo8B,KAAvC,CAAZ;;AAEA,QAAI,CAAC/sC,GAAD,IAAQ,CAACA,IAAIzL,GAAjB,EAAsB;AACrB,aAAO4O,SAAP;AACA;;AAED9Q,WAAO8F,IAAP,CAAY,eAAZ,EAA6B6H,IAAIzL,GAAjC,EAAsClC,OAAOI,MAAP,EAAtC;AAEA,WAAOuN,GAAP;AACA;;AAjBa,CAAf,E;;;;;;;;;;;ACAA,IAAI/I,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN6C,OAAOuN,OAAP,CAAe;AACdotC,iBAAe;AAEd,QAAI,CAAC36C,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAMN,UAAU;AACf4f,YAAM;AACL,oBAAY;AADP,OADS;AAIfzqB,cAAQ;AACPZ,kBAAU,CADH;AAEPmrB,eAAO;AAFA;AAJO,KAAhB;AAUA,UAAMA,QAAQzvB,WAAWC,MAAX,CAAkBk9C,KAAlB,CAAwB5yC,IAAxB,CAA6B;AAAE4X,aAAO,OAAT;AAAkBnS,mBAAa;AAAEmmB,iBAAS,CAAX;AAAcpN,aAAK;AAAnB;AAA/B,KAA7B,EAAuFhN,KAAvF,EAAd;;AACA,UAAMyhC,UAAUh2C,EAAEohB,KAAF,CAAQ6G,KAAR,EAAe,KAAf,CAAhB,CAjBc,CAmBd;AACA;;;AACA,UAAMnI,QAAQtnB,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwBg+B,gBAAxB,CAAyCD,OAAzC,EAAkD,IAAlD,EAAwDztC,OAAxD,EAAiEgM,KAAjE,EAAd;;AACA,SAAK,MAAMhY,IAAX,IAAmBujB,KAAnB,EAA0B;AACzBvjB,WAAK0rB,KAAL,GAAajoB,EAAEk2C,YAAF,CAAe35C,KAAK0rB,KAApB,EAA2B+tB,OAA3B,CAAb;AACA;;AACD,WAAOl2B,KAAP;AACA;;AA3Ba,CAAf,E;;;;;;;;;;;ACFA1kB,OAAOuN,OAAP,CAAe;AACdwtC,qBAAmBxrB,QAAnB,EAA6B;AAE5Bxa,UAAMwa,QAAN,EAAgBpqB,MAAhB;;AAEA,QAAI,CAACnF,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,WAAOrQ,WAAWkyB,QAAX,CAAoBtvB,OAAOI,MAAP,EAApB,EAAqCmvB,QAArC,CAAP;AACA;;AAVa,CAAf,E;;;;;;;;;;;ACAAvvB,OAAOuN,OAAP,CAAe;AACduiB,sBAAoB9H,QAApB,EAA8B;AAC7BjT,UAAMiT,QAAN,EAAgB0J,MAAM8mB,QAAN,CAAeF,OAAf,CAAhB;;AAEA,QAAI,CAACt4C,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,SAAK8pC,OAAL;AACA,WAAOn6C,WAAW2qB,wBAAX,CAAoC/nB,OAAOmB,IAAP,EAApC,EAAmD6mB,QAAnD,CAAP;AACA;;AAVa,CAAf,E;;;;;;;;;;;ACAAhoB,OAAOuN,OAAP,CAAe;AACdytC,WAAS94C,GAAT,EAAck1C,IAAd,EAAoB;AACnBriC,UAAM7S,GAAN,EAAW6G,MAAX;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAM5N,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCpc,GAApC,CAAb;;AAEA,QAAI,CAACrC,IAAL,EAAW;AACV,YAAM,IAAIG,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA,KAXkB,CAanB;;;AACA,UAAMtM,OAAOnB,OAAOmB,IAAP,EAAb;;AACA,QAAItB,KAAKi5C,SAAL,IAAkB33C,IAAlB,IAA0BA,KAAKurB,QAA/B,IAA2CvrB,KAAKurB,QAAL,CAAcosB,SAA7D,EAAwE;AACvE,YAAMmC,WAAW79C,WAAW89C,2BAAX,CAAuC/5C,IAAvC,CAAjB;;AAEA,UAAI,CAAC/D,WAAW+9C,SAAX,CAAqBC,cAArB,CAAoCv7C,KAAKi5C,SAAzC,EAAoDmC,QAApD,CAAL,EAAoE;AACnE,cAAM,IAAIj7C,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,gBAAtC,EAAwD;AAAE8O,kBAAQ;AAAV,SAAxD,CAAN;AACA;AACD,KAND,MAMO;AACN,UAAK5N,KAAKS,CAAL,KAAW,GAAZ,IAAqBlD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,aAAhD,MAAmE,IAA5F,EAAmG;AAClG,cAAM,IAAIJ,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,kBAAQ;AAAV,SAArD,CAAN;AACA;;AAED,UAAK5N,KAAK6jC,gBAAL,KAA0B,IAA3B,IAAqC0T,SAASv3C,KAAK4jC,QAAnD,IAAgE,CAACrmC,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,wBAAhD,CAArE,EAAgJ;AAC/I,cAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,uBAAvC,EAAgE;AAAE8O,kBAAQ;AAAV,SAAhE,CAAN;AACA;AACD;;AAED,WAAOrQ,WAAWwrB,aAAX,CAAyB1mB,GAAzB,EAA8Bf,IAA9B,CAAP;AACA;;AAjCa,CAAf,E;;;;;;;;;;;ACAAnB,OAAOuN,OAAP,CAAe;AACd8tC,YAAUn5C,GAAV,EAAe;AAEd6S,UAAM7S,GAAN,EAAW6G,MAAX;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,SAAK8pC,OAAL;AAEA,UAAM13C,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCpc,GAApC,CAAb;AACA,UAAMf,OAAOnB,OAAOmB,IAAP,EAAb;;AAEA,QAAItB,KAAKS,CAAL,KAAW,GAAf,EAAoB;AACnB,YAAM,IAAIN,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAED,QAAI,CAACwE,MAAM4E,IAAN,CAAWhX,KAAKmD,SAAL,IAAkB,EAA7B,EAAiC0a,QAAjC,CAA0Cvc,KAAKO,QAA/C,CAAL,EAA+D;AAC9D,YAAM,IAAI1B,OAAOrB,KAAX,CAAiB,wBAAjB,EAA2C,0BAA3C,EAAuE;AAAE8O,gBAAQ;AAAV,OAAvE,CAAN;AACA,KAnBa,CAqBd;;;AACA,QAAIrQ,WAAW8C,KAAX,CAAiBo7C,OAAjB,CAAyBn6C,KAAKZ,GAA9B,EAAmC,OAAnC,EAA4CV,KAAKU,GAAjD,CAAJ,EAA2D;AAC1D,YAAMg7C,YAAYn+C,WAAW8C,KAAX,CAAiBs7C,cAAjB,CAAgC,OAAhC,EAAyC37C,KAAKU,GAA9C,EAAmD4Y,KAAnD,GAA2Dza,MAA7E;;AACA,UAAI68C,cAAc,CAAlB,EAAqB;AACpB,cAAM,IAAIv7C,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,uEAA7C,EAAsH;AAAE8O,kBAAQ;AAAV,SAAtH,CAAN;AACA;AACD;;AAED,WAAOrQ,WAAW4xB,kBAAX,CAA8B9sB,GAA9B,EAAmClC,OAAOmB,IAAP,EAAnC,CAAP;AACA;;AA/Ba,CAAf,E;;;;;;;;;;;ACAA,IAAI0C,CAAJ;AAAM9G,OAAOC,KAAP,CAAaC,QAAQ,mBAAR,CAAb,EAA0C;AAACC,UAAQC,CAAR,EAAU;AAAC0G,QAAE1G,CAAF;AAAI;;AAAhB,CAA1C,EAA4D,CAA5D;AAEN6C,OAAOuN,OAAP,CAAe;AACdkuC,qBAAmBj9C,IAAnB,EAAyB;AAExBuW,UAAMvW,IAAN,EAAYuK,MAAZ;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAIrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,mBAAhD,MAAyE,IAA7E,EAAmF;AAClF,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAEDjP,WAAOA,KAAKq0B,WAAL,GAAmBjpB,OAAnB,CAA2B,aAA3B,EAA0C,EAA1C,CAAP;AACApL,WAAOqF,EAAE4zC,UAAF,CAAaj5C,IAAb,CAAP;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,EAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,MAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,aAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,gBAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,iBAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,QAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,iBAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,0BAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,KAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,SAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,oBAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,qBAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,eAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,cAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,iBAA/D;AACApB,eAAWoF,QAAX,CAAoByoB,UAApB,CAAgC,yBAAyBzsB,IAAM,cAA/D;AACA;;AA/Ba,CAAf,E;;;;;;;;;;;ACFAwB,OAAOuN,OAAP,CAAe;AACdmuC,mBAAiB;AAChB,QAAI,CAAC17C,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAIrQ,WAAW8C,KAAX,CAAiBo7C,OAAjB,CAAyBt7C,OAAOI,MAAP,EAAzB,EAA0C,OAA1C,MAAuD,IAA3D,EAAiE;AAChE,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAEDzN,WAAO6V,UAAP,CAAkB,MAAM;AACvB7V,aAAO6V,UAAP,CAAkB,MAAM;AACvBhN,gBAAQwvB,IAAR,CAAa,6CAAb;AACA/mB,gBAAQqqC,KAAR;AACA,OAHD,EAGG,IAHH;AAIArqC,cAAQsqC,IAAR,CAAa,CAAb;AACA,KAND,EAMG,IANH;AAQA,WAAO;AACNxtC,eAAS,sCADH;AAEN5M,cAAQ,CAAC,CAAD;AAFF,KAAP;AAIA;;AAtBa,CAAf,E;;;;;;;;;;;ACAA,IAAIoD,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN6C,OAAOuN,OAAP,CAAe;AACd,oBAAkBopB,KAAlB,EAAyBlpB,MAAzB,EAAiCuE,IAAjC,EAAuC;AACtC+C,UAAM4hB,KAAN,EAAa5tB,MAAb;AACAgM,UAAMtH,MAAN,EAAc1E,MAAd;;AACA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5D8O,gBAAQ;AADoD,OAAvD,CAAN;AAGA;;AACD,QAAI,CAACrQ,WAAW8C,KAAX,CAAiBo7C,OAAjB,CAAyBt7C,OAAOI,MAAP,EAAzB,EAA0C,OAA1C,CAAL,EAAyD;AACxD,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAC1D8O,gBAAQ;AADkD,OAArD,CAAN;AAGA;;AACD,UAAMouC,IAAIz+C,WAAWC,MAAX,CAAkBs5B,KAAlB,CAAV;;AAEA,QAAI,CAACklB,CAAD,IAAM,CAACj3C,EAAE+uB,UAAF,CAAakoB,EAAEpuC,MAAF,CAAb,CAAX,EAAoC;AACnC,YAAM,IAAIzN,OAAOrB,KAAX,CAAiB,sBAAjB,EAAyC,gBAAzC,EAA2D;AAChE8O,gBAAQ;AADwD,OAA3D,CAAN;AAGA;;AACD,UAAMuhC,SAAS5xC,WAAWC,MAAX,CAAkBs5B,KAAlB,EAAyBlpB,MAAzB,EAAiC4E,KAAjC,CAAuCjV,WAAWC,MAAX,CAAkBs5B,KAAlB,CAAvC,EAAiE3kB,IAAjE,CAAf;AACA,WAAOg9B,UAAUA,OAAO71B,KAAjB,GAAyB61B,OAAO71B,KAAP,EAAzB,GAA0C61B,MAAjD;AACA;;AAvBa,CAAf,E;;;;;;;;;;;ACFA;AAEAhvC,OAAOuN,OAAP,CAAe;AACduuC,cAAYv7C,GAAZ,EAAiBgF,KAAjB,EAAwBU,MAAxB,EAAgC;AAC/B,QAAIjG,OAAOI,MAAP,OAAoB,IAAxB,EAA8B;AAC7B,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,iCAA7C,EAAgF;AACrF8O,gBAAQ;AAD6E,OAAhF,CAAN;AAGA;;AAED,QAAI,CAACrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,yBAAhD,CAAL,EAAiF;AAChF,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,iCAA7C,EAAgF;AACrF8O,gBAAQ;AAD6E,OAAhF,CAAN;AAGA,KAX8B,CAa/B;;;AACAsH,UAAMxU,GAAN,EAAWwI,MAAX;AAEA,UAAM7F,UAAU9F,WAAWC,MAAX,CAAkBo2B,QAAlB,CAA2B/H,EAA3B,CAA8BpN,WAA9B,CAA0C/d,GAA1C,CAAhB,CAhB+B,CAkB/B;;AACA,YAAQ2C,QAAQmG,IAAhB;AACC,WAAK,UAAL;AACC0L,cAAMxP,KAAN,EAAamsB,MAAMqqB,KAAN,CAAY,CAAC52C,MAAD,CAAZ,EAAsB,EAAtB,CAAb;AACA;;AACD,WAAK,SAAL;AACC4P,cAAMxP,KAAN,EAAa+yC,OAAb;AACA;;AACD,WAAK,KAAL;AACCvjC,cAAMxP,KAAN,EAAa4rC,MAAb;AACA;;AACD;AACCp8B,cAAMxP,KAAN,EAAawD,MAAb;AACA;AAZF;;AAeA3L,eAAWoF,QAAX,CAAoBoxB,UAApB,CAA+BrzB,GAA/B,EAAoCgF,KAApC,EAA2CU,MAA3C;AACA,WAAO,IAAP;AACA;;AArCa,CAAf,E;;;;;;;;;;;ACFA,IAAIrB,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN6C,OAAOuN,OAAP,CAAe;AACdyuC,sBAAoBp6B,MAApB,EAA4B;AAC3B7M,UAAM6M,MAAN,EAAc,CAAC7Y,MAAD,CAAd;;AACA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5D8O,gBAAQ;AADoD,OAAvD,CAAN;AAGA;;AACD,QAAI,CAACrQ,WAAW8C,KAAX,CAAiBo7C,OAAjB,CAAyBt7C,OAAOI,MAAP,EAAzB,EAA0C,OAA1C,CAAL,EAAyD;AACxD,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAC1D8O,gBAAQ;AADkD,OAArD,CAAN;AAGA;;AACD,UAAMwuC,iBAAiB,uIAAvB;;AACA,UAAMC,cAAct3C,EAAE0Y,OAAF,CAAU1Y,EAAEuB,GAAF,CAAMyb,MAAN,EAAc,UAASxW,KAAT,EAAgB;AAC3D,UAAI6wC,eAAex2C,IAAf,CAAoB2F,KAApB,CAAJ,EAAgC;AAC/B,eAAOA,KAAP;AACA;AACD,KAJ6B,CAAV,CAApB;;AAKA,UAAMjM,SAAS/B,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,cAAxB,KAA2C,EAA3E,CAAf;AACA,UAAM+d,SAASpjB,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,cAAxB,KAA2C,EAA3E,CAAf;AACA,QAAIiM,IAAJ;AACA,QAAIqT,OAAJ;AACA,UAAM5gB,OAAOnB,OAAOmB,IAAP,EAAb;AACA,UAAMue,MAAMve,KAAK2M,QAAL,IAAiB1Q,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,CAAjB,IAAwD,IAApE;;AACA,QAAIrF,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAJ,EAAsD;AACrDsf,gBAAU3kB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,oBAAxB,CAAV;AACAiM,aAAOtR,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,iBAAxB,CAAP;AACA,KAHD,MAGO;AACNsf,gBAAUxT,QAAQC,EAAR,CAAW,4BAAX,EAAyC;AAClDkR;AADkD,OAAzC,CAAV;AAGAhR,aAAOH,QAAQC,EAAR,CAAW,yBAAX,EAAsC;AAC5CkR;AAD4C,OAAtC,CAAP;AAGA;;AACDqC,cAAU3kB,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCmY,OAAhC,CAAV;AACAm6B,gBAAY72C,OAAZ,CAAoB+F,SAAS;AAC5B,WAAKmsC,OAAL;AACA7oC,aAAOtR,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgC8E,IAAhC,EAAsC;AAC5CtD;AAD4C,OAAtC,CAAP;;AAGA,UAAI;AACH4W,cAAM3L,IAAN,CAAW;AACV4D,cAAI7O,KADM;AAEVyL,gBAAMzZ,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,YAAxB,CAFI;AAGVsf,iBAHU;AAIVrT,gBAAMvP,SAASuP,IAAT,GAAgB8R;AAJZ,SAAX;AAMA,OAPD,CAOE,OAAO;AAACpS;AAAD,OAAP,EAAkB;AACnB,cAAM,IAAIpO,OAAOrB,KAAX,CAAiB,yBAAjB,EAA6C,+BAA+ByP,OAAS,EAArF,EAAwF;AAC7FX,kBAAQ,qBADqF;AAE7FW;AAF6F,SAAxF,CAAN;AAIA;AACD,KAlBD;AAmBA,WAAO8tC,WAAP;AACA;;AAzDa,CAAf,E;;;;;;;;;;;ACFA,IAAIvgC,MAAJ;AAAW5e,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAACwe,aAAOxe,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;AAEX6C,OAAOuN,OAAP,CAAe;AACdwQ,cAAY3P,OAAZ,EAAqB;AACpB2G,UAAM3G,OAAN,EAAejJ,MAAf;;AAEA,QAAI,CAACnF,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5D8O,gBAAQ;AADoD,OAAvD,CAAN;AAGA;;AAED,QAAIW,QAAQrJ,EAAZ,EAAgB;AACf,YAAMmZ,SAASjJ,KAAK4G,GAAL,CAASF,OAAOvN,QAAQrJ,EAAf,EAAmB+W,IAAnB,EAAT,CAAf;;AACA,UAAIoC,SAAS,KAAb,EAAoB;AACnB,cAAM,IAAIle,OAAOrB,KAAX,CAAiB,8BAAjB,EAAiD,kCAAjD,EAAqF;AAC1F8O,kBAAQ,aADkF;AAE1F0uC,sBAAY/tC,QAAQrJ,EAFsE;AAG1Fq3C,qBAAW,IAAIp3C,IAAJ,GAAWq3C,OAAX;AAH+E,SAArF,CAAN;AAKA,OAND,MAMO,IAAIn+B,SAAS,KAAb,EAAoB;AAC1B9P,gBAAQrJ,EAAR,GAAa,IAAIC,IAAJ,EAAb;AACA;AACD,KAXD,MAWO;AACNoJ,cAAQrJ,EAAR,GAAa,IAAIC,IAAJ,EAAb;AACA;;AAED,QAAIoJ,QAAQT,GAAR,IAAeS,QAAQT,GAAR,CAAYjP,MAAZ,GAAqBtB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,wBAAxB,CAAxC,EAA2F;AAC1F,YAAM,IAAIzC,OAAOrB,KAAX,CAAiB,6BAAjB,EAAgD,6CAAhD,EAA+F;AACpG8O,gBAAQ;AAD4F,OAA/F,CAAN;AAGA;;AAED,UAAMtM,OAAO/D,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCte,OAAOI,MAAP,EAApC,EAAqD;AACjEkC,cAAQ;AACPZ,kBAAU,CADH;AAEPlD,cAAM;AAFC;AADyD,KAArD,CAAb;AAOA,UAAMqB,OAAOG,OAAO8F,IAAP,CAAY,eAAZ,EAA6BsI,QAAQlM,GAArC,EAA0Cf,KAAKZ,GAA/C,CAAb;;AACA,QAAI,CAACV,IAAL,EAAW;AACV,aAAO,KAAP;AACA;;AAED,UAAMkC,eAAe3E,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyDtQ,QAAQlM,GAAjE,EAAsElC,OAAOI,MAAP,EAAtE,CAArB;;AACA,QAAI2B,gBAAgBA,aAAa4c,OAA7B,IAAwC5c,aAAa6c,OAAzD,EAAkE;AACjExhB,iBAAWslB,aAAX,CAAyBC,UAAzB,CAAoC3iB,OAAOI,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAC/DG,aAAKxB,OAAOC,EAAP,EAD0D;AAE/DkD,aAAKrC,KAAKU,GAFqD;AAG/DwE,YAAI,IAAIC,IAAJ,EAH2D;AAI/D2I,aAAKY,QAAQC,EAAR,CAAW,iBAAX,EAA8B,EAA9B,EAAkCrN,KAAK2M,QAAvC;AAJ0D,OAAhE;AAMA,aAAO,KAAP;AACA;;AAED,QAAI,CAACjO,KAAKgf,KAAL,IAAY,EAAb,EAAiBnB,QAAjB,CAA0Bvc,KAAKO,QAA/B,CAAJ,EAA8C;AAC7CtE,iBAAWslB,aAAX,CAAyBC,UAAzB,CAAoC3iB,OAAOI,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAC/DG,aAAKxB,OAAOC,EAAP,EAD0D;AAE/DkD,aAAKrC,KAAKU,GAFqD;AAG/DwE,YAAI,IAAIC,IAAJ,EAH2D;AAI/D2I,aAAKY,QAAQC,EAAR,CAAW,qBAAX,EAAkC,EAAlC,EAAsCrN,KAAK2M,QAA3C;AAJ0D,OAAhE;AAMA,aAAO,KAAP;AACA;;AAED,QAAIM,QAAQ0Q,KAAR,IAAiB,IAAjB,IAAyB1hB,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,+BAAxB,CAA7B,EAAuF;AACtF2L,cAAQ0Q,KAAR,GAAgB3d,KAAK3C,IAArB;AACA;;AAED,QAAIwB,OAAOwC,QAAP,CAAgB,QAAhB,EAA0B85C,SAA9B,EAAyC;AACxCluC,cAAQ0jB,kBAAR,GAA6B,KAAKyqB,UAAL,CAAgBzqB,kBAAhB,EAA7B;AACA;;AAED10B,eAAW4W,OAAX,CAAmBC,YAAnB,CAAgC8K,GAAhC,GAvEoB,CAuEmB;;AACvC,WAAO3hB,WAAW2gB,WAAX,CAAuB5c,IAAvB,EAA6BiN,OAA7B,EAAsCvO,IAAtC,CAAP;AACA;;AA1Ea,CAAf,E,CA4EA;;AACAzC,WAAW+W,WAAX,CAAuBkB,WAAvB,CAAmC,aAAnC,EAAkD,CAAlD,EAAqD,IAArD,EAA2D;AAC1DjV,SAAOA,MAAP,EAAe;AACd,WAAO,CAAChD,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BhoB,MAA/B,EAAuC,oBAAvC,CAAR;AACA;;AAHyD,CAA3D,E;;;;;;;;;;;AC/EAJ,OAAOuN,OAAP,CAAe;AACdivC,sBAAoB;AACnB,QAAI,CAACx8C,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5D8O,gBAAQ;AADoD,OAAvD,CAAN;AAGA;;AACD,UAAMtM,OAAOnB,OAAOmB,IAAP,EAAb;;AACA,QAAI,CAACA,KAAKygB,MAAN,IAAgB,CAACzgB,KAAKygB,MAAL,CAAY,CAAZ,CAAjB,IAAmCzgB,KAAKygB,MAAL,CAAY,CAAZ,EAAeE,OAAtD,EAA+D;AAC9D,YAAM,IAAI9hB,OAAOrB,KAAX,CAAiB,qBAAjB,EAAwC,eAAxC,EAAyD;AAC9D8O,gBAAQ;AADsD,OAAzD,CAAN;AAGA;;AACD,SAAK8pC,OAAL;AACA,UAAMp4C,SAAS/B,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,cAAxB,KAA2C,EAA3E,CAAf;AACA,UAAM+d,SAASpjB,WAAW2N,YAAX,CAAwBnB,OAAxB,CAAgCxM,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,cAAxB,KAA2C,EAA3E,CAAf;AACAoG,YAAQC,GAAR,CAAa,yBAAyB3H,KAAKygB,MAAL,CAAY,CAAZ,EAAeE,OAAS,EAA9D;;AACA,QAAI;AACHE,YAAM3L,IAAN,CAAW;AACV4D,YAAI9Y,KAAKygB,MAAL,CAAY,CAAZ,EAAeE,OADT;AAEVjL,cAAMzZ,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,YAAxB,CAFI;AAGVsf,iBAAS,iBAHC;AAIVrT,cAAO,GAAGvP,MAAQ,6CAA6CqhB,MAAQ;AAJ7D,OAAX;AAMA,KAPD,CAOE,OAAO;AAACpS;AAAD,KAAP,EAAkB;AACnB,YAAM,IAAIpO,OAAOrB,KAAX,CAAiB,yBAAjB,EAA6C,+BAA+ByP,OAAS,EAArF,EAAwF;AAC7FX,gBAAQ,mBADqF;AAE7FW;AAF6F,OAAxF,CAAN;AAIA;;AACD,WAAO;AACNA,eAAS,yBADH;AAEN5M,cAAQ,CAACL,KAAKygB,MAAL,CAAY,CAAZ,EAAeE,OAAhB;AAFF,KAAP;AAIA;;AAlCa,CAAf;AAqCAvM,eAAeZ,OAAf,CAAuB;AACtBtL,QAAM,QADgB;AAEtB7K,QAAM,mBAFgB;;AAGtB4B,WAAS;AACR,WAAO,IAAP;AACA;;AALqB,CAAvB,EAMG,CANH,EAMM,IANN,E;;;;;;;;;;;ACrCAJ,OAAOuN,OAAP,CAAe;AACdkvC,iBAAer8C,MAAf,EAAuBwnC,KAAvB,EAA8B;AAE7B7yB,UAAM3U,MAAN,EAAc2I,MAAd;AACAgM,UAAM6yB,KAAN,EAAalW,MAAM8mB,QAAN,CAAeF,OAAf,CAAb;;AAEA,QAAI,CAACt4C,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAIrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,mBAAhD,MAAyE,IAA7E,EAAmF;AAClF,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAED,UAAMtM,OAAOnB,OAAO0kB,KAAP,CAAaziB,OAAb,CAAqB;AAAE1B,WAAKH;AAAP,KAArB,EAAsC;AAAEkC,cAAQ;AAAEZ,kBAAU;AAAZ;AAAV,KAAtC,CAAb;;AAEA,QAAIkmC,KAAJ,EAAW;AACV,aAAO5nC,OAAO8F,IAAP,CAAY,6BAAZ,EAA2C,OAA3C,EAAoD3E,KAAKO,QAAzD,CAAP;AACA,KAFD,MAEO;AACN,aAAO1B,OAAO8F,IAAP,CAAY,kCAAZ,EAAgD,OAAhD,EAAyD3E,KAAKO,QAA9D,CAAP;AACA;AACD;;AArBa,CAAf,E;;;;;;;;;;;ACAA1B,OAAOuN,OAAP,CAAe;AACdijB,cAAYhyB,IAAZ,EAAkB;AAEjBuW,UAAMvW,IAAN,EAAYuK,MAAZ;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAACrQ,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,8BAAxB,CAAL,EAA8D;AAC7D,YAAM,IAAIzC,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAED,QAAI,CAACrQ,WAAWozB,WAAX,CAAuBxwB,OAAOI,MAAP,EAAvB,EAAwC5B,IAAxC,CAAL,EAAoD;AACnD,YAAM,IAAIwB,OAAOrB,KAAX,CAAiB,6BAAjB,EAAgD,uBAAhD,EAAyE;AAAE8O,gBAAQ;AAAV,OAAzE,CAAN;AACA;;AAED,WAAOjP,IAAP;AACA;;AAlBa,CAAf;AAqBApB,WAAW+W,WAAX,CAAuBkB,WAAvB,CAAmC,aAAnC,EAAkD,CAAlD,EAAqD,IAArD,EAA2D;AAC1DjV,UAAQ,MAAM;AAD4C,CAA3D,E;;;;;;;;;;;ACrBA,IAAIwE,CAAJ;;AAAM7H,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACC,UAAQC,CAAR,EAAU;AAACyH,QAAEzH,CAAF;AAAI;;AAAhB,CAAnC,EAAqD,CAArD;AAEN6C,OAAOuN,OAAP,CAAe;AACdgjB,cAAY7uB,QAAZ,EAAsBg7C,QAAQ,EAA9B,EAAkC;AACjC,UAAM;AAAEC;AAAF,QAAkCD,KAAxC;AACA3nC,UAAMrT,QAAN,EAAgBqH,MAAhB;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAMtM,OAAOnB,OAAOmB,IAAP,EAAb;;AAEA,QAAIA,KAAKO,QAAL,IAAiB,CAACtE,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,8BAAxB,CAAtB,EAA+E;AAC9E,YAAM,IAAIzC,OAAOrB,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAE8O,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAED,QAAItM,KAAKO,QAAL,KAAkBA,QAAlB,IAA+BP,KAAKO,QAAL,IAAiBP,KAAKO,QAAL,CAAcmxB,WAAd,OAAgCnxB,SAASmxB,WAAT,EAApF,EAA6G;AAC5G,aAAOnxB,QAAP;AACA;;AAED,QAAI8I,cAAJ;;AACA,QAAI;AACHA,uBAAiB,IAAIC,MAAJ,CAAY,IAAIrN,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,uBAAxB,CAAkD,GAAlE,CAAjB;AACA,KAFD,CAEE,OAAOiI,KAAP,EAAc;AACfF,uBAAiB,IAAIC,MAAJ,CAAW,mBAAX,CAAjB;AACA;;AAED,QAAI,CAACD,eAAe/E,IAAf,CAAoB/D,QAApB,CAAL,EAAoC;AACnC,YAAM,IAAI1B,OAAOrB,KAAX,CAAiB,kBAAjB,EAAsC,GAAGiG,EAAE+qB,MAAF,CAASjuB,QAAT,CAAoB,oFAA7D,CAAN;AACA;;AAED,QAAI,CAACtE,WAAW8rB,yBAAX,CAAqCxnB,QAArC,CAAL,EAAqD;AACpD,YAAM,IAAI1B,OAAOrB,KAAX,CAAiB,yBAAjB,EAA6C,WAAWiG,EAAE+qB,MAAF,CAASjuB,QAAT,CAAoB,gCAA5E,EAA6G;AAAE+L,gBAAQ,aAAV;AAAyBiiB,eAAOhuB;AAAhC,OAA7G,CAAN;AACA;;AAED,QAAI,CAACtE,WAAWmzB,WAAX,CAAuBpvB,KAAKZ,GAA5B,EAAiCmB,QAAjC,CAAL,EAAiD;AAChD,YAAM,IAAI1B,OAAOrB,KAAX,CAAiB,iCAAjB,EAAoD,2BAApD,EAAiF;AAAE8O,gBAAQ;AAAV,OAAjF,CAAN;AACA;;AAED,QAAI,CAACtM,KAAKO,QAAV,EAAoB;AACnB1B,aAAO2jB,SAAP,CAAiBxiB,KAAKZ,GAAtB,EAA2B,MAAMP,OAAO8F,IAAP,CAAY,qBAAZ,EAAmC62C,2BAAnC,CAAjC;AACA38C,aAAOiJ,KAAP,CAAa,YAAW;AACvB,eAAO7L,WAAWyH,SAAX,CAAqBmD,GAArB,CAAyB,iBAAzB,EAA4C5K,WAAWC,MAAX,CAAkBwf,KAAlB,CAAwByB,WAAxB,CAAoCnd,KAAKZ,GAAzC,CAA5C,CAAP;AACA,OAFD;AAGA;;AAED,WAAOmB,QAAP;AACA;;AA9Ca,CAAf;AAiDAtE,WAAW+W,WAAX,CAAuBkB,WAAvB,CAAmC,aAAnC,EAAkD,CAAlD,EAAqD,IAArD,EAA2D;AAC1DjV,WAAS;AAAE,WAAO,IAAP;AAAc;;AADiC,CAA3D,E;;;;;;;;;;;ACnDAJ,OAAOuN,OAAP,CAAe;AACdmjB,WAAStlB,KAAT,EAAgB;AAEf2J,UAAO3J,KAAP,EAAcrC,MAAd;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAMtM,OAAOnB,OAAOmB,IAAP,EAAb;;AAEA,QAAI,CAAC/D,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,2BAAxB,CAAL,EAA2D;AAC1D,YAAM,IAAIzC,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,+BAA7C,EAA8E;AAAE8O,gBAAQ,UAAV;AAAsBlM,gBAAQ;AAA9B,OAA9E,CAAN;AACA;;AAED,QAAIJ,KAAKygB,MAAL,IAAezgB,KAAKygB,MAAL,CAAY,CAAZ,CAAf,IAAiCzgB,KAAKygB,MAAL,CAAY,CAAZ,EAAeE,OAAf,KAA2B1W,KAAhE,EAAuE;AACtE,aAAOA,KAAP;AACA;;AAED,QAAI,CAAChO,WAAWszB,QAAX,CAAoBvvB,KAAKZ,GAAzB,EAA8B6K,KAA9B,CAAL,EAA2C;AAC1C,YAAM,IAAIpL,OAAOrB,KAAX,CAAiB,8BAAjB,EAAiD,wBAAjD,EAA2E;AAAE8O,gBAAQ;AAAV,OAA3E,CAAN;AACA;;AAED,WAAOrC,KAAP;AACA;;AAxBa,CAAf;AA2BAhO,WAAW+W,WAAX,CAAuBkB,WAAvB,CAAmC,UAAnC,EAA+C,CAA/C,EAAkD,IAAlD,EAAwD;AACvDjV;AAAO;AAAY;AAAE,WAAO,IAAP;AAAc;;AADoB,CAAxD,E;;;;;;;;;;;AC3BAJ,OAAOuN,OAAP,CAAe;AACd0pB,gBAAc/0B,GAAd,EAAmB;AAElB6S,UAAM7S,GAAN,EAAW6G,MAAX;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAM5N,OAAOzC,WAAWC,MAAX,CAAkB6M,KAAlB,CAAwBoU,WAAxB,CAAoCpc,GAApC,CAAb;;AAEA,QAAI,CAACrC,IAAL,EAAW;AACV,YAAM,IAAIG,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAACrQ,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,gBAAhD,EAAkEP,KAAKU,GAAvE,CAAL,EAAkF;AACjF,YAAM,IAAIP,OAAOrB,KAAX,CAAiB,sBAAjB,EAAyC,gBAAzC,EAA2D;AAAE8O,gBAAQ;AAAV,OAA3D,CAAN;AACA;;AAED,WAAOrQ,WAAW65B,aAAX,CAAyB/0B,GAAzB,CAAP;AACA;;AApBa,CAAf,E;;;;;;;;;;;ACAAlC,OAAOuN,OAAP,CAAe;AACdqvC,cAAY;AAAC16C,OAAD;AAAMyc;AAAN,GAAZ,EAA4B;AAE3B5J,UAAM7S,GAAN,EAAW6G,MAAX;AACAgM,UAAM4J,OAAN,EAAe5V,MAAf;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAM1L,eAAe3E,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyDxc,GAAzD,EAA8DlC,OAAOI,MAAP,EAA9D,CAArB;AACA,UAAM43C,gBAAgB56C,WAAWC,MAAX,CAAkByF,aAAlB,CAAgC4b,wBAAhC,CAAyDxc,GAAzD,EAA8Dyc,OAA9D,CAAtB;;AAEA,QAAI,CAAC5c,YAAD,IAAiB,CAACi2C,aAAtB,EAAqC;AACpC,YAAM,IAAIh4C,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAEDrQ,eAAWC,MAAX,CAAkByF,aAAlB,CAAgCkkC,oBAAhC,CAAqD9kC,GAArD,EAA0Dyc,OAA1D,EAAmE3e,OAAOI,MAAP,EAAnE;AAEA,WAAO,IAAP;AACA;;AApBa,CAAf,E;;;;;;;;;;;ACAA,IAAIub,MAAJ;AAAW5e,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAACwe,aAAOxe,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;AAEX6C,OAAOuN,OAAP,CAAe;AACd6pB,gBAAchpB,OAAd,EAAuB;AAEtB2G,UAAM3G,OAAN,EAAesjB,MAAMmhB,eAAN,CAAsB;AAACtyC,WAAIwI;AAAL,KAAtB,CAAf;;AAEA,QAAI,CAAC/I,OAAOI,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIJ,OAAOrB,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAE8O,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAMurC,kBAAkB57C,WAAWC,MAAX,CAAkBghB,QAAlB,CAA2BC,WAA3B,CAAuClQ,QAAQ7N,GAA/C,CAAxB;;AAEA,QAAI,CAACy4C,eAAD,IAAoB,CAACA,gBAAgBz4C,GAAzC,EAA8C;AAC7C;AACA;;AAED,UAAM6nB,gBAAgBhrB,WAAW8C,KAAX,CAAiBkoB,aAAjB,CAA+BpoB,OAAOI,MAAP,EAA/B,EAAgD,cAAhD,EAAgEgO,QAAQlM,GAAxE,CAAtB;AACA,UAAM26C,cAAcz/C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,sBAAxB,CAApB;AACA,UAAMq6C,UAAU9D,gBAAgBvqC,CAAhB,IAAqBuqC,gBAAgBvqC,CAAhB,CAAkBlO,GAAlB,KAA0BP,OAAOI,MAAP,EAA/D;;AAEA,QAAI,CAACgoB,aAAD,KAAmB,CAACy0B,WAAD,IAAgB,CAACC,OAApC,CAAJ,EAAkD;AACjD,YAAM,IAAI98C,OAAOrB,KAAX,CAAiB,0BAAjB,EAA6C,6BAA7C,EAA4E;AAAE8O,gBAAQ,eAAV;AAA2BlM,gBAAQ;AAAnC,OAA5E,CAAN;AACA;;AAED,UAAMw7C,qBAAqB3/C,WAAWoF,QAAX,CAAoBC,GAApB,CAAwB,yCAAxB,CAA3B;;AACA,QAAIivB,MAAMjsB,IAAN,CAAWs3C,kBAAX,EAA+B5L,MAA/B,KAA0C4L,uBAAuB,CAArE,EAAwE;AACvE,UAAIzD,aAAJ;AACA,UAAID,KAAJ;;AAEA,UAAI3nB,MAAMjsB,IAAN,CAAWuzC,gBAAgBj0C,EAA3B,EAA+BosC,MAA/B,CAAJ,EAA4C;AAC3CkI,gBAAQ19B,OAAOq9B,gBAAgBj0C,EAAvB,CAAR;AACA;;AACD,UAAIs0C,KAAJ,EAAW;AACVC,wBAAgB39B,SAASG,IAAT,CAAcu9B,KAAd,EAAqB,SAArB,CAAhB;AACA;;AACD,UAAIC,gBAAgByD,kBAApB,EAAwC;AACvC,cAAM,IAAI/8C,OAAOrB,KAAX,CAAiB,+BAAjB,EAAkD,4BAAlD,EAAgF;AAAE8O,kBAAQ;AAAV,SAAhF,CAAN;AACA;AACD,KApCqB,CAsCtB;;;AACA,QAAIurC,gBAAgBh5B,WAAhB,IAA+Bg5B,gBAAgBh5B,WAAhB,CAA4BthB,MAA5B,GAAqC,CAApE,IAAyEs6C,gBAAgBh5B,WAAhB,CAA4B,CAA5B,EAA+B5S,WAA/B,KAA+C0D,SAA5H,EAAuI;AACtI1C,cAAQ4R,WAAR,GAAsBg5B,gBAAgBh5B,WAAtC;AACA5R,cAAQ4R,WAAR,CAAoB,CAApB,EAAuB5S,WAAvB,GAAqCgB,QAAQT,GAA7C;AACAS,cAAQT,GAAR,GAAcqrC,gBAAgBrrC,GAA9B;AACA;;AAEDS,YAAQK,CAAR,GAAYuqC,gBAAgBvqC,CAA5B;AAEA,WAAOrR,WAAWg6B,aAAX,CAAyBhpB,OAAzB,EAAkCpO,OAAOmB,IAAP,EAAlC,CAAP;AACA;;AAjDa,CAAf,E;;;;;;;;;;;ACFA,IAAIF,oBAAJ,EAAyBK,qBAAzB,EAA+C8B,gBAA/C,EAAgEC,eAAhE,EAAgFC,cAAhF,EAA+FC,cAA/F;AAA8GxG,OAAOC,KAAP,CAAaC,QAAQ,kBAAR,CAAb,EAAyC;AAACgE,uBAAqB9D,CAArB,EAAuB;AAAC8D,2BAAqB9D,CAArB;AAAuB,GAAhD;;AAAiDmE,wBAAsBnE,CAAtB,EAAwB;AAACmE,4BAAsBnE,CAAtB;AAAwB,GAAlG;;AAAmGiG,mBAAiBjG,CAAjB,EAAmB;AAACiG,uBAAiBjG,CAAjB;AAAmB,GAA1I;;AAA2IkG,kBAAgBlG,CAAhB,EAAkB;AAACkG,sBAAgBlG,CAAhB;AAAkB,GAAhL;;AAAiLmG,iBAAenG,CAAf,EAAiB;AAACmG,qBAAenG,CAAf;AAAiB,GAApN;;AAAqNoG,iBAAepG,CAAf,EAAiB;AAACoG,qBAAepG,CAAf;AAAiB;;AAAxP,CAAzC,EAAmS,CAAnS;AAS9GC,WAAW2O,SAAX,CAAqBxE,GAArB,CAAyB,IAAIhE,cAAJ,EAAzB;AACAnG,WAAW2O,SAAX,CAAqBxE,GAArB,CAAyB,IAAInE,gBAAJ,EAAzB;AACAhG,WAAW2O,SAAX,CAAqBxE,GAArB,CAAyB,IAAItG,oBAAJ,EAAzB;AACA7D,WAAW2O,SAAX,CAAqBxE,GAArB,CAAyB,IAAIjE,cAAJ,EAAzB;AACAlG,WAAW2O,SAAX,CAAqBxE,GAArB,CAAyB,IAAIlE,eAAJ,EAAzB;AACAjG,WAAW2O,SAAX,CAAqBxE,GAArB,CAAyB,IAAIjG,qBAAJ,EAAzB,E","file":"/packages/rocketchat_lib.js","sourcesContent":["import EventEmitter from 'wolfy87-eventemitter';\nRocketChat = new EventEmitter();\n/*\n* Kick off the global namespace for RocketChat.\n* @namespace RocketChat\n*/\nRocketChat.models = {};\n","export const RoomSettingsEnum = {\n\tNAME: 'roomName',\n\tTOPIC: 'roomTopic',\n\tANNOUNCEMENT: 'roomAnnouncement',\n\tDESCRIPTION: 'roomDescription',\n\tREAD_ONLY: 'readOnly',\n\tREACT_WHEN_READ_ONLY: 'reactWhenReadOnly',\n\tARCHIVE_OR_UNARCHIVE: 'archiveOrUnarchive',\n\tJOIN_CODE: 'joinCode'\n};\n\nexport const UiTextContext = {\n\tCLOSE_WARNING: 'closeWarning',\n\tHIDE_WARNING: 'hideWarning',\n\tLEAVE_WARNING: 'leaveWarning',\n\tNO_ROOMS_SUBSCRIBED: 'noRoomsSubscribed'\n};\n\nexport class RoomTypeRouteConfig {\n\tconstructor({ name, path }) {\n\t\tif (typeof name !== 'undefined' && (typeof name !== 'string' || name.length === 0)) {\n\t\t\tthrow new Error('The name must be a string.');\n\t\t}\n\n\t\tif (typeof path !== 'undefined' && (typeof path !== 'string' || path.length === 0)) {\n\t\t\tthrow new Error('The path must be a string.');\n\t\t}\n\n\t\tthis._name = name;\n\t\tthis._path = path;\n\t}\n\n\tget name() {\n\t\treturn this._name;\n\t}\n\n\tget path() {\n\t\treturn this._path;\n\t}\n}\n\nexport class RoomTypeConfig {\n\tconstructor({\n\t\tidentifier = Random.id(),\n\t\torder,\n\t\ticon,\n\t\theader,\n\t\tlabel,\n\t\troute\n\t}) {\n\t\tif (typeof identifier !== 'string' || identifier.length === 0) {\n\t\t\tthrow new Error('The identifier must be a string.');\n\t\t}\n\n\t\tif (typeof order !== 'number') {\n\t\t\tthrow new Error('The order must be a number.');\n\t\t}\n\n\t\tif (typeof icon !== 'undefined' && (typeof icon !== 'string' || icon.length === 0)) {\n\t\t\tthrow new Error('The icon must be a string.');\n\t\t}\n\n\t\tif (typeof header !== 'undefined' && (typeof header !== 'string' || header.length === 0)) {\n\t\t\tthrow new Error('The header must be a string.');\n\t\t}\n\n\t\tif (typeof label !== 'undefined' && (typeof label !== 'string' || label.length === 0)) {\n\t\t\tthrow new Error('The label must be a string.');\n\t\t}\n\n\t\tif (typeof route !== 'undefined' && !(route instanceof RoomTypeRouteConfig)) {\n\t\t\tthrow new Error('Room\\'s route is not a valid route configuration. Must be an instance of \"RoomTypeRouteConfig\".');\n\t\t}\n\n\t\tthis._identifier = identifier;\n\t\tthis._order = order;\n\t\tthis._icon = icon;\n\t\tthis._header = header;\n\t\tthis._label = label;\n\t\tthis._route = route;\n\t}\n\n\t/**\n\t * The room type's internal identifier.\n\t */\n\tget identifier() {\n\t\treturn this._identifier;\n\t}\n\n\t/**\n\t * The order of this room type for the display.\n\t */\n\tget order() {\n\t\treturn this._order;\n\t}\n\n\t/**\n\t * Sets the order of this room type for the display.\n\t *\n\t * @param {number} order the number value for the order\n\t */\n\tset order(order) {\n\t\tif (typeof order !== 'number') {\n\t\t\tthrow new Error('The order must be a number.');\n\t\t}\n\n\t\tthis._order = order;\n\t}\n\n\t/**\n\t * The icon class, css, to use as the visual aid.\n\t */\n\tget icon() {\n\t\treturn this._icon;\n\t}\n\n\t/**\n\t * The header name of this type.\n\t */\n\tget header() {\n\t\treturn this._header;\n\t}\n\n\t/**\n\t * The i18n label for this room type.\n\t */\n\tget label() {\n\t\treturn this._label;\n\t}\n\n\t/**\n\t * The route config for this room type.\n\t */\n\tget route() {\n\t\treturn this._route;\n\t}\n\n\t/**\n\t * Gets the room's name to display in the UI.\n\t *\n\t * @param {object} room\n\t */\n\tgetDisplayName(room) {\n\t\treturn room.name;\n\t}\n\n\tallowRoomSettingChange(/* room, setting */) {\n\t\treturn true;\n\t}\n\n\tcanBeCreated() {\n\t\treturn Meteor.isServer ?\n\t\t\tRocketChat.authz.hasAtLeastOnePermission(Meteor.userId(), [`create-${ this._identifier }`]) :\n\t\t\tRocketChat.authz.hasAtLeastOnePermission([`create-${ this._identifier }`]);\n\t}\n\n\tcanBeDeleted(room) {\n\t\treturn Meteor.isServer ?\n\t\t\tRocketChat.authz.hasAtLeastOnePermission(Meteor.userId(), [`delete-${ room.t }`], room._id) :\n\t\t\tRocketChat.authz.hasAtLeastOnePermission([`delete-${ room.t }`], room._id);\n\t}\n\n\tsupportMembersList(/* room */) {\n\t\treturn true;\n\t}\n\n\tisGroupChat() {\n\t\treturn false;\n\t}\n\n\tcanAddUser(/* userId, room */) {\n\t\treturn false;\n\t}\n\n\tuserDetailShowAll(/* room */) {\n\t\treturn true;\n\t}\n\n\tuserDetailShowAdmin(/* room */) {\n\t\treturn true;\n\t}\n\n\tpreventRenaming(/* room */) {\n\t\treturn false;\n\t}\n\n\tincludeInRoomSearch() {\n\t\treturn false;\n\t}\n\n\tenableMembersListProfile() {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns a text which can be used in generic UIs.\n\t * @param context The role of the text in the UI-Element\n\t * @return {string} A text or a translation key - the consumers of this method will pass the\n\t * returned value to an internationalization library\n\t */\n\tgetUiText(/* context */) {\n\t\treturn '';\n\t}\n}\n","import { RoomTypeConfig } from '../RoomTypeConfig';\n\nexport class ConversationRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'merged',\n\t\t\torder: 30,\n\t\t\tlabel: 'Conversations'\n\t\t});\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\treturn RocketChat.getUserPreference(user, 'mergeChannels');\n\t}\n}\n","/* globals openRoom */\nimport {RoomTypeConfig, RoomTypeRouteConfig, RoomSettingsEnum, UiTextContext} from '../RoomTypeConfig';\n\nexport class DirectMessageRoomRoute extends RoomTypeRouteConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'direct',\n\t\t\tpath: '/direct/:username'\n\t\t});\n\t}\n\n\taction(params) {\n\t\treturn openRoom('d', params.username);\n\t}\n\n\tlink(sub) {\n\t\treturn {username: sub.name};\n\t}\n}\n\nexport class DirectMessageRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'd',\n\t\t\torder: 50,\n\t\t\tlabel: 'Direct_Messages',\n\t\t\troute: new DirectMessageRoomRoute()\n\t\t});\n\t}\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'd',\n\t\t\tname: identifier\n\t\t};\n\n\t\tconst subscription = ChatSubscription.findOne(query);\n\t\tif (subscription && subscription.rid) {\n\t\t\treturn ChatRoom.findOne(subscription.rid);\n\t\t}\n\t}\n\n\troomName(roomData) {\n\t\tconst subscription = ChatSubscription.findOne({rid: roomData._id}, {fields: {name: 1, fname: 1}});\n\t\tif (!subscription) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name') && subscription.fname) {\n\t\t\treturn subscription.fname;\n\t\t}\n\n\t\treturn subscription.name;\n\t}\n\n\tsecondaryRoomName(roomData) {\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tconst subscription = ChatSubscription.findOne({rid: roomData._id}, {fields: {name: 1}});\n\t\t\treturn subscription && subscription.name;\n\t\t}\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst mergeChannels = RocketChat.getUserPreference(user, 'mergeChannels');\n\t\treturn !mergeChannels && RocketChat.authz.hasAtLeastOnePermission(['view-d-room', 'view-joined-room']);\n\t}\n\n\tgetUserStatus(roomId) {\n\t\tconst subscription = RocketChat.models.Subscriptions.findOne({rid: roomId});\n\t\tif (subscription == null) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn Session.get(`user_${ subscription.name }_status`);\n\t}\n\n\tgetDisplayName(room) {\n\t\treturn room.usernames.join(' x ');\n\t}\n\n\tallowRoomSettingChange(room, setting) {\n\t\tswitch (setting) {\n\t\t\tcase RoomSettingsEnum.NAME:\n\t\t\tcase RoomSettingsEnum.DESCRIPTION:\n\t\t\tcase RoomSettingsEnum.READ_ONLY:\n\t\t\tcase RoomSettingsEnum.REACT_WHEN_READ_ONLY:\n\t\t\tcase RoomSettingsEnum.ARCHIVE_OR_UNARCHIVE:\n\t\t\tcase RoomSettingsEnum.JOIN_CODE:\n\t\t\t\treturn false;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t}\n\n\tenableMembersListProfile() {\n\t\treturn true;\n\t}\n\n\tuserDetailShowAll(/* room */) {\n\t\treturn false;\n\t}\n\n\tgetUiText(context) {\n\t\tswitch (context) {\n\t\t\tcase UiTextContext.HIDE_WARNING:\n\t\t\t\treturn 'Hide_Private_Warning';\n\t\t\tcase UiTextContext.LEAVE_WARNING:\n\t\t\t\treturn 'Leave_Private_Warning';\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n}\n","import { RoomTypeConfig } from '../RoomTypeConfig';\n\nexport class FavoriteRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'f',\n\t\t\torder: 20,\n\t\t\theader: 'favorite',\n\t\t\ticon: 'star',\n\t\t\tlabel: 'Favorites'\n\t\t});\n\t}\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\treturn RocketChat.settings.get('Favorite_Rooms') && RocketChat.getUserPreference(user, 'sidebarShowFavorites');\n\t}\n}\n","import { ConversationRoomType } from './conversation';\nimport { DirectMessageRoomType } from './direct';\nimport { FavoriteRoomType } from './favorite';\nimport { PrivateRoomType } from './private';\nimport { PublicRoomType } from './public';\nimport { UnreadRoomType } from './unread';\n\nexport {\n\tConversationRoomType,\n\tDirectMessageRoomType,\n\tFavoriteRoomType,\n\tPrivateRoomType,\n\tPublicRoomType,\n\tUnreadRoomType\n};\n","/* globals openRoom */\nimport {RoomSettingsEnum, RoomTypeConfig, RoomTypeRouteConfig, UiTextContext} from '../RoomTypeConfig';\n\nexport class PrivateRoomRoute extends RoomTypeRouteConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'group',\n\t\t\tpath: '/group/:name'\n\t\t});\n\t}\n\n\taction(params) {\n\t\treturn openRoom('p', params.name);\n\t}\n}\n\nexport class PrivateRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'p',\n\t\t\torder: 40,\n\t\t\ticon: 'lock',\n\t\t\tlabel: 'Private_Groups',\n\t\t\troute: new PrivateRoomRoute()\n\t\t});\n\t}\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tname: identifier\n\t\t};\n\n\t\treturn ChatRoom.findOne(query);\n\t}\n\n\troomName(roomData) {\n\t\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\t\treturn roomData.fname || roomData.name;\n\t\t}\n\n\t\treturn roomData.name;\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst mergeChannels = RocketChat.getUserPreference(user, 'mergeChannels');\n\t\treturn !mergeChannels && RocketChat.authz.hasAllPermission('view-p-room');\n\t}\n\n\tisGroupChat() {\n\t\treturn true;\n\t}\n\n\tcanAddUser(room) {\n\t\treturn RocketChat.authz.hasAtLeastOnePermission(['add-user-to-any-p-room', 'add-user-to-joined-room'], room._id);\n\t}\n\n\tallowRoomSettingChange(room, setting) {\n\t\tswitch (setting) {\n\t\t\tcase RoomSettingsEnum.JOIN_CODE:\n\t\t\t\treturn false;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t}\n\n\tenableMembersListProfile() {\n\t\treturn true;\n\t}\n\n\tgetUiText(context) {\n\t\tswitch (context) {\n\t\t\tcase UiTextContext.HIDE_WARNING:\n\t\t\t\treturn 'Hide_Group_Warning';\n\t\t\tcase UiTextContext.LEAVE_WARNING:\n\t\t\t\treturn 'Leave_Group_Warning';\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n}\n","/* globals openRoom */\nimport {RoomTypeConfig, RoomTypeRouteConfig, UiTextContext} from '../RoomTypeConfig';\n\nexport class PublicRoomRoute extends RoomTypeRouteConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'channel',\n\t\t\tpath: '/channel/:name'\n\t\t});\n\t}\n\n\taction(params) {\n\t\treturn openRoom('c', params.name);\n\t}\n}\n\nexport class PublicRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'c',\n\t\t\torder: 30,\n\t\t\ticon: 'hashtag',\n\t\t\tlabel: 'Channels',\n\t\t\troute: new PublicRoomRoute()\n\t\t});\n\t}\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'c',\n\t\t\tname: identifier\n\t\t};\n\t\treturn ChatRoom.findOne(query);\n\t}\n\n\troomName(roomData) {\n\t\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\t\treturn roomData.fname || roomData.name;\n\t\t}\n\t\treturn roomData.name;\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\t// const roomsListExhibitionMode = RocketChat.getUserPreference(user, 'roomsListExhibitionMode');\n\t\tconst mergeChannels = RocketChat.getUserPreference(user, 'mergeChannels');\n\t\treturn !mergeChannels && (RocketChat.authz.hasAtLeastOnePermission(['view-c-room', 'view-joined-room']) || RocketChat.settings.get('Accounts_AllowAnonymousRead') === true);\n\t}\n\n\tshowJoinLink(roomId) {\n\t\treturn !!ChatRoom.findOne({_id: roomId, t: 'c'});\n\t}\n\n\tincludeInRoomSearch() {\n\t\treturn true;\n\t}\n\n\tisGroupChat() {\n\t\treturn true;\n\t}\n\n\tcanAddUser(room) {\n\t\treturn RocketChat.authz.hasAtLeastOnePermission(['add-user-to-any-c-room', 'add-user-to-joined-room'], room._id);\n\t}\n\n\tallowRoomSettingChange() {\n\t\treturn true;\n\t}\n\n\tenableMembersListProfile() {\n\t\treturn true;\n\t}\n\n\tgetUiText(context) {\n\t\tswitch (context) {\n\t\t\tcase UiTextContext.HIDE_WARNING:\n\t\t\t\treturn 'Hide_Room_Warning';\n\t\t\tcase UiTextContext.LEAVE_WARNING:\n\t\t\t\treturn 'Leave_Room_Warning';\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n}\n","import { RoomTypeConfig } from '../RoomTypeConfig';\n\nexport class UnreadRoomType extends RoomTypeConfig {\n\tconstructor() {\n\t\tsuper({\n\t\t\tidentifier: 'unread',\n\t\t\torder: 10,\n\t\t\tlabel: 'Unread'\n\t\t});\n\n\t\tthis.unread = true;\n\t}\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\treturn RocketChat.getUserPreference(user, 'sidebarShowUnread');\n\t}\n}\n","import s from 'underscore.string';\n\nRocketChat.getURL = (path, { cdn = true, full = false } = {}) => {\n\tconst cdnPrefix = s.rtrim(s.trim(RocketChat.settings.get('CDN_PREFIX') || ''), '/');\n\tconst pathPrefix = s.rtrim(s.trim(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX || ''), '/');\n\n\tlet basePath;\n\n\tconst finalPath = s.ltrim(s.trim(path), '/');\n\n\tif (cdn && cdnPrefix !== '') {\n\t\tbasePath = cdnPrefix + pathPrefix;\n\t} else if (full || Meteor.isCordova) {\n\t\treturn Meteor.absoluteUrl(finalPath);\n\t} else {\n\t\tbasePath = pathPrefix;\n\t}\n\n\treturn `${ basePath }/${ finalPath }`;\n};\n","import _ from 'underscore';\n\n/*\n* RocketChat.settings holds all packages settings\n* @namespace RocketChat.settings\n*/\nRocketChat.settings = {\n\tcallbacks: {},\n\tregexCallbacks: {},\n\tts: new Date,\n\tget(_id, callback) {\n\t\tif (callback != null) {\n\t\t\tRocketChat.settings.onload(_id, callback);\n\t\t\tif (!Meteor.settings) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_id === '*') {\n\t\t\t\treturn Object.keys(Meteor.settings).forEach(key => {\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tcallback(key, value);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (_.isRegExp(_id) && Meteor.settings) {\n\t\t\t\treturn Object.keys(Meteor.settings).forEach(key => {\n\t\t\t\t\tif (!_id.test(key)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tcallback(key, value);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Meteor.settings[_id] != null && callback(_id, Meteor.settings[_id]);\n\t\t} else {\n\t\t\tif (!Meteor.settings) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_.isRegExp(_id)) {\n\t\t\t\treturn Object.keys(Meteor.settings).reduce((items, key) => {\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tif (_id.test(key)) {\n\t\t\t\t\t\titems.push({\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tvalue\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn items;\n\t\t\t\t}, []);\n\t\t\t}\n\t\t\treturn Meteor.settings && Meteor.settings[_id];\n\t\t}\n\t},\n\tset(_id, value, callback) {\n\t\treturn Meteor.call('saveSetting', _id, value, callback);\n\t},\n\tbatchSet(settings, callback) {\n\t\t// async -> sync\n\t\t// http://daemon.co.za/2012/04/simple-async-with-only-underscore/\n\t\tconst save = function(setting) {\n\t\t\treturn function(callback) {\n\t\t\t\treturn Meteor.call('saveSetting', setting._id, setting.value, setting.editor, callback);\n\t\t\t};\n\t\t};\n\t\tconst actions = _.map(settings, (setting) => save(setting));\n\t\treturn _(actions).reduceRight(_.wrap, (err, success) => callback(err, success))();\n\t},\n\tload(key, value, initialLoad) {\n\t\t['*', key].forEach(item => {\n\t\t\tif (RocketChat.settings.callbacks[item]) {\n\t\t\t\tRocketChat.settings.callbacks[item].forEach(callback => callback(key, value, initialLoad));\n\t\t\t}\n\t\t});\n\t\tObject.keys(RocketChat.settings.regexCallbacks).forEach(cbKey => {\n\t\t\tconst cbValue = RocketChat.settings.regexCallbacks[cbKey];\n\t\t\tif (!cbValue.regex.test(key)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcbValue.callbacks.forEach(callback => callback(key, value, initialLoad));\n\t\t});\n\t},\n\tonload(key, callback) {\n\t\t// if key is '*'\n\t\t// \tfor key, value in Meteor.settings\n\t\t// \t\tcallback key, value, false\n\t\t// else if Meteor.settings?[_id]?\n\t\t// \tcallback key, Meteor.settings[_id], false\n\t\tconst keys = [].concat(key);\n\t\tkeys.forEach(k => {\n\t\t\tif (_.isRegExp(k)) {\n\t\t\t\tRocketChat.settings.regexCallbacks[name = k.source] = RocketChat.settings.regexCallbacks[name = k.source] || {\n\t\t\t\t\tregex: k,\n\t\t\t\t\tcallbacks: []\n\t\t\t\t};\n\t\t\t\tRocketChat.settings.regexCallbacks[k.source].callbacks.push(callback);\n\t\t\t} else {\n\t\t\t\tRocketChat.settings.callbacks[k] = RocketChat.settings.callbacks[k] || [];\n\t\t\t\tRocketChat.settings.callbacks[k].push(callback);\n\t\t\t}\n\t\t});\n\t}\n};\n","import _ from 'underscore';\n\n/*\n* Callback hooks provide an easy way to add extra steps to common operations.\n* @namespace RocketChat.callbacks\n*/\n\nRocketChat.callbacks = {};\n\nif (Meteor.isServer) {\n\tRocketChat.callbacks.showTime = true;\n\tRocketChat.callbacks.showTotalTime = true;\n} else {\n\tRocketChat.callbacks.showTime = false;\n\tRocketChat.callbacks.showTotalTime = false;\n}\n\n\n/*\n* Callback priorities\n*/\n\nRocketChat.callbacks.priority = {\n\tHIGH: -1000,\n\tMEDIUM: 0,\n\tLOW: 1000\n};\n\n\n/*\n* Add a callback function to a hook\n* @param {String} hook - The name of the hook\n* @param {Function} callback - The callback function\n*/\n\nRocketChat.callbacks.add = function(hook, callback, priority, id) {\n\tif (priority == null) {\n\t\tpriority = RocketChat.callbacks.priority.MEDIUM;\n\t}\n\tif (!_.isNumber(priority)) {\n\t\tpriority = RocketChat.callbacks.priority.MEDIUM;\n\t}\n\tcallback.priority = priority;\n\tcallback.id = id || Random.id();\n\tRocketChat.callbacks[hook] = RocketChat.callbacks[hook] || [];\n\tif (RocketChat.callbacks.showTime === true) {\n\t\tconst err = new Error;\n\t\tcallback.stack = err.stack;\n\t}\n\tif (RocketChat.callbacks[hook].find((cb) => cb.id === callback.id)) {\n\t\treturn;\n\t}\n\tRocketChat.callbacks[hook].push(callback);\n};\n\n\n/*\n* Remove a callback from a hook\n* @param {string} hook - The name of the hook\n* @param {string} id - The callback's id\n*/\n\nRocketChat.callbacks.remove = function(hookName, id) {\n\tRocketChat.callbacks[hookName] = _.reject(RocketChat.callbacks[hookName], (callback) => callback.id === id);\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n* @returns {Object} Returns the item after it's been through all the callbacks for this hook\n*/\n\nRocketChat.callbacks.run = function(hook, item, constant) {\n\tconst callbacks = RocketChat.callbacks[hook];\n\tif (callbacks && callbacks.length) {\n\t\tlet totalTime = 0;\n\t\tconst result = _.sortBy(callbacks, function(callback) {\n\t\t\treturn callback.priority || RocketChat.callbacks.priority.MEDIUM;\n\t\t}).reduce(function(result, callback) {\n\t\t\tlet time = 0;\n\t\t\tif (RocketChat.callbacks.showTime === true || RocketChat.callbacks.showTotalTime === true) {\n\t\t\t\ttime = Date.now();\n\t\t\t}\n\t\t\tconst callbackResult = callback(result, constant);\n\t\t\tif (RocketChat.callbacks.showTime === true || RocketChat.callbacks.showTotalTime === true) {\n\t\t\t\tconst currentTime = Date.now() - time;\n\t\t\t\ttotalTime += currentTime;\n\t\t\t\tif (RocketChat.callbacks.showTime === true) {\n\t\t\t\t\tif (Meteor.isServer) {\n\t\t\t\t\t\tRocketChat.statsTracker.timing('callbacks.time', currentTime, [`hook:${ hook }`, `callback:${ callback.id }`]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet stack = callback.stack && typeof callback.stack.split === 'function' && callback.stack.split('\\n');\n\t\t\t\t\t\tstack = stack && stack[2] && (stack[2].match(/\\(.+\\)/)||[])[0];\n\t\t\t\t\t\tconsole.log(String(currentTime), hook, callback.id, stack);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn (typeof callbackResult === 'undefined') ? result : callbackResult;\n\t\t}, item);\n\t\tif (RocketChat.callbacks.showTotalTime === true) {\n\t\t\tif (Meteor.isServer) {\n\t\t\t\tRocketChat.statsTracker.timing('callbacks.totalTime', totalTime, [`hook:${ hook }`]);\n\t\t\t} else {\n\t\t\t\tconsole.log(`${ hook }:`, totalTime);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t} else {\n\t\treturn item;\n\t}\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item, in async mode (only works on server)\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n*/\n\nRocketChat.callbacks.runAsync = function(hook, item, constant) {\n\tconst callbacks = RocketChat.callbacks[hook];\n\tif (Meteor.isServer && callbacks && callbacks.length) {\n\t\tMeteor.defer(function() {\n\t\t\t_.sortBy(callbacks, (callback) => callback.priority || RocketChat.callbacks.priority.MEDIUM).forEach((callback) => callback(item, constant));\n\t\t});\n\t} else {\n\t\treturn item;\n\t}\n};\n","import _ from 'underscore';\n\nRocketChat.fileUploadMediaWhiteList = function() {\n\tconst mediaTypeWhiteList = RocketChat.settings.get('FileUpload_MediaTypeWhiteList');\n\n\tif (!mediaTypeWhiteList || mediaTypeWhiteList === '*') {\n\t\treturn;\n\t}\n\treturn _.map(mediaTypeWhiteList.split(','), function(item) {\n\t\treturn item.trim();\n\t});\n};\n\nRocketChat.fileUploadIsValidContentType = function(type) {\n\tconst list = RocketChat.fileUploadMediaWhiteList();\n\tif (!list) {\n\t\treturn true;\n\t}\n\n\tif (!type) {\n\t\treturn false;\n\t}\n\n\tif (_.contains(list, type)) {\n\t\treturn true;\n\t} else {\n\t\tconst wildCardGlob = '/*';\n\t\tconst wildcards = _.filter(list, function(item) {\n\t\t\treturn item.indexOf(wildCardGlob) > 0;\n\t\t});\n\t\tif (_.contains(wildcards, type.replace(/(\\/.*)$/, wildCardGlob))) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n","const colors = ['#F44336', '#E91E63', '#9C27B0', '#673AB7', '#3F51B5', '#2196F3', '#03A9F4', '#00BCD4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFC107', '#FF9800', '#FF5722', '#795548', '#9E9E9E', '#607D8B'];\n\nRocketChat.getAvatarColor = function(name) {\n\treturn colors[name.length % colors.length];\n};\n","import s from 'underscore.string';\n\nRocketChat.getValidRoomName = function getValidRoomName(displayName, rid = '') {\n\tlet slugifiedName = displayName;\n\n\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\tconst room = RocketChat.models.Rooms.findOneByDisplayName(displayName);\n\t\tif (room && room._id !== rid) {\n\t\t\tif (room.archived) {\n\t\t\t\tthrow new Meteor.Error('error-archived-duplicate-name', `There's an archived channel with name ${ displayName }`, { function: 'RocketChat.getValidRoomName', channel_name: displayName });\n\t\t\t} else {\n\t\t\t\tthrow new Meteor.Error('error-duplicate-channel-name', `A channel with name '${ displayName }' exists`, { function: 'RocketChat.getValidRoomName', channel_name: displayName });\n\t\t\t}\n\t\t}\n\t\tslugifiedName = s.slugify(displayName);\n\t}\n\n\tlet nameValidation;\n\ttry {\n\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t} catch (error) {\n\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t}\n\tif (!nameValidation.test(slugifiedName)) {\n\t\tthrow new Meteor.Error('error-invalid-room-name', `${ slugifiedName } is not a valid room name.`, {\n\t\t\t'function': 'RocketChat.getValidRoomName',\n\t\t\tchannel_name: slugifiedName\n\t\t});\n\t}\n\n\tconst room = RocketChat.models.Rooms.findOneByName(slugifiedName);\n\tif (room && room._id !== rid) {\n\t\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\t\tlet tmpName = slugifiedName;\n\t\t\tlet next = 0;\n\t\t\twhile (RocketChat.models.Rooms.findOneByNameAndNotId(tmpName, rid)) {\n\t\t\t\ttmpName = `${ slugifiedName }-${ ++next }`;\n\t\t\t}\n\t\t\tslugifiedName = tmpName;\n\t\t} else if (room.archived) {\n\t\t\tthrow new Meteor.Error('error-archived-duplicate-name', `There's an archived channel with name ${ slugifiedName }`, { function: 'RocketChat.getValidRoomName', channel_name: slugifiedName });\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-duplicate-channel-name', `A channel with name '${ slugifiedName }' exists`, { function: 'RocketChat.getValidRoomName', channel_name: slugifiedName });\n\t\t}\n\t}\n\n\treturn slugifiedName;\n};\n","import s from 'underscore.string';\n\nRocketChat.placeholders = {};\n\nRocketChat.placeholders.replace = function(str, data) {\n\tif (!str) {\n\t\treturn '';\n\t}\n\n\tstr = str.replace(/\\[Site_Name\\]/g, RocketChat.settings.get('Site_Name') || '');\n\tstr = str.replace(/\\[Site_URL\\]/g, RocketChat.settings.get('Site_Url') || '');\n\n\tif (data) {\n\t\tstr = str.replace(/\\[name\\]/g, data.name || '');\n\t\tstr = str.replace(/\\[fname\\]/g, s.strLeft(data.name, ' ') || '');\n\t\tstr = str.replace(/\\[lname\\]/g, s.strRightBack(data.name, ' ') || '');\n\t\tstr = str.replace(/\\[email\\]/g, data.email || '');\n\t\tstr = str.replace(/\\[password\\]/g, data.password || '');\n\t\tstr = str.replace(/\\[reason\\]/g, data.reason || '');\n\t\tstr = str.replace(/\\[User\\]/g, data.user || '');\n\t\tstr = str.replace(/\\[Room\\]/g, data.room || '');\n\n\t\tif (data.unsubscribe) {\n\t\t\tstr = str.replace(/\\[unsubscribe\\]/g, data.unsubscribe);\n\t\t}\n\t}\n\n\tstr = str.replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + '<br>' + '$2');\n\n\n\treturn str;\n};\n","import _ from 'underscore';\n\n/*\n* Callback hooks provide an easy way to add extra steps to common operations.\n* @namespace RocketChat.promises\n*/\n\nRocketChat.promises = {};\n\n\n/*\n* Callback priorities\n*/\n\nRocketChat.promises.priority = {\n\tHIGH: -1000,\n\tMEDIUM: 0,\n\tLOW: 1000\n};\n\n\n/*\n* Add a callback function to a hook\n* @param {String} hook - The name of the hook\n* @param {Function} callback - The callback function\n*/\n\nRocketChat.promises.add = function(hook, callback, p = RocketChat.promises.priority.MEDIUM, id) {\n\tconst priority = !_.isNumber(p) ? RocketChat.promises.priority.MEDIUM : p;\n\tcallback.priority = priority;\n\tcallback.id = id || Random.id();\n\tRocketChat.promises[hook] = RocketChat.promises[hook] || [];\n\tif (RocketChat.promises[hook].find(cb => cb.id === callback.id)) {\n\t\treturn;\n\t}\n\tRocketChat.promises[hook].push(callback);\n};\n\n\n/*\n* Remove a callback from a hook\n* @param {string} hook - The name of the hook\n* @param {string} id - The callback's id\n*/\n\nRocketChat.promises.remove = function(hookName, id) {\n\tRocketChat.promises[hookName] = _.reject(RocketChat.promises[hookName], (callback) => callback.id === id);\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n* @returns {Object} Returns the item after it's been through all the callbacks for this hook\n*/\n\nRocketChat.promises.run = function(hook, item, constant) {\n\tlet callbacks = RocketChat.promises[hook];\n\tif (callbacks == null || callbacks.length === 0) {\n\t\treturn Promise.resolve(item);\n\t}\n\tcallbacks = _.sortBy(callbacks, (callback) => callback.priority || RocketChat.promises.priority.MEDIUM);\n\treturn callbacks.reduce(function(previousPromise, callback) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\treturn previousPromise.then((result) => callback(result, constant).then(resolve, reject));\n\t\t});\n\t}, Promise.resolve(item));\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item, in async mode (only works on server)\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n*/\n\nRocketChat.promises.runAsync = function(hook, item, constant) {\n\tconst callbacks = RocketChat.promises[hook];\n\tif (!Meteor.isServer || callbacks == null || callbacks.length === 0) {\n\t\treturn item;\n\t}\n\tMeteor.defer(() => {\n\t\t_.sortBy(callbacks, (callback) => callback.priority || RocketChat.promises.priority.MEDIUM).forEach(function(callback) {\n\t\t\tcallback(item, constant);\n\t\t});\n\t});\n};\n","/* globals roomExit */\nimport { RoomTypeConfig } from './RoomTypeConfig';\n\nexport class RoomTypesCommon {\n\tconstructor() {\n\t\tthis.roomTypes = {};\n\t\tthis.roomTypesOrder = [];\n\t\tthis.mainOrder = 1;\n\t}\n\n\t/**\n\t * Adds a room type to the application.\n\t *\n\t * @param {RoomTypeConfig} roomConfig\n\t * @returns {void}\n\t */\n\tadd(roomConfig) {\n\t\tif (!(roomConfig instanceof RoomTypeConfig)) {\n\t\t\tthrow new Error('Invalid Room Configuration object, it must extend \"RoomTypeConfig\"');\n\t\t}\n\n\t\tif (this.roomTypes[roomConfig.identifier]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!roomConfig.order) {\n\t\t\troomConfig.order = this.mainOrder + 10;\n\t\t\tthis.mainOrder += 10;\n\t\t}\n\n\t\tthis.roomTypesOrder.push({\n\t\t\tidentifier: roomConfig.identifier,\n\t\t\torder: roomConfig.order\n\t\t});\n\n\t\tthis.roomTypes[roomConfig.identifier] = roomConfig;\n\n\t\tif (roomConfig.route && roomConfig.route.path && roomConfig.route.name && roomConfig.route.action) {\n\t\t\tconst routeConfig = {\n\t\t\t\tname: roomConfig.route.name,\n\t\t\t\taction: roomConfig.route.action\n\t\t\t};\n\n\t\t\tif (Meteor.isClient) {\n\t\t\t\trouteConfig.triggersExit = [roomExit];\n\t\t\t}\n\n\t\t\treturn FlowRouter.route(roomConfig.route.path, routeConfig);\n\t\t}\n\t}\n\n\thasCustomLink(roomType) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link != null;\n\t}\n\n\t/**\n\t * @param {string} roomType room type (e.g.: c (for channels), d (for direct channels))\n\t * @param {object} subData the user's subscription data\n\t */\n\tgetRouteLink(roomType, subData) {\n\t\tif (!this.roomTypes[roomType]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link) {\n\t\t\trouteData = this.roomTypes[roomType].route.link(subData);\n\t\t} else if (subData && subData.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name\n\t\t\t};\n\t\t}\n\n\t\treturn FlowRouter.path(this.roomTypes[roomType].route.name, routeData);\n\t}\n\n\topenRouteLink(roomType, subData, queryParams) {\n\t\tif (!this.roomTypes[roomType]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link) {\n\t\t\trouteData = this.roomTypes[roomType].route.link(subData);\n\t\t} else if (subData && subData.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name\n\t\t\t};\n\t\t}\n\n\t\treturn FlowRouter.go(this.roomTypes[roomType].route.name, routeData, queryParams);\n\t}\n}\n","RocketChat.slashCommands = {\n\tcommands: {}\n};\n\nRocketChat.slashCommands.add = function(command, callback, options = {}, result) {\n\tRocketChat.slashCommands.commands[command] = {\n\t\tcommand,\n\t\tcallback,\n\t\tparams: options.params,\n\t\tdescription: options.description,\n\t\tpermission: options.permission,\n\t\tclientOnly: options.clientOnly || false,\n\t\tresult\n\t};\n};\n\nRocketChat.slashCommands.run = function(command, params, item) {\n\tif (RocketChat.slashCommands.commands[command] && RocketChat.slashCommands.commands[command].callback) {\n\t\treturn RocketChat.slashCommands.commands[command].callback(command, params, item);\n\t}\n};\n\nMeteor.methods({\n\tslashCommand(command) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'slashCommand'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.slashCommands.run(command.cmd, command.params, command.msg);\n\t}\n});\n","import s from 'underscore.string';\n\nRocketChat.Message = {\n\tparse(msg, language) {\n\t\tconst messageType = RocketChat.MessageTypes.getType(msg);\n\t\tif (messageType) {\n\t\t\tif (messageType.render) {\n\t\t\t\treturn messageType.render(msg);\n\t\t\t} else if (messageType.template) {\n\t\t\t\t// Render message\n\t\t\t\treturn;\n\t\t\t} else if (messageType.message) {\n\t\t\t\tif (!language && typeof localStorage !== 'undefined') {\n\t\t\t\t\tlanguage = localStorage.getItem('userLanguage');\n\t\t\t\t}\n\t\t\t\tconst data = (typeof messageType.data === 'function' && messageType.data(msg)) || {};\n\t\t\t\treturn TAPi18n.__(messageType.message, data, language);\n\t\t\t}\n\t\t}\n\t\tif (msg.u && msg.u.username === RocketChat.settings.get('Chatops_Username')) {\n\t\t\tmsg.html = msg.msg;\n\t\t\treturn msg.html;\n\t\t}\n\t\tmsg.html = msg.msg;\n\t\tif (s.trim(msg.html) !== '') {\n\t\t\tmsg.html = s.escapeHTML(msg.html);\n\t\t}\n\t\tmsg.html = msg.html.replace(/\\n/gm, '<br/>');\n\t\treturn msg.html;\n\t}\n};\n","RocketChat.messageBox = {};\n\nRocketChat.messageBox.actions = new class {\n\tconstructor() {\n\t\tthis.actions = {};\n\t}\n\n\t/* Add a action to messagebox\n\t@param group\n\t@param label\n\t@param config\n\ticon: icon class\n\taction: action function\n\tcondition: condition to display the action\n\t*/\n\n\tadd(group, label, config) {\n\t\tif (!group && !label && !config) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.actions[group]) {\n\t\t\tthis.actions[group] = [];\n\t\t}\n\n\t\tconst actionExists = this.actions[group].find((action) => {\n\t\t\treturn action.label === label;\n\t\t});\n\n\t\tif (actionExists) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.actions[group].push({...config, label});\n\t}\n\n\tget(group) {\n\t\tif (!group) {\n\t\t\treturn Object.keys(this.actions).reduce((ret, key) => {\n\t\t\t\tconst actions = this.actions[key].filter(action => !action.condition || action.condition());\n\t\t\t\tif (actions.length) {\n\t\t\t\t\tret[key] = actions;\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t}, {});\n\t\t}\n\n\t\treturn this.actions[group].filter(action => !action.condition || action.condition());\n\t}\n\n\tgetById(id) {\n\t\tconst messageActions = this.actions;\n\t\tlet actions = [];\n\t\tObject.keys(messageActions).forEach(function(action) {\n\t\t\tactions = actions.concat(messageActions[action]);\n\t\t});\n\n\t\treturn actions.filter(action => action.id === id);\n\t}\n};\n","RocketChat.MessageTypes = new class {\n\tconstructor() {\n\t\tthis.types = {};\n\t}\n\n\tregisterType(options) {\n\t\treturn this.types[options.id] = options;\n\t}\n\n\tgetType(message) {\n\t\treturn this.types[message && message.t];\n\t}\n\n\tisSystemMessage(message) {\n\t\tconst type = this.types[message && message.t];\n\t\treturn type && type.system;\n\t}\n\n};\n\nMeteor.startup(function() {\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'r',\n\t\tsystem: true,\n\t\tmessage: 'Room_name_changed',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\troom_name: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'au',\n\t\tsystem: true,\n\t\tmessage: 'User_added_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_added: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'ru',\n\t\tsystem: true,\n\t\tmessage: 'User_removed_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_removed: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'ul',\n\t\tsystem: true,\n\t\tmessage: 'User_left',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_left: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'uj',\n\t\tsystem: true,\n\t\tmessage: 'User_joined_channel',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'wm',\n\t\tsystem: true,\n\t\tmessage: 'Welcome',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'rm',\n\t\tsystem: true,\n\t\tmessage: 'Message_removed',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'rtc',\n\t\trender(message) {\n\t\t\treturn RocketChat.callbacks.run('renderRtcMessage', message);\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'user-muted',\n\t\tsystem: true,\n\t\tmessage: 'User_muted_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_muted: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'user-unmuted',\n\t\tsystem: true,\n\t\tmessage: 'User_unmuted_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_unmuted: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'subscription-role-added',\n\t\tsystem: true,\n\t\tmessage: '__username__was_set__role__by__user_by_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.msg,\n\t\t\t\trole: message.role,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'subscription-role-removed',\n\t\tsystem: true,\n\t\tmessage: '__username__is_no_longer__role__defined_by__user_by_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.msg,\n\t\t\t\trole: message.role,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'room-archived',\n\t\tsystem: true,\n\t\tmessage: 'This_room_has_been_archived_by__username_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'room-unarchived',\n\t\tsystem: true,\n\t\tmessage: 'This_room_has_been_unarchived_by__username_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.u.username\n\t\t\t};\n\t\t}\n\t});\n});\n","let logger;\n\nif (Meteor.isServer) {\n\tlogger = new Logger('TemplateVarHandler', {});\n}\n\nRocketChat.templateVarHandler = function(variable, object) {\n\n\tconst templateRegex = /#{([\\w\\-]+)}/gi;\n\tlet match = templateRegex.exec(variable);\n\tlet tmpVariable = variable;\n\n\tif (match == null) {\n\t\tif (!object.hasOwnProperty(variable)) {\n\t\t\tlogger && logger.debug(`user does not have attribute: ${ variable }`);\n\t\t\treturn;\n\t\t}\n\t\treturn object[variable];\n\t} else {\n\t\tlogger && logger.debug('template found. replacing values');\n\t\twhile (match != null) {\n\t\t\tconst tmplVar = match[0];\n\t\t\tconst tmplAttrName = match[1];\n\n\t\t\tif (!object.hasOwnProperty(tmplAttrName)) {\n\t\t\t\tlogger && logger.debug(`user does not have attribute: ${ tmplAttrName }`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst attrVal = object[tmplAttrName];\n\t\t\tlogger && logger.debug(`replacing template var: ${ tmplVar } with value: ${ attrVal }`);\n\t\t\ttmpVariable = tmpVariable.replace(tmplVar, attrVal);\n\t\t\tmatch = templateRegex.exec(variable);\n\t\t}\n\t\treturn tmpVariable;\n\t}\n};\n","/**\n * Tries to retrieve the user preference falling back to a default system\n * value or to a default value if it is passed as argument\n*/\nRocketChat.getUserPreference = function(user, key, defaultValue=undefined) {\n\tlet preference;\n\n\tif (user && user.settings && user.settings.preferences &&\n\t\tuser.settings.preferences.hasOwnProperty(key)) {\n\t\tpreference = user.settings.preferences[key];\n\t} else if (defaultValue === undefined) {\n\t\tpreference = RocketChat.settings.get(`Accounts_Default_User_Preferences_${ key }`);\n\t}\n\n\treturn preference !== undefined ? preference : defaultValue;\n};\n","/* globals WebAppInternals */\nRocketChat.settings.get('Site_Url', function(key, value) {\n\tif (value == null || value.trim() === '') {\n\t\treturn;\n\t}\n\tlet host = value.replace(/\\/$/, '');\n\t// let prefix = '';\n\tconst match = value.match(/([^\\/]+\\/{2}[^\\/]+)(\\/.+)/);\n\tif (match != null) {\n\t\thost = match[1];\n\t\t// prefix = match[2].replace(/\\/$/, '');\n\t}\n\t__meteor_runtime_config__.ROOT_URL = value;\n\n\tif (Meteor.absoluteUrl.defaultOptions && Meteor.absoluteUrl.defaultOptions.rootUrl) {\n\t\tMeteor.absoluteUrl.defaultOptions.rootUrl = value;\n\t}\n\tif (Meteor.isServer) {\n\t\tRocketChat.hostname = host.replace(/^https?:\\/\\//, '');\n\t\tprocess.env.MOBILE_ROOT_URL = host;\n\t\tprocess.env.MOBILE_DDP_URL = host;\n\t\tif (typeof WebAppInternals !== 'undefined' && WebAppInternals.generateBoilerplate) {\n\t\t\treturn WebAppInternals.generateBoilerplate();\n\t\t}\n\t}\n});\n","/* global InstanceStatus */\nimport _ from 'underscore';\n\nconst logger = new Logger('Meteor', {\n\tmethods: {\n\t\tmethod: {\n\t\t\ttype: 'debug'\n\t\t},\n\t\tpublish: {\n\t\t\ttype: 'debug'\n\t\t}\n\t}\n});\n\nconst wrapMethods = function(name, originalHandler, methodsMap) {\n\tmethodsMap[name] = function() {\n\t\tconst args = name === 'ufsWrite' ? Array.prototype.slice.call(arguments, 1) : arguments;\n\t\tlogger.method(name, '-> userId:', Meteor.userId(), ', arguments: ', args);\n\n\t\treturn originalHandler.apply(this, arguments);\n\t};\n};\n\nconst originalMeteorMethods = Meteor.methods;\n\nMeteor.methods = function(methodMap) {\n\t_.each(methodMap, function(handler, name) {\n\t\twrapMethods(name, handler, methodMap);\n\t});\n\toriginalMeteorMethods(methodMap);\n};\n\nconst originalMeteorPublish = Meteor.publish;\n\nMeteor.publish = function(name, func) {\n\treturn originalMeteorPublish(name, function() {\n\t\tlogger.publish(name, '-> userId:', this.userId, ', arguments: ', arguments);\n\n\t\treturn func.apply(this, arguments);\n\t});\n};\n\nWebApp.rawConnectHandlers.use(function(req, res, next) {\n\tres.setHeader('X-Instance-ID', InstanceStatus.id());\n\treturn next();\n});\n","import bugsnag from 'bugsnag';\n\nRocketChat.bugsnag = bugsnag;\n\nRocketChat.settings.get('Bugsnag_api_key', (key, value) => {\n\tif (value) {\n\t\tbugsnag.register(value);\n\t}\n});\n\nconst notify = function(message, stack) {\n\tif (typeof stack === 'string') {\n\t\tmessage += ` ${ stack }`;\n\t}\n\tlet options = {};\n\tif (RocketChat.Info) {\n\t\toptions = { app: { version: RocketChat.Info.version, info: RocketChat.Info } };\n\t}\n\tconst error = new Error(message);\n\terror.stack = stack;\n\tRocketChat.bugsnag.notify(error, options);\n};\n\nprocess.on('uncaughtException', Meteor.bindEnvironment((error) => {\n\tnotify(error.message, error.stack);\n\tthrow error;\n}));\n\nconst originalMeteorDebug = Meteor._debug;\nMeteor._debug = function() {\n\tnotify(...arguments);\n\treturn originalMeteorDebug(...arguments);\n};\n","import client from 'prom-client';\n\nRocketChat.promclient = client;\n\nRocketChat.metrics = {};\n\n// one sample metrics only - a counter\n\nRocketChat.metrics.messagesSent = new client.Counter({'name': 'message_sent', 'help': 'cumulated number of messages sent'});\n","/* globals RateLimiter */\nimport _ from 'underscore';\n\nRocketChat.RateLimiter = new class {\n\tlimitFunction(fn, numRequests, timeInterval, matchers) {\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\treturn fn;\n\t\t}\n\t\tconst rateLimiter = new RateLimiter();\n\t\trateLimiter.addRule(matchers, numRequests, timeInterval);\n\t\treturn function(...args) {\n\t\t\tconst match = {};\n\t\t\t_.each(matchers, function(matcher, key) {\n\t\t\t\treturn match[key] = args[key];\n\t\t\t});\n\t\t\trateLimiter.increment(match);\n\t\t\tconst rateLimitResult = rateLimiter.check(match);\n\t\t\tif (rateLimitResult.allowed) {\n\t\t\t\treturn fn.apply(null, arguments);\n\t\t\t} else {\n\t\t\t\tthrow new Meteor.Error('error-too-many-requests', `Error, too many requests. Please slow down. You must wait ${ Math.ceil(rateLimitResult.timeToReset / 1000) } seconds before trying again.`, {\n\t\t\t\t\ttimeToReset: rateLimitResult.timeToReset,\n\t\t\t\t\tseconds: Math.ceil(rateLimitResult.timeToReset / 1000)\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tlimitMethod(methodName, numRequests, timeInterval, matchers) {\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\treturn;\n\t\t}\n\t\tconst match = {\n\t\t\ttype: 'method',\n\t\t\tname: methodName\n\t\t};\n\t\t_.each(matchers, function(matcher, key) {\n\t\t\treturn match[key] = matchers[key];\n\t\t});\n\t\treturn DDPRateLimiter.addRule(match, numRequests, timeInterval);\n\t}\n\n};\n","/* globals LoggerManager */\nRocketChat.settings.get('Log_Package', function(key, value) {\n\treturn LoggerManager.showPackage = value;\n});\n\nRocketChat.settings.get('Log_File', function(key, value) {\n\treturn LoggerManager.showFileAndLine = value;\n});\n\nRocketChat.settings.get('Log_Level', function(key, value) {\n\tif (value != null) {\n\t\tLoggerManager.logLevel = parseInt(value);\n\t\tMeteor.setTimeout(() => {\n\t\t\treturn LoggerManager.enable(true);\n\t\t}, 200);\n\t}\n});\n","/* globals Push */\nclass PushNotification {\n\tgetNotificationId(roomId) {\n\t\tconst serverId = RocketChat.settings.get('uniqueID');\n\t\treturn this.hash(`${ serverId }|${ roomId }`); // hash\n\t}\n\n\thash(str) {\n\t\tlet hash = 0;\n\t\tlet i = str.length;\n\n\t\twhile (i) {\n\t\t\thash = ((hash << 5) - hash) + str.charCodeAt(--i);\n\t\t\thash = hash & hash; // Convert to 32bit integer\n\t\t}\n\t\treturn hash;\n\t}\n\n\tsend({ roomName, roomId, username, message, usersTo, payload, badge = 1, category }) {\n\t\tlet title;\n\t\tif (roomName && roomName !== '') {\n\t\t\ttitle = `${ roomName }`;\n\t\t\tmessage = `${ username }: ${ message }`;\n\t\t} else {\n\t\t\ttitle = `${ username }`;\n\t\t}\n\t\tconst icon = RocketChat.settings.get('Assets_favicon_192').url || RocketChat.settings.get('Assets_favicon_192').defaultUrl;\n\t\tconst config = {\n\t\t\tfrom: 'push',\n\t\t\tbadge,\n\t\t\tsound: 'default',\n\t\t\ttitle,\n\t\t\ttext: message,\n\t\t\tpayload,\n\t\t\tquery: usersTo,\n\t\t\tnotId: this.getNotificationId(roomId),\n\t\t\tgcm: {\n\t\t\t\tstyle: 'inbox',\n\t\t\t\tsummaryText: '%n% new messages',\n\t\t\t\timage: RocketChat.getURL(icon, { full: true })\n\t\t\t}\n\t\t};\n\n\t\tif (category !== '') {\n\t\t\tconfig.apn = {\n\t\t\t\tcategory\n\t\t\t};\n\t\t}\n\n\t\treturn Push.send(config);\n\t}\n}\n\nRocketChat.PushNotification = new PushNotification();\n","RocketChat.emailDomainDefaultBlackList = [\n\t'0-mail.com',\n\t'0815.ru',\n\t'0815.su',\n\t'0clickemail.com',\n\t'0wnd.net',\n\t'0wnd.org',\n\t'10mail.org',\n\t'10minut.com.pl',\n\t'10minutemail.co.za',\n\t'10minutemail.com',\n\t'10minutemail.de',\n\t'123-m.com',\n\t'1chuan.com',\n\t'1fsdfdsfsdf.tk',\n\t'1pad.de',\n\t'1zhuan.com',\n\t'20email.eu',\n\t'20mail.eu',\n\t'20mail.it',\n\t'20minutemail.com',\n\t'21cn.com',\n\t'2fdgdfgdfgdf.tk',\n\t'2prong.com',\n\t'30minutemail.com',\n\t'33mail.com',\n\t'3d-painting.com',\n\t'3trtretgfrfe.tk',\n\t'4gfdsgfdgfd.tk',\n\t'4warding.com',\n\t'4warding.net',\n\t'4warding.org',\n\t'5ghgfhfghfgh.tk',\n\t'60minutemail.com',\n\t'675hosting.com',\n\t'675hosting.net',\n\t'675hosting.org',\n\t'6hjgjhgkilkj.tk',\n\t'6ip.us',\n\t'6paq.com',\n\t'6url.com',\n\t'75hosting.com',\n\t'75hosting.net',\n\t'75hosting.org',\n\t'7days-printing.com',\n\t'7tags.com',\n\t'99experts.com',\n\t'9ox.net',\n\t'a-bc.net',\n\t'a45.in',\n\t'abcmail.email',\n\t'abyssmail.com',\n\t'acentri.com',\n\t'advantimo.com',\n\t'afrobacon.com',\n\t'ag.us.to',\n\t'agedmail.com',\n\t'ahk.jp',\n\t'ajaxapp.net',\n\t'alivance.com',\n\t'ama-trade.de',\n\t'amail.com',\n\t'amilegit.com',\n\t'amiri.net',\n\t'amiriindustries.com',\n\t'anappthat.com',\n\t'ano-mail.net',\n\t'anonbox.net',\n\t'anonmails.de',\n\t'anonymail.dk',\n\t'anonymbox.com',\n\t'antichef.com',\n\t'antichef.net',\n\t'antireg.ru',\n\t'antispam.de',\n\t'antispammail.de',\n\t'appixie.com',\n\t'armyspy.com',\n\t'artman-conception.com',\n\t'aver.com',\n\t'azmeil.tk',\n\t'baxomale.ht.cx',\n\t'beddly.com',\n\t'beefmilk.com',\n\t'bigprofessor.so',\n\t'bigstring.com',\n\t'binkmail.com',\n\t'bio-muesli.net',\n\t'blogmyway.org',\n\t'bobmail.info',\n\t'bofthew.com',\n\t'bootybay.de',\n\t'boun.cr',\n\t'bouncr.com',\n\t'boxformail.in',\n\t'breakthru.com',\n\t'brefmail.com',\n\t'brennendesreich.de',\n\t'broadbandninja.com',\n\t'bsnow.net',\n\t'bspamfree.org',\n\t'bu.mintemail.com',\n\t'buffemail.com',\n\t'bugmenot.com',\n\t'bumpymail.com',\n\t'bund.us',\n\t'bundes-li.ga',\n\t'burnthespam.info',\n\t'burstmail.info',\n\t'buymoreplays.com',\n\t'buyusedlibrarybooks.org',\n\t'byom.de',\n\t'c2.hu',\n\t'cachedot.net',\n\t'card.zp.ua',\n\t'casualdx.com',\n\t'cbair.com',\n\t'cek.pm',\n\t'cellurl.com',\n\t'centermail.com',\n\t'centermail.net',\n\t'chammy.info',\n\t'cheatmail.de',\n\t'childsavetrust.org',\n\t'chogmail.com',\n\t'choicemail1.com',\n\t'chong-mail.com',\n\t'chong-mail.net',\n\t'chong-mail.org',\n\t'clixser.com',\n\t'cmail.com',\n\t'cmail.net',\n\t'cmail.org',\n\t'coldemail.info',\n\t'consumerriot.com',\n\t'cool.fr.nf',\n\t'correo.blogos.net',\n\t'cosmorph.com',\n\t'courriel.fr.nf',\n\t'courrieltemporaire.com',\n\t'crapmail.org',\n\t'crazymailing.com',\n\t'cubiclink.com',\n\t'curryworld.de',\n\t'cust.in',\n\t'cuvox.de',\n\t'd3p.dk',\n\t'dacoolest.com',\n\t'daintly.com',\n\t'dandikmail.com',\n\t'dayrep.com',\n\t'dbunker.com',\n\t'dcemail.com',\n\t'deadaddress.com',\n\t'deadspam.com',\n\t'deagot.com',\n\t'dealja.com',\n\t'delikkt.de',\n\t'despam.it',\n\t'despammed.com',\n\t'devnullmail.com',\n\t'dfgh.net',\n\t'digitalsanctuary.com',\n\t'dingbone.com',\n\t'discard.email',\n\t'discardmail.com',\n\t'discardmail.de',\n\t'disposableaddress.com',\n\t'disposableemailaddresses.com',\n\t'disposableemailaddresses.emailmiser.com',\n\t'disposableinbox.com',\n\t'dispose.it',\n\t'disposeamail.com',\n\t'disposemail.com',\n\t'dispostable.com',\n\t'dlemail.ru',\n\t'dm.w3internet.co.uk',\n\t'dm.w3internet.co.ukexample.com',\n\t'dodgeit.com',\n\t'dodgit.com',\n\t'dodgit.org',\n\t'doiea.com',\n\t'domozmail.com',\n\t'donemail.ru',\n\t'dontreg.com',\n\t'dontsendmespam.de',\n\t'dotmsg.com',\n\t'drdrb.com',\n\t'drdrb.net',\n\t'droplar.com',\n\t'dropmail.me',\n\t'dt.com',\n\t'duam.net',\n\t'dudmail.com',\n\t'dump-email.info',\n\t'dumpandjunk.com',\n\t'dumpmail.de',\n\t'dumpyemail.com',\n\t'duskmail.com',\n\t'e-mail.com',\n\t'e-mail.org',\n\t'e4ward.com',\n\t'easytrashmail.com',\n\t'einmalmail.de',\n\t'einrot.com',\n\t'einrot.de',\n\t'eintagsmail.de',\n\t'email60.com',\n\t'emaildienst.de',\n\t'emailgo.de',\n\t'emailias.com',\n\t'emailigo.de',\n\t'emailinfive.com',\n\t'emaillime.com',\n\t'emailmiser.com',\n\t'emailproxsy.com',\n\t'emailsensei.com',\n\t'emailtemporanea.com',\n\t'emailtemporanea.net',\n\t'emailtemporar.ro',\n\t'emailtemporario.com.br',\n\t'emailthe.net',\n\t'emailtmp.com',\n\t'emailto.de',\n\t'emailwarden.com',\n\t'emailx.at.hm',\n\t'emailxfer.com',\n\t'emeil.in',\n\t'emeil.ir',\n\t'emil.com',\n\t'emz.net',\n\t'enterto.com',\n\t'ephemail.net',\n\t'ero-tube.org',\n\t'etranquil.com',\n\t'etranquil.net',\n\t'etranquil.org',\n\t'evopo.com',\n\t'explodemail.com',\n\t'express.net.ua',\n\t'eyepaste.com',\n\t'fakeinbox.com',\n\t'fakeinformation.com',\n\t'fakemail.fr',\n\t'fakemailz.com',\n\t'fammix.com',\n\t'fansworldwide.de',\n\t'fantasymail.de',\n\t'fastacura.com',\n\t'fastchevy.com',\n\t'fastchrysler.com',\n\t'fastkawasaki.com',\n\t'fastmazda.com',\n\t'fastmitsubishi.com',\n\t'fastnissan.com',\n\t'fastsubaru.com',\n\t'fastsuzuki.com',\n\t'fasttoyota.com',\n\t'fastyamaha.com',\n\t'fatflap.com',\n\t'fdfdsfds.com',\n\t'fightallspam.com',\n\t'figjs.com',\n\t'fiifke.de',\n\t'filzmail.com',\n\t'fivemail.de',\n\t'fixmail.tk',\n\t'fizmail.com',\n\t'fleckens.hu',\n\t'flemail.ru',\n\t'flyspam.com',\n\t'footard.com',\n\t'forgetmail.com',\n\t'fr33mail.info',\n\t'frapmail.com',\n\t'freundin.ru',\n\t'friendlymail.co.uk',\n\t'front14.org',\n\t'fuckingduh.com',\n\t'fudgerub.com',\n\t'fux0ringduh.com',\n\t'fyii.de',\n\t'garliclife.com',\n\t'gehensiemirnichtaufdensack.de',\n\t'gelitik.in',\n\t'get1mail.com',\n\t'get2mail.fr',\n\t'getairmail.com',\n\t'getmails.eu',\n\t'getonemail.com',\n\t'getonemail.net',\n\t'ghosttexter.de',\n\t'giantmail.de',\n\t'girlsundertheinfluence.com',\n\t'gishpuppy.com',\n\t'gmial.com',\n\t'goemailgo.com',\n\t'gorillaswithdirtyarmpits.com',\n\t'gotmail.com',\n\t'gotmail.net',\n\t'gotmail.org',\n\t'gotti.otherinbox.com',\n\t'gowikibooks.com',\n\t'gowikicampus.com',\n\t'gowikicars.com',\n\t'gowikifilms.com',\n\t'gowikigames.com',\n\t'gowikimusic.com',\n\t'gowikimusic.great-host.in',\n\t'gowikinetwork.com',\n\t'gowikitravel.com',\n\t'gowikitv.com',\n\t'grandmamail.com',\n\t'grandmasmail.com',\n\t'great-host.in',\n\t'greensloth.com',\n\t'grr.la',\n\t'gsrv.co.uk',\n\t'guerillamail.biz',\n\t'guerillamail.com',\n\t'guerillamail.net',\n\t'guerillamail.org',\n\t'guerrillamail.biz',\n\t'guerrillamail.com',\n\t'guerrillamail.de',\n\t'guerrillamail.info',\n\t'guerrillamail.net',\n\t'guerrillamail.org',\n\t'guerrillamailblock.com',\n\t'gustr.com',\n\t'h.mintemail.com',\n\t'h8s.org',\n\t'hacccc.com',\n\t'haltospam.com',\n\t'harakirimail.com',\n\t'hartbot.de',\n\t'hat-geld.de',\n\t'hatespam.org',\n\t'hellodream.mobi',\n\t'herp.in',\n\t'hidemail.de',\n\t'hidzz.com',\n\t'hmamail.com',\n\t'hochsitze.com',\n\t'hopemail.biz',\n\t'hotpop.com',\n\t'hulapla.de',\n\t'iaoss.com',\n\t'ieatspam.eu',\n\t'ieatspam.info',\n\t'ieh-mail.de',\n\t'ihateyoualot.info',\n\t'iheartspam.org',\n\t'ikbenspamvrij.nl',\n\t'imails.info',\n\t'imgof.com',\n\t'imstations.com',\n\t'inbax.tk',\n\t'inbox.si',\n\t'inboxalias.com',\n\t'inboxclean.com',\n\t'inboxclean.org',\n\t'inboxproxy.com',\n\t'incognitomail.com',\n\t'incognitomail.net',\n\t'incognitomail.org',\n\t'infocom.zp.ua',\n\t'inoutmail.de',\n\t'inoutmail.eu',\n\t'inoutmail.info',\n\t'inoutmail.net',\n\t'insorg-mail.info',\n\t'instant-mail.de',\n\t'ip6.li',\n\t'ipoo.org',\n\t'irish2me.com',\n\t'iwi.net',\n\t'jamit.com.au',\n\t'jetable.com',\n\t'jetable.fr.nf',\n\t'jetable.net',\n\t'jetable.org',\n\t'jnxjn.com',\n\t'jourrapide.com',\n\t'jsrsolutions.com',\n\t'junk1e.com',\n\t'kasmail.com',\n\t'kaspop.com',\n\t'keepmymail.com',\n\t'killmail.com',\n\t'killmail.net',\n\t'kimsdisk.com',\n\t'kingsq.ga',\n\t'kir.ch.tc',\n\t'klassmaster.com',\n\t'klassmaster.net',\n\t'klzlk.com',\n\t'kook.ml',\n\t'koszmail.pl',\n\t'kulturbetrieb.info',\n\t'kurzepost.de',\n\t'l33r.eu',\n\t'lackmail.net',\n\t'lags.us',\n\t'lawlita.com',\n\t'lazyinbox.com',\n\t'letthemeatspam.com',\n\t'lhsdv.com',\n\t'lifebyfood.com',\n\t'link2mail.net',\n\t'litedrop.com',\n\t'loadby.us',\n\t'login-email.ml',\n\t'lol.ovpn.to',\n\t'lolfreak.net',\n\t'lookugly.com',\n\t'lopl.co.cc',\n\t'lortemail.dk',\n\t'lovemeleaveme.com',\n\t'lr78.com',\n\t'lroid.com',\n\t'lukop.dk',\n\t'm21.cc',\n\t'm4ilweb.info',\n\t'maboard.com',\n\t'mail-filter.com',\n\t'mail-temporaire.fr',\n\t'mail.by',\n\t'mail.mezimages.net',\n\t'mail.zp.ua',\n\t'mail114.net',\n\t'mail1a.de',\n\t'mail21.cc',\n\t'mail2rss.org',\n\t'mail333.com',\n\t'mail4trash.com',\n\t'mailbidon.com',\n\t'mailbiz.biz',\n\t'mailblocks.com',\n\t'mailbucket.org',\n\t'mailcat.biz',\n\t'mailcatch.com',\n\t'mailde.de',\n\t'mailde.info',\n\t'maildrop.cc',\n\t'maildx.com',\n\t'maileater.com',\n\t'mailed.ro',\n\t'maileimer.de',\n\t'mailexpire.com',\n\t'mailfa.tk',\n\t'mailforspam.com',\n\t'mailfreeonline.com',\n\t'mailfs.com',\n\t'mailguard.me',\n\t'mailimate.com',\n\t'mailin8r.com',\n\t'mailinater.com',\n\t'mailinator.com',\n\t'mailinator.net',\n\t'mailinator.org',\n\t'mailinator.us',\n\t'mailinator2.com',\n\t'mailincubator.com',\n\t'mailismagic.com',\n\t'mailmate.com',\n\t'mailme.ir',\n\t'mailme.lv',\n\t'mailme24.com',\n\t'mailmetrash.com',\n\t'mailmetrash.comilzilla.org',\n\t'mailmoat.com',\n\t'mailms.com',\n\t'mailnator.com',\n\t'mailnesia.com',\n\t'mailnull.com',\n\t'mailorg.org',\n\t'mailpick.biz',\n\t'mailproxsy.com',\n\t'mailquack.com',\n\t'mailrock.biz',\n\t'mailscrap.com',\n\t'mailshell.com',\n\t'mailsiphon.com',\n\t'mailslapping.com',\n\t'mailslite.com',\n\t'mailtemp.info',\n\t'mailtome.de',\n\t'mailtothis.com',\n\t'mailtrash.net',\n\t'mailtv.net',\n\t'mailtv.tv',\n\t'mailzilla.com',\n\t'mailzilla.org',\n\t'mailzilla.orgmbx.cc',\n\t'makemetheking.com',\n\t'manifestgenerator.com',\n\t'manybrain.com',\n\t'mbx.cc',\n\t'mega.zik.dj',\n\t'meinspamschutz.de',\n\t'meltmail.com',\n\t'messagebeamer.de',\n\t'mezimages.net',\n\t'mierdamail.com',\n\t'migumail.com',\n\t'ministry-of-silly-walks.de',\n\t'mintemail.com',\n\t'misterpinball.de',\n\t'mjukglass.nu',\n\t'mmailinater.com',\n\t'moakt.com',\n\t'mobi.web.id',\n\t'mobileninja.co.uk',\n\t'moburl.com',\n\t'mohmal.com',\n\t'moncourrier.fr.nf',\n\t'monemail.fr.nf',\n\t'monmail.fr.nf',\n\t'monumentmail.com',\n\t'msa.minsmail.com',\n\t'mt2009.com',\n\t'mt2014.com',\n\t'mx0.wwwnew.eu',\n\t'my10minutemail.com',\n\t'mycard.net.ua',\n\t'mycleaninbox.net',\n\t'myemailboxy.com',\n\t'mymail-in.net',\n\t'mymailoasis.com',\n\t'mynetstore.de',\n\t'mypacks.net',\n\t'mypartyclip.de',\n\t'myphantomemail.com',\n\t'mysamp.de',\n\t'myspaceinc.com',\n\t'myspaceinc.net',\n\t'myspaceinc.org',\n\t'myspacepimpedup.com',\n\t'myspamless.com',\n\t'mytemp.email',\n\t'mytempemail.com',\n\t'mytempmail.com',\n\t'mytrashmail.com',\n\t'nabuma.com',\n\t'neomailbox.com',\n\t'nepwk.com',\n\t'nervmich.net',\n\t'nervtmich.net',\n\t'netmails.com',\n\t'netmails.net',\n\t'netzidiot.de',\n\t'neverbox.com',\n\t'nice-4u.com',\n\t'nincsmail.com',\n\t'nincsmail.hu',\n\t'nnh.com',\n\t'no-spam.ws',\n\t'noblepioneer.com',\n\t'nobulk.com',\n\t'noclickemail.com',\n\t'nogmailspam.info',\n\t'nomail.pw',\n\t'nomail.xl.cx',\n\t'nomail2me.com',\n\t'nomorespamemails.com',\n\t'nonspam.eu',\n\t'nonspammer.de',\n\t'noref.in',\n\t'nospam.ze.tc',\n\t'nospam4.us',\n\t'nospamfor.us',\n\t'nospammail.net',\n\t'nospamthanks.info',\n\t'notmailinator.com',\n\t'notsharingmy.info',\n\t'nowhere.org',\n\t'nowmymail.com',\n\t'nurfuerspam.de',\n\t'nus.edu.sg',\n\t'nwldx.com',\n\t'objectmail.com',\n\t'obobbo.com',\n\t'odaymail.com',\n\t'odnorazovoe.ru',\n\t'one-time.email',\n\t'oneoffemail.com',\n\t'oneoffmail.com',\n\t'onewaymail.com',\n\t'onlatedotcom.info',\n\t'online.ms',\n\t'oopi.org',\n\t'opayq.com',\n\t'ordinaryamerican.net',\n\t'otherinbox.codupmyspace.com',\n\t'otherinbox.com',\n\t'ourklips.com',\n\t'outlawspam.com',\n\t'ovpn.to',\n\t'owlpic.com',\n\t'pancakemail.com',\n\t'paplease.com',\n\t'pcusers.otherinbox.com',\n\t'pepbot.com',\n\t'pfui.ru',\n\t'pimpedupmyspace.com',\n\t'pjjkp.com',\n\t'plexolan.de',\n\t'poczta.onet.pl',\n\t'politikerclub.de',\n\t'pooae.com',\n\t'poofy.org',\n\t'pookmail.com',\n\t'privacy.net',\n\t'privatdemail.net',\n\t'privy-mail.com',\n\t'privymail.de',\n\t'proxymail.eu',\n\t'prtnx.com',\n\t'prtz.eu',\n\t'punkass.com',\n\t'putthisinyourspamdatabase.com',\n\t'pwrby.com',\n\t'quickinbox.com',\n\t'quickmail.nl',\n\t'rcpt.at',\n\t'reallymymail.com',\n\t'realtyalerts.ca',\n\t'recode.me',\n\t'recursor.net',\n\t'recyclemail.dk',\n\t'regbypass.com',\n\t'regbypass.comsafe-mail.net',\n\t'rejectmail.com',\n\t'reliable-mail.com',\n\t'rhyta.com',\n\t'rklips.com',\n\t'rmqkr.net',\n\t'royal.net',\n\t'rppkn.com',\n\t'rtrtr.com',\n\t's0ny.net',\n\t'safe-mail.net',\n\t'safersignup.de',\n\t'safetymail.info',\n\t'safetypost.de',\n\t'sandelf.de',\n\t'saynotospams.com',\n\t'schafmail.de',\n\t'schrott-email.de',\n\t'secretemail.de',\n\t'secure-mail.biz',\n\t'selfdestructingmail.com',\n\t'selfdestructingmail.org',\n\t'sendspamhere.com',\n\t'sendspamhere.com',\n\t'senseless-entertainment.com',\n\t'services391.com',\n\t'sharedmailbox.org',\n\t'sharklasers.com',\n\t'shieldedmail.com',\n\t'shieldemail.com',\n\t'shiftmail.com',\n\t'shitmail.me',\n\t'shitmail.org',\n\t'shitware.nl',\n\t'shmeriously.com',\n\t'shortmail.net',\n\t'shotmail.ru',\n\t'showslow.de',\n\t'sibmail.com',\n\t'sinnlos-mail.de',\n\t'siteposter.net',\n\t'skeefmail.com',\n\t'slapsfromlastnight.com',\n\t'slaskpost.se',\n\t'slipry.net',\n\t'slopsbox.com',\n\t'slushmail.com',\n\t'smashmail.de',\n\t'smellfear.com',\n\t'smellrear.com',\n\t'snakemail.com',\n\t'sneakemail.com',\n\t'sneakmail.de',\n\t'snkmail.com',\n\t'sofimail.com',\n\t'sofort-mail.de',\n\t'softpls.asia',\n\t'sogetthis.com',\n\t'sohu.com',\n\t'solvemail.info',\n\t'soodonims.com',\n\t'spa.com',\n\t'spaereplease.com',\n\t'spam.la',\n\t'spam.su',\n\t'spam4.me',\n\t'spamail.de',\n\t'spamarrest.com',\n\t'spamavert.com',\n\t'spambob.com',\n\t'spambob.net',\n\t'spambob.org',\n\t'spambog.com',\n\t'spambog.de',\n\t'spambog.net',\n\t'spambog.ru',\n\t'spambox.info',\n\t'spambox.irishspringrealty.com',\n\t'spambox.us',\n\t'spamcannon.com',\n\t'spamcannon.net',\n\t'spamcero.com',\n\t'spamcon.org',\n\t'spamcorptastic.com',\n\t'spamcowboy.com',\n\t'spamcowboy.net',\n\t'spamcowboy.org',\n\t'spamday.com',\n\t'spamex.com',\n\t'spamfree.eu',\n\t'spamfree24.com',\n\t'spamfree24.de',\n\t'spamfree24.eu',\n\t'spamfree24.info',\n\t'spamfree24.net',\n\t'spamfree24.org',\n\t'spamgoes.in',\n\t'spamgourmet.com',\n\t'spamgourmet.net',\n\t'spamgourmet.org',\n\t'spamherelots.com',\n\t'spamhereplease.com',\n\t'spamhole.com',\n\t'spamify.com',\n\t'spaminator.de',\n\t'spamkill.info',\n\t'spaml.com',\n\t'spaml.de',\n\t'spammotel.com',\n\t'spamobox.com',\n\t'spamoff.de',\n\t'spamsalad.in',\n\t'spamslicer.com',\n\t'spamspot.com',\n\t'spamstack.net',\n\t'spamthis.co.uk',\n\t'spamthisplease.com',\n\t'spamtrail.com',\n\t'spamtroll.net',\n\t'speed.1s.fr',\n\t'spikio.com',\n\t'spoofmail.de',\n\t'squizzy.de',\n\t'ssoia.com',\n\t'startkeys.com',\n\t'stinkefinger.net',\n\t'stop-my-spam.com',\n\t'stuffmail.de',\n\t'super-auswahl.de',\n\t'supergreatmail.com',\n\t'supermailer.jp',\n\t'superrito.com',\n\t'superstachel.de',\n\t'suremail.info',\n\t'svk.jp',\n\t'sweetxxx.de',\n\t'tagyourself.com',\n\t'talkinator.com',\n\t'tapchicuoihoi.com',\n\t'teewars.org',\n\t'teleosaurs.xyz',\n\t'teleworm.com',\n\t'teleworm.us',\n\t'temp-mail.org',\n\t'temp-mail.ru',\n\t'temp.emeraldwebmail.com',\n\t'temp.headstrong.de',\n\t'tempalias.com',\n\t'tempe-mail.com',\n\t'tempemail.biz',\n\t'tempemail.co.za',\n\t'tempemail.com',\n\t'tempemail.net',\n\t'tempemail.net',\n\t'tempinbox.co.uk',\n\t'tempinbox.com',\n\t'tempmail.eu',\n\t'tempmail.it',\n\t'tempmail2.com',\n\t'tempmaildemo.com',\n\t'tempmailer.com',\n\t'tempmailer.de',\n\t'tempomail.fr',\n\t'temporarily.de',\n\t'temporarioemail.com.br',\n\t'temporaryemail.net',\n\t'temporaryemail.us',\n\t'temporaryforwarding.com',\n\t'temporaryinbox.com',\n\t'temporarymailaddress.com',\n\t'tempsky.com',\n\t'tempthe.net',\n\t'tempymail.com',\n\t'thanksnospam.info',\n\t'thankyou2010.com',\n\t'thc.st',\n\t'thecloudindex.com',\n\t'thelimestones.com',\n\t'thisisnotmyrealemail.com',\n\t'thismail.net',\n\t'thrma.com',\n\t'throwawayemailaddress.com',\n\t'tilien.com',\n\t'tittbit.in',\n\t'tizi.com',\n\t'tmail.ws',\n\t'tmailinator.com',\n\t'toiea.com',\n\t'toomail.biz',\n\t'topranklist.de',\n\t'tradermail.info',\n\t'trash-amil.com',\n\t'trash-mail.at',\n\t'trash-mail.com',\n\t'trash-mail.de',\n\t'trash2009.com',\n\t'trash2010.com',\n\t'trash2011.com',\n\t'trashdevil.com',\n\t'trashdevil.de',\n\t'trashemail.de',\n\t'trashmail.at',\n\t'trashmail.com',\n\t'trashmail.de',\n\t'trashmail.me',\n\t'trashmail.net',\n\t'trashmail.org',\n\t'trashmail.ws',\n\t'trashmailer.com',\n\t'trashymail.com',\n\t'trashymail.net',\n\t'trbvm.com',\n\t'trbvn.com',\n\t'trialmail.de',\n\t'trillianpro.com',\n\t'tryalert.com',\n\t'turual.com',\n\t'twinmail.de',\n\t'twoweirdtricks.com',\n\t'tyldd.com',\n\t'uggsrock.com',\n\t'umail.net',\n\t'upliftnow.com',\n\t'uplipht.com',\n\t'uroid.com',\n\t'us.af',\n\t'username.e4ward.com',\n\t'venompen.com',\n\t'veryrealemail.com',\n\t'vidchart.com',\n\t'viditag.com',\n\t'viewcastmedia.com',\n\t'viewcastmedia.net',\n\t'viewcastmedia.org',\n\t'viewcastmediae',\n\t'viralplays.com',\n\t'vkcode.ru',\n\t'vomoto.com',\n\t'vpn.st',\n\t'vsimcard.com',\n\t'vubby.com',\n\t'walala.org',\n\t'walkmail.net',\n\t'walkmail.ru',\n\t'wasteland.rfc822.org',\n\t'webemail.me',\n\t'webm4il.info',\n\t'webuser.in',\n\t'wee.my',\n\t'weg-werf-email.de',\n\t'wegwerf-email-addressen.de',\n\t'wegwerf-emails.de',\n\t'wegwerfadresse.de',\n\t'wegwerfemail.com',\n\t'wegwerfemail.de',\n\t'wegwerfmail.de',\n\t'wegwerfmail.info',\n\t'wegwerfmail.net',\n\t'wegwerfmail.org',\n\t'wetrainbayarea.com',\n\t'wetrainbayarea.org',\n\t'wh4f.org',\n\t'whatiaas.com',\n\t'whatpaas.com',\n\t'whatsaas.com',\n\t'whopy.com',\n\t'whtjddn.33mail.com',\n\t'whyspam.me',\n\t'wilemail.com',\n\t'willhackforfood.biz',\n\t'willselfdestruct.com',\n\t'winemaven.info',\n\t'wronghead.com',\n\t'wuzup.net',\n\t'wuzupmail.net',\n\t'www.e4ward.com',\n\t'www.gishpuppy.com',\n\t'www.mailinator.com',\n\t'wwwnew.eu',\n\t'x.ip6.li',\n\t'xagloo.com',\n\t'xemaps.com',\n\t'xents.com',\n\t'xmaily.com',\n\t'xoxy.net',\n\t'xyzfree.net',\n\t'yapped.net',\n\t'yeah.net',\n\t'yep.it',\n\t'yogamaven.com',\n\t'yomail.info',\n\t'yopmail.com',\n\t'yopmail.fr',\n\t'yopmail.net',\n\t'yourdomain.com',\n\t'ypmail.webarnak.fr.eu.org',\n\t'yuurok.com',\n\t'z1p.biz',\n\t'za.com',\n\t'zehnminuten.de',\n\t'zehnminutenmail.de',\n\t'zetmail.com',\n\t'zippymail.info',\n\t'zoaxe.com',\n\t'zoemail.com',\n\t'zoemail.net',\n\t'zoemail.org',\n\t'zomg.info',\n\t'zxcv.com',\n\t'zxcvbnm.com',\n\t'zzz.com'\n];\n\n","import IMAP from 'imap';\nimport POP3 from 'poplib';\nimport { simpleParser } from 'mailparser';\n\nexport class IMAPIntercepter {\n\tconstructor() {\n\t\tthis.imap = new IMAP({\n\t\t\tuser: RocketChat.settings.get('Direct_Reply_Username'),\n\t\t\tpassword: RocketChat.settings.get('Direct_Reply_Password'),\n\t\t\thost: RocketChat.settings.get('Direct_Reply_Host'),\n\t\t\tport: RocketChat.settings.get('Direct_Reply_Port'),\n\t\t\tdebug: RocketChat.settings.get('Direct_Reply_Debug') ? console.log : false,\n\t\t\ttls: !RocketChat.settings.get('Direct_Reply_IgnoreTLS'),\n\t\t\tconnTimeout: 30000,\n\t\t\tkeepalive: true\n\t\t});\n\n\t\tthis.delete = RocketChat.settings.get('Direct_Reply_Delete') ? RocketChat.settings.get('Direct_Reply_Delete') : true;\n\n\t\t// On successfully connected.\n\t\tthis.imap.on('ready', Meteor.bindEnvironment(() => {\n\t\t\tif (this.imap.state !== 'disconnected') {\n\t\t\t\tthis.openInbox(Meteor.bindEnvironment((err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\t\t\t\t\t// fetch new emails & wait [IDLE]\n\t\t\t\t\tthis.getEmails();\n\n\t\t\t\t\t// If new message arrived, fetch them\n\t\t\t\t\tthis.imap.on('mail', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\tthis.getEmails();\n\t\t\t\t\t}));\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconsole.log('IMAP didnot connected.');\n\t\t\t\tthis.imap.end();\n\t\t\t}\n\t\t}));\n\n\t\tthis.imap.on('error', (err) => {\n\t\t\tconsole.log('Error occurred ...');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\topenInbox(cb) {\n\t\tthis.imap.openBox('INBOX', false, cb);\n\t}\n\n\tstart() {\n\t\tthis.imap.connect();\n\t}\n\n\tisActive() {\n\t\tif (this.imap && this.imap.state && this.imap.state === 'disconnected') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tstop(callback = new Function) {\n\t\tthis.imap.end();\n\t\tthis.imap.once('end', callback);\n\t}\n\n\trestart() {\n\t\tthis.stop(() => {\n\t\t\tconsole.log('Restarting IMAP ....');\n\t\t\tthis.start();\n\t\t});\n\t}\n\n\t// Fetch all UNSEEN messages and pass them for further processing\n\tgetEmails() {\n\t\tthis.imap.search(['UNSEEN'], Meteor.bindEnvironment((err, newEmails) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\t// newEmails => array containing serials of unseen messages\n\t\t\tif (newEmails.length > 0) {\n\t\t\t\tconst f = this.imap.fetch(newEmails, {\n\t\t\t\t\t// fetch headers & first body part.\n\t\t\t\t\tbodies: ['HEADER.FIELDS (FROM TO DATE MESSAGE-ID)', '1'],\n\t\t\t\t\tstruct: true,\n\t\t\t\t\tmarkSeen: true\n\t\t\t\t});\n\n\t\t\t\tf.on('message', Meteor.bindEnvironment((msg, seqno) => {\n\t\t\t\t\tconst email = {};\n\n\t\t\t\t\tmsg.on('body', (stream, info) => {\n\t\t\t\t\t\tlet headerBuffer = '';\n\t\t\t\t\t\tlet bodyBuffer = '';\n\n\t\t\t\t\t\tstream.on('data', (chunk) => {\n\t\t\t\t\t\t\tif (info.which === '1') {\n\t\t\t\t\t\t\t\tbodyBuffer += chunk.toString('utf8');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\theaderBuffer += chunk.toString('utf8');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tstream.once('end', () => {\n\t\t\t\t\t\t\tif (info.which === '1') {\n\t\t\t\t\t\t\t\temail.body = bodyBuffer;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// parse headers\n\t\t\t\t\t\t\t\temail.headers = IMAP.parseHeader(headerBuffer);\n\n\t\t\t\t\t\t\t\temail.headers.to = email.headers.to[0];\n\t\t\t\t\t\t\t\temail.headers.date = email.headers.date[0];\n\t\t\t\t\t\t\t\temail.headers.from = email.headers.from[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// On fetched each message, pass it further\n\t\t\t\t\tmsg.once('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\t// delete message from inbox\n\t\t\t\t\t\tif (this.delete) {\n\t\t\t\t\t\t\tthis.imap.seq.addFlags(seqno, 'Deleted', (err) => {\n\t\t\t\t\t\t\t\tif (err) { console.log(`Mark deleted error: ${ err }`); }\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tRocketChat.processDirectEmail(email);\n\t\t\t\t\t}));\n\t\t\t\t}));\n\t\t\t\tf.once('error', (err) => {\n\t\t\t\t\tconsole.log(`Fetch error: ${ err }`);\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t}\n}\n\nexport class POP3Intercepter {\n\tconstructor() {\n\t\tthis.pop3 = new POP3(RocketChat.settings.get('Direct_Reply_Port'), RocketChat.settings.get('Direct_Reply_Host'), {\n\t\t\tenabletls: !RocketChat.settings.get('Direct_Reply_IgnoreTLS'),\n\t\t\tdebug: RocketChat.settings.get('Direct_Reply_Debug') ? console.log : false\n\t\t});\n\n\t\tthis.totalMsgCount = 0;\n\t\tthis.currentMsgCount = 0;\n\n\t\tthis.pop3.on('connect', Meteor.bindEnvironment(() => {\n\t\t\tthis.pop3.login(RocketChat.settings.get('Direct_Reply_Username'), RocketChat.settings.get('Direct_Reply_Password'));\n\t\t}));\n\n\t\tthis.pop3.on('login', Meteor.bindEnvironment((status) => {\n\t\t\tif (status) {\n\t\t\t\t// run on start\n\t\t\t\tthis.pop3.list();\n\t\t\t} else {\n\t\t\t\tconsole.log('Unable to Log-in ....');\n\t\t\t}\n\t\t}));\n\n\t\t// on getting list of all emails\n\t\tthis.pop3.on('list', Meteor.bindEnvironment((status, msgcount) => {\n\t\t\tif (status) {\n\t\t\t\tif (msgcount > 0) {\n\t\t\t\t\tthis.totalMsgCount = msgcount;\n\t\t\t\t\tthis.currentMsgCount = 1;\n\t\t\t\t\t// Retrieve email\n\t\t\t\t\tthis.pop3.retr(this.currentMsgCount);\n\t\t\t\t} else {\n\t\t\t\t\tthis.pop3.quit();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('Cannot Get Emails ....');\n\t\t\t}\n\t\t}));\n\n\t\t// on retrieved email\n\t\tthis.pop3.on('retr', Meteor.bindEnvironment((status, msgnumber, data) => {\n\t\t\tif (status) {\n\t\t\t\t// parse raw email data to  JSON object\n\t\t\t\tsimpleParser(data, Meteor.bindEnvironment((err, mail) => {\n\t\t\t\t\tthis.initialProcess(mail);\n\t\t\t\t}));\n\n\t\t\t\tthis.currentMsgCount += 1;\n\n\t\t\t\t// delete email\n\t\t\t\tthis.pop3.dele(msgnumber);\n\t\t\t} else {\n\t\t\t\tconsole.log('Cannot Retrieve Message ....');\n\t\t\t}\n\t\t}));\n\n\t\t// on email deleted\n\t\tthis.pop3.on('dele', Meteor.bindEnvironment((status) => {\n\t\t\tif (status) {\n\t\t\t\t// get next email\n\t\t\t\tif (this.currentMsgCount <= this.totalMsgCount) {\n\t\t\t\t\tthis.pop3.retr(this.currentMsgCount);\n\t\t\t\t} else {\n\t\t\t\t\t// parsed all messages.. so quitting\n\t\t\t\t\tthis.pop3.quit();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('Cannot Delete Message....');\n\t\t\t}\n\t\t}));\n\n\t\t// invalid server state\n\t\tthis.pop3.on('invalid-state', function(cmd) {\n\t\t\tconsole.log(`Invalid state. You tried calling ${ cmd }`);\n\t\t});\n\n\t\t// locked => command already running, not finished yet\n\t\tthis.pop3.on('locked', function(cmd) {\n\t\t\tconsole.log(`Current command has not finished yet. You tried calling ${ cmd }`);\n\t\t});\n\t}\n\n\tinitialProcess(mail) {\n\t\tconst email = {\n\t\t\theaders: {\n\t\t\t\tfrom: mail.from.text,\n\t\t\t\tto: mail.to.text,\n\t\t\t\tdate: mail.date,\n\t\t\t\t'message-id': mail.messageId\n\t\t\t},\n\t\t\tbody: mail.text\n\t\t};\n\n\t\tRocketChat.processDirectEmail(email);\n\t}\n}\n\nexport class POP3Helper {\n\tconstructor() {\n\t\tthis.running = false;\n\t}\n\n\tstart() {\n\t\t// run every x-minutes\n\t\tif (RocketChat.settings.get('Direct_Reply_Frequency')) {\n\t\t\tRocketChat.POP3 = new POP3Intercepter();\n\n\t\t\tthis.running = Meteor.setInterval(() => {\n\t\t\t\t// get new emails and process\n\t\t\t\tRocketChat.POP3 = new POP3Intercepter();\n\t\t\t}, Math.max(RocketChat.settings.get('Direct_Reply_Frequency')*60*1000, 2*60*1000));\n\t\t}\n\t}\n\n\tisActive() {\n\t\treturn this.running;\n\t}\n\n\tstop(callback = new Function) {\n\t\tif (this.isActive()) {\n\t\t\tMeteor.clearInterval(this.running);\n\t\t}\n\t\tcallback();\n\t}\n}\n","// Do not disclose if user exists when password is invalid\nconst _runLoginHandlers = Accounts._runLoginHandlers;\nAccounts._runLoginHandlers = function(methodInvocation, options) {\n\tconst result = _runLoginHandlers.call(Accounts, methodInvocation, options);\n\n\tif (result.error && result.error.reason === 'Incorrect password') {\n\t\tresult.error = new Meteor.Error(403, 'User not found');\n\t}\n\n\treturn result;\n};\n","import _ from 'underscore';\nimport s from 'underscore.string';\nimport moment from 'moment';\n\nRocketChat.callbacks.add('afterSaveMessage', function(message, room) {\n\t// skips this callback if the message was edited and increments it if the edit was way in the past (aka imported)\n\tif (message.editedAt && Math.abs(moment(message.editedAt).diff()) > 60000) {\n\t\t//TODO: Review as I am not sure how else to get around this as the incrementing of the msgs count shouldn't be in this callback\n\t\tRocketChat.models.Rooms.incMsgCountById(message.rid, 1);\n\t\treturn message;\n\t} else if (message.editedAt) {\n\n\t\t// only updates last message if it was edited (skip rest of callback)\n\t\tif (RocketChat.settings.get('Store_Last_Message') && (!room.lastMessage || room.lastMessage._id === message._id)) {\n\t\t\tRocketChat.models.Rooms.setLastMessageById(message.rid, message);\n\t\t}\n\t\treturn message;\n\t}\n\n\tif (message.ts && Math.abs(moment(message.ts).diff()) > 60000) {\n\t\tRocketChat.models.Rooms.incMsgCountById(message.rid, 1);\n\t\treturn message;\n\t}\n\n\t/**\n\t * Chechs if a messages contains a user highlight\n\t *\n\t * @param {string} message\n\t * @param {array|undefined} highlights\n\t *\n\t * @returns {boolean}\n     */\n\tfunction messageContainsHighlight(message, highlights) {\n\t\tif (! highlights || highlights.length === 0) { return false; }\n\n\t\tlet has = false;\n\t\thighlights.some(function(highlight) {\n\t\t\tconst regexp = new RegExp(s.escapeRegExp(highlight), 'i');\n\t\t\tif (regexp.test(message.msg)) {\n\t\t\t\thas = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\n\t\treturn has;\n\t}\n\n\tif (room != null) {\n\t\tlet toAll = false;\n\t\tlet toHere = false;\n\t\tconst mentionIds = [];\n\t\tconst highlightsIds = [];\n\t\tconst highlights = RocketChat.models.Users.findUsersByUsernamesWithHighlights(room.usernames, { fields: { '_id': 1, 'settings.preferences.highlights': 1 }}).fetch();\n\n\t\tif (message.mentions != null) {\n\t\t\tmessage.mentions.forEach(function(mention) {\n\t\t\t\tif (!toAll && mention._id === 'all') {\n\t\t\t\t\ttoAll = true;\n\t\t\t\t}\n\t\t\t\tif (!toHere && mention._id === 'here') {\n\t\t\t\t\ttoHere = true;\n\t\t\t\t}\n\t\t\t\tif (mention._id !== message.u._id) {\n\t\t\t\t\tmentionIds.push(mention._id);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\thighlights.forEach(function(user) {\n\t\t\tconst userHighlights = RocketChat.getUserPreference(user, 'highlights');\n\t\t\tif (userHighlights && messageContainsHighlight(message, userHighlights)) {\n\t\t\t\tif (user._id !== message.u._id) {\n\t\t\t\t\thighlightsIds.push(user._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (room.t === 'd') {\n\t\t\tconst unreadCountDM = RocketChat.settings.get('Unread_Count_DM');\n\n\t\t\tif (unreadCountDM === 'all_messages') {\n\t\t\t\tRocketChat.models.Subscriptions.incUnreadForRoomIdExcludingUserId(room._id, message.u._id);\n\t\t\t} else if (toAll || toHere) {\n\t\t\t\tRocketChat.models.Subscriptions.incGroupMentionsAndUnreadForRoomIdExcludingUserId(room._id, message.u._id, 1, 1);\n\t\t\t} else if ((mentionIds && mentionIds.length > 0) || (highlightsIds && highlightsIds.length > 0)) {\n\t\t\t\tRocketChat.models.Subscriptions.incUserMentionsAndUnreadForRoomIdAndUserIds(room._id, _.compact(_.unique(mentionIds.concat(highlightsIds))), 1, 1);\n\t\t\t}\n\t\t} else {\n\t\t\tconst unreadCount = RocketChat.settings.get('Unread_Count');\n\n\t\t\tif (toAll || toHere) {\n\t\t\t\tlet incUnread = 0;\n\t\t\t\tif (['all_messages', 'group_mentions_only', 'user_and_group_mentions_only'].includes(unreadCount)) {\n\t\t\t\t\tincUnread = 1;\n\t\t\t\t}\n\t\t\t\tRocketChat.models.Subscriptions.incGroupMentionsAndUnreadForRoomIdExcludingUserId(room._id, message.u._id, 1, incUnread);\n\t\t\t} else if ((mentionIds && mentionIds.length > 0) || (highlightsIds && highlightsIds.length > 0)) {\n\t\t\t\tlet incUnread = 0;\n\t\t\t\tif (['all_messages', 'user_mentions_only', 'user_and_group_mentions_only'].includes(unreadCount)) {\n\t\t\t\t\tincUnread = 1;\n\t\t\t\t}\n\t\t\t\tRocketChat.models.Subscriptions.incUserMentionsAndUnreadForRoomIdAndUserIds(room._id, _.compact(_.unique(mentionIds.concat(highlightsIds))), 1, incUnread);\n\t\t\t} else if (unreadCount === 'all_messages') {\n\t\t\t\tRocketChat.models.Subscriptions.incUnreadForRoomIdExcludingUserId(room._id, message.u._id);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Update all the room activity tracker fields\n\tRocketChat.models.Rooms.incMsgCountAndSetLastMessageById(message.rid, 1, message.ts, RocketChat.settings.get('Store_Last_Message') && message);\n\n\t// Update all other subscriptions to alert their owners but witout incrementing\n\t// the unread counter, as it is only for mentions and direct messages\n\tRocketChat.models.Subscriptions.setAlertForRoomIdExcludingUserId(message.rid, message.u._id);\n\n\treturn message;\n\n}, RocketChat.callbacks.priority.LOW, 'notifyUsersOnMessage');\n","import {EmailReplyParser as reply} from 'emailreplyparser';\nimport moment from 'moment';\n\nRocketChat.processDirectEmail = function(email) {\n\tfunction sendMessage(email) {\n\t\tconst message = {\n\t\t\tts: new Date(email.headers.date),\n\t\t\tmsg: email.body,\n\t\t\tsentByEmail: true,\n\t\t\tgroupable: false\n\t\t};\n\n\t\tif (message.ts) {\n\t\t\tconst tsDiff = Math.abs(moment(message.ts).diff());\n\t\t\tif (tsDiff > 10000) {\n\t\t\t\tmessage.ts = new Date();\n\t\t\t}\n\t\t} else {\n\t\t\tmessage.ts = new Date();\n\t\t}\n\n\t\tif (message.msg && message.msg.length > RocketChat.settings.get('Message_MaxAllowedSize')) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// reduce new lines in multiline message\n\t\tmessage.msg = message.msg.split('\\n\\n').join('\\n');\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email.headers.from, {\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1\n\t\t\t}\n\t\t});\n\t\tif (!user) {\n\t\t\t// user not found\n\t\t\treturn false;\n\t\t}\n\n\t\tconst prevMessage = RocketChat.models.Messages.findOneById(email.headers.mid, {\n\t\t\trid: 1,\n\t\t\tu: 1\n\t\t});\n\t\tif (!prevMessage) {\n\t\t\t// message doesn't exist anymore\n\t\t\treturn false;\n\t\t}\n\t\tmessage.rid = prevMessage.rid;\n\n\t\tconst room = Meteor.call('canAccessRoom', message.rid, user._id);\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst roomInfo = RocketChat.models.Rooms.findOneById(message.rid, {\n\t\t\tt: 1,\n\t\t\tname: 1\n\t\t});\n\n\t\t// check mention\n\t\tif (message.msg.indexOf(`@${ prevMessage.u.username }`) === -1 && roomInfo.t !== 'd') {\n\t\t\tmessage.msg = `@${ prevMessage.u.username } ${ message.msg }`;\n\t\t}\n\n\t\t// reply message link\n\t\tlet prevMessageLink = `[ ](${ Meteor.absoluteUrl().replace(/\\/$/, '') }`;\n\t\tif (roomInfo.t === 'c') {\n\t\t\tprevMessageLink += `/channel/${ roomInfo.name }?msg=${ email.headers.mid }) `;\n\t\t} else if (roomInfo.t === 'd') {\n\t\t\tprevMessageLink += `/direct/${ prevMessage.u.username }?msg=${ email.headers.mid }) `;\n\t\t} else if (roomInfo.t === 'p') {\n\t\t\tprevMessageLink += `/group/${ roomInfo.name }?msg=${ email.headers.mid }) `;\n\t\t}\n\t\t// add reply message link\n\t\tmessage.msg = prevMessageLink + message.msg;\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(message.rid, user._id);\n\t\tif (subscription && subscription.blocked || subscription.blocker) {\n\t\t\t// room is blocked\n\t\t\treturn false;\n\t\t}\n\n\t\tif ((room.muted || []).includes(user.username)) {\n\t\t\t// room is muted\n\t\t\treturn false;\n\t\t}\n\n\t\tif (message.alias == null && RocketChat.settings.get('Message_SetNameToAliasEnabled')) {\n\t\t\tmessage.alias = user.name;\n\t\t}\n\n\t\tRocketChat.metrics.messagesSent.inc(); // TODO This line needs to be moved to it's proper place. See the comments on: https://github.com/RocketChat/Rocket.Chat/pull/5736\n\n\t\treturn RocketChat.sendMessage(user, message, room);\n\t}\n\n\t// Extract/parse reply from email body\n\temail.body = reply.parse_reply(email.body);\n\n\t// if 'To' email format is \"Name <username@domain>\"\n\tif (email.headers.to.indexOf('<') >= 0 && email.headers.to.indexOf('>') >= 0) {\n\t\temail.headers.to = email.headers.to.split('<')[1].split('>')[0];\n\t}\n\n\t// if 'From' email format is \"Name <username@domain>\"\n\tif (email.headers.from.indexOf('<') >= 0 && email.headers.from.indexOf('>') >= 0) {\n\t\temail.headers.from = email.headers.from.split('<')[1].split('>')[0];\n\t}\n\n\t// 'To' email format \"username+messageId@domain\"\n\tif (email.headers.to.indexOf('+') >= 0) {\n\t\t// Valid 'To' format\n\t\temail.headers.mid = email.headers.to.split('@')[0].split('+')[1];\n\t\tsendMessage(email);\n\t} else {\n\t\tconsole.log('Invalid Email....If not. Please report it.');\n\t}\n};\n","import { RoomTypesCommon } from '../../lib/RoomTypesCommon';\n\nRocketChat.roomTypes = new class roomTypesServer extends RoomTypesCommon {\n\t/**\n\t * Add a publish for a room type\n\t *\n\t * @param {string} roomType room type (e.g.: c (for channels), d (for direct channels))\n\t * @param {function} callback function that will return the publish's data\n\t*/\n\tsetPublish(roomType, callback) {\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].publish != null) {\n\t\t\tthrow new Meteor.Error('route-publish-exists', 'Publish for the given type already exists');\n\t\t}\n\t\tif (this.roomTypes[roomType] == null) {\n\t\t\tthis.roomTypes[roomType] = {};\n\t\t}\n\t\treturn this.roomTypes[roomType].publish = callback;\n\t}\n\n\tsetRoomFind(roomType, callback) {\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].roomFind != null) {\n\t\t\tthrow new Meteor.Error('room-find-exists', 'Room find for the given type already exists');\n\t\t}\n\t\tif (this.roomTypes[roomType] == null) {\n\t\t\tthis.roomTypes[roomType] = {};\n\t\t}\n\t\treturn this.roomTypes[roomType].roomFind = callback;\n\t}\n\n\tgetRoomFind(roomType) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].roomFind;\n\t}\n\n\n\t/**\n\t * Run the publish for a room type\n\t *\n\t * @param scope Meteor publish scope\n\t * @param {string} roomType room type (e.g.: c (for channels), d (for direct channels))\n\t * @param identifier identifier of the room\n\t*/\n\trunPublish(scope, roomType, identifier) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].publish && this.roomTypes[roomType].publish.call(scope, identifier);\n\t}\n\n};\n","import moment from 'moment';\nimport s from 'underscore.string';\n\nfunction getEmailContent({ messageContent, message, user, room }) {\n\tconst lng = user && user.language || RocketChat.settings.get('language') || 'en';\n\n\tconst roomName = `#${ RocketChat.settings.get('UI_Allow_room_names_with_special_chars') ? room.fname || room.name : room.name }`;\n\n\tconst userName = RocketChat.settings.get('UI_Use_Real_Name') ? message.u.name || message.u.username : message.u.username;\n\n\tconst header = TAPi18n.__(room.t === 'd' ? 'User_sent_a_message_to_you' : 'User_sent_a_message_on_channel', {\n\t\tusername: userName,\n\t\tchannel: roomName,\n\t\tlng\n\t});\n\n\tif (messageContent) {\n\t\treturn `${ header }<br/><br/>${ messageContent }`;\n\t}\n\n\tif (message.file) {\n\t\tconst fileHeader = TAPi18n.__(room.t === 'd' ? 'User_uploaded_a_file_to_you' : 'User_uploaded_a_file_on_channel', {\n\t\t\tusername: userName,\n\t\t\tchannel: roomName,\n\t\t\tlng\n\t\t});\n\n\t\tlet content = `${ TAPi18n.__('Attachment_File_Uploaded') }: ${ message.file.name }`;\n\n\t\tif (message.attachments && message.attachments.length === 1 && message.attachments[0].description !== '') {\n\t\t\tcontent += `<br/><br/>${ message.attachments[0].description }`;\n\t\t}\n\n\t\treturn `${ fileHeader }<br/><br/>${ content }`;\n\t}\n\n\tif (message.attachments.length > 0) {\n\t\tconst [ attachment ] = message.attachments;\n\n\t\tlet content = '';\n\n\t\tif (attachment.title) {\n\t\t\tcontent += `${ attachment.title }<br/>`;\n\t\t}\n\t\tif (attachment.text) {\n\t\t\tcontent += `${ attachment.text }<br/>`;\n\t\t}\n\n\t\treturn `${ header }<br/><br/>${ content }`;\n\t}\n\n\treturn header;\n}\n\nRocketChat.callbacks.add('afterSaveMessage', function(message, room) {\n\t// skips this callback if the message was edited\n\tif (message.editedAt) {\n\t\treturn message;\n\t}\n\n\tif (message.ts && Math.abs(moment(message.ts).diff()) > 60000) {\n\t\treturn message;\n\t}\n\n\tconst getMessageLink = (room, sub) => {\n\t\tconst roomPath = RocketChat.roomTypes.getRouteLink(room.t, sub);\n\t\tconst path = Meteor.absoluteUrl(roomPath ? roomPath.replace(/^\\//, '') : '');\n\t\tconst style = [\n\t\t\t'color: #fff;',\n\t\t\t'padding: 9px 12px;',\n\t\t\t'border-radius: 4px;',\n\t\t\t'background-color: #04436a;',\n\t\t\t'text-decoration: none;'\n\t\t].join(' ');\n\t\tconst message = TAPi18n.__('Offline_Link_Message');\n\t\treturn `<p style=\"text-align:center;margin-bottom:8px;\"><a style=\"${ style }\" href=\"${ path }\">${ message }</a>`;\n\t};\n\n\tconst divisorMessage = '<hr style=\"margin: 20px auto; border: none; border-bottom: 1px solid #dddddd;\">';\n\n\tlet messageHTML;\n\n\tif (message.msg !== '') {\n\t\tmessageHTML = s.escapeHTML(message.msg);\n\t\tmessage = RocketChat.callbacks.run('renderMessage', message);\n\t\tif (message.tokens && message.tokens.length > 0) {\n\t\t\tmessage.tokens.forEach((token) => {\n\t\t\t\ttoken.text = token.text.replace(/([^\\$])(\\$[^\\$])/gm, '$1$$$2');\n\t\t\t\tmessageHTML = messageHTML.replace(token.token, token.text);\n\t\t\t});\n\t\t}\n\t\tmessageHTML = messageHTML.replace(/\\n/gm, '<br/>');\n\t}\n\n\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\tlet footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\tconst usersToSendEmail = {};\n\tif (room.t === 'd') {\n\t\tusersToSendEmail[message.rid.replace(message.u._id, '')] = 'direct';\n\t} else {\n\t\tlet isMentionAll = message.mentions.find(mention => mention._id === 'all');\n\n\t\tif (isMentionAll) {\n\t\t\tconst maxMembersForNotification = RocketChat.settings.get('Notifications_Max_Room_Members');\n\t\t\tif (maxMembersForNotification !== 0 && room.usernames.length > maxMembersForNotification) {\n\t\t\t\tisMentionAll = undefined;\n\t\t\t}\n\t\t}\n\n\t\tlet query;\n\t\tif (isMentionAll) {\n\t\t\t// Query all users in room limited by the max room members setting\n\t\t\tquery = RocketChat.models.Subscriptions.findByRoomId(room._id);\n\t\t} else {\n\t\t\t// Query only mentioned users, will be always a few users\n\t\t\tconst userIds = message.mentions.map(mention => mention._id);\n\t\t\tquery = RocketChat.models.Subscriptions.findByRoomIdAndUserIdsOrAllMessages(room._id, userIds);\n\t\t}\n\n\t\tquery.forEach((sub) => {\n\t\t\tif (sub.disableNotifications) {\n\t\t\t\treturn delete usersToSendEmail[sub.u._id];\n\t\t\t}\n\n\t\t\tconst emailNotifications = sub.emailNotifications;\n\n\t\t\tif (emailNotifications === 'nothing') {\n\t\t\t\treturn delete usersToSendEmail[sub.u._id];\n\t\t\t}\n\n\t\t\tconst mentionedUser = isMentionAll || message.mentions.find(mention => mention._id === sub.u._id);\n\n\t\t\tif (emailNotifications === 'default' || emailNotifications == null) {\n\t\t\t\tif (mentionedUser) {\n\t\t\t\t\treturn usersToSendEmail[sub.u._id] = 'default';\n\t\t\t\t}\n\t\t\t\treturn delete usersToSendEmail[sub.u._id];\n\t\t\t}\n\n\t\t\tif (emailNotifications === 'mentions' && mentionedUser) {\n\t\t\t\treturn usersToSendEmail[sub.u._id] = 'mention';\n\t\t\t}\n\n\t\t\tif (emailNotifications === 'all') {\n\t\t\t\treturn usersToSendEmail[sub.u._id] = 'all';\n\t\t\t}\n\t\t});\n\t}\n\tconst userIdsToSendEmail = Object.keys(usersToSendEmail);\n\n\tlet defaultLink;\n\n\tconst linkByUser = {};\n\tif (RocketChat.roomTypes.hasCustomLink(room.t)) {\n\t\tRocketChat.models.Subscriptions.findByRoomIdAndUserIds(room._id, userIdsToSendEmail).forEach((sub) => {\n\t\t\tlinkByUser[sub.u._id] = getMessageLink(room, sub);\n\t\t});\n\t} else {\n\t\tdefaultLink = getMessageLink(room, {\n\t\t\tname: room.name\n\t\t});\n\t}\n\n\tif (userIdsToSendEmail.length > 0) {\n\t\tconst usersOfMention = RocketChat.models.Users.getUsersToSendOfflineEmail(userIdsToSendEmail).fetch();\n\n\t\tif (usersOfMention && usersOfMention.length > 0) {\n\t\t\tusersOfMention.forEach((user) => {\n\t\t\t\tconst emailNotificationMode = RocketChat.getUserPreference(user, 'emailNotificationMode');\n\t\t\t\tif (usersToSendEmail[user._id] === 'default') {\n\t\t\t\t\tif (emailNotificationMode === 'all') { //Mention/DM\n\t\t\t\t\t\tusersToSendEmail[user._id] = 'mention';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (usersToSendEmail[user._id] === 'direct') {\n\t\t\t\t\tconst userEmailPreferenceIsDisabled = emailNotificationMode === 'disabled';\n\t\t\t\t\tconst directMessageEmailPreference = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(message.rid, message.rid.replace(message.u._id, '')).emailNotifications;\n\n\t\t\t\t\tif (directMessageEmailPreference === 'nothing') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((directMessageEmailPreference === 'default' || directMessageEmailPreference == null) && userEmailPreferenceIsDisabled) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Checks if user is in the room he/she is mentioned (unless it's public channel)\n\t\t\t\tif (room.t !== 'c' && room.usernames.indexOf(user.username) === -1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Footer in case direct reply is enabled.\n\t\t\t\tif (RocketChat.settings.get('Direct_Reply_Enable')) {\n\t\t\t\t\tfooter = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer_Direct_Reply') || '');\n\t\t\t\t}\n\n\t\t\t\tlet emailSubject;\n\t\t\t\tconst username = RocketChat.settings.get('UI_Use_Real_Name') ? message.u.name : message.u.username;\n\t\t\t\tconst roomName = RocketChat.settings.get('UI_Allow_room_names_with_special_chars') ? room.fname : room.name;\n\t\t\t\tswitch (usersToSendEmail[user._id]) {\n\t\t\t\t\tcase 'all':\n\t\t\t\t\t\temailSubject = RocketChat.placeholders.replace(RocketChat.settings.get('Offline_Mention_All_Email'), {\n\t\t\t\t\t\t\tuser: username,\n\t\t\t\t\t\t\troom: roomName || room.label\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'direct':\n\t\t\t\t\t\temailSubject = RocketChat.placeholders.replace(RocketChat.settings.get('Offline_DM_Email'), {\n\t\t\t\t\t\t\tuser: username,\n\t\t\t\t\t\t\troom: roomName\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'mention':\n\t\t\t\t\t\temailSubject = RocketChat.placeholders.replace(RocketChat.settings.get('Offline_Mention_Email'), {\n\t\t\t\t\t\t\tuser: username,\n\t\t\t\t\t\t\troom: roomName\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tuser.emails.some((email) => {\n\t\t\t\t\tif (email.verified) {\n\t\t\t\t\t\tconst content = getEmailContent({\n\t\t\t\t\t\t\tmessageContent: messageHTML,\n\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\troom\n\t\t\t\t\t\t});\n\t\t\t\t\t\temail = {\n\t\t\t\t\t\t\tto: email.address,\n\t\t\t\t\t\t\tsubject: emailSubject,\n\t\t\t\t\t\t\thtml: header + content + divisorMessage + (linkByUser[user._id] || defaultLink) + footer\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// using user full-name/channel name in from address\n\t\t\t\t\t\tif (room.t === 'd') {\n\t\t\t\t\t\t\temail.from = `${ message.u.name } <${ RocketChat.settings.get('From_Email') }>`;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\temail.from = `${ room.name } <${ RocketChat.settings.get('From_Email') }>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If direct reply enabled, email content with headers\n\t\t\t\t\t\tif (RocketChat.settings.get('Direct_Reply_Enable')) {\n\t\t\t\t\t\t\temail.headers = {\n\t\t\t\t\t\t\t\t// Reply-To header with format \"username+messageId@domain\"\n\t\t\t\t\t\t\t\t'Reply-To': `${ RocketChat.settings.get('Direct_Reply_Username').split('@')[0].split(RocketChat.settings.get('Direct_Reply_Separator'))[0] }${ RocketChat.settings.get('Direct_Reply_Separator') }${ message._id }@${ RocketChat.settings.get('Direct_Reply_Username').split('@')[1] }`\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tMeteor.defer(() => {\n\t\t\t\t\t\t\tEmail.send(email);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\treturn message;\n\n}, RocketChat.callbacks.priority.LOW, 'sendEmailOnMessage');\n","/* globals Push */\nimport _ from 'underscore';\nimport s from 'underscore.string';\nimport moment from 'moment';\n\nconst CATEGORY_MESSAGE = 'MESSAGE';\nconst CATEGORY_MESSAGE_NOREPLY = 'MESSAGE_NOREPLY';\n\n/**\n * Replaces @username with full name\n *\n * @param {string} message The message to replace\n * @param {object[]} mentions Array of mentions used to make replacements\n *\n * @returns {string}\n */\nfunction replaceMentionedUsernamesWithFullNames(message, mentions) {\n\tif (!mentions || !mentions.length) {\n\t\treturn message;\n\t}\n\tmentions.forEach((mention) => {\n\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\tif (user && user.name) {\n\t\t\tmessage = message.replace(`@${ mention.username }`, user.name);\n\t\t}\n\t});\n\treturn message;\n}\n\nfunction canSendMessageToRoom(room, username) {\n\treturn !((room.muted || []).includes(username));\n}\n\n/**\n * This function returns a string ready to be shown in the notification\n *\n * @param {object} message the message to be parsed\n */\nfunction parseMessageText(message, userId) {\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\tconst lng = user && user.language || RocketChat.settings.get('language') || 'en';\n\n\tif (!message.msg && message.attachments && message.attachments[0]) {\n\t\tmessage.msg = message.attachments[0].image_type ? TAPi18n.__('User_uploaded_image', {lng}) : TAPi18n.__('User_uploaded_file', {lng});\n\t}\n\tmessage.msg = RocketChat.callbacks.run('beforeNotifyUser', message.msg);\n\n\treturn message.msg;\n}\n/**\n * Send notification to user\n *\n * @param {string} userId The user to notify\n * @param {object} user The sender\n * @param {object} room The room send from\n * @param {number} duration Duration of notification\n */\nfunction notifyDesktopUser(userId, user, message, room, duration) {\n\n\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\tmessage.msg = parseMessageText(message, userId);\n\n\tif (UI_Use_Real_Name) {\n\t\tmessage.msg = replaceMentionedUsernamesWithFullNames(message.msg, message.mentions);\n\t}\n\tlet title = UI_Use_Real_Name ? user.name : `@${ user.username }`;\n\tif (room.t !== 'd' && room.name) {\n\t\ttitle += ` @ #${ room.name }`;\n\t}\n\tRocketChat.Notifications.notifyUser(userId, 'notification', {\n\t\ttitle,\n\t\ttext: message.msg,\n\t\tduration,\n\t\tpayload: {\n\t\t\t_id: message._id,\n\t\t\trid: message.rid,\n\t\t\tsender: message.u,\n\t\t\ttype: room.t,\n\t\t\tname: room.name\n\t\t}\n\t});\n}\n\nfunction notifyAudioUser(userId, message, room) {\n\tRocketChat.Notifications.notifyUser(userId, 'audioNotification', {\n\t\tpayload: {\n\t\t\t_id: message._id,\n\t\t\trid: message.rid,\n\t\t\tsender: message.u,\n\t\t\ttype: room.t,\n\t\t\tname: room.name\n\t\t}\n\t});\n}\n\n/**\n * Checks if a message contains a user highlight\n *\n * @param {string} message\n * @param {array|undefined} highlights\n *\n * @returns {boolean}\n */\nfunction messageContainsHighlight(message, highlights) {\n\tif (! highlights || highlights.length === 0) { return false; }\n\n\tlet has = false;\n\thighlights.some(function(highlight) {\n\t\tconst regexp = new RegExp(s.escapeRegExp(highlight), 'i');\n\t\tif (regexp.test(message.msg)) {\n\t\t\thas = true;\n\t\t\treturn true;\n\t\t}\n\t});\n\n\treturn has;\n}\n\nfunction getBadgeCount(userId) {\n\tconst subscriptions = RocketChat.models.Subscriptions.findUnreadByUserId(userId).fetch();\n\n\treturn subscriptions.reduce((unread, sub) => {\n\t\treturn sub.unread + unread;\n\t}, 0);\n}\n\nconst sendPushNotifications = (userIdsToPushNotify = [], message, room, push_room, push_username, push_message, pushUsernames) => {\n\tif (userIdsToPushNotify.length > 0 && Push.enabled === true) {\n\t\t// send a push notification for each user individually (to get his/her badge count)\n\t\tuserIdsToPushNotify.forEach((userIdToNotify) => {\n\t\t\tRocketChat.PushNotification.send({\n\t\t\t\troomId: message.rid,\n\t\t\t\troomName: push_room,\n\t\t\t\tusername: push_username,\n\t\t\t\tmessage: push_message,\n\t\t\t\tbadge: getBadgeCount(userIdToNotify),\n\t\t\t\tpayload: {\n\t\t\t\t\thost: Meteor.absoluteUrl(),\n\t\t\t\t\trid: message.rid,\n\t\t\t\t\tsender: message.u,\n\t\t\t\t\ttype: room.t,\n\t\t\t\t\tname: room.name\n\t\t\t\t},\n\t\t\t\tusersTo: {\n\t\t\t\t\tuserId: userIdToNotify\n\t\t\t\t},\n\t\t\t\tcategory: canSendMessageToRoom(room, pushUsernames[userIdToNotify]) ? CATEGORY_MESSAGE : CATEGORY_MESSAGE_NOREPLY\n\t\t\t});\n\t\t});\n\t}\n};\n\nconst callJoin = (user, rid) => user.active && Meteor.runAsUser(user._id, () => Meteor.call('joinRoom', rid));\nRocketChat.callbacks.add('afterSaveMessage', function(message, room, userId) {\n\n\t// skips this callback if the message was edited\n\tif (message.editedAt) {\n\t\treturn message;\n\t}\n\n\tif (message.ts && Math.abs(moment(message.ts).diff()) > 60000) {\n\t\treturn message;\n\t}\n\n\tconst pushUsernames = {};\n\n\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\n\t// might be a livechat visitor\n\tif (!user) {\n\t\treturn message;\n\t}\n\n\t/*\n\tIncrement unread couter if direct messages\n\t */\n\tconst settings = {\n\t\talwaysNotifyDesktopUsers: [],\n\t\tdontNotifyDesktopUsers: [],\n\t\talwaysNotifyMobileUsers: [],\n\t\tdontNotifyMobileUsers: [],\n\t\tdesktopNotificationDurations: {},\n\t\talwaysNotifyAudioUsers: [],\n\t\tdontNotifyAudioUsers: [],\n\t\taudioNotificationValues: {}\n\t};\n\n\t/**\n\t * Checks if a given user can be notified\n\t *\n\t * @param {string} id\n\t * @param {string} type - mobile|desktop\n\t *\n\t * @returns {boolean}\n     */\n\tfunction canBeNotified(id, type) {\n\t\tconst types = {\n\t\t\tdesktop: [ 'dontNotifyDesktopUsers', 'alwaysNotifyDesktopUsers' ],\n\t\t\tmobile: [ 'dontNotifyMobileUsers', 'alwaysNotifyMobileUsers' ],\n\t\t\taudio: [ 'dontNotifyAudioUsers', 'alwaysNotifyAudioUsers' ]\n\t\t};\n\n\t\treturn (settings[types[type][0]].indexOf(id) === -1 || settings[types[type][1]].indexOf(id) !== -1);\n\t}\n\n\t// Don't fetch all users if room exceeds max members\n\tconst maxMembersForNotification = RocketChat.settings.get('Notifications_Max_Room_Members');\n\tconst disableAllMessageNotifications = room.usernames.length > maxMembersForNotification && maxMembersForNotification !== 0;\n\tconst subscriptions = RocketChat.models.Subscriptions.findNotificationPreferencesByRoom(room._id, disableAllMessageNotifications);\n\tconst userIds = [];\n\tsubscriptions.forEach((s) => {\n\t\tuserIds.push(s.u._id);\n\t});\n\tconst users = {};\n\tRocketChat.models.Users.findUsersByIds(userIds, { fields: { 'settings.preferences': 1 } }).forEach((user) => {\n\t\tusers[user._id] = user;\n\t});\n\n\tsubscriptions.forEach(subscription => {\n\t\tif (subscription.disableNotifications) {\n\t\t\tsettings.dontNotifyDesktopUsers.push(subscription.u._id);\n\t\t\tsettings.dontNotifyMobileUsers.push(subscription.u._id);\n\t\t\tsettings.dontNotifyAudioUsers.push(subscription.u._id);\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\taudioNotifications = RocketChat.getUserPreference(users[subscription.u._id], 'audioNotifications'),\n\t\t\tdesktopNotifications = RocketChat.getUserPreference(users[subscription.u._id], 'desktopNotifications'),\n\t\t\tmobilePushNotifications = RocketChat.getUserPreference(users[subscription.u._id], 'mobileNotifications')\n\t\t} = subscription;\n\n\t\tif (audioNotifications === 'all' && !disableAllMessageNotifications) {\n\t\t\tsettings.alwaysNotifyAudioUsers.push(subscription.u._id);\n\t\t}\n\t\tif (desktopNotifications === 'all' && !disableAllMessageNotifications) {\n\t\t\tsettings.alwaysNotifyDesktopUsers.push(subscription.u._id);\n\t\t} else if (desktopNotifications === 'nothing') {\n\t\t\tsettings.dontNotifyDesktopUsers.push(subscription.u._id);\n\t\t}\n\t\tif (mobilePushNotifications === 'all' && !disableAllMessageNotifications) {\n\t\t\tsettings.alwaysNotifyMobileUsers.push(subscription.u._id);\n\t\t} else if (mobilePushNotifications === 'nothing') {\n\t\t\tsettings.dontNotifyMobileUsers.push(subscription.u._id);\n\t\t}\n\n\t\tsettings.audioNotificationValues[subscription.u._id] = subscription.audioNotificationValue;\n\t\tsettings.desktopNotificationDurations[subscription.u._id] = subscription.desktopNotificationDuration;\n\t});\n\tlet userIdsForAudio = [];\n\tlet userIdsToNotify = [];\n\tlet userIdsToPushNotify = [];\n\tconst mentions = [];\n\tconst alwaysNotifyMobileBoolean = RocketChat.settings.get('Notifications_Always_Notify_Mobile');\n\n\tconst usersWithHighlights = RocketChat.models.Users.findUsersByUsernamesWithHighlights(room.usernames, { fields: { '_id': 1, 'settings.preferences.highlights': 1 }}).fetch()\n\t\t.filter(user => messageContainsHighlight(message, user.settings.preferences.highlights));\n\n\tlet push_message = ' ';\n\t//Set variables depending on Push Notification settings\n\tif (RocketChat.settings.get('Push_show_message')) {\n\t\tpush_message = parseMessageText(message, userId);\n\t}\n\n\tlet push_username = '';\n\tlet push_room = '';\n\tif (RocketChat.settings.get('Push_show_username_room')) {\n\t\tpush_username = user.username;\n\t\tpush_room = `#${ room.name }`;\n\t}\n\n\tconsole.log (room._id);\n\tconsole.log (message);\n\tif (room.t == null || room.t === 'd') {\n\t\tconst userOfMentionId = message.rid.replace(message.u._id, '');\n\t\tconst userOfMention = RocketChat.models.Users.findOne({\n\t\t\t_id: userOfMentionId\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tstatusConnection: 1,\n\t\t\t\tcurRoom: 1,\n\t\t\t}\n\t\t});\n\n\t\t// Always notify Sandstorm\n\t\tif (userOfMention != null) {\n\t\t\tRocketChat.Sandstorm.notify(message, [userOfMention._id],\n\t\t\t\t`@${ user.username }: ${ message.msg }`, 'privateMessage');\n\n\t\t\tif (canBeNotified(userOfMentionId, 'desktop')) {\n\t\t\t\tconst duration = settings.desktopNotificationDurations[userOfMention._id];\n\t\t\t\tnotifyDesktopUser(userOfMention._id, user, message, room, duration);\n\t\t\t}\n\n\n\t\t\tconsole.log (userOfMention);\n\t\t\tif (canBeNotified(userOfMentionId, 'mobile')) {\n\t\t\t\tconsole.log ('sending mobile push 1');\n\t\t\t\tif (Push.enabled === true && (userOfMention.statusConnection !== 'online' || userOfMention.curRoom !== room._id || alwaysNotifyMobileBoolean === true)) {\n\t\t\t\t\tconsole.log ('sending mobile push 2');\n\t\t\t\t\tRocketChat.PushNotification.send({\n\t\t\t\t\t\troomId: message.rid,\n\t\t\t\t\t\tusername: push_username,\n\t\t\t\t\t\tmessage: push_message,\n\t\t\t\t\t\tbadge: getBadgeCount(userOfMention._id),\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\thost: Meteor.absoluteUrl(),\n\t\t\t\t\t\t\trid: message.rid,\n\t\t\t\t\t\t\tsender: message.u,\n\t\t\t\t\t\t\ttype: room.t,\n\t\t\t\t\t\t\tname: room.name\n\t\t\t\t\t\t},\n\t\t\t\t\t\tusersTo: {\n\t\t\t\t\t\t\tuserId: userOfMention._id\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcategory: canSendMessageToRoom(room, userOfMention.username) ? CATEGORY_MESSAGE : CATEGORY_MESSAGE_NOREPLY\n\t\t\t\t\t});\n\t\t\t\t\treturn message;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t} else {\n\t\tconst mentionIds = (message.mentions || []).map(({_id}) => _id);\n\t\tconst toAll = mentionIds.includes('all');\n\t\tconst toHere = mentionIds.includes('here');\n\n\t\tif (mentionIds.length + settings.alwaysNotifyDesktopUsers.length > 0) {\n\t\t\tlet desktopMentionIds = _.union(mentionIds, settings.alwaysNotifyDesktopUsers);\n\t\t\tdesktopMentionIds = _.difference(desktopMentionIds, settings.dontNotifyDesktopUsers);\n\n\t\t\tlet usersOfDesktopMentions = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: desktopMentionIds\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tactive: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t\tmentions.push(...usersOfDesktopMentions);\n\t\t\tif (room.t !== 'c') {\n\t\t\t\tusersOfDesktopMentions = _.reject(usersOfDesktopMentions, (usersOfMentionItem) => {\n\t\t\t\t\treturn room.usernames.indexOf(usersOfMentionItem.username) === -1;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tuserIdsToNotify = _.pluck(usersOfDesktopMentions, '_id');\n\t\t}\n\n\t\tif (mentionIds.length + settings.alwaysNotifyMobileUsers.length > 0) {\n\t\t\tlet mobileMentionIds = _.union(mentionIds, settings.alwaysNotifyMobileUsers);\n\t\t\tmobileMentionIds = _.difference(mobileMentionIds, settings.dontNotifyMobileUsers);\n\n\t\t\tconst usersOfMobileMentionsQuery = {\n\t\t\t\t_id: {\n\t\t\t\t\t$in: mobileMentionIds\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (alwaysNotifyMobileBoolean !== true) {\n\t\t\t\t//usersOfMobileMentionsQuery.statusConnection = { $ne: 'online' };\n\t\t\t\tusersOfMobileMentionsQuery['$or'] = [{statusConnection: { $ne: 'online' }}, {curRoom: {$ne: room._id}}];\n\t\t\t}\n\n\t\t\tlet usersOfMobileMentions = RocketChat.models.Users.find(usersOfMobileMentionsQuery, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tstatusConnection: 1,\n\t\t\t\t\tactive: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\n\t\t\tmentions.push(...usersOfMobileMentions);\n\t\t\tif (room.t !== 'c') {\n\t\t\t\tusersOfMobileMentions = _.reject(usersOfMobileMentions, usersOfMentionItem => !room.usernames.includes(usersOfMentionItem.username));\n\t\t\t}\n\n\t\t\tuserIdsToPushNotify = usersOfMobileMentions.map(userMobile => {\n\t\t\t\tpushUsernames[userMobile._id] = userMobile.username;\n\t\t\t\treturn userMobile._id;\n\t\t\t});\n\t\t}\n\n\t\tif (mentionIds.length + settings.alwaysNotifyAudioUsers.length > 0) {\n\t\t\tlet audioMentionIds = _.union(mentionIds, settings.alwaysNotifyAudioUsers);\n\t\t\taudioMentionIds = _.difference(audioMentionIds, userIdsToNotify);\n\n\t\t\tlet usersOfAudioMentions = RocketChat.models.Users.find({ _id: { $in: audioMentionIds }, statusConnection: {\n\t\t\t\t$ne:'offline'\n\t\t\t} }, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tactive: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t\tmentions.push(...usersOfAudioMentions);\n\t\t\tif (room.t !== 'c') {\n\t\t\t\tusersOfAudioMentions = _.reject(usersOfAudioMentions, (usersOfMentionItem) => {\n\t\t\t\t\treturn room.usernames.indexOf(usersOfMentionItem.username) === -1;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tuserIdsForAudio = _.pluck(usersOfAudioMentions, '_id');\n\t\t}\n\n\t\tif (room.t === 'c') {\n\t\t\tmentions.filter(user => !room.usernames.includes(user.username))\n\t\t\t\t.forEach(user =>callJoin(user, room._id));\n\t\t}\n\n\t\tif ([toAll, toHere].some(e => e) && room.usernames && room.usernames.length > 0) {\n\t\t\tRocketChat.models.Users.find({\n\t\t\t\tusername: { $in: room.usernames },\n\t\t\t\t_id: { $ne: user._id }\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tstatus: 1,\n\t\t\t\t\tstatusConnection: 1\n\t\t\t\t}\n\t\t\t}).forEach(function(user) {\n\t\t\t\tif (['online', 'away', 'busy'].includes(user.status) && !(settings.dontNotifyDesktopUsers || []).includes(user._id)) {\n\t\t\t\t\tuserIdsToNotify.push(user._id);\n\t\t\t\t\tuserIdsForAudio.push(user._id);\n\t\t\t\t}\n\t\t\t\tif (toAll && user.statusConnection !== 'online' && !(settings.dontNotifyMobileUsers || []).includes(user._id)) {\n\t\t\t\t\tpushUsernames[user._id] = user.username;\n\t\t\t\t\treturn userIdsToPushNotify.push(user._id);\n\t\t\t\t}\n\t\t\t\tif (toAll && user.statusConnection !== 'online') {\n\t\t\t\t\tuserIdsForAudio.push(user._id);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (usersWithHighlights.length > 0) {\n\t\t\tconst highlightsIds = _.pluck(usersWithHighlights, '_id');\n\t\t\tuserIdsForAudio = userIdsForAudio.concat(highlightsIds);\n\t\t\tuserIdsToNotify = userIdsToNotify.concat(highlightsIds);\n\t\t\tuserIdsToPushNotify = userIdsToPushNotify.concat(highlightsIds);\n\t\t}\n\n\t\tuserIdsToNotify = _.without(_.compact(_.unique(userIdsToNotify)), message.u._id);\n\t\tuserIdsToPushNotify = _.without(_.compact(_.unique(userIdsToPushNotify)), message.u._id);\n\t\tuserIdsForAudio = _.without(_.compact(_.unique(userIdsForAudio)), message.u._id);\n\n\t\tfor (const usersOfMentionId of userIdsToNotify) {\n\t\t\tconst duration = settings.desktopNotificationDurations[usersOfMentionId];\n\t\t\tnotifyDesktopUser(usersOfMentionId, user, message, room, duration);\n\t\t}\n\t\tfor (const usersOfMentionId of userIdsForAudio) {\n\t\t\tnotifyAudioUser(usersOfMentionId, message, room);\n\t\t}\n\t\tsendPushNotifications(userIdsToPushNotify, message, room, push_room, push_username, push_message, pushUsernames);\n\n\t\tconst allUserIdsToNotify = _.unique(userIdsToNotify.concat(userIdsToPushNotify));\n\t\tRocketChat.Sandstorm.notify(message, allUserIdsToNotify,\n\t\t\t`@${ user.username }: ${ message.msg }`, room.t === 'p' ? 'privateMessage' : 'message');\n\t}\n\n\treturn message;\n\n}, RocketChat.callbacks.priority.LOW, 'sendNotificationOnMessage');\n","import _ from 'underscore';\nimport dns from 'dns';\n\nlet emailDomainBlackList = [];\nlet emailDomainWhiteList = [];\nlet useDefaultBlackList = false;\nlet useDNSDomainCheck = false;\n\nRocketChat.settings.get('Accounts_BlockedDomainsList', function(key, value) {\n\temailDomainBlackList = _.map(value.split(','), (domain) => domain.trim());\n});\nRocketChat.settings.get('Accounts_AllowedDomainsList', function(key, value) {\n\temailDomainWhiteList = _.map(value.split(','), (domain) => domain.trim());\n});\nRocketChat.settings.get('Accounts_UseDefaultBlockedDomainsList', function(key, value) {\n\tuseDefaultBlackList = value;\n});\nRocketChat.settings.get('Accounts_UseDNSDomainCheck', function(key, value) {\n\tuseDNSDomainCheck = value;\n});\n\nRocketChat.validateEmailDomain = function(email) {\n\tconst emailValidation = /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n\tif (!emailValidation.test(email)) {\n\t\tthrow new Meteor.Error('error-invalid-email', `Invalid email ${ email }`, { function: 'RocketChat.validateEmailDomain', email });\n\t}\n\n\tconst emailDomain = email.substr(email.lastIndexOf('@') + 1);\n\n\t// if not in whitelist\n\tif (emailDomainWhiteList.indexOf(emailDomain) === -1) {\n\t\tif (emailDomainBlackList.indexOf(emailDomain) !== -1 || (useDefaultBlackList && RocketChat.emailDomainDefaultBlackList.indexOf(emailDomain) !== -1)) {\n\t\t\tthrow new Meteor.Error('error-email-domain-blacklisted', 'The email domain is blacklisted', { function: 'RocketChat.validateEmailDomain' });\n\t\t}\n\t}\n\n\tif (useDNSDomainCheck) {\n\t\ttry {\n\t\t\tMeteor.wrapAsync(dns.resolveMx)(emailDomain);\n\t\t} catch (e) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain', 'Invalid domain', { function: 'RocketChat.validateEmailDomain' });\n\t\t}\n\t}\n};\n","/*\n\tWhat is this file? Great question! To make Rocket.Chat more \"modular\"\n\tand to make the \"rocketchat:lib\" package more of a core package\n\twith the libraries, this index file contains the exported members\n\tfor the *server* pieces of code which does include the shared\n\tlibrary files.\n*/\n\nimport { RoomSettingsEnum, RoomTypeConfig, RoomTypeRouteConfig } from '../../lib/RoomTypeConfig';\n\nexport {\n\tRoomSettingsEnum,\n\tRoomTypeConfig,\n\tRoomTypeRouteConfig\n};\n","import fs from 'fs';\n\nfunction hasDockerEnv() {\n\ttry {\n\t\tfs.statSync('/.dockerenv');\n\t\treturn true;\n\t} catch (err) {\n\t\treturn false;\n\t}\n}\n\nfunction hasDockerCGroup() {\n\ttry {\n\t\treturn fs.readFileSync('/proc/self/cgroup', 'utf8').indexOf('docker') !== -1;\n\t} catch (err) {\n\t\treturn false;\n\t}\n}\n\nfunction check() {\n\treturn hasDockerEnv() || hasDockerCGroup();\n}\n\nlet isDocker;\nRocketChat.isDocker = function() {\n\tif (isDocker === undefined) {\n\t\tisDocker = check();\n\t}\n\n\treturn isDocker;\n};\n","RocketChat.addUserToDefaultChannels = function(user, silenced) {\n\tRocketChat.callbacks.run('beforeJoinDefaultChannels', user);\n\tconst defaultRooms = RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c', 'p'], {fields: {usernames: 0}}).fetch();\n\tdefaultRooms.forEach((room) => {\n\n\t\t// put user in default rooms\n\t\tconst muted = room.ro && !RocketChat.authz.hasPermission(user._id, 'post-readonly');\n\t\tRocketChat.models.Rooms.addUsernameById(room._id, user.username, muted);\n\n\t\tif (!RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user._id)) {\n\n\t\t\t// Add a subscription to this user\n\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\tts: new Date(),\n\t\t\t\topen: true,\n\t\t\t\talert: true,\n\t\t\t\tunread: 1,\n\t\t\t\tuserMentions: 1,\n\t\t\t\tgroupMentions: 0\n\t\t\t});\n\n\t\t\t// Insert user joined message\n\t\t\tif (!silenced) {\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(room._id, user);\n\t\t\t}\n\t\t}\n\t});\n};\n","RocketChat.addUserToRoom = function(rid, user, inviter, silenced) {\n\tconst now = new Date();\n\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t// Check if user is already in room\n\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\tif (subscription) {\n\t\treturn;\n\t}\n\n\tif (room.t === 'c' || room.t === 'p') {\n\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t}\n\n\tconst muted = room.ro && !RocketChat.authz.hasPermission(user._id, 'post-readonly');\n\tRocketChat.models.Rooms.addUsernameById(rid, user.username, muted);\n\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\tts: now,\n\t\topen: true,\n\t\talert: true,\n\t\tunread: 1,\n\t\tuserMentions: 1,\n\t\tgroupMentions: 0\n\t});\n\n\tif (!silenced) {\n\t\tif (inviter) {\n\t\t\tRocketChat.models.Messages.createUserAddedWithRoomIdAndUser(rid, user, {\n\t\t\t\tts: now,\n\t\t\t\tu: {\n\t\t\t\t\t_id: inviter._id,\n\t\t\t\t\tusername: inviter.username\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, { ts: now });\n\t\t}\n\t}\n\n\tif (room.t === 'c' || room.t === 'p') {\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t});\n\t}\n\n\treturn true;\n};\n","RocketChat.archiveRoom = function(rid) {\n\tRocketChat.models.Rooms.archiveById(rid);\n\tRocketChat.models.Subscriptions.archiveByRoomId(rid);\n\n\tRocketChat.callbacks.run('afterRoomArchived', RocketChat.models.Rooms.findOneById(rid), Meteor.user());\n};\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.checkUsernameAvailability = function(username) {\n\treturn RocketChat.settings.get('Accounts_BlockedUsernameList', function(key, value) {\n\t\tconst usernameBlackList = _.map(value.split(','), function(username) {\n\t\t\treturn username.trim();\n\t\t});\n\t\tif (usernameBlackList.length !== 0) {\n\t\t\tif (usernameBlackList.every(restrictedUsername => {\n\t\t\t\tconst regex = new RegExp(`^${ s.escapeRegExp(restrictedUsername) }$`, 'i');\n\t\t\t\treturn !regex.test(s.trim(s.escapeRegExp(username)));\n\t\t\t})) {\n\t\t\t\treturn !Meteor.users.findOne({\n\t\t\t\t\tusername: {\n\t\t\t\t\t\t$regex: new RegExp(`^${ s.trim(s.escapeRegExp(username)) }$`, 'i')\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n};\n","import s from 'underscore.string';\n\nRocketChat.checkEmailAvailability = function(email) {\n\treturn !Meteor.users.findOne({ 'emails.address': { $regex : new RegExp(`^${ s.trim(s.escapeRegExp(email)) }$`, 'i') } });\n};\n","/* globals RocketChat */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.createRoom = function(type, name, owner, members, readOnly, extraData={}) {\n\tname = s.trim(name);\n\towner = s.trim(owner);\n\tmembers = [].concat(members);\n\n\tif (!name) {\n\t\tthrow new Meteor.Error('error-invalid-name', 'Invalid name', { function: 'RocketChat.createRoom' });\n\t}\n\n\towner = RocketChat.models.Users.findOneByUsername(owner, { fields: { username: 1 }});\n\tif (!owner) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { function: 'RocketChat.createRoom' });\n\t}\n\n\tconst slugifiedRoomName = RocketChat.getValidRoomName(name);\n\n\tconst now = new Date();\n\tif (!_.contains(members, owner.username)) {\n\t\tmembers.push(owner.username);\n\t}\n\n\tif (type === 'c') {\n\t\tRocketChat.callbacks.run('beforeCreateChannel', owner, {\n\t\t\tt: 'c',\n\t\t\tname: slugifiedRoomName,\n\t\t\tfname: name,\n\t\t\tts: now,\n\t\t\tro: readOnly === true,\n\t\t\tsysMes: readOnly !== true,\n\t\t\tusernames: members,\n\t\t\tu: {\n\t\t\t\t_id: owner._id,\n\t\t\t\tusername: owner.username\n\t\t\t}\n\t\t});\n\t}\n\n\textraData = Object.assign({}, extraData, {\n\t\tts: now,\n\t\tro: readOnly === true,\n\t\tsysMes: readOnly !== true\n\t});\n\n\tconst room = RocketChat.models.Rooms.createWithTypeNameUserAndUsernames(type, slugifiedRoomName, name, owner, members, extraData);\n\n\tfor (const username of members) {\n\t\tconst member = RocketChat.models.Users.findOneByUsername(username, { fields: { username: 1 }});\n\t\tif (!member) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// make all room members muted by default, unless they have the post-readonly permission\n\t\tif (readOnly === true && !RocketChat.authz.hasPermission(member._id, 'post-readonly')) {\n\t\t\tRocketChat.models.Rooms.muteUsernameByRoomId(room._id, username);\n\t\t}\n\n\t\tconst extra = { open: true };\n\n\t\tif (username === owner.username) {\n\t\t\textra.ls = now;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, member, extra);\n\t}\n\n\tRocketChat.authz.addUserRoles(owner._id, ['owner'], room._id);\n\n\tif (type === 'c') {\n\t\tMeteor.defer(() => {\n\t\t\tRocketChat.callbacks.run('afterCreateChannel', owner, room);\n\t\t});\n\t} else if (type === 'p') {\n\t\tMeteor.defer(() => {\n\t\t\tRocketChat.callbacks.run('afterCreatePrivateGroup', owner, room);\n\t\t});\n\t}\n\n\treturn {\n\t\trid: room._id,\n\t\tname: slugifiedRoomName\n\t};\n};\n","/* globals FileUpload */\nRocketChat.deleteMessage = function(message, user) {\n\tconst keepHistory = RocketChat.settings.get('Message_KeepHistory');\n\tconst showDeletedStatus = RocketChat.settings.get('Message_ShowDeletedStatus');\n\tlet deletedMsg;\n\n\tif (keepHistory) {\n\t\tif (showDeletedStatus) {\n\t\t\tRocketChat.models.Messages.cloneAndSaveAsHistoryById(message._id);\n\t\t} else {\n\t\t\tRocketChat.models.Messages.setHiddenById(message._id, true);\n\t\t}\n\n\t\tif (message.file && message.file._id) {\n\t\t\tRocketChat.models.Uploads.update(message.file._id, { $set: { _hidden: true } });\n\t\t}\n\t} else {\n\t\tif (!showDeletedStatus) {\n\t\t\tdeletedMsg = RocketChat.models.Messages.findOneById(message._id);\n\t\t\tRocketChat.models.Messages.removeById(message._id);\n\t\t}\n\n\t\tif (message.file && message.file._id) {\n\t\t\tFileUpload.getStore('Uploads').deleteById(message.file._id);\n\t\t}\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterDeleteMessage', deletedMsg);\n\t\t});\n\t}\n\n\t// update last message\n\tif (RocketChat.settings.get('Store_Last_Message')) {\n\t\tconst room = RocketChat.models.Rooms.findOneById(message.rid, { fields: { lastMessage: 1 } });\n\t\tif (!room.lastMessage || room.lastMessage._id === message._id) {\n\t\t\tconst lastMessage = RocketChat.models.Messages.getLastVisibleMessageSentWithNoTypeByRoomId(message.rid, message._id);\n\t\t\tRocketChat.models.Rooms.setLastMessageById(message.rid, lastMessage);\n\t\t}\n\t}\n\n\tif (showDeletedStatus) {\n\t\tRocketChat.models.Messages.setAsDeletedByIdAndUser(message._id, user);\n\t} else {\n\t\tRocketChat.Notifications.notifyRoom(message.rid, 'deleteMessage', { _id: message._id });\n\t}\n};\n","RocketChat.deleteUser = function(userId) {\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t// Users without username can't do anything, so there is nothing to remove\n\tif (user.username != null) {\n\t\tRocketChat.models.Messages.removeByUserId(userId); // Remove user messages\n\t\tRocketChat.models.Subscriptions.db.findByUserId(userId).forEach((subscription) => {\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\t\tif (room) {\n\t\t\t\tif (room.t !== 'c' && room.usernames.length === 1) {\n\t\t\t\t\tRocketChat.models.Rooms.removeById(subscription.rid); // Remove non-channel rooms with only 1 user (the one being deleted)\n\t\t\t\t}\n\t\t\t\tif (room.t === 'd') {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(subscription.rid);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(subscription.rid);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Subscriptions.removeByUserId(userId); // Remove user subscriptions\n\t\tRocketChat.models.Rooms.removeByTypeContainingUsername('d', user.username); // Remove direct rooms with the user\n\t\tRocketChat.models.Rooms.removeUsernameFromAll(user.username); // Remove user from all other rooms\n\n\t\t// removes user's avatar\n\t\tif (user.avatarOrigin === 'upload' || user.avatarOrigin === 'url') {\n\t\t\tFileUpload.getStore('Avatars').deleteByName(user.username);\n\t\t}\n\n\t\tRocketChat.models.Integrations.disableByUserId(userId); // Disables all the integrations which rely on the user being deleted.\n\t}\n\n\tRocketChat.models.Users.removeById(userId); // Remove user from users database\n};\n","/* globals RocketChat */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.getFullUserData = function({userId, filter, limit}) {\n\tlet fields = {\n\t\tname: 1,\n\t\tusername: 1,\n\t\tstatus: 1,\n\t\tutcOffset: 1,\n\t\ttype: 1,\n\t\tactive: 1,\n\t\treason: 1\n\t};\n\n\tif (RocketChat.authz.hasPermission(userId, 'view-full-other-user-info')) {\n\t\tfields = _.extend(fields, {\n\t\t\temails: 1,\n\t\t\tphone: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tcreatedAt: 1,\n\t\t\tlastLogin: 1,\n\t\t\tservices: 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\troles: 1,\n\t\t\tcustomFields: 1\n\t\t});\n\t} else if (limit !== 0) {\n\t\tlimit = 1;\n\t}\n\n\tfilter = s.trim(filter);\n\n\tif (!filter && limit === 1) {\n\t\treturn undefined;\n\t}\n\n\tconst options = {\n\t\tfields,\n\t\tlimit,\n\t\tsort: { username: 1 }\n\t};\n\n\tif (filter) {\n\t\tif (limit === 1) {\n\t\t\treturn RocketChat.models.Users.findByUsername(filter, options);\n\t\t} else {\n\t\t\tconst filterReg = new RegExp(s.escapeRegExp(filter), 'i');\n\t\t\treturn RocketChat.models.Users.findByUsernameNameOrEmailAddress(filterReg, options);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Users.find({}, options);\n};\n","/* globals RocketChat */\nimport _ from 'underscore';\n\nRocketChat.getRoomByNameOrIdWithOptionToJoin = function _getRoomByNameOrIdWithOptionToJoin({ currentUserId, nameOrId, type='', tryDirectByUserIdOnly=false, joinChannel=true, errorOnEmpty=true }) {\n\tlet room;\n\n\t//If the nameOrId starts with #, then let's try to find a channel or group\n\tif (nameOrId.startsWith('#')) {\n\t\tnameOrId = nameOrId.substring(1);\n\t\troom = RocketChat.models.Rooms.findOneByIdOrName(nameOrId);\n\t} else if (nameOrId.startsWith('@') || type === 'd') {\n\t\t//If the nameOrId starts with @ OR type is 'd', then let's try just a direct message\n\t\tnameOrId = nameOrId.replace('@', '');\n\n\t\tlet roomUser;\n\t\tif (tryDirectByUserIdOnly) {\n\t\t\troomUser = RocketChat.models.Users.findOneById(nameOrId);\n\t\t} else {\n\t\t\troomUser = RocketChat.models.Users.findOne({\n\t\t\t\t$or: [{ _id: nameOrId }, { username: nameOrId }]\n\t\t\t});\n\t\t}\n\n\t\tconst rid = _.isObject(roomUser) ? [currentUserId, roomUser._id].sort().join('') : nameOrId;\n\t\troom = RocketChat.models.Rooms.findOneById(rid);\n\n\t\t//If the room hasn't been found yet, let's try some more\n\t\tif (!_.isObject(room)) {\n\t\t\t//If the roomUser wasn't found, then there's no destination to point towards\n\t\t\t//so return out based upon errorOnEmpty\n\t\t\tif (!_.isObject(roomUser)) {\n\t\t\t\tif (errorOnEmpty) {\n\t\t\t\t\tthrow new Meteor.Error('invalid-channel');\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\troom = Meteor.runAsUser(currentUserId, function() {\n\t\t\t\tconst {rid} = Meteor.call('createDirectMessage', roomUser.username);\n\t\t\t\treturn RocketChat.models.Rooms.findOneById(rid);\n\t\t\t});\n\t\t}\n\t} else {\n\t\t//Otherwise, we'll treat this as a channel or group.\n\t\troom = RocketChat.models.Rooms.findOneByIdOrName(nameOrId);\n\t}\n\n\t//If no room was found, handle the room return based upon errorOnEmpty\n\tif (!room && errorOnEmpty) {\n\t\tthrow new Meteor.Error('invalid-channel');\n\t} else if (!room) {\n\t\treturn;\n\t}\n\n\t//If a room was found and they provided a type to search, then check\n\t//and if the type found isn't what we're looking for then handle\n\t//the return based upon errorOnEmpty\n\tif (type && room.t !== type) {\n\t\tif (errorOnEmpty) {\n\t\t\tthrow new Meteor.Error('invalid-channel');\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t//If the room type is channel and joinChannel has been passed, try to join them\n\t//if they can't join the room, this will error out!\n\tif (room.t === 'c' && joinChannel) {\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, currentUserId);\n\n\t\tif (!sub) {\n\t\t\tMeteor.runAsUser(currentUserId, function() {\n\t\t\t\treturn Meteor.call('joinRoom', room._id);\n\t\t\t});\n\t\t}\n\t}\n\n\treturn room;\n};\n","import _ from 'underscore';\n\nconst hideMessagesOfType = [];\n\nRocketChat.settings.get(/Message_HideType_.+/, function(key, value) {\n\tconst type = key.replace('Message_HideType_', '');\n\tconst types = type === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [type];\n\n\treturn types.forEach((type) => {\n\t\tconst index = hideMessagesOfType.indexOf(type);\n\n\t\tif (value === true && index === -1) {\n\t\t\treturn hideMessagesOfType.push(type);\n\t\t}\n\n\t\tif (index > -1) {\n\t\t\treturn hideMessagesOfType.splice(index, 1);\n\t\t}\n\t});\n});\n\nRocketChat.loadMessageHistory = function loadMessageHistory({ userId, rid, end, limit = 20, ls }) {\n\tconst options = {\n\t\tsort: {\n\t\t\tts: -1\n\t\t},\n\t\tlimit\n\t};\n\n\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\toptions.fields = {\n\t\t\teditedAt: 0\n\t\t};\n\t}\n\n\tlet records;\n\tif (end != null) {\n\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestampNotContainingTypes(rid, end, hideMessagesOfType, options).fetch();\n\t} else {\n\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdNotContainingTypes(rid, hideMessagesOfType, options).fetch();\n\t}\n\n\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\tconst messages = records.map((message) => {\n\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t_id: userId\n\t\t});\n\t\tif (message.u && message.u._id && UI_Use_Real_Name) {\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\t\t\tmessage.u.name = user && user.name;\n\t\t}\n\t\tif (message.mentions && message.mentions.length && UI_Use_Real_Name) {\n\t\t\tmessage.mentions.forEach((mention) => {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\tmention.name = user && user.name;\n\t\t\t});\n\t\t}\n\t\treturn message;\n\t});\n\n\tlet unreadNotLoaded = 0;\n\tlet firstUnread;\n\n\tif (ls != null) {\n\t\tconst firstMessage = messages[messages.length - 1];\n\n\t\tif ((firstMessage != null ? firstMessage.ts : undefined) > ls) {\n\t\t\tdelete options.limit;\n\n\t\t\tconst unreadMessages = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestampsNotContainingTypes(rid, ls, firstMessage.ts, hideMessagesOfType, {\n\t\t\t\tlimit: 1,\n\t\t\t\tsort: {\n\t\t\t\t\tts: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfirstUnread = unreadMessages.fetch()[0];\n\t\t\tunreadNotLoaded = unreadMessages.count();\n\t\t}\n\t}\n\n\treturn {\n\t\tmessages,\n\t\tfirstUnread,\n\t\tunreadNotLoaded\n\t};\n};\n","RocketChat.removeUserFromRoom = function(rid, user) {\n\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\tif (room) {\n\t\tRocketChat.callbacks.run('beforeLeaveRoom', user, room);\n\t\tRocketChat.models.Rooms.removeUsernameById(rid, user.username);\n\n\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\tconst removedUser = user;\n\t\t\tRocketChat.models.Messages.createUserLeaveWithRoomIdAndUser(rid, removedUser);\n\t\t}\n\n\t\tif (room.t === 'l') {\n\t\t\tRocketChat.models.Messages.createCommandWithRoomIdAndUser('survey', rid, user);\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(rid, user._id);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLeaveRoom', user, room);\n\t\t});\n\t}\n};\n","/* globals Gravatar */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.saveUser = function(userId, userData) {\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\tconst existingRoles = _.pluck(RocketChat.authz.getRoles(), '_id');\n\n\tif (userData._id && userId !== userData._id && !RocketChat.authz.hasPermission(userId, 'edit-other-user-info')) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing user is not allowed', {\n\t\t\tmethod: 'insertOrUpdateUser',\n\t\t\taction: 'Editing_user'\n\t\t});\n\t}\n\n\tif (!userData._id && !RocketChat.authz.hasPermission(userId, 'create-user')) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'Adding user is not allowed', {\n\t\t\tmethod: 'insertOrUpdateUser',\n\t\t\taction: 'Adding_user'\n\t\t});\n\t}\n\n\tif (userData.roles && _.difference(userData.roles, existingRoles).length > 0) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'The field Roles consist invalid role name', {\n\t\t\tmethod: 'insertOrUpdateUser',\n\t\t\taction: 'Assign_role'\n\t\t});\n\t}\n\n\tif (userData.roles && _.indexOf(userData.roles, 'admin') >= 0 && !RocketChat.authz.hasPermission(userId, 'assign-admin-role')) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'Assigning admin is not allowed', {\n\t\t\tmethod: 'insertOrUpdateUser',\n\t\t\taction: 'Assign_admin'\n\t\t});\n\t}\n\n\tif (!userData._id && !s.trim(userData.name)) {\n\t\tthrow new Meteor.Error('error-the-field-is-required', 'The field Name is required', {\n\t\t\tmethod: 'insertOrUpdateUser',\n\t\t\tfield: 'Name'\n\t\t});\n\t}\n\n\tif (!userData._id && !s.trim(userData.username)) {\n\t\tthrow new Meteor.Error('error-the-field-is-required', 'The field Username is required', {\n\t\t\tmethod: 'insertOrUpdateUser',\n\t\t\tfield: 'Username'\n\t\t});\n\t}\n\n\tlet nameValidation;\n\n\ttry {\n\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t} catch (e) {\n\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t}\n\n\tif (userData.username && !nameValidation.test(userData.username)) {\n\t\tthrow new Meteor.Error('error-input-is-not-a-valid-field', `${ _.escape(userData.username) } is not a valid username`, {\n\t\t\tmethod: 'insertOrUpdateUser',\n\t\t\tinput: userData.username,\n\t\t\tfield: 'Username'\n\t\t});\n\t}\n\n\tif (!userData._id && !userData.password) {\n\t\tthrow new Meteor.Error('error-the-field-is-required', 'The field Password is required', {\n\t\t\tmethod: 'insertOrUpdateUser',\n\t\t\tfield: 'Password'\n\t\t});\n\t}\n\n\tif (!userData._id) {\n\t\tif (!RocketChat.checkUsernameAvailability(userData.username)) {\n\t\t\tthrow new Meteor.Error('error-field-unavailable', `${ _.escape(userData.username) } is already in use :(`, {\n\t\t\t\tmethod: 'insertOrUpdateUser',\n\t\t\t\tfield: userData.username\n\t\t\t});\n\t\t}\n\n\t\tif (userData.email && !RocketChat.checkEmailAvailability(userData.email)) {\n\t\t\tthrow new Meteor.Error('error-field-unavailable', `${ _.escape(userData.email) } is already in use :(`, {\n\t\t\t\tmethod: 'insertOrUpdateUser',\n\t\t\t\tfield: userData.email\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.validateEmailDomain(userData.email);\n\n\t\t// insert user\n\t\tconst createUser = {\n\t\t\tusername: userData.username,\n\t\t\tpassword: userData.password,\n\t\t\tjoinDefaultChannels: userData.joinDefaultChannels\n\t\t};\n\t\tif (userData.email) {\n\t\t\tcreateUser.email = userData.email;\n\t\t}\n\n\t\tconst _id = Accounts.createUser(createUser);\n\n\t\tconst updateUser = {\n\t\t\t$set: {\n\t\t\t\tname: userData.name,\n\t\t\t\troles: userData.roles || ['user'],\n\t\t\t\tsettings: userData.settings || {}\n\t\t\t}\n\t\t};\n\n\t\tif (typeof userData.requirePasswordChange !== 'undefined') {\n\t\t\tupdateUser.$set.requirePasswordChange = userData.requirePasswordChange;\n\t\t}\n\n\t\tif (typeof userData.verified === 'boolean') {\n\t\t\tupdateUser.$set['emails.0.verified'] = userData.verified;\n\t\t}\n\n\t\tMeteor.users.update({ _id }, updateUser);\n\n\t\tif (userData.sendWelcomeEmail) {\n\t\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\t\t\tlet subject;\n\t\t\tlet html;\n\n\t\t\tif (RocketChat.settings.get('Accounts_UserAddedEmail_Customized')) {\n\t\t\t\tsubject = RocketChat.settings.get('Accounts_UserAddedEmailSubject');\n\t\t\t\thtml = RocketChat.settings.get('Accounts_UserAddedEmail');\n\t\t\t} else {\n\t\t\t\tsubject = TAPi18n.__('Accounts_UserAddedEmailSubject_Default', { lng: user.language || RocketChat.settings.get('language') || 'en' });\n\t\t\t\thtml = TAPi18n.__('Accounts_UserAddedEmail_Default', { lng: user.language || RocketChat.settings.get('language') || 'en' });\n\t\t\t}\n\n\t\t\tsubject = RocketChat.placeholders.replace(subject);\n\t\t\thtml = RocketChat.placeholders.replace(html, {\n\t\t\t\tname: userData.name,\n\t\t\t\temail: userData.email,\n\t\t\t\tpassword: userData.password\n\t\t\t});\n\n\t\t\tconst email = {\n\t\t\t\tto: userData.email,\n\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\tsubject,\n\t\t\t\thtml: header + html + footer\n\t\t\t};\n\n\t\t\tMeteor.defer(function() {\n\t\t\t\ttry {\n\t\t\t\t\tEmail.send(email);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\t\tfunction: 'RocketChat.saveUser',\n\t\t\t\t\t\tmessage: error.message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tuserData._id = _id;\n\n\t\tif (RocketChat.settings.get('Accounts_SetDefaultAvatar') === true && userData.email) {\n\t\t\tconst gravatarUrl = Gravatar.imageUrl(userData.email, { default: '404', size: 200, secure: true });\n\n\t\t\ttry {\n\t\t\t\tRocketChat.setUserAvatar(userData, gravatarUrl, '', 'url');\n\t\t\t} catch (e) {\n\t\t\t\t//Ignore this error for now, as it not being successful isn't bad\n\t\t\t}\n\t\t}\n\n\t\treturn _id;\n\t} else {\n\t\t// update user\n\t\tif (userData.username) {\n\t\t\tRocketChat.setUsername(userData._id, userData.username);\n\t\t}\n\n\t\tif (userData.name) {\n\t\t\tRocketChat.setRealName(userData._id, userData.name);\n\t\t}\n\n\t\tif (userData.email) {\n\t\t\tconst shouldSendVerificationEmailToUser = userData.verified !== true;\n\t\t\tRocketChat.setEmail(userData._id, userData.email, shouldSendVerificationEmailToUser);\n\t\t}\n\n\t\tif (userData.password && userData.password.trim() && RocketChat.authz.hasPermission(userId, 'edit-other-user-password')) {\n\t\t\tAccounts.setPassword(userData._id, userData.password.trim());\n\t\t}\n\n\t\tconst updateUser = {\n\t\t\t$set: {}\n\t\t};\n\n\t\tif (userData.roles) {\n\t\t\tupdateUser.$set.roles = userData.roles;\n\t\t}\n\n\t\tif (userData.settings) {\n\t\t\tupdateUser.$set.settings = { preferences: userData.settings.preferences };\n\t\t}\n\n\t\tif (typeof userData.requirePasswordChange !== 'undefined') {\n\t\t\tupdateUser.$set.requirePasswordChange = userData.requirePasswordChange;\n\t\t}\n\n\t\tif (typeof userData.verified === 'boolean') {\n\t\t\tupdateUser.$set['emails.0.verified'] = userData.verified;\n\t\t}\n\n\t\tMeteor.users.update({ _id: userData._id }, updateUser);\n\n\t\treturn true;\n\t}\n};\n","import s from 'underscore.string';\n\nRocketChat.saveCustomFields = function(userId, formData) {\n\tif (s.trim(RocketChat.settings.get('Accounts_CustomFields')) !== '') {\n\t\tRocketChat.validateCustomFields(formData);\n\t\treturn RocketChat.saveCustomFieldsWithoutValidation(userId, formData);\n\t}\n};\n","import s from 'underscore.string';\n\nRocketChat.saveCustomFieldsWithoutValidation = function(userId, formData) {\n\tif (s.trim(RocketChat.settings.get('Accounts_CustomFields')) !== '') {\n\t\tlet customFieldsMeta;\n\t\ttry {\n\t\t\tcustomFieldsMeta = JSON.parse(RocketChat.settings.get('Accounts_CustomFields'));\n\t\t} catch (e) {\n\t\t\tthrow new Meteor.Error('error-invalid-customfield-json', 'Invalid JSON for Custom Fields');\n\t\t}\n\n\t\tconst customFields = {};\n\t\tObject.keys(customFieldsMeta).forEach(key => customFields[key] = formData[key]);\n\t\tRocketChat.models.Users.setCustomFields(userId, customFields);\n\n\t\t// Update customFields of all Direct Messages' Rooms for userId\n\t\tRocketChat.models.Subscriptions.setCustomFieldsDirectMessagesByUserId(userId, customFields);\n\n\t\tObject.keys(customFields).forEach((fieldName) => {\n\t\t\tif (!customFieldsMeta[fieldName].modifyRecordField) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst modifyRecordField = customFieldsMeta[fieldName].modifyRecordField;\n\t\t\tconst update = {};\n\t\t\tif (modifyRecordField.array) {\n\t\t\t\tupdate.$addToSet = {};\n\t\t\t\tupdate.$addToSet[modifyRecordField.field] = customFields[fieldName];\n\t\t\t} else {\n\t\t\t\tupdate.$set = {};\n\t\t\t\tupdate.$set[modifyRecordField.field] = customFields[fieldName];\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.update(userId, update);\n\t\t});\n\t}\n};\n","import _ from 'underscore';\n\nRocketChat.sendMessage = function(user, message, room, upsert = false) {\n\tif (!user || !message || !room._id) {\n\t\treturn false;\n\t}\n\tif (message.ts == null) {\n\t\tmessage.ts = new Date();\n\t}\n\tmessage.u = _.pick(user, ['_id', 'username', 'name']);\n\tif (!Match.test(message.msg, String)) {\n\t\tmessage.msg = '';\n\t}\n\tmessage.rid = room._id;\n\tif (!room.usernames || room.usernames.length === 0) {\n\t\tconst updated_room = RocketChat.models.Rooms.findOneById(room._id);\n\t\tif (updated_room != null) {\n\t\t\troom = updated_room;\n\t\t} else {\n\t\t\troom.usernames = [];\n\t\t}\n\t}\n\tif (message.parseUrls !== false) {\n\t\tconst urls = message.msg.match(/([A-Za-z]{3,9}):\\/\\/([-;:&=\\+\\$,\\w]+@{1})?([-A-Za-z0-9\\.]+)+:?(\\d+)?((\\/[-\\+=!:~%\\/\\.@\\,\\(\\)\\w]*)?\\??([-\\+=&!:;%@\\/\\.\\,\\w]+)?(?:#([^\\s\\)]+))?)?/g);\n\n\t\tif (urls) {\n\t\t\tmessage.urls = urls.map(function(url) {\n\t\t\t\treturn {\n\t\t\t\t\turl\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t}\n\n\tif (RocketChat.settings.get('Message_Read_Receipt_Enabled')) {\n\t\tmessage.unread = true;\n\t}\n\n\tmessage = RocketChat.callbacks.run('beforeSaveMessage', message);\n\tif (message) {\n\t\t// Avoid saving sandstormSessionId to the database\n\t\tlet sandstormSessionId = null;\n\t\tif (message.sandstormSessionId) {\n\t\t\tsandstormSessionId = message.sandstormSessionId;\n\t\t\tdelete message.sandstormSessionId;\n\t\t}\n\t\tif (message._id && upsert) {\n\t\t\tconst _id = message._id;\n\t\t\tdelete message._id;\n\t\t\tRocketChat.models.Messages.upsert({\n\t\t\t\t_id,\n\t\t\t\t'u._id': message.u._id\n\t\t\t}, message);\n\t\t\tmessage._id = _id;\n\t\t} else {\n\t\t\tmessage._id = RocketChat.models.Messages.insert(message);\n\t\t}\n\n\t\t/*\n\t\tDefer other updates as their return is not interesting to the user\n\t\t*/\n\t\tMeteor.defer(() => {\n\t\t\t// Execute all callbacks\n\t\t\tmessage.sandstormSessionId = sandstormSessionId;\n\t\t\treturn RocketChat.callbacks.run('afterSaveMessage', message, room, user._id);\n\t\t});\n\t\treturn message;\n\t}\n};\n","import _ from 'underscore';\n\nconst blockedSettings = {};\n\nif (process.env.SETTINGS_BLOCKED) {\n\tprocess.env.SETTINGS_BLOCKED.split(',').forEach((settingId) => blockedSettings[settingId] = 1);\n}\n\nconst hiddenSettings = {};\nif (process.env.SETTINGS_HIDDEN) {\n\tprocess.env.SETTINGS_HIDDEN.split(',').forEach((settingId) => hiddenSettings[settingId] = 1);\n}\n\nRocketChat.settings._sorter = {};\n\n\n/*\n* Add a setting\n* @param {String} _id\n* @param {Mixed} value\n* @param {Object} setting\n*/\n\nRocketChat.settings.add = function(_id, value, options = {}) {\n\tif (options == null) {\n\t\toptions = {};\n\t}\n\tif (!_id || value == null) {\n\t\treturn false;\n\t}\n\tif (RocketChat.settings._sorter[options.group] == null) {\n\t\tRocketChat.settings._sorter[options.group] = 0;\n\t}\n\toptions.packageValue = value;\n\toptions.valueSource = 'packageValue';\n\toptions.hidden = options.hidden || false;\n\toptions.blocked = options.blocked || false;\n\tif (options.sorter == null) {\n\t\toptions.sorter = RocketChat.settings._sorter[options.group]++;\n\t}\n\tif (options.enableQuery != null) {\n\t\toptions.enableQuery = JSON.stringify(options.enableQuery);\n\t}\n\tif (options.i18nDefaultQuery != null) {\n\t\toptions.i18nDefaultQuery = JSON.stringify(options.i18nDefaultQuery);\n\t}\n\tif (typeof process !== 'undefined' && process.env && process.env[_id]) {\n\t\tvalue = process.env[_id];\n\t\tif (value.toLowerCase() === 'true') {\n\t\t\tvalue = true;\n\t\t} else if (value.toLowerCase() === 'false') {\n\t\t\tvalue = false;\n\t\t}\n\t\toptions.processEnvValue = value;\n\t\toptions.valueSource = 'processEnvValue';\n\t} else if (Meteor.settings && typeof Meteor.settings[_id] !== 'undefined') {\n\t\tif (Meteor.settings[_id] == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvalue = Meteor.settings[_id];\n\t\toptions.meteorSettingsValue = value;\n\t\toptions.valueSource = 'meteorSettingsValue';\n\t}\n\tif (options.i18nLabel == null) {\n\t\toptions.i18nLabel = _id;\n\t}\n\tif (options.i18nDescription == null) {\n\t\toptions.i18nDescription = `${ _id }_Description`;\n\t}\n\tif (blockedSettings[_id] != null) {\n\t\toptions.blocked = true;\n\t}\n\tif (hiddenSettings[_id] != null) {\n\t\toptions.hidden = true;\n\t}\n\tif (typeof process !== 'undefined' && process.env && process.env[`OVERWRITE_SETTING_${ _id }`]) {\n\t\tlet value = process.env[`OVERWRITE_SETTING_${ _id }`];\n\t\tif (value.toLowerCase() === 'true') {\n\t\t\tvalue = true;\n\t\t} else if (value.toLowerCase() === 'false') {\n\t\t\tvalue = false;\n\t\t}\n\t\toptions.value = value;\n\t\toptions.processEnvValue = value;\n\t\toptions.valueSource = 'processEnvValue';\n\t}\n\tconst updateOperations = {\n\t\t$set: options,\n\t\t$setOnInsert: {\n\t\t\tcreatedAt: new Date\n\t\t}\n\t};\n\tif (options.editor != null) {\n\t\tupdateOperations.$setOnInsert.editor = options.editor;\n\t\tdelete options.editor;\n\t}\n\tif (options.value == null) {\n\t\tif (options.force === true) {\n\t\t\tupdateOperations.$set.value = options.packageValue;\n\t\t} else {\n\t\t\tupdateOperations.$setOnInsert.value = value;\n\t\t}\n\t}\n\tconst query = _.extend({\n\t\t_id\n\t}, updateOperations.$set);\n\tif (options.section == null) {\n\t\tupdateOperations.$unset = {\n\t\t\tsection: 1\n\t\t};\n\t\tquery.section = {\n\t\t\t$exists: false\n\t\t};\n\t}\n\tconst existantSetting = RocketChat.models.Settings.db.findOne(query);\n\tif (existantSetting != null) {\n\t\tif (existantSetting.editor == null && updateOperations.$setOnInsert.editor != null) {\n\t\t\tupdateOperations.$set.editor = updateOperations.$setOnInsert.editor;\n\t\t\tdelete updateOperations.$setOnInsert.editor;\n\t\t}\n\t} else {\n\t\tupdateOperations.$set.ts = new Date;\n\t}\n\treturn RocketChat.models.Settings.upsert({\n\t\t_id\n\t}, updateOperations);\n};\n\n\n/*\n* Add a setting group\n* @param {String} _id\n*/\n\nRocketChat.settings.addGroup = function(_id, options = {}, cb) {\n\tif (!_id) {\n\t\treturn false;\n\t}\n\tif (_.isFunction(options)) {\n\t\tcb = options;\n\t\toptions = {};\n\t}\n\tif (options.i18nLabel == null) {\n\t\toptions.i18nLabel = _id;\n\t}\n\tif (options.i18nDescription == null) {\n\t\toptions.i18nDescription = `${ _id }_Description`;\n\t}\n\toptions.ts = new Date;\n\toptions.blocked = false;\n\toptions.hidden = false;\n\tif (blockedSettings[_id] != null) {\n\t\toptions.blocked = true;\n\t}\n\tif (hiddenSettings[_id] != null) {\n\t\toptions.hidden = true;\n\t}\n\tRocketChat.models.Settings.upsert({\n\t\t_id\n\t}, {\n\t\t$set: options,\n\t\t$setOnInsert: {\n\t\t\ttype: 'group',\n\t\t\tcreatedAt: new Date\n\t\t}\n\t});\n\tif (cb != null) {\n\t\tcb.call({\n\t\t\tadd(id, value, options) {\n\t\t\t\tif (options == null) {\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.group = _id;\n\t\t\t\treturn RocketChat.settings.add(id, value, options);\n\t\t\t},\n\t\t\tsection(section, cb) {\n\t\t\t\treturn cb.call({\n\t\t\t\t\tadd(id, value, options) {\n\t\t\t\t\t\tif (options == null) {\n\t\t\t\t\t\t\toptions = {};\n\t\t\t\t\t\t}\n\t\t\t\t\t\toptions.group = _id;\n\t\t\t\t\t\toptions.section = section;\n\t\t\t\t\t\treturn RocketChat.settings.add(id, value, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n};\n\n\n/*\n* Remove a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.removeById = function(_id) {\n\tif (!_id) {\n\t\treturn false;\n\t}\n\treturn RocketChat.models.Settings.removeById(_id);\n};\n\n\n/*\n* Update a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.updateById = function(_id, value, editor) {\n\tif (!_id || value == null) {\n\t\treturn false;\n\t}\n\tif (editor != null) {\n\t\treturn RocketChat.models.Settings.updateValueAndEditorById(_id, value, editor);\n\t}\n\treturn RocketChat.models.Settings.updateValueById(_id, value);\n};\n\n\n/*\n* Update options of a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.updateOptionsById = function(_id, options) {\n\tif (!_id || options == null) {\n\t\treturn false;\n\t}\n\treturn RocketChat.models.Settings.updateOptionsById(_id, options);\n};\n\n\n/*\n* Update a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.clearById = function(_id) {\n\tif (_id == null) {\n\t\treturn false;\n\t}\n\treturn RocketChat.models.Settings.updateValueById(_id, undefined);\n};\n\n\n/*\n* Update a setting by id\n*/\n\nRocketChat.settings.init = function() {\n\tRocketChat.settings.initialLoad = true;\n\tRocketChat.models.Settings.find().observe({\n\t\tadded(record) {\n\t\t\tMeteor.settings[record._id] = record.value;\n\t\t\tif (record.env === true) {\n\t\t\t\tprocess.env[record._id] = record.value;\n\t\t\t}\n\t\t\treturn RocketChat.settings.load(record._id, record.value, RocketChat.settings.initialLoad);\n\t\t},\n\t\tchanged(record) {\n\t\t\tMeteor.settings[record._id] = record.value;\n\t\t\tif (record.env === true) {\n\t\t\t\tprocess.env[record._id] = record.value;\n\t\t\t}\n\t\t\treturn RocketChat.settings.load(record._id, record.value, RocketChat.settings.initialLoad);\n\t\t},\n\t\tremoved(record) {\n\t\t\tdelete Meteor.settings[record._id];\n\t\t\tif (record.env === true) {\n\t\t\t\tdelete process.env[record._id];\n\t\t\t}\n\t\t\treturn RocketChat.settings.load(record._id, undefined, RocketChat.settings.initialLoad);\n\t\t}\n\t});\n\tRocketChat.settings.initialLoad = false;\n\tRocketChat.settings.afterInitialLoad.forEach(fn => fn(Meteor.settings));\n};\n\nRocketChat.settings.afterInitialLoad = [];\n\nRocketChat.settings.onAfterInitialLoad = function(fn) {\n\tRocketChat.settings.afterInitialLoad.push(fn);\n\tif (RocketChat.settings.initialLoad === false) {\n\t\treturn fn(Meteor.settings);\n\t}\n};\n","RocketChat.setUserAvatar = function(user, dataURI, contentType, service) {\n\tlet encoding;\n\tlet image;\n\n\tif (service === 'initials') {\n\t\treturn RocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t} else if (service === 'url') {\n\t\tlet result = null;\n\n\t\ttry {\n\t\t\tresult = HTTP.get(dataURI, { npmRequestOptions: {encoding: 'binary'} });\n\t\t} catch (error) {\n\t\t\tif (!error.response || error.response.statusCode !== 404) {\n\t\t\t\tconsole.log(`Error while handling the setting of the avatar from a url (${ dataURI }) for ${ user.username }:`, error);\n\t\t\t\tthrow new Meteor.Error('error-avatar-url-handling', `Error while handling avatar setting from a URL (${ dataURI }) for ${ user.username }`, { function: 'RocketChat.setUserAvatar', url: dataURI, username: user.username });\n\t\t\t}\n\t\t}\n\n\t\tif (result.statusCode !== 200) {\n\t\t\tconsole.log(`Not a valid response, ${ result.statusCode }, from the avatar url: ${ dataURI }`);\n\t\t\tthrow new Meteor.Error('error-avatar-invalid-url', `Invalid avatar URL: ${ dataURI }`, { function: 'RocketChat.setUserAvatar', url: dataURI });\n\t\t}\n\n\t\tif (!/image\\/.+/.test(result.headers['content-type'])) {\n\t\t\tconsole.log(`Not a valid content-type from the provided url, ${ result.headers['content-type'] }, from the avatar url: ${ dataURI }`);\n\t\t\tthrow new Meteor.Error('error-avatar-invalid-url', `Invalid avatar URL: ${ dataURI }`, { function: 'RocketChat.setUserAvatar', url: dataURI });\n\t\t}\n\n\t\tencoding = 'binary';\n\t\timage = result.content;\n\t\tcontentType = result.headers['content-type'];\n\t} else if (service === 'rest') {\n\t\tencoding = 'binary';\n\t\timage = dataURI;\n\t} else {\n\t\tconst fileData = RocketChatFile.dataURIParse(dataURI);\n\t\tencoding = 'base64';\n\t\timage = fileData.image;\n\t\tcontentType = fileData.contentType;\n\t}\n\n\tconst buffer = new Buffer(image, encoding);\n\tconst fileStore = FileUpload.getStore('Avatars');\n\tfileStore.deleteByName(user.username);\n\n\tconst file = {\n\t\tuserId: user._id,\n\t\ttype: contentType,\n\t\tsize: buffer.length\n\t};\n\n\tfileStore.insert(file, buffer, () => {\n\t\tMeteor.setTimeout(function() {\n\t\t\tRocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {username: user.username});\n\t\t}, 500);\n\t});\n};\n","import s from 'underscore.string';\n\nRocketChat._setUsername = function(userId, u) {\n\tconst username = s.trim(u);\n\tif (!userId || !username) {\n\t\treturn false;\n\t}\n\tlet nameValidation;\n\ttry {\n\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t} catch (error) {\n\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t}\n\tif (!nameValidation.test(username)) {\n\t\treturn false;\n\t}\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\t// User already has desired username, return\n\tif (user.username === username) {\n\t\treturn user;\n\t}\n\tconst previousUsername = user.username;\n\t// Check username availability or if the user already owns a different casing of the name\n\tif (!previousUsername || !(username.toLowerCase() === previousUsername.toLowerCase())) {\n\t\tif (!RocketChat.checkUsernameAvailability(username)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\t//If first time setting username, send Enrollment Email\n\ttry {\n\t\tif (!previousUsername && user.emails && user.emails.length > 0 && RocketChat.settings.get('Accounts_Enrollment_Email')) {\n\t\t\tAccounts.sendEnrollmentEmail(user._id);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error(e);\n\t}\n\t/* globals getAvatarSuggestionForUser */\n\tuser.username = username;\n\tif (!previousUsername && RocketChat.settings.get('Accounts_SetDefaultAvatar') === true) {\n\t\tconst avatarSuggestions = getAvatarSuggestionForUser(user);\n\t\tlet gravatar;\n\t\tObject.keys(avatarSuggestions).some(service => {\n\t\t\tconst avatarData = avatarSuggestions[service];\n\t\t\tif (service !== 'gravatar') {\n\t\t\t\tRocketChat.setUserAvatar(user, avatarData.blob, avatarData.contentType, service);\n\t\t\t\tgravatar = null;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tgravatar = avatarData;\n\t\t\t}\n\t\t});\n\t\tif (gravatar != null) {\n\t\t\tRocketChat.setUserAvatar(user, gravatar.blob, gravatar.contentType, 'gravatar');\n\t\t}\n\t}\n\t// Username is available; if coming from old username, update all references\n\tif (previousUsername) {\n\t\tRocketChat.models.Messages.updateAllUsernamesByUserId(user._id, username);\n\t\tRocketChat.models.Messages.updateUsernameOfEditByUserId(user._id, username);\n\t\tRocketChat.models.Messages.findByMention(previousUsername).forEach(function(msg) {\n\t\t\tconst updatedMsg = msg.msg.replace(new RegExp(`@${ previousUsername }`, 'ig'), `@${ username }`);\n\t\t\treturn RocketChat.models.Messages.updateUsernameAndMessageOfMentionByIdAndOldUsername(msg._id, previousUsername, username, updatedMsg);\n\t\t});\n\t\tRocketChat.models.Rooms.replaceUsername(previousUsername, username);\n\t\tRocketChat.models.Rooms.replaceMutedUsername(previousUsername, username);\n\t\tRocketChat.models.Rooms.replaceUsernameOfUserByUserId(user._id, username);\n\t\tRocketChat.models.Subscriptions.setUserUsernameByUserId(user._id, username);\n\t\tRocketChat.models.Subscriptions.setNameForDirectRoomsWithOldName(previousUsername, username);\n\n\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\tconst file = fileStore.model.findOneByName(previousUsername);\n\t\tif (file) {\n\t\t\tfileStore.model.updateFileNameById(file._id, username);\n\t\t}\n\t}\n\t// Set new username*\n\tRocketChat.models.Users.setUsername(user._id, username);\n\treturn user;\n};\n\nRocketChat.setUsername = RocketChat.RateLimiter.limitFunction(RocketChat._setUsername, 1, 60000, {\n\t[0](userId) {\n\t\treturn !userId || !RocketChat.authz.hasPermission(userId, 'edit-other-user-info');\n\t}\n});\n","import s from 'underscore.string';\n\nRocketChat._setRealName = function(userId, name) {\n\tname = s.trim(name);\n\tif (!userId || !name) {\n\t\treturn false;\n\t}\n\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t// User already has desired name, return\n\tif (user.name === name) {\n\t\treturn user;\n\t}\n\n\t// Set new name\n\tRocketChat.models.Users.setName(user._id, name);\n\tuser.name = name;\n\n\tif (RocketChat.settings.get('UI_Use_Real_Name') === true) {\n\t\tRocketChat.Notifications.notifyLogged('Users:NameChanged', {\n\t\t\t_id: user._id,\n\t\t\tname: user.name,\n\t\t\tusername: user.username\n\t\t});\n\t}\n\n\treturn user;\n};\n\nRocketChat.setRealName = RocketChat.RateLimiter.limitFunction(RocketChat._setRealName, 1, 60000, {\n\t0() { return !Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-info'); } // Administrators have permission to change others names, so don't limit those\n});\n","import s from 'underscore.string';\n\nRocketChat._setEmail = function(userId, email, shouldSendVerificationEmail = true) {\n\temail = s.trim(email);\n\tif (!userId) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { function: '_setEmail' });\n\t}\n\n\tif (!email) {\n\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email', { function: '_setEmail' });\n\t}\n\n\tRocketChat.validateEmailDomain(email);\n\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t// User already has desired username, return\n\tif (user.emails && user.emails[0] && user.emails[0].address === email) {\n\t\treturn user;\n\t}\n\n\t// Check email availability\n\tif (!RocketChat.checkEmailAvailability(email)) {\n\t\tthrow new Meteor.Error('error-field-unavailable', `${ email } is already in use :(`, { function: '_setEmail', field: email });\n\t}\n\n\t// Set new email\n\tRocketChat.models.Users.setEmail(user._id, email);\n\tuser.email = email;\n\tif (shouldSendVerificationEmail === true) {\n\t\tMeteor.call('sendConfirmationEmail', user.email);\n\t}\n\treturn user;\n};\n\nRocketChat.setEmail = RocketChat.RateLimiter.limitFunction(RocketChat._setEmail, 1, 60000, {\n\t0() { return !Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-info'); } // Administrators have permission to change others emails, so don't limit those\n});\n","RocketChat.unarchiveRoom = function(rid) {\n\tRocketChat.models.Rooms.unarchiveById(rid);\n\tRocketChat.models.Subscriptions.unarchiveByRoomId(rid);\n};\n","RocketChat.updateMessage = function(message, user) {\n\t// If we keep history of edits, insert a new message to store history information\n\tif (RocketChat.settings.get('Message_KeepHistory')) {\n\t\tRocketChat.models.Messages.cloneAndSaveAsHistoryById(message._id);\n\t}\n\n\tmessage.editedAt = new Date();\n\tmessage.editedBy = {\n\t\t_id: user._id,\n\t\tusername: user.username\n\t};\n\n\tconst urls = message.msg.match(/([A-Za-z]{3,9}):\\/\\/([-;:&=\\+\\$,\\w]+@{1})?([-A-Za-z0-9\\.]+)+:?(\\d+)?((\\/[-\\+=!:~%\\/\\.@\\,\\w]*)?\\??([-\\+=&!:;%@\\/\\.\\,\\w]+)?(?:#([^\\s\\)]+))?)?/g);\n\tif (urls) {\n\t\tmessage.urls = urls.map((url) => { return { url }; });\n\t}\n\n\tmessage = RocketChat.callbacks.run('beforeSaveMessage', message);\n\n\tconst tempid = message._id;\n\tdelete message._id;\n\n\tRocketChat.models.Messages.update({ _id: tempid }, { $set: message });\n\n\tconst room = RocketChat.models.Rooms.findOneById(message.rid);\n\n\tMeteor.defer(function() {\n\t\tRocketChat.callbacks.run('afterSaveMessage', RocketChat.models.Messages.findOneById(tempid), room, user._id);\n\t});\n};\n","import s from 'underscore.string';\n\nRocketChat.validateCustomFields = function(fields) {\n\t// Special Case:\n\t// If an admin didn't set any custom fields there's nothing to validate against so consider any customFields valid\n\tif (s.trim(RocketChat.settings.get('Accounts_CustomFields')) === '') {\n\t\treturn;\n\t}\n\n\tlet customFieldsMeta;\n\ttry {\n\t\tcustomFieldsMeta = JSON.parse(RocketChat.settings.get('Accounts_CustomFields'));\n\t} catch (e) {\n\t\tthrow new Meteor.Error('error-invalid-customfield-json', 'Invalid JSON for Custom Fields');\n\t}\n\n\tconst customFields = {};\n\n\tObject.keys(customFieldsMeta).forEach((fieldName) => {\n\t\tconst field = customFieldsMeta[fieldName];\n\n\t\tcustomFields[fieldName] = fields[fieldName];\n\t\tconst fieldValue = s.trim(fields[fieldName]);\n\n\t\tif (field.required && fieldValue === '') {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Field ${ fieldName } is required`, {method: 'registerUser'});\n\t\t}\n\n\t\tif (field.type === 'select' && field.options.indexOf(fields[fieldName]) === -1) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Value for field ${ fieldName } is invalid`, {method: 'registerUser'});\n\t\t}\n\n\t\tif (field.maxLength && fieldValue.length > field.maxLength) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Max length of field ${ fieldName } ${ field.maxLength }`, {method: 'registerUser'});\n\t\t}\n\n\t\tif (field.minLength && fieldValue.length < field.minLength) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Min length of field ${ fieldName } ${ field.minLength }`, {method: 'registerUser'});\n\t\t}\n\t});\n};\n","RocketChat.Notifications = new class {\n\tconstructor() {\n\t\tthis.debug = false;\n\t\tthis.streamAll = new Meteor.Streamer('notify-all');\n\t\tthis.streamLogged = new Meteor.Streamer('notify-logged');\n\t\tthis.streamRoom = new Meteor.Streamer('notify-room');\n\t\tthis.streamRoomUsers = new Meteor.Streamer('notify-room-users');\n\t\tthis.streamUser = new Meteor.Streamer('notify-user');\n\t\tthis.streamAll.allowWrite('none');\n\t\tthis.streamLogged.allowWrite('none');\n\t\tthis.streamRoom.allowWrite('none');\n\t\tthis.streamRoomUsers.allowWrite(function(eventName, ...args) {\n\t\t\tconst [roomId, e] = eventName.split('/');\n\t\t\t// const user = Meteor.users.findOne(this.userId, {\n\t\t\t// \tfields: {\n\t\t\t// \t\tusername: 1\n\t\t\t// \t}\n\t\t\t// });\n\t\t\tif (RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(roomId, this.userId) != null) {\n\t\t\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomIdAndNotUserId(roomId, this.userId).fetch();\n\t\t\t\tsubscriptions.forEach(subscription => RocketChat.Notifications.notifyUser(subscription.u._id, e, ...args));\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\tthis.streamUser.allowWrite('logged');\n\t\tthis.streamAll.allowRead('all');\n\t\tthis.streamLogged.allowRead('logged');\n\t\tthis.streamRoom.allowRead(function(eventName, extraData) {\n\t\t\tconst [roomId] = eventName.split('/');\n\t\t\tconst user = Meteor.users.findOne(this.userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\t\tif (!room) {\n\t\t\t\tconsole.warn(`Invalid streamRoom eventName: \"${ eventName }\"`);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (room.t === 'l' && extraData && extraData.token && room.v.token === extraData.token) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this.userId == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn room.usernames.indexOf(user.username) > -1;\n\t\t});\n\t\tthis.streamRoomUsers.allowRead('none');\n\t\tthis.streamUser.allowRead(function(eventName) {\n\t\t\tconst [userId] = eventName.split('/');\n\t\t\treturn (this.userId != null) && this.userId === userId;\n\t\t});\n\t}\n\n\tnotifyAll(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyAll', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamAll.emit.apply(this.streamAll, args);\n\t}\n\n\tnotifyLogged(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyLogged', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamLogged.emit.apply(this.streamLogged, args);\n\t}\n\n\tnotifyRoom(room, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyRoom', arguments);\n\t\t}\n\t\targs.unshift(`${ room }/${ eventName }`);\n\t\treturn this.streamRoom.emit.apply(this.streamRoom, args);\n\t}\n\n\tnotifyUser(userId, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyUser', arguments);\n\t\t}\n\t\targs.unshift(`${ userId }/${ eventName }`);\n\t\treturn this.streamUser.emit.apply(this.streamUser, args);\n\t}\n\n\tnotifyAllInThisInstance(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyAll', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamAll.emitWithoutBroadcast.apply(this.streamAll, args);\n\t}\n\n\tnotifyLoggedInThisInstance(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyLogged', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamLogged.emitWithoutBroadcast.apply(this.streamLogged, args);\n\t}\n\n\tnotifyRoomInThisInstance(room, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyRoomAndBroadcast', arguments);\n\t\t}\n\t\targs.unshift(`${ room }/${ eventName }`);\n\t\treturn this.streamRoom.emitWithoutBroadcast.apply(this.streamRoom, args);\n\t}\n\n\tnotifyUserInThisInstance(userId, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyUserAndBroadcast', arguments);\n\t\t}\n\t\targs.unshift(`${ userId }/${ eventName }`);\n\t\treturn this.streamUser.emitWithoutBroadcast.apply(this.streamUser, args);\n\t}\n};\n\nRocketChat.Notifications.streamRoom.allowWrite(function(eventName, username, typing, extraData) {\n\tconst [roomId, e] = eventName.split('/');\n\tif (e === 'webrtc') {\n\t\treturn true;\n\t}\n\tif (e === 'typing') {\n\n\t\t// typing from livechat widget\n\t\tif (extraData && extraData.token) {\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\t\tif (room && room.t === 'l' && room.v.token === extraData.token) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tconst user = Meteor.users.findOne(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\t\tif (user != null && user.username === username) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n});\n","import ModelsBaseDb from './_BaseDb';\nimport ModelsBaseCache from './_BaseCache';\n\nRocketChat.models._CacheControl = new Meteor.EnvironmentVariable();\n\nclass ModelsBase {\n\tconstructor(nameOrModel, useCache) {\n\t\tthis._db = new ModelsBaseDb(nameOrModel, this);\n\t\tthis.model = this._db.model;\n\t\tthis.collectionName = this._db.collectionName;\n\t\tthis.name = this._db.name;\n\n\t\tthis._useCache = useCache === true;\n\n\t\tthis.cache = new ModelsBaseCache(this);\n\t\t// TODO_CACHE: remove\n\t\tthis.on = this.cache.on.bind(this.cache);\n\t\tthis.emit = this.cache.emit.bind(this.cache);\n\t\tthis.getDynamicView = this.cache.getDynamicView.bind(this.cache);\n\t\tthis.processQueryOptionsOnResult = this.cache.processQueryOptionsOnResult.bind(this.cache);\n\t\t// END_TODO_CACHE\n\n\t\tthis.db = this;\n\n\t\tif (this._useCache) {\n\t\t\tthis.db = new this.constructor(this.model, false);\n\t\t}\n\t}\n\n\tget useCache() {\n\t\tif (RocketChat.models._CacheControl.get() === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this._useCache;\n\t}\n\n\tget origin() {\n\t\treturn this.useCache === true ? 'cache' : '_db';\n\t}\n\n\tarrayToCursor(data) {\n\t\treturn {\n\t\t\tfetch() {\n\t\t\t\treturn data;\n\t\t\t},\n\t\t\tcount() {\n\t\t\t\treturn data.length;\n\t\t\t},\n\t\t\tforEach(fn) {\n\t\t\t\treturn data.forEach(fn);\n\t\t\t}\n\t\t};\n\t}\n\n\tsetUpdatedAt(/*record, checkQuery, query*/) {\n\t\treturn this._db.setUpdatedAt(...arguments);\n\t}\n\n\tfind() {\n\t\ttry {\n\t\t\treturn this[this.origin].find(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tfindOne() {\n\t\ttry {\n\t\t\treturn this[this.origin].findOne(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tfindOneById() {\n\t\ttry {\n\t\t\treturn this[this.origin].findOneById(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tfindOneByIds(ids, options) {\n\t\tcheck(ids, [String]);\n\n\t\ttry {\n\t\t\treturn this[this.origin].findOneByIds(ids, options);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tinsert(/*record*/) {\n\t\treturn this._db.insert(...arguments);\n\t}\n\n\tupdate(/*query, update, options*/) {\n\t\treturn this._db.update(...arguments);\n\t}\n\n\tupsert(/*query, update*/) {\n\t\treturn this._db.upsert(...arguments);\n\t}\n\n\tremove(/*query*/) {\n\t\treturn this._db.remove(...arguments);\n\t}\n\n\tinsertOrUpsert() {\n\t\treturn this._db.insertOrUpsert(...arguments);\n\t}\n\n\tallow() {\n\t\treturn this._db.allow(...arguments);\n\t}\n\n\tdeny() {\n\t\treturn this._db.deny(...arguments);\n\t}\n\n\tensureIndex() {\n\t\treturn this._db.ensureIndex(...arguments);\n\t}\n\n\tdropIndex() {\n\t\treturn this._db.dropIndex(...arguments);\n\t}\n\n\ttryEnsureIndex() {\n\t\treturn this._db.tryEnsureIndex(...arguments);\n\t}\n\n\ttryDropIndex() {\n\t\treturn this._db.tryDropIndex(...arguments);\n\t}\n\n\ttrashFind(/*query, options*/) {\n\t\treturn this._db.trashFind(...arguments);\n\t}\n\n\ttrashFindDeletedAfter(/*deletedAt, query, options*/) {\n\t\treturn this._db.trashFindDeletedAfter(...arguments);\n\t}\n\n\t// dinamicTrashFindAfter(method, deletedAt, ...args) {\n\t// \tconst scope = {\n\t// \t\tfind: (query={}) => {\n\t// \t\t\treturn this.trashFindDeletedAfter(deletedAt, query, { fields: {_id: 1, _deletedAt: 1} });\n\t// \t\t}\n\t// \t};\n\n\t// \tscope.model = {\n\t// \t\tfind: scope.find\n\t// \t};\n\n\t// \treturn this[method].apply(scope, args);\n\t// }\n\n\t// dinamicFindAfter(method, updatedAt, ...args) {\n\t// \tconst scope = {\n\t// \t\tfind: (query={}, options) => {\n\t// \t\t\tquery._updatedAt = {\n\t// \t\t\t\t$gt: updatedAt\n\t// \t\t\t};\n\n\t// \t\t\treturn this.find(query, options);\n\t// \t\t}\n\t// \t};\n\n\t// \tscope.model = {\n\t// \t\tfind: scope.find\n\t// \t};\n\n\t// \treturn this[method].apply(scope, args);\n\t// }\n\n\t// dinamicFindChangesAfter(method, updatedAt, ...args) {\n\t// \treturn {\n\t// \t\tupdate: this.dinamicFindAfter(method, updatedAt, ...args).fetch(),\n\t// \t\tremove: this.dinamicTrashFindAfter(method, updatedAt, ...args).fetch()\n\t// \t};\n\t// }\n\n}\n\nRocketChat.models._Base = ModelsBase;\n","/* globals InstanceStatus */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.models.Avatars = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('avatars');\n\n\t\tthis.model.before.insert((userId, doc) => {\n\t\t\tdoc.instanceId = InstanceStatus.id();\n\t\t});\n\n\t\tthis.tryEnsureIndex({ name: 1 });\n\t}\n\n\tinsertAvatarFileInit(name, userId, store, file, extra) {\n\t\tconst fileData = {\n\t\t\t_id: name,\n\t\t\tname,\n\t\t\tuserId,\n\t\t\tstore,\n\t\t\tcomplete: false,\n\t\t\tuploading: true,\n\t\t\tprogress: 0,\n\t\t\textension: s.strRightBack(file.name, '.'),\n\t\t\tuploadedAt: new Date()\n\t\t};\n\n\t\t_.extend(fileData, file, extra);\n\n\t\treturn this.insertOrUpsert(fileData);\n\t}\n\n\tupdateFileComplete(fileId, userId, file) {\n\t\tif (!fileId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst filter = {\n\t\t\t_id: fileId,\n\t\t\tuserId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tprogress: 1\n\t\t\t}\n\t\t};\n\n\t\tupdate.$set = _.extend(file, update.$set);\n\n\t\tif (this.model.direct && this.model.direct.update) {\n\t\t\treturn this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\treturn this.update(filter, update);\n\t\t}\n\t}\n\n\tfindOneByName(name) {\n\t\treturn this.findOne({ name });\n\t}\n\n\tupdateFileNameById(fileId, name) {\n\t\tconst filter = { _id: fileId };\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\t\tif (this.model.direct && this.model.direct.update) {\n\t\t\treturn this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\treturn this.update(filter, update);\n\t\t}\n\t}\n\n\t// @TODO deprecated\n\tupdateFileCompleteByNameAndUserId(name, userId, url) {\n\t\tif (!name) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst filter = {\n\t\t\tname,\n\t\t\tuserId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tprogress: 1,\n\t\t\t\turl\n\t\t\t}\n\t\t};\n\n\t\tif (this.model.direct && this.model.direct.update) {\n\t\t\treturn this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\treturn this.update(filter, update);\n\t\t}\n\t}\n\n\tdeleteFile(fileId) {\n\t\tif (this.model.direct && this.model.direct.remove) {\n\t\t\treturn this.model.direct.remove({ _id: fileId });\n\t\t} else {\n\t\t\treturn this.remove({ _id: fileId });\n\t\t}\n\t}\n};\n","import _ from 'underscore';\n\nRocketChat.models.Messages = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('message');\n\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'ts': 1 });\n\t\tthis.tryEnsureIndex({ 'ts': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1 });\n\t\tthis.tryEnsureIndex({ 'editedAt': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'editedBy._id': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'rid': 1, 't': 1, 'u._id': 1 });\n\t\tthis.tryEnsureIndex({ 'expireAt': 1 }, { expireAfterSeconds: 0 });\n\t\tthis.tryEnsureIndex({ 'msg': 'text' });\n\t\tthis.tryEnsureIndex({ 'file._id': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'mentions.username': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'pinned': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'snippeted': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'location': '2dsphere' });\n\t\tthis.tryEnsureIndex({ 'slackBotId': 1, 'slackTs': 1 }, { sparse: 1 });\n\t}\n\n\t// FIND\n\tfindByMention(username, options) {\n\t\tconst query =\t{'mentions.username': username};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByMentionAndRoomId(username, rid, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\t'mentions.username': username,\n\t\t\trid\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomId(roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdNotContainingTypes(roomId, types, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\n\t\t\trid: roomId\n\t\t};\n\n\t\tif (Match.test(types, [String]) && (types.length > 0)) {\n\t\t\tquery.t =\n\t\t\t{$nin: types};\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindInvisibleByRoomId(roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: true,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdAfterTimestamp(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gt: timestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindForUpdates(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: timestamp\n\t\t\t}\n\t\t};\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBeforeTimestamp(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$lt: timestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBeforeTimestampInclusive(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$lte: timestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBetweenTimestamps(roomId, afterTimestamp, beforeTimestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gt: afterTimestamp,\n\t\t\t\t$lt: beforeTimestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBetweenTimestampsInclusive(roomId, afterTimestamp, beforeTimestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gte: afterTimestamp,\n\t\t\t\t$lte: beforeTimestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBeforeTimestampNotContainingTypes(roomId, timestamp, types, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$lt: timestamp\n\t\t\t}\n\t\t};\n\n\t\tif (Match.test(types, [String]) && (types.length > 0)) {\n\t\t\tquery.t =\n\t\t\t{$nin: types};\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBetweenTimestampsNotContainingTypes(roomId, afterTimestamp, beforeTimestamp, types, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gt: afterTimestamp,\n\t\t\t\t$lt: beforeTimestamp\n\t\t\t}\n\t\t};\n\n\t\tif (Match.test(types, [String]) && (types.length > 0)) {\n\t\t\tquery.t =\n\t\t\t{$nin: types};\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleCreatedOrEditedAfterTimestamp(timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\t$or: [{\n\t\t\t\tts: {\n\t\t\t\t\t$gt: timestamp\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t'editedAt': {\n\t\t\t\t\t$gt: timestamp\n\t\t\t\t}\n\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindStarredByUserAtRoom(userId, roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\t'starred._id': userId,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindPinnedByRoom(roomId, options) {\n\t\tconst query = {\n\t\t\tt: { $ne: 'rm' },\n\t\t\t_hidden: { $ne: true },\n\t\t\tpinned: true,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindSnippetedByRoom(roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\tsnippeted: true,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tgetLastTimestamp(options) {\n\t\tif (options == null) { options = {}; }\n\t\tconst query = { ts: { $exists: 1 } };\n\t\toptions.sort = { ts: -1 };\n\t\toptions.limit = 1;\n\t\tconst [message] = this.find(query, options).fetch();\n\t\treturn message && message.ts;\n\t}\n\n\tfindByRoomIdAndMessageIds(rid, messageIds, options) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t_id: {\n\t\t\t\t$in: messageIds\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindOneBySlackBotIdAndSlackTs(slackBotId, slackTs) {\n\t\tconst query = {\n\t\t\tslackBotId,\n\t\t\tslackTs\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindOneBySlackTs(slackTs) {\n\t\tconst query = {slackTs};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tgetLastVisibleMessageSentWithNoTypeByRoomId(rid, messageId) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t_hidden: { $ne: true },\n\t\t\tt: { $exists: false }\n\t\t};\n\n\t\tif (messageId) {\n\t\t\tquery._id = { $ne: messageId };\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tcloneAndSaveAsHistoryById(_id) {\n\t\tconst me = RocketChat.models.Users.findOneById(Meteor.userId());\n\t\tconst record = this.findOneById(_id);\n\t\trecord._hidden = true;\n\t\trecord.parent = record._id;\n\t\trecord.editedAt = new Date;\n\t\trecord.editedBy = {\n\t\t\t_id: Meteor.userId(),\n\t\t\tusername: me.username\n\t\t};\n\t\tdelete record._id;\n\t\treturn this.insert(record);\n\t}\n\n\t// UPDATE\n\tsetHiddenById(_id, hidden) {\n\t\tif (hidden == null) { hidden = true; }\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t_hidden: hidden\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAsDeletedByIdAndUser(_id, user) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tmsg: '',\n\t\t\t\tt: 'rm',\n\t\t\t\turls: [],\n\t\t\t\tmentions: [],\n\t\t\t\tattachments: [],\n\t\t\t\treactions: [],\n\t\t\t\teditedAt: new Date(),\n\t\t\t\teditedBy: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetPinnedByIdAndUserId(_id, pinnedBy, pinned, pinnedAt) {\n\t\tif (pinned == null) { pinned = true; }\n\t\tif (pinnedAt == null) { pinnedAt = 0; }\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tpinned,\n\t\t\t\tpinnedAt: pinnedAt || new Date,\n\t\t\t\tpinnedBy\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetSnippetedByIdAndUserId(message, snippetName, snippetedBy, snippeted, snippetedAt) {\n\t\tif (snippeted == null) { snippeted = true; }\n\t\tif (snippetedAt == null) { snippetedAt = 0; }\n\t\tconst query =\t{_id: message._id};\n\n\t\tconst msg = `\\`\\`\\`${ message.msg }\\`\\`\\``;\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tmsg,\n\t\t\t\tsnippeted,\n\t\t\t\tsnippetedAt: snippetedAt || new Date,\n\t\t\t\tsnippetedBy,\n\t\t\t\tsnippetName\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetUrlsById(_id, urls) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\turls\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateAllUsernamesByUserId(userId, username) {\n\t\tconst query =\t{'u._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'u.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tupdateUsernameOfEditByUserId(userId, username) {\n\t\tconst query =\t{'editedBy._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'editedBy.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tupdateUsernameAndMessageOfMentionByIdAndOldUsername(_id, oldUsername, newUsername, newMessage) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\t'mentions.username': oldUsername\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'mentions.$.username': newUsername,\n\t\t\t\t'msg': newMessage\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateUserStarById(_id, userId, starred) {\n\t\tlet update;\n\t\tconst query =\t{_id};\n\n\t\tif (starred) {\n\t\t\tupdate = {\n\t\t\t\t$addToSet: {\n\t\t\t\t\tstarred: { _id: userId }\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\tupdate = {\n\t\t\t\t$pull: {\n\t\t\t\t\tstarred: { _id: Meteor.userId() }\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupgradeEtsToEditAt() {\n\t\tconst query =\t{ets: { $exists: 1 }};\n\n\t\tconst update = {\n\t\t\t$rename: {\n\t\t\t\t'ets': 'editedAt'\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetMessageAttachments(_id, attachments) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tattachments\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetSlackBotIdAndSlackTs(_id, slackBotId, slackTs) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tslackBotId,\n\t\t\t\tslackTs\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\n\t// INSERT\n\tcreateWithTypeRoomIdMessageAndUser(type, roomId, message, user, extraData) {\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId, { fields: { sysMes: 1 }});\n\t\tif ((room != null ? room.sysMes : undefined) === false) {\n\t\t\treturn;\n\t\t}\n\t\tconst record = {\n\t\t\tt: type,\n\t\t\trid: roomId,\n\t\t\tts: new Date,\n\t\t\tmsg: message,\n\t\t\tu: {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username\n\t\t\t},\n\t\t\tgroupable: false\n\t\t};\n\n\t\tif (RocketChat.settings.get('Message_Read_Receipt_Enabled')) {\n\t\t\trecord.unread = true;\n\t\t}\n\n\t\t_.extend(record, extraData);\n\n\t\trecord._id = this.insertOrUpsert(record);\n\t\tRocketChat.models.Rooms.incMsgCountById(room._id, 1);\n\t\treturn record;\n\t}\n\n\tcreateUserJoinWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('uj', roomId, message, user, extraData);\n\t}\n\n\tcreateUserLeaveWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('ul', roomId, message, user, extraData);\n\t}\n\n\tcreateUserRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('ru', roomId, message, user, extraData);\n\t}\n\n\tcreateUserAddedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('au', roomId, message, user, extraData);\n\t}\n\n\tcreateCommandWithRoomIdAndUser(command, roomId, user, extraData) {\n\t\treturn this.createWithTypeRoomIdMessageAndUser('command', roomId, command, user, extraData);\n\t}\n\n\tcreateUserMutedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('user-muted', roomId, message, user, extraData);\n\t}\n\n\tcreateUserUnmutedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('user-unmuted', roomId, message, user, extraData);\n\t}\n\n\tcreateNewModeratorWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('new-moderator', roomId, message, user, extraData);\n\t}\n\n\tcreateModeratorRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('moderator-removed', roomId, message, user, extraData);\n\t}\n\n\tcreateNewOwnerWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('new-owner', roomId, message, user, extraData);\n\t}\n\n\tcreateOwnerRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('owner-removed', roomId, message, user, extraData);\n\t}\n\n\tcreateNewLeaderWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('new-leader', roomId, message, user, extraData);\n\t}\n\n\tcreateLeaderRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('leader-removed', roomId, message, user, extraData);\n\t}\n\n\tcreateSubscriptionRoleAddedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('subscription-role-added', roomId, message, user, extraData);\n\t}\n\n\tcreateSubscriptionRoleRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('subscription-role-removed', roomId, message, user, extraData);\n\t}\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query =\t{_id};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByRoomId(roomId) {\n\t\tconst query =\t{rid: roomId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByUserId(userId) {\n\t\tconst query =\t{'u._id': userId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tgetMessageByFileId(fileID) {\n\t\treturn this.findOne({ 'file._id': fileID });\n\t}\n\n\tsetAsRead(rid, until) {\n\t\treturn this.update({\n\t\t\trid,\n\t\t\tunread: true,\n\t\t\tts: { $lt: until }\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\tunread: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n\n\tsetAsReadById(_id) {\n\t\treturn this.update({\n\t\t\t_id\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\tunread: 1\n\t\t\t}\n\t\t});\n\t}\n\n\tfindUnreadMessagesByRoomAndDate(rid, after) {\n\t\tconst query = {\n\t\t\tunread: true,\n\t\t\trid\n\t\t};\n\n\t\tif (after) {\n\t\t\tquery.ts = { $gt: after };\n\t\t}\n\n\t\treturn this.find(query, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\t}\n};\n","import _ from 'underscore';\n\nRocketChat.models.Reports = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('reports');\n\t}\n\tcreateWithMessageDescriptionAndUserId(message, description, userId, extraData) {\n\t\tconst record = {\n\t\t\tmessage,\n\t\t\tdescription,\n\t\t\tts: new Date(),\n\t\t\tuserId\n\t\t};\n\t\t_.extend(record, extraData);\n\t\trecord._id = this.insert(record);\n\t\treturn record;\n\t}\n};\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nclass ModelRooms extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'name': 1 }, { unique: 1, sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'default': 1 });\n\t\tthis.tryEnsureIndex({ 'usernames': 1 });\n\t\tthis.tryEnsureIndex({ 't': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1 });\n\n\t\tthis.cache.ignoreUpdatedFields = ['msgs', 'lm'];\n\t\tthis.cache.ensureIndex(['t', 'name'], 'unique');\n\t\tthis.cache.options = {fields: {usernames: 0}};\n\t}\n\n\tfindOneByIdOrName(_idOrName, options) {\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\t_id: _idOrName\n\t\t\t}, {\n\t\t\t\tname: _idOrName\n\t\t\t}]\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByImportId(_id, options) {\n\t\tconst query = {importIds: _id};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByName(name, options) {\n\t\tconst query = {name};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByNameAndNotId(name, rid) {\n\t\tconst query = {\n\t\t\t_id: { $ne: rid },\n\t\t\tname\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindOneByDisplayName(fname, options) {\n\t\tconst query = {fname};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByNameAndType(name, type, options) {\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByIdContainingUsername(_id, username, options) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByNameAndTypeNotContainingUsername(name, type, username, options) {\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type,\n\t\t\tusernames: {\n\t\t\t\t$ne: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\n\t// FIND\n\n\tfindById(roomId, options) {\n\t\treturn this.find({ _id: roomId }, options);\n\t}\n\n\tfindByIds(roomIds, options) {\n\t\treturn this.find({ _id: {$in: [].concat(roomIds)} }, options);\n\t}\n\n\tfindByType(type, options) {\n\t\tconst query = {t: type};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypes(types, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByUserId(userId, options) {\n\t\tconst query = {'u._id': userId};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindBySubscriptionUserId(userId, options) {\n\t\tlet data;\n\t\tif (this.useCache) {\n\t\t\tdata = RocketChat.models.Subscriptions.findByUserId(userId).fetch();\n\t\t\tdata = data.map(function(item) {\n\t\t\t\tif (item._room) {\n\t\t\t\t\treturn item._room;\n\t\t\t\t}\n\t\t\t\tconsole.log('Empty Room for Subscription', item);\n\t\t\t});\n\t\t\tdata = data.filter(item => item);\n\t\t\treturn this.arrayToCursor(this.processQueryOptionsOnResult(data, options));\n\t\t}\n\n\t\tdata = RocketChat.models.Subscriptions.findByUserId(userId, {fields: {rid: 1}}).fetch();\n\t\tdata = data.map(item => item.rid);\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: data\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindBySubscriptionUserIdUpdatedAfter(userId, _updatedAt, options) {\n\t\tif (this.useCache) {\n\t\t\tlet data = RocketChat.models.Subscriptions.findByUserId(userId).fetch();\n\t\t\tdata = data.map(function(item) {\n\t\t\t\tif (item._room) {\n\t\t\t\t\treturn item._room;\n\t\t\t\t}\n\t\t\t\tconsole.log('Empty Room for Subscription', item);\n\t\t\t});\n\t\t\tdata = data.filter(item => item && item._updatedAt > _updatedAt);\n\t\t\treturn this.arrayToCursor(this.processQueryOptionsOnResult(data, options));\n\t\t}\n\n\t\tlet ids = RocketChat.models.Subscriptions.findByUserId(userId, {fields: {rid: 1}}).fetch();\n\t\tids = ids.map(item => item.rid);\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: ids\n\t\t\t},\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: _updatedAt\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameContaining(name, options) {\n\t\tconst nameRegex = new RegExp(s.trim(s.escapeRegExp(name)), 'i');\n\n\t\tconst query = {\n\t\t\t$or: [\n\t\t\t\t{name: nameRegex},\n\t\t\t\t{\n\t\t\t\t\tt: 'd',\n\t\t\t\t\tusernames: nameRegex\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameContainingTypesWithUsername(name, types, options) {\n\t\tconst nameRegex = new RegExp(s.trim(s.escapeRegExp(name)), 'i');\n\n\t\tconst $or = [];\n\t\tfor (const type of Array.from(types)) {\n\t\t\tconst obj = {name: nameRegex, t: type.type};\n\t\t\tif (type.username != null) {\n\t\t\t\tobj.usernames = type.username;\n\t\t\t}\n\t\t\tif (type.ids != null) {\n\t\t\t\tobj._id = {$in: type.ids};\n\t\t\t}\n\t\t\t$or.push(obj);\n\t\t}\n\n\t\tconst query = {$or};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindContainingTypesWithUsername(types, options) {\n\n\t\tconst $or = [];\n\t\tfor (const type of Array.from(types)) {\n\t\t\tconst obj = {t: type.type};\n\t\t\tif (type.username != null) {\n\t\t\t\tobj.usernames = type.username;\n\t\t\t}\n\t\t\tif (type.ids != null) {\n\t\t\t\tobj._id = {$in: type.ids};\n\t\t\t}\n\t\t\t$or.push(obj);\n\t\t}\n\n\t\tconst query = {$or};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameContainingAndTypes(name, types, options) {\n\t\tconst nameRegex = new RegExp(s.trim(s.escapeRegExp(name)), 'i');\n\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\t$or: [\n\t\t\t\t{name: nameRegex},\n\t\t\t\t{\n\t\t\t\t\tt: 'd',\n\t\t\t\t\tusernames: nameRegex\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameAndType(name, type, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tname\n\t\t};\n\n\t\t// do not use cache\n\t\treturn this._db.find(query, options);\n\t}\n\n\tfindByNameAndTypeNotDefault(name, type, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tname,\n\t\t\tdefault: {\n\t\t\t\t$ne: true\n\t\t\t}\n\t\t};\n\n\t\t// do not use cache\n\t\treturn this._db.find(query, options);\n\t}\n\n\tfindByNameAndTypesNotContainingUsername(name, types, username, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\tname,\n\t\t\tusernames: {\n\t\t\t\t$ne: username\n\t\t\t}\n\t\t};\n\n\t\t// do not use cache\n\t\treturn this._db.find(query, options);\n\t}\n\n\tfindByNameStartingAndTypes(name, types, options) {\n\t\tconst nameRegex = new RegExp(`^${ s.trim(s.escapeRegExp(name)) }`, 'i');\n\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\t$or: [\n\t\t\t\t{name: nameRegex},\n\t\t\t\t{\n\t\t\t\t\tt: 'd',\n\t\t\t\t\tusernames: nameRegex\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByDefaultAndTypes(defaultValue, types, options) {\n\t\tconst query = {\n\t\t\tdefault: defaultValue,\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeContainingUsername(type, username, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeContainingUsernames(type, username, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tusernames: { $all: [].concat(username) }\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypesAndNotUserIdContainingUsername(types, userId, username, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\tuid: {\n\t\t\t\t$ne: userId\n\t\t\t},\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByContainingUsername(username, options) {\n\t\tconst query = {usernames: username};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndName(type, name, options) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('t,name', [type, name], options);\n\t\t}\n\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndNameContainingUsername(type, name, username, options) {\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndArchivationState(type, archivationstate, options) {\n\t\tconst query = {t: type};\n\n\t\tif (archivationstate) {\n\t\t\tquery.archived = true;\n\t\t} else {\n\t\t\tquery.archived = { $ne: true };\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\t// UPDATE\n\taddImportIds(_id, importIds) {\n\t\timportIds = [].concat(importIds);\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\timportIds: {\n\t\t\t\t\t$each: importIds\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tarchiveById(_id) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tarchived: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tunarchiveById(_id) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tarchived: false\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\taddUsernameById(_id, username, muted) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\tif (muted) {\n\t\t\tupdate.$addToSet.muted = username;\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\taddUsernamesById(_id, usernames) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tusernames: {\n\t\t\t\t\t$each: usernames\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\taddUsernameByName(name, username) {\n\t\tconst query = {name};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveUsernameById(_id, username) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveUsernamesById(_id, usernames) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: {\n\t\t\t\t\t$in: usernames\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveUsernameFromAll(username) {\n\t\tconst query = {usernames: username};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tremoveUsernameByName(name, username) {\n\t\tconst query = {name};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetNameById(_id, name, fname) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname,\n\t\t\t\tfname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tincMsgCountById(_id, inc) {\n\t\tif (inc == null) { inc = 1; }\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$inc: {\n\t\t\t\tmsgs: inc\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tincMsgCountAndSetLastMessageById(_id, inc, lastMessageTimestamp, lastMessage) {\n\t\tif (inc == null) { inc = 1; }\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlm: lastMessageTimestamp\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tmsgs: inc\n\t\t\t}\n\t\t};\n\n\t\tif (lastMessage) {\n\t\t\tupdate.$set.lastMessage = lastMessage;\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetLastMessageById(_id, lastMessage) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlastMessage\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\treplaceUsername(previousUsername, username) {\n\t\tconst query = {usernames: previousUsername};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'usernames.$': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\treplaceMutedUsername(previousUsername, username) {\n\t\tconst query = {muted: previousUsername};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'muted.$': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\treplaceUsernameOfUserByUserId(userId, username) {\n\t\tconst query = {'u._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'u.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetJoinCodeById(_id, joinCode) {\n\t\tlet update;\n\t\tconst query = {_id};\n\n\t\tif ((joinCode != null ? joinCode.trim() : undefined) !== '') {\n\t\t\tupdate = {\n\t\t\t\t$set: {\n\t\t\t\t\tjoinCodeRequired: true,\n\t\t\t\t\tjoinCode\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\tupdate = {\n\t\t\t\t$set: {\n\t\t\t\t\tjoinCodeRequired: false\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\tjoinCode: 1\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetUserById(_id, user) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetTypeById(_id, type) {\n\t\tconst query = {_id};\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tt: type\n\t\t\t}\n\t\t};\n\t\tif (type === 'p') {\n\t\t\tupdate.$unset = {default: ''};\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetTopicById(_id, topic) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\ttopic\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAnnouncementById(_id, announcement) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tannouncement\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tmuteUsernameByRoomId(_id, username) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tmuted: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tunmuteUsernameByRoomId(_id, username) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tmuted: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsaveDefaultById(_id, defaultValue) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tdefault: defaultValue === 'true'\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetTopicAndTagsById(_id, topic, tags) {\n\t\tconst setData = {};\n\t\tconst unsetData = {};\n\n\t\tif (topic != null) {\n\t\t\tif (!_.isEmpty(s.trim(topic))) {\n\t\t\t\tsetData.topic = s.trim(topic);\n\t\t\t} else {\n\t\t\t\tunsetData.topic = 1;\n\t\t\t}\n\t\t}\n\n\t\tif (tags != null) {\n\t\t\tif (!_.isEmpty(s.trim(tags))) {\n\t\t\t\tsetData.tags = s.trim(tags).split(',').map(tag => s.trim(tag));\n\t\t\t} else {\n\t\t\t\tunsetData.tags = 1;\n\t\t\t}\n\t\t}\n\n\t\tconst update = {};\n\n\t\tif (!_.isEmpty(setData)) {\n\t\t\tupdate.$set = setData;\n\t\t}\n\n\t\tif (!_.isEmpty(unsetData)) {\n\t\t\tupdate.$unset = unsetData;\n\t\t}\n\n\t\tif (_.isEmpty(update)) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.update({ _id }, update);\n\t}\n\n\t// INSERT\n\tcreateWithTypeNameUserAndUsernames(type, name, fname, user, usernames, extraData) {\n\t\tconst room = {\n\t\t\tname,\n\t\t\tfname,\n\t\t\tt: type,\n\t\t\tusernames,\n\t\t\tmsgs: 0,\n\t\t\tu: {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username\n\t\t\t}\n\t\t};\n\n\t\t_.extend(room, extraData);\n\n\t\troom._id = this.insert(room);\n\t\treturn room;\n\t}\n\n\tcreateWithIdTypeAndName(_id, type, name, extraData) {\n\t\tconst room = {\n\t\t\t_id,\n\t\t\tts: new Date(),\n\t\t\tt: type,\n\t\t\tname,\n\t\t\tusernames: [],\n\t\t\tmsgs: 0\n\t\t};\n\n\t\t_.extend(room, extraData);\n\n\t\tthis.insert(room);\n\t\treturn room;\n\t}\n\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query = {_id};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByTypeContainingUsername(type, username) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.remove(query);\n\t}\n}\n\nRocketChat.models.Rooms = new ModelRooms('room', true);\n","class ModelSettings extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'blocked': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'hidden': 1 }, { sparse: 1 });\n\t}\n\n\t// FIND\n\tfindById(_id) {\n\t\tconst query = {_id};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindOneNotHiddenById(_id) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\thidden: { $ne: true }\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindByIds(_id = []) {\n\t\t_id = [].concat(_id);\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: _id\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindByRole(role, options) {\n\t\tconst query = {role};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindPublic(options) {\n\t\tconst query = {public: true};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindNotHiddenPublic(ids = []) {\n\t\tconst filter = {\n\t\t\thidden: { $ne: true },\n\t\t\tpublic: true\n\t\t};\n\n\t\tif (ids.length > 0) {\n\t\t\tfilter._id =\n\t\t\t\t{$in: ids};\n\t\t}\n\n\t\treturn this.find(filter, { fields: {_id: 1, value: 1} });\n\t}\n\n\tfindNotHiddenPublicUpdatedAfter(updatedAt) {\n\t\tconst filter = {\n\t\t\thidden: { $ne: true },\n\t\t\tpublic: true,\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: updatedAt\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(filter, { fields: {_id: 1, value: 1} });\n\t}\n\n\tfindNotHiddenPrivate() {\n\t\treturn this.find({\n\t\t\thidden: { $ne: true },\n\t\t\tpublic: { $ne: true }\n\t\t});\n\t}\n\n\tfindNotHidden(options) {\n\t\treturn this.find({ hidden: { $ne: true } }, options);\n\t}\n\n\tfindNotHiddenUpdatedAfter(updatedAt) {\n\t\treturn this.find({\n\t\t\thidden: { $ne: true },\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: updatedAt\n\t\t\t}\n\t\t});\n\t}\n\n\t// UPDATE\n\tupdateValueById(_id, value) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\tvalue: { $ne: value },\n\t\t\t_id\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tvalue\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateValueAndEditorById(_id, value, editor) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\tvalue: { $ne: value },\n\t\t\t_id\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tvalue,\n\t\t\t\teditor\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateValueNotHiddenById(_id, value) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\thidden: { $ne: true },\n\t\t\tblocked: { $ne: true }\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tvalue\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateOptionsById(_id, options) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\t_id\n\t\t};\n\n\t\tconst update = {$set: options};\n\n\t\treturn this.update(query, update);\n\t}\n\n\t// INSERT\n\tcreateWithIdAndValue(_id, value) {\n\t\tconst record = {\n\t\t\t_id,\n\t\t\tvalue,\n\t\t\t_createdAt: new Date\n\t\t};\n\n\t\treturn this.insert(record);\n\t}\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\t_id\n\t\t};\n\n\t\treturn this.remove(query);\n\t}\n}\n\nRocketChat.models.Settings = new ModelSettings('settings', true);\n","import _ from 'underscore';\n\nclass ModelSubscriptions extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'u._id': 1 }, { unique: 1 });\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'alert': 1, 'u._id': 1 });\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'roles': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1, 'code': 1 }, { unique: 1 });\n\t\tthis.tryEnsureIndex({ 'open': 1 });\n\t\tthis.tryEnsureIndex({ 'alert': 1 });\n\t\tthis.tryEnsureIndex({ 'unread': 1 });\n\t\tthis.tryEnsureIndex({ 'ts': 1 });\n\t\tthis.tryEnsureIndex({ 'ls': 1 });\n\t\tthis.tryEnsureIndex({ 'audioNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'desktopNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'mobilePushNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'emailNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'autoTranslate': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'autoTranslateLanguage': 1 }, { sparse: 1 });\n\n\t\tthis.cache.ensureIndex('rid', 'array');\n\t\tthis.cache.ensureIndex('u._id', 'array');\n\t\tthis.cache.ensureIndex('name', 'array');\n\t\tthis.cache.ensureIndex(['rid', 'u._id'], 'unique');\n\t\tthis.cache.ensureIndex(['name', 'u._id'], 'unique');\n\t}\n\n\n\t// FIND ONE\n\tfindOneByRoomIdAndUserId(roomId, userId) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('rid,u._id', [roomId, userId]).fetch();\n\t\t}\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindOneByRoomNameAndUserId(roomName, userId) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('name,u._id', [roomName, userId]).fetch();\n\t\t}\n\t\tconst query = {\n\t\t\tname: roomName,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\t// FIND\n\tfindByUserId(userId, options) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('u._id', userId, options);\n\t\t}\n\n\t\tconst query =\n\t\t\t{'u._id': userId};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByUserIdUpdatedAfter(userId, updatedAt, options) {\n\t\tconst query = {\n\t\t\t'u._id': userId,\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: updatedAt\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\t// FIND\n\tfindByRoomIdAndRoles(roomId, roles, options) {\n\t\troles = [].concat(roles);\n\t\tconst query = {\n\t\t\t'rid': roomId,\n\t\t\t'roles': { $in: roles }\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByType(types, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndUserId(type, userId, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeNameAndUserId(type, name, userId, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tname,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByRoomId(roomId, options) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('rid', roomId, options);\n\t\t}\n\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByRoomIdAndNotUserId(roomId, userId, options) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tgetLastSeen(options) {\n\t\tif (options == null) { options = {}; }\n\t\tconst query = { ls: { $exists: 1 } };\n\t\toptions.sort = { ls: -1 };\n\t\toptions.limit = 1;\n\t\tconst [subscription] = this.find(query, options).fetch();\n\t\treturn subscription && subscription.ls;\n\t}\n\n\tfindByRoomIdAndUserIds(roomId, userIds) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$in: userIds\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindByRoomIdAndUserIdsOrAllMessages(roomId, userIds) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t$or: [\n\t\t\t\t{ 'u._id': { $in: userIds } },\n\t\t\t\t{ emailNotifications: 'all' }\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindUnreadByUserId(userId) {\n\t\tconst query = {\n\t\t\t'u._id': userId,\n\t\t\tunread: {\n\t\t\t\t$gt: 0\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, { fields: { unread: 1 } });\n\t}\n\n\tgetMinimumLastSeenByRoomId(rid) {\n\t\treturn this.db.findOne({\n\t\t\trid\n\t\t}, {\n\t\t\tsort: {\n\t\t\t\tls: 1\n\t\t\t},\n\t\t\tfields: {\n\t\t\t\tls: 1\n\t\t\t}\n\t\t});\n\t}\n\n\t// UPDATE\n\tarchiveByRoomId(roomId) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: false,\n\t\t\t\topen: false,\n\t\t\t\tarchived: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tunarchiveByRoomId(roomId) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: false,\n\t\t\t\topen: true,\n\t\t\t\tarchived: false\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\thideByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: false,\n\t\t\t\topen: false\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\topenByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\topen: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAsReadByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\topen: true,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tls: new Date\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAsUnreadByRoomIdAndUserId(roomId, userId, firstMessageUnreadTimestamp) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\topen: true,\n\t\t\t\talert: true,\n\t\t\t\tls: firstMessageUnreadTimestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetCustomFieldsDirectMessagesByUserId(userId, fields) {\n\t\tconst values = {};\n\t\tObject.keys(fields).forEach(key => {\n\t\t\tvalues[`customFields.${ key }`] = fields[key];\n\t\t});\n\n\t\tconst query = {\n\t\t\t'u._id': userId,\n\t\t\t't': 'd'\n\t\t};\n\t\tconst update = { $set: values };\n\t\tconst options = { 'multi': true };\n\n\t\treturn this.update(query, update, options);\n\t}\n\n\tsetFavoriteByRoomIdAndUserId(roomId, userId, favorite) {\n\t\tif (favorite == null) { favorite = true; }\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tf: favorite\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateNameAndAlertByRoomId(roomId, name, fname) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname,\n\t\t\t\tfname,\n\t\t\t\talert: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tupdateNameByRoomId(roomId, name) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetUserUsernameByUserId(userId, username) {\n\t\tconst query =\n\t\t\t{'u._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'u.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetNameForDirectRoomsWithOldName(oldName, name) {\n\t\tconst query = {\n\t\t\tname: oldName,\n\t\t\tt: 'd'\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tincUnreadForRoomIdExcludingUserId(roomId, userId, inc) {\n\t\tif (inc == null) { inc = 1; }\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tunread: inc\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tincGroupMentionsAndUnreadForRoomIdExcludingUserId(roomId, userId, incGroup = 1, incUnread = 1) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tunread: incUnread,\n\t\t\t\tgroupMentions: incGroup\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tincUserMentionsAndUnreadForRoomIdAndUserIds(roomId, userIds, incUser = 1, incUnread = 1) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$in: userIds\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tunread: incUnread,\n\t\t\t\tuserMentions: incUser\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\tsetAlertForRoomIdExcludingUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t},\n\t\t\t$or: [\n\t\t\t\t{ alert: { $ne: true } },\n\t\t\t\t{ open: { $ne: true } }\n\t\t\t]\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t}\n\t\t};\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetBlockedByRoomId(rid, blocked, blocker) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t'u._id': blocked\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tblocked: true\n\t\t\t}\n\t\t};\n\n\t\tconst query2 = {\n\t\t\trid,\n\t\t\t'u._id': blocker\n\t\t};\n\n\t\tconst update2 = {\n\t\t\t$set: {\n\t\t\t\tblocker: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update) && this.update(query2, update2);\n\t}\n\n\tunsetBlockedByRoomId(rid, blocked, blocker) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t'u._id': blocked\n\t\t};\n\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\tblocked: 1\n\t\t\t}\n\t\t};\n\n\t\tconst query2 = {\n\t\t\trid,\n\t\t\t'u._id': blocker\n\t\t};\n\n\t\tconst update2 = {\n\t\t\t$unset: {\n\t\t\t\tblocker: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update) && this.update(query2, update2);\n\t}\n\n\tupdateTypeByRoomId(roomId, type) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tt: type\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\taddRoleById(_id, role) {\n\t\tconst query =\n\t\t\t{_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: role\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveRoleById(_id, role) {\n\t\tconst query =\n\t\t\t{_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\troles: role\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetArchivedByUsername(username, archived) {\n\t\tconst query = {\n\t\t\tt: 'd',\n\t\t\tname: username\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tarchived\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\t// INSERT\n\tcreateWithRoomAndUser(room, user, extraData) {\n\t\tconst subscription = {\n\t\t\topen: false,\n\t\t\talert: false,\n\t\t\tunread: 0,\n\t\t\tuserMentions: 0,\n\t\t\tgroupMentions: 0,\n\t\t\tts: room.ts,\n\t\t\trid: room._id,\n\t\t\tname: room.name,\n\t\t\tfname: room.fname,\n\t\t\tcustomFields: room.customFields,\n\t\t\tt: room.t,\n\t\t\tu: {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username,\n\t\t\t\tname: user.name\n\t\t\t}\n\t\t};\n\n\t\t_.extend(subscription, extraData);\n\n\t\treturn this.insert(subscription);\n\t}\n\n\n\t// REMOVE\n\tremoveByUserId(userId) {\n\t\tconst query =\n\t\t\t{'u._id': userId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByRoomId(roomId) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.remove(query);\n\t}\n}\n\nRocketChat.models.Subscriptions = new ModelSubscriptions('subscription', true);\n","/* globals InstanceStatus */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nRocketChat.models.Uploads = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('uploads');\n\n\t\tthis.model.before.insert((userId, doc) => {\n\t\t\tdoc.instanceId = InstanceStatus.id();\n\t\t});\n\n\t\tthis.tryEnsureIndex({ 'rid': 1 });\n\t\tthis.tryEnsureIndex({ 'uploadedAt': 1 });\n\t}\n\n\tfindNotHiddenFilesOfRoom(roomId, limit) {\n\t\tconst fileQuery = {\n\t\t\trid: roomId,\n\t\t\tcomplete: true,\n\t\t\tuploading: false,\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t}\n\t\t};\n\n\t\tconst fileOptions = {\n\t\t\tlimit,\n\t\t\tsort: {\n\t\t\t\tuploadedAt: -1\n\t\t\t},\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tuserId: 1,\n\t\t\t\trid: 1,\n\t\t\t\tname: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\ttype: 1,\n\t\t\t\turl: 1,\n\t\t\t\tuploadedAt: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(fileQuery, fileOptions);\n\t}\n\n\tinsertFileInit(userId, store, file, extra) {\n\t\tconst fileData = {\n\t\t\tuserId,\n\t\t\tstore,\n\t\t\tcomplete: false,\n\t\t\tuploading: true,\n\t\t\tprogress: 0,\n\t\t\textension: s.strRightBack(file.name, '.'),\n\t\t\tuploadedAt: new Date()\n\t\t};\n\n\t\t_.extend(fileData, file, extra);\n\n\t\tif (this.model.direct && this.model.direct.insert != null) {\n\t\t\tfile = this.model.direct.insert(fileData);\n\t\t} else {\n\t\t\tfile = this.insert(fileData);\n\t\t}\n\n\t\treturn file;\n\t}\n\n\tupdateFileComplete(fileId, userId, file) {\n\t\tlet result;\n\t\tif (!fileId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst filter = {\n\t\t\t_id: fileId,\n\t\t\tuserId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tprogress: 1\n\t\t\t}\n\t\t};\n\n\t\tupdate.$set = _.extend(file, update.$set);\n\n\t\tif (this.model.direct && this.model.direct.update != null) {\n\t\t\tresult = this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\tresult = this.update(filter, update);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tdeleteFile(fileId) {\n\t\tif (this.model.direct && this.model.direct.remove != null) {\n\t\t\treturn this.model.direct.remove({ _id: fileId });\n\t\t} else {\n\t\t\treturn this.remove({ _id: fileId });\n\t\t}\n\t}\n};\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nclass ModelUsers extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'roles': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'name': 1 });\n\t\tthis.tryEnsureIndex({ 'lastLogin': 1 });\n\t\tthis.tryEnsureIndex({ 'status': 1 });\n\t\tthis.tryEnsureIndex({ 'active': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'statusConnection': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'type': 1 });\n\n\t\tthis.cache.ensureIndex('username', 'unique');\n\t}\n\n\tfindOneByImportId(_id, options) {\n\t\treturn this.findOne({ importIds: _id }, options);\n\t}\n\n\tfindOneByUsername(username, options) {\n\t\tif (typeof username === 'string') {\n\t\t\tusername = new RegExp(`^${ username }$`, 'i');\n\t\t}\n\n\t\tconst query = {username};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByEmailAddress(emailAddress, options) {\n\t\tconst query =\t{'emails.address': new RegExp(`^${ s.escapeRegExp(emailAddress) }$`, 'i')};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneAdmin(admin, options) {\n\t\tconst query =\t{admin};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByIdAndLoginToken(_id, token, options) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\t'services.resume.loginTokens.hashedToken' : Accounts._hashLoginToken(token)\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\n\t// FIND\n\tfindById(userId) {\n\t\tconst query =\t{_id: userId};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindUsersNotOffline(options) {\n\t\tconst query = {\n\t\t\tusername: {\n\t\t\t\t$exists: 1\n\t\t\t},\n\t\t\tstatus: {\n\t\t\t\t$in: ['online', 'away', 'busy']\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\n\tfindByUsername(username, options) {\n\t\tconst query =\t{username};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindUsersByUsernamesWithHighlights(usernames, options) {\n\t\tif (this.useCache) {\n\t\t\tconst result = {\n\t\t\t\tfetch() {\n\t\t\t\t\treturn RocketChat.models.Users.getDynamicView('highlights').data().filter(record => usernames.indexOf(record.username) > -1);\n\t\t\t\t},\n\t\t\t\tcount() {\n\t\t\t\t\treturn result.fetch().length;\n\t\t\t\t},\n\t\t\t\tforEach(fn) {\n\t\t\t\t\treturn result.fetch().forEach(fn);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn result;\n\t\t}\n\n\t\tconst query = {\n\t\t\tusername: { $in: usernames },\n\t\t\t'settings.preferences.highlights.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindActiveByUsernameOrNameRegexWithExceptions(searchTerm, exceptions, options) {\n\t\tif (exceptions == null) { exceptions = []; }\n\t\tif (options == null) { options = {}; }\n\t\tif (!_.isArray(exceptions)) {\n\t\t\texceptions = [ exceptions ];\n\t\t}\n\n\t\tconst termRegex = new RegExp(s.escapeRegExp(searchTerm), 'i');\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\tusername: termRegex\n\t\t\t}, {\n\t\t\t\tname: termRegex\n\t\t\t}],\n\t\t\tactive: true,\n\t\t\ttype: {\n\t\t\t\t$in: ['user', 'bot']\n\t\t\t},\n\t\t\t$and: [{\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tusername: {\n\t\t\t\t\t$nin: exceptions\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByActiveUsersExcept(searchTerm, exceptions, options) {\n\t\tif (exceptions == null) { exceptions = []; }\n\t\tif (options == null) { options = {}; }\n\t\tif (!_.isArray(exceptions)) {\n\t\t\texceptions = [ exceptions ];\n\t\t}\n\n\t\tconst termRegex = new RegExp(s.escapeRegExp(searchTerm), 'i');\n\n\t\tconst orStmt = _.reduce(RocketChat.settings.get('Accounts_SearchFields').trim().split(','), function(acc, el) {\n\t\t\tacc.push({ [el.trim()]: termRegex });\n\t\t\treturn acc;\n\t\t}, []);\n\t\tconst query = {\n\t\t\t$and: [\n\t\t\t\t{\n\t\t\t\t\tactive: true,\n\t\t\t\t\t$or: orStmt\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tusername: { $exists: true, $nin: exceptions }\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\t// do not use cache\n\t\treturn this._db.find(query, options);\n\t}\n\n\tfindUsersByNameOrUsername(nameOrUsername, options) {\n\t\tconst query = {\n\t\t\tusername: {\n\t\t\t\t$exists: 1\n\t\t\t},\n\n\t\t\t$or: [\n\t\t\t\t{name: nameOrUsername},\n\t\t\t\t{username: nameOrUsername}\n\t\t\t],\n\n\t\t\ttype: {\n\t\t\t\t$in: ['user']\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByUsernameNameOrEmailAddress(usernameNameOrEmailAddress, options) {\n\t\tconst query = {\n\t\t\t$or: [\n\t\t\t\t{name: usernameNameOrEmailAddress},\n\t\t\t\t{username: usernameNameOrEmailAddress},\n\t\t\t\t{'emails.address': usernameNameOrEmailAddress}\n\t\t\t],\n\t\t\ttype: {\n\t\t\t\t$in: ['user', 'bot']\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindLDAPUsers(options) {\n\t\tconst query =\t{ldap: true};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindCrowdUsers(options) {\n\t\tconst query =\t{crowd: true};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tgetLastLogin(options) {\n\t\tif (options == null) { options = {}; }\n\t\tconst query = { lastLogin: { $exists: 1 } };\n\t\toptions.sort = { lastLogin: -1 };\n\t\toptions.limit = 1;\n\t\tconst [user] = this.find(query, options).fetch();\n\t\treturn user && user.lastLogin;\n\t}\n\n\tfindUsersByUsernames(usernames, options) {\n\t\tconst query = {\n\t\t\tusername: {\n\t\t\t\t$in: usernames\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindUsersByIds(ids, options) {\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: ids\n\t\t\t}\n\t\t};\n\t\treturn this.find(query, options);\n\t}\n\n\t// UPDATE\n\taddImportIds(_id, importIds) {\n\t\timportIds = [].concat(importIds);\n\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\timportIds: {\n\t\t\t\t\t$each: importIds\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateLastLoginById(_id) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlastLogin: new Date\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetServiceId(_id, serviceName, serviceId) {\n\t\tconst update =\n\t\t{$set: {}};\n\n\t\tconst serviceIdKey = `services.${ serviceName }.id`;\n\t\tupdate.$set[serviceIdKey] = serviceId;\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetUsername(_id, username) {\n\t\tconst update =\n\t\t{$set: {username}};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetEmail(_id, email) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\temails: [{\n\t\t\t\t\taddress: email,\n\t\t\t\t\tverified: false\n\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetEmailVerified(_id, email) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\temails: {\n\t\t\t\t$elemMatch: {\n\t\t\t\t\taddress: email,\n\t\t\t\t\tverified: false\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'emails.$.verified': true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetName(_id, name) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetCustomFields(_id, fields) {\n\t\tconst values = {};\n\t\tObject.keys(fields).forEach(key => {\n\t\t\tvalues[`customFields.${ key }`] = fields[key];\n\t\t});\n\n\t\tconst update = {$set: values};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetAvatarOrigin(_id, origin) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tavatarOrigin: origin\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tunsetAvatarOrigin(_id) {\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\tavatarOrigin: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetCurrentRoom(_id, curRoom) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tcurRoom\n\t\t\t}\n\t\t};\n\n\t\tconsole.log (update);\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetUserActive(_id, active) {\n\t\tif (active == null) { active = true; }\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tactive\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetAllUsersActive(active) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tactive\n\t\t\t}\n\t\t};\n\n\t\treturn this.update({}, update, { multi: true });\n\t}\n\n\tunsetLoginTokens(_id) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'services.resume.loginTokens' : []\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tunsetRequirePasswordChange(_id) {\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\t'requirePasswordChange' : true,\n\t\t\t\t'requirePasswordChangeReason' : true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tresetPasswordAndSetRequirePasswordChange(_id, requirePasswordChange, requirePasswordChangeReason) {\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\t'services.password': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\trequirePasswordChange,\n\t\t\t\trequirePasswordChangeReason\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetLanguage(_id, language) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlanguage\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetProfile(_id, profile) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'settings.profile': profile\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tclearSettings(_id) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tsettings: {}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetPreferences(_id, preferences) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'settings.preferences': preferences\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetUtcOffset(_id, utcOffset) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\tutcOffset: {\n\t\t\t\t$ne: utcOffset\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tutcOffset\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsaveUserById(_id, data) {\n\t\tconst setData = {};\n\t\tconst unsetData = {};\n\n\t\tif (data.name != null) {\n\t\t\tif (!_.isEmpty(s.trim(data.name))) {\n\t\t\t\tsetData.name = s.trim(data.name);\n\t\t\t} else {\n\t\t\t\tunsetData.name = 1;\n\t\t\t}\n\t\t}\n\n\t\tif (data.email != null) {\n\t\t\tif (!_.isEmpty(s.trim(data.email))) {\n\t\t\t\tsetData.emails = [{address: s.trim(data.email)}];\n\t\t\t} else {\n\t\t\t\tunsetData.emails = 1;\n\t\t\t}\n\t\t}\n\n\t\tif (data.phone != null) {\n\t\t\tif (!_.isEmpty(s.trim(data.phone))) {\n\t\t\t\tsetData.phone = [{phoneNumber: s.trim(data.phone)}];\n\t\t\t} else {\n\t\t\t\tunsetData.phone = 1;\n\t\t\t}\n\t\t}\n\n\t\tconst update = {};\n\n\t\tif (!_.isEmpty(setData)) {\n\t\t\tupdate.$set = setData;\n\t\t}\n\n\t\tif (!_.isEmpty(unsetData)) {\n\t\t\tupdate.$unset = unsetData;\n\t\t}\n\n\t\tif (_.isEmpty(update)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.update({ _id }, update);\n\t}\n\n\t// INSERT\n\tcreate(data) {\n\t\tconst user = {\n\t\t\tcreatedAt: new Date,\n\t\t\tavatarOrigin: 'none'\n\t\t};\n\n\t\t_.extend(user, data);\n\n\t\treturn this.insert(user);\n\t}\n\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\treturn this.remove(_id);\n\t}\n\n\t/*\nFind users to send a message by email if:\n- he is not online\n- has a verified email\n- has not disabled email notifications\n- `active` is equal to true (false means they were deactivated and can't login)\n*/\n\tgetUsersToSendOfflineEmail(usersIds) {\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: usersIds\n\t\t\t},\n\t\t\tactive: true,\n\t\t\tstatus: 'offline',\n\t\t\tstatusConnection: {\n\t\t\t\t$ne: 'online'\n\t\t\t},\n\t\t\t'emails.verified': true\n\t\t};\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tusername: 1,\n\t\t\t\temails: 1,\n\t\t\t\t'settings.preferences.emailNotificationMode': 1,\n\t\t\t\tlanguage: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n}\n\nRocketChat.models.Users = new ModelUsers(Meteor.users, true);\n","/* eslint new-cap: 0 */\nimport _ from 'underscore';\nimport loki from 'lokijs';\nimport {EventEmitter} from 'events';\nimport objectPath from 'object-path';\n\nconst logger = new Logger('BaseCache');\n\nconst lokiEq = loki.LokiOps.$eq;\nconst lokiNe = loki.LokiOps.$ne;\n\nloki.LokiOps.$eq = function(a, b) {\n\tif (Array.isArray(a)) {\n\t\treturn a.indexOf(b) !== -1;\n\t}\n\treturn lokiEq(a, b);\n};\n\nloki.LokiOps.$ne = function(a, b) {\n\tif (Array.isArray(a)) {\n\t\treturn a.indexOf(b) === -1;\n\t}\n\treturn lokiNe(a, b);\n};\n\nconst lokiIn = loki.LokiOps.$in;\nloki.LokiOps.$in = function(a, b) {\n\tif (Array.isArray(a)) {\n\t\treturn a.some(subA => lokiIn(subA, b));\n\t}\n\treturn lokiIn(a, b);\n};\n\nloki.LokiOps.$nin = function(a, b) {\n\treturn !loki.LokiOps.$in(a, b);\n};\n\nloki.LokiOps.$all = function(a, b) {\n\treturn b.every(subB => a.includes(subB));\n};\n\nloki.LokiOps.$exists = function(a, b) {\n\tif (b) {\n\t\treturn loki.LokiOps.$ne(a, undefined);\n\t}\n\n\treturn loki.LokiOps.$eq(a, undefined);\n};\n\nloki.LokiOps.$elemMatch = function(a, b) {\n\treturn _.findWhere(a, b);\n};\n\nconst ignore = [\n\t'emit',\n\t'load',\n\t'on',\n\t'addToAllIndexes'\n];\n\nfunction traceMethodCalls(target) {\n\ttarget._stats = {};\n\n\tfor (const property in target) {\n\t\tif (typeof target[property] === 'function' && ignore.indexOf(property) === -1) {\n\t\t\ttarget._stats[property] = {\n\t\t\t\tcalls: 0,\n\t\t\t\ttime: 0,\n\t\t\t\tavg: 0\n\t\t\t};\n\t\t\tconst origMethod = target[property];\n\t\t\ttarget[property] = function(...args) {\n\n\t\t\t\tif (target.loaded !== true) {\n\t\t\t\t\treturn origMethod.apply(target, args);\n\t\t\t\t}\n\n\t\t\t\tconst startTime = RocketChat.statsTracker.now();\n\t\t\t\tconst result = origMethod.apply(target, args);\n\t\t\t\tconst time = Math.round(RocketChat.statsTracker.now() - startTime) / 1000;\n\t\t\t\ttarget._stats[property].time += time;\n\t\t\t\ttarget._stats[property].calls++;\n\t\t\t\ttarget._stats[property].avg = target._stats[property].time / target._stats[property].calls;\n\n\t\t\t\treturn result;\n\t\t\t};\n\t\t}\n\t}\n\n\tsetInterval(function() {\n\t\tfor (const property in target._stats) {\n\t\t\tif (target._stats.hasOwnProperty(property) && target._stats[property].time > 0) {\n\t\t\t\tconst tags = [`property:${ property }`, `collection:${ target.collectionName }`];\n\t\t\t\tRocketChat.statsTracker.timing('cache.methods.time', target._stats[property].avg, tags);\n\t\t\t\tRocketChat.statsTracker.increment('cache.methods.totalTime', target._stats[property].time, tags);\n\t\t\t\tRocketChat.statsTracker.increment('cache.methods.count', target._stats[property].calls, tags);\n\t\t\t\ttarget._stats[property].avg = 0;\n\t\t\t\ttarget._stats[property].time = 0;\n\t\t\t\ttarget._stats[property].calls = 0;\n\t\t\t}\n\t\t}\n\t}, 10000);\n\n\ttarget._getStatsAvg = function() {\n\t\tconst stats = [];\n\t\tfor (const property in target._stats) {\n\t\t\tif (target._stats.hasOwnProperty(property)) {\n\t\t\t\tstats.push([Math.round(target._stats[property].avg*100)/100, property]);\n\t\t\t}\n\t\t}\n\t\treturn _.sortBy(stats, function(record) {\n\t\t\treturn record[0];\n\t\t});\n\t};\n}\n\nclass Adapter {\n\tloadDatabase(/*dbname, callback*/) {}\n\tsaveDatabase(/*dbname, dbstring, callback*/) {}\n\tdeleteDatabase(/*dbname, callback*/) {}\n}\n\nconst db = new loki('rocket.chat.json', {adapter: Adapter});\n\nclass ModelsBaseCache extends EventEmitter {\n\tconstructor(model) {\n\t\tsuper();\n\n\t\ttraceMethodCalls(this);\n\n\t\tthis.indexes = {};\n\t\tthis.ignoreUpdatedFields = ['_updatedAt'];\n\n\t\tthis.query = {};\n\t\tthis.options = {};\n\n\t\tthis.ensureIndex('_id', 'unique');\n\n\t\tthis.joins = {};\n\n\t\tthis.on('inserted', (...args) => { this.emit('changed', 'inserted', ...args); });\n\t\tthis.on('removed', (...args) => { this.emit('changed', 'removed', ...args); });\n\t\tthis.on('updated', (...args) => { this.emit('changed', 'updated', ...args); });\n\n\t\tthis.on('beforeinsert', (...args) => { this.emit('beforechange', 'inserted', ...args); });\n\t\tthis.on('beforeremove', (...args) => { this.emit('beforechange', 'removed', ...args); });\n\t\tthis.on('beforeupdate', (...args) => { this.emit('beforechange', 'updated', ...args); });\n\n\t\tthis.on('inserted', (...args) => { this.emit('sync', 'inserted', ...args); });\n\t\tthis.on('updated', (...args) => { this.emit('sync', 'updated', ...args); });\n\t\tthis.on('beforeremove', (...args) => { this.emit('sync', 'removed', ...args); });\n\n\t\tthis.db = db;\n\n\t\tthis.model = model;\n\n\t\tthis.collectionName = this.model._db.collectionName;\n\t\tthis.collection = this.db.addCollection(this.collectionName);\n\t}\n\n\thasOne(join, {field, link}) {\n\t\tthis.join({join, field, link, multi: false});\n\t}\n\n\thasMany(join, {field, link}) {\n\t\tthis.join({join, field, link, multi: true});\n\t}\n\n\tjoin({join, field, link, multi}) {\n\t\tif (!RocketChat.models[join]) {\n\t\t\tconsole.log(`Invalid cache model ${ join }`);\n\t\t\treturn;\n\t\t}\n\n\t\tRocketChat.models[join].cache.on('inserted', (record) => {\n\t\t\tthis.processRemoteJoinInserted({join, field, link, multi, record});\n\t\t});\n\n\t\tRocketChat.models[join].cache.on('beforeupdate', (record, diff) => {\n\t\t\tif (diff[link.remote]) {\n\t\t\t\tthis.processRemoteJoinRemoved({join, field, link, multi, record});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models[join].cache.on('updated', (record, diff) => {\n\t\t\tif (diff[link.remote]) {\n\t\t\t\tthis.processRemoteJoinInserted({join, field, link, multi, record});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models[join].cache.on('removed', (record) => {\n\t\t\tthis.processRemoteJoinRemoved({join, field, link, multi, record});\n\t\t});\n\n\t\tthis.on('inserted', (localRecord) => {\n\t\t\tthis.processLocalJoinInserted({join, field, link, multi, localRecord});\n\t\t});\n\n\t\tthis.on('beforeupdate', (localRecord, diff) => {\n\t\t\tif (diff[link.local]) {\n\t\t\t\tif (multi === true) {\n\t\t\t\t\tlocalRecord[field] = [];\n\t\t\t\t} else {\n\t\t\t\t\tlocalRecord[field] = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.on('updated', (localRecord, diff) => {\n\t\t\tif (diff[link.local]) {\n\t\t\t\tthis.processLocalJoinInserted({join, field, link, multi, localRecord});\n\t\t\t}\n\t\t});\n\t}\n\n\tprocessRemoteJoinInserted({field, link, multi, record}) {\n\t\tlet localRecords = this._findByIndex(link.local, objectPath.get(record, link.remote));\n\n\t\tif (!localRecords) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(localRecords)) {\n\t\t\tlocalRecords = [localRecords];\n\t\t}\n\n\t\tfor (let i = 0; i < localRecords.length; i++) {\n\t\t\tconst localRecord = localRecords[i];\n\t\t\tif (multi === true && !localRecord[field]) {\n\t\t\t\tlocalRecord[field] = [];\n\t\t\t}\n\n\t\t\tif (typeof link.where === 'function' && link.where(localRecord, record) === false) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet mutableRecord = record;\n\n\t\t\tif (typeof link.transform === 'function') {\n\t\t\t\tmutableRecord = link.transform(localRecord, mutableRecord);\n\t\t\t}\n\n\t\t\tif (multi === true) {\n\t\t\t\tlocalRecord[field].push(mutableRecord);\n\t\t\t} else {\n\t\t\t\tlocalRecord[field] = mutableRecord;\n\t\t\t}\n\n\t\t\tthis.emit(`join:${ field }:inserted`, localRecord, mutableRecord);\n\t\t\tthis.emit(`join:${ field }:changed`, 'inserted', localRecord, mutableRecord);\n\t\t}\n\t}\n\n\tprocessLocalJoinInserted({join, field, link, multi, localRecord}) {\n\t\tlet records = RocketChat.models[join].cache._findByIndex(link.remote, objectPath.get(localRecord, link.local));\n\n\t\tif (!Array.isArray(records)) {\n\t\t\trecords = [records];\n\t\t}\n\n\t\tfor (let i = 0; i < records.length; i++) {\n\t\t\tlet record = records[i];\n\n\t\t\tif (typeof link.where === 'function' && link.where(localRecord, record) === false) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (typeof link.transform === 'function') {\n\t\t\t\trecord = link.transform(localRecord, record);\n\t\t\t}\n\n\t\t\tif (multi === true) {\n\t\t\t\tlocalRecord[field].push(record);\n\t\t\t} else {\n\t\t\t\tlocalRecord[field] = record;\n\t\t\t}\n\n\t\t\tthis.emit(`join:${ field }:inserted`, localRecord, record);\n\t\t\tthis.emit(`join:${ field }:changed`, 'inserted', localRecord, record);\n\t\t}\n\t}\n\n\tprocessRemoteJoinRemoved({field, link, multi, record}) {\n\t\tlet localRecords = this._findByIndex(link.local, objectPath.get(record, link.remote));\n\n\t\tif (!localRecords) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(localRecords)) {\n\t\t\tlocalRecords = [localRecords];\n\t\t}\n\n\t\tfor (let i = 0; i < localRecords.length; i++) {\n\t\t\tconst localRecord = localRecords[i];\n\n\t\t\tif (multi === true) {\n\t\t\t\tif (Array.isArray(localRecord[field])) {\n\t\t\t\t\tif (typeof link.remove === 'function') {\n\t\t\t\t\t\tlink.remove(localRecord[field], record);\n\t\t\t\t\t} else if (localRecord[field].indexOf(record) > -1) {\n\t\t\t\t\t\tlocalRecord[field].splice(localRecord[field].indexOf(record), 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlocalRecord[field] = undefined;\n\t\t\t}\n\n\t\t\tthis.emit(`join:${ field }:removed`, localRecord, record);\n\t\t\tthis.emit(`join:${ field }:changed`, 'removed', localRecord, record);\n\t\t}\n\t}\n\n\tensureIndex(fields, type='array') {\n\t\tif (!Array.isArray(fields)) {\n\t\t\tfields = [fields];\n\t\t}\n\n\t\tthis.indexes[fields.join(',')] = {\n\t\t\ttype,\n\t\t\tfields,\n\t\t\tdata: {}\n\t\t};\n\t}\n\n\taddToAllIndexes(record) {\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tthis.addToIndex(indexName, record);\n\t\t\t}\n\t\t}\n\t}\n\n\taddToIndex(indexName, record) {\n\t\tconst index = this.indexes[indexName];\n\t\tif (!index) {\n\t\t\tconsole.error(`Index not defined ${ indexName }`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst keys = [];\n\t\tfor (const field of index.fields) {\n\t\t\tkeys.push(objectPath.get(record, field));\n\t\t}\n\t\tconst key = keys.join('|');\n\n\t\tif (index.type === 'unique') {\n\t\t\tindex.data[key] = record;\n\t\t\treturn;\n\t\t}\n\n\t\tif (index.type === 'array') {\n\t\t\tif (!index.data[key]) {\n\t\t\t\tindex.data[key] = [];\n\t\t\t}\n\t\t\tindex.data[key].push(record);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tremoveFromAllIndexes(record) {\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tthis.removeFromIndex(indexName, record);\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveFromIndex(indexName, record) {\n\t\tconst index = this.indexes[indexName];\n\t\tif (!this.indexes[indexName]) {\n\t\t\tconsole.error(`Index not defined ${ indexName }`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!index.data) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet key = [];\n\t\tfor (const field of index.fields) {\n\t\t\tkey.push(objectPath.get(record, field));\n\t\t}\n\t\tkey = key.join('|');\n\n\t\tif (index.type === 'unique') {\n\t\t\tindex.data[key] = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (index.type === 'array') {\n\t\t\tif (!index.data[key]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst i = index.data[key].indexOf(record);\n\t\t\tif (i > -1) {\n\t\t\t\tindex.data[key].splice(i, 1);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_findByIndex(index, keys) {\n\t\tconst key = [].concat(keys).join('|');\n\t\tif (!this.indexes[index]) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.indexes[index].data) {\n\t\t\tconst result = this.indexes[index].data[key];\n\t\t\tif (result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\tif (this.indexes[index].type === 'array') {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tfindByIndex(index, keys, options={}) {\n\t\treturn {\n\t\t\tfetch: () => {\n\t\t\t\treturn this.processQueryOptionsOnResult(this._findByIndex(index, keys), options);\n\t\t\t},\n\n\t\t\tcount: () => {\n\t\t\t\tconst records = this.findByIndex(index, keys, options).fetch();\n\t\t\t\tif (Array.isArray(records)) {\n\t\t\t\t\treturn records.length;\n\t\t\t\t}\n\t\t\t\treturn !records ? 0 : 1;\n\t\t\t},\n\n\t\t\tforEach: (fn) => {\n\t\t\t\tconst records = this.findByIndex(index, keys, options).fetch();\n\t\t\t\tif (Array.isArray(records)) {\n\t\t\t\t\treturn records.forEach(fn);\n\t\t\t\t}\n\t\t\t\tif (records) {\n\t\t\t\t\treturn fn(records);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tload() {\n\t\tif (this.model._useCache === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log('Will load cache for', this.collectionName);\n\t\tthis.emit('beforeload');\n\t\tthis.loaded = false;\n\t\tconst time = RocketChat.statsTracker.now();\n\t\tconst data = this.model.db.find(this.query, this.options).fetch();\n\t\tfor (let i=0; i < data.length; i++) {\n\t\t\tthis.insert(data[i]);\n\t\t}\n\t\tconsole.log(String(data.length), 'records load from', this.collectionName);\n\t\tRocketChat.statsTracker.timing('cache.load', RocketChat.statsTracker.now() - time, [`collection:${ this.collectionName }`]);\n\n\t\tthis.startSync();\n\t\tthis.loaded = true;\n\t\tthis.emit('afterload');\n\t}\n\n\tstartSync() {\n\t\tif (this.model._useCache === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.model._db.on('change', ({action, id, data/*, oplog*/}) => {\n\t\t\tswitch (action) {\n\t\t\t\tcase 'insert':\n\t\t\t\t\tdata._id = id;\n\t\t\t\t\tthis.insert(data);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'remove':\n\t\t\t\t\tthis.removeById(id);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'update:record':\n\t\t\t\t\tthis.updateDiffById(id, data);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'update:diff':\n\t\t\t\t\tthis.updateDiffById(id, data);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'update:query':\n\t\t\t\t\tthis.update(data.query, data.update, data.options);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t}\n\n\tprocessQueryOptionsOnResult(result, options={}) {\n\t\tif (result === undefined || result === null) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (Array.isArray(result)) {\n\t\t\tif (options.sort) {\n\t\t\t\tresult = result.sort((a, b) => {\n\t\t\t\t\tlet r = 0;\n\t\t\t\t\tfor (const field in options.sort) {\n\t\t\t\t\t\tif (options.sort.hasOwnProperty(field)) {\n\t\t\t\t\t\t\tconst direction = options.sort[field];\n\t\t\t\t\t\t\tlet valueA;\n\t\t\t\t\t\t\tlet valueB;\n\t\t\t\t\t\t\tif (field.indexOf('.') > -1) {\n\t\t\t\t\t\t\t\tvalueA = objectPath.get(a, field);\n\t\t\t\t\t\t\t\tvalueB = objectPath.get(b, field);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalueA = a[field];\n\t\t\t\t\t\t\t\tvalueB = b[field];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (valueA > valueB) {\n\t\t\t\t\t\t\t\tr = direction;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (valueA < valueB) {\n\t\t\t\t\t\t\t\tr = -direction;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn r;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (typeof options.skip === 'number') {\n\t\t\t\tresult.splice(0, options.skip);\n\t\t\t}\n\n\t\t\tif (typeof options.limit === 'number' && options.limit !== 0) {\n\t\t\t\tresult.splice(options.limit);\n\t\t\t}\n\t\t}\n\n\t\tif (!options.fields) {\n\t\t\toptions.fields = {};\n\t\t}\n\n\t\tconst fieldsToRemove = [];\n\t\tconst fieldsToGet = [];\n\n\t\tfor (const field in options.fields) {\n\t\t\tif (options.fields.hasOwnProperty(field)) {\n\t\t\t\tif (options.fields[field] === 0) {\n\t\t\t\t\tfieldsToRemove.push(field);\n\t\t\t\t} else if (options.fields[field] === 1) {\n\t\t\t\t\tfieldsToGet.push(field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (fieldsToRemove.length > 0 && fieldsToGet.length > 0) {\n\t\t\tconsole.warn('Can\\'t mix remove and get fields');\n\t\t\tfieldsToRemove.splice(0, fieldsToRemove.length);\n\t\t}\n\n\t\tif (fieldsToGet.length > 0 && fieldsToGet.indexOf('_id') === -1) {\n\t\t\tfieldsToGet.push('_id');\n\t\t}\n\n\t\tconst pickFields = (obj, fields) => {\n\t\t\tconst picked = {};\n\t\t\tfields.forEach((field) => {\n\t\t\t\tif (field.indexOf('.') !== -1) {\n\t\t\t\t\tobjectPath.set(picked, field, objectPath.get(obj, field));\n\t\t\t\t} else {\n\t\t\t\t\tpicked[field] = obj[field];\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn picked;\n\t\t};\n\n\t\tif (fieldsToRemove.length > 0 || fieldsToGet.length > 0) {\n\t\t\tif (Array.isArray(result)) {\n\t\t\t\tresult = result.map((record) => {\n\t\t\t\t\tif (fieldsToRemove.length > 0) {\n\t\t\t\t\t\treturn _.omit(record, ...fieldsToRemove);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (fieldsToGet.length > 0) {\n\t\t\t\t\t\treturn pickFields(record, fieldsToGet);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (fieldsToRemove.length > 0) {\n\t\t\t\t\treturn _.omit(result, ...fieldsToRemove);\n\t\t\t\t}\n\n\t\t\t\tif (fieldsToGet.length > 0) {\n\t\t\t\t\treturn pickFields(result, fieldsToGet);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprocessQuery(query, parentField) {\n\t\tif (!query) {\n\t\t\treturn query;\n\t\t}\n\n\t\tif (Match.test(query, String)) {\n\t\t\treturn {\n\t\t\t\t_id: query\n\t\t\t};\n\t\t}\n\n\t\tif (Object.keys(query).length > 1 && parentField !== '$elemMatch') {\n\t\t\tconst and = [];\n\t\t\tfor (const field in query) {\n\t\t\t\tif (query.hasOwnProperty(field)) {\n\t\t\t\t\tand.push({\n\t\t\t\t\t\t[field]: query[field]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tquery = {$and: and};\n\t\t}\n\n\t\tfor (const field in query) {\n\t\t\tif (query.hasOwnProperty(field)) {\n\t\t\t\tconst value = query[field];\n\t\t\t\tif (value instanceof RegExp && field !== '$regex') {\n\t\t\t\t\tquery[field] = {\n\t\t\t\t\t\t$regex: value\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (field === '$and' || field === '$or') {\n\t\t\t\t\tquery[field] = value.map((subValue) => {\n\t\t\t\t\t\treturn this.processQuery(subValue, field);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (Match.test(value, Object) && Object.keys(value).length > 0) {\n\t\t\t\t\tquery[field] = this.processQuery(value, field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn query;\n\t}\n\n\tfind(query, options={}) {\n\t\treturn {\n\t\t\tfetch: () => {\n\t\t\t\ttry {\n\t\t\t\t\tquery = this.processQuery(query);\n\t\t\t\t\treturn this.processQueryOptionsOnResult(this.collection.find(query), options);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Exception on cache find for', this.collectionName);\n\t\t\t\t\tconsole.error('Query:', JSON.stringify(query, null, 2));\n\t\t\t\t\tconsole.error('Options:', JSON.stringify(options, null, 2));\n\t\t\t\t\tconsole.error(e.stack);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tcount: () => {\n\t\t\t\ttry {\n\t\t\t\t\tquery = this.processQuery(query);\n\t\t\t\t\tconst { limit, skip } = options;\n\t\t\t\t\treturn this.processQueryOptionsOnResult(this.collection.find(query), { limit, skip }).length;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Exception on cache find for', this.collectionName);\n\t\t\t\t\tconsole.error('Query:', JSON.stringify(query, null, 2));\n\t\t\t\t\tconsole.error('Options:', JSON.stringify(options, null, 2));\n\t\t\t\t\tconsole.error(e.stack);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tforEach: (fn) => {\n\t\t\t\treturn this.find(query, options).fetch().forEach(fn);\n\t\t\t},\n\n\t\t\tobserve: (obj) => {\n\t\t\t\tlogger.debug(this.collectionName, 'Falling back observe to model with query:', query);\n\t\t\t\treturn this.model.db.find(...arguments).observe(obj);\n\t\t\t},\n\n\t\t\tobserveChanges: (obj) => {\n\t\t\t\tlogger.debug(this.collectionName, 'Falling back observeChanges to model with query:', query);\n\t\t\t\treturn this.model.db.find(...arguments).observeChanges(obj);\n\t\t\t},\n\n\t\t\t_publishCursor: (cursor, sub, collection) => {\n\t\t\t\tlogger.debug(this.collectionName, 'Falling back _publishCursor to model with query:', query);\n\t\t\t\treturn this.model.db.find(...arguments)._publishCursor(cursor, sub, collection);\n\t\t\t}\n\t\t};\n\t}\n\n\tfindOne(query, options) {\n\t\ttry {\n\t\t\tquery = this.processQuery(query);\n\t\t\treturn this.processQueryOptionsOnResult(this.collection.findOne(query), options);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on cache findOne for', this.collectionName);\n\t\t\tconsole.error('Query:', JSON.stringify(query, null, 2));\n\t\t\tconsole.error('Options:', JSON.stringify(options, null, 2));\n\t\t\tconsole.error(e.stack);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tfindOneById(_id, options) {\n\t\treturn this.findByIndex('_id', _id, options).fetch();\n\t}\n\n\tfindOneByIds(ids, options) {\n\t\tconst query = this.processQuery({ _id: { $in: ids }});\n\t\treturn this.processQueryOptionsOnResult(this.collection.findOne(query), options);\n\t}\n\n\tfindWhere(query, options) {\n\t\tquery = this.processQuery(query);\n\t\treturn this.processQueryOptionsOnResult(this.collection.findWhere(query), options);\n\t}\n\n\taddDynamicView() {\n\t\treturn this.collection.addDynamicView(...arguments);\n\t}\n\n\tgetDynamicView() {\n\t\treturn this.collection.getDynamicView(...arguments);\n\t}\n\n\tinsert(record) {\n\t\tif (Array.isArray(record)) {\n\t\t\tfor (const item of record) {\n\t\t\t\tthis.insert(item);\n\t\t\t}\n\t\t} else {\n\t\t\t// TODO remove - ignore updates in room.usernames\n\t\t\tif (this.collectionName === 'rocketchat_room' && record.usernames) {\n\t\t\t\tdelete record.usernames;\n\t\t\t}\n\t\t\tthis.emit('beforeinsert', record);\n\t\t\tthis.addToAllIndexes(record);\n\t\t\tthis.collection.insert(record);\n\t\t\tthis.emit('inserted', record);\n\t\t}\n\t}\n\n\tupdateDiffById(id, diff) {\n\t\t// TODO remove - ignore updates in room.usernames\n\t\tif (this.collectionName === 'rocketchat_room' && diff.usernames) {\n\t\t\tdelete diff.usernames;\n\t\t}\n\n\t\tconst record = this._findByIndex('_id', id);\n\t\tif (!record) {\n\t\t\tconsole.error('Cache.updateDiffById: No record', this.collectionName, id, diff);\n\t\t\treturn;\n\t\t}\n\t\tthis.removeFromAllIndexes(record);\n\n\t\tconst updatedFields = _.without(Object.keys(diff), ...this.ignoreUpdatedFields);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('beforeupdate', record, diff);\n\t\t}\n\n\t\tfor (const key in diff) {\n\t\t\tif (diff.hasOwnProperty(key)) {\n\t\t\t\tobjectPath.set(record, key, diff[key]);\n\t\t\t}\n\t\t}\n\n\t\tthis.collection.update(record);\n\t\tthis.addToAllIndexes(record);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('updated', record, diff);\n\t\t}\n\t}\n\n\tupdateRecord(record, update) {\n\t\t// TODO remove - ignore updates in room.usernames\n\t\tif (this.collectionName === 'rocketchat_room' && (record.usernames || (record.$set && record.$set.usernames))) {\n\t\t\tdelete record.usernames;\n\t\t\tif (record.$set && record.$set.usernames) {\n\t\t\t\tdelete record.$set.usernames;\n\t\t\t}\n\t\t}\n\n\t\tthis.removeFromAllIndexes(record);\n\n\t\tconst topLevelFields = Object.keys(update).map(field => field.split('.')[0]);\n\t\tconst updatedFields = _.without(topLevelFields, ...this.ignoreUpdatedFields);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('beforeupdate', record, record);\n\t\t}\n\n\t\tif (update.$set) {\n\t\t\t_.each(update.$set, (value, field) => {\n\t\t\t\tobjectPath.set(record, field, value);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$unset) {\n\t\t\t_.each(update.$unset, (value, field) => {\n\t\t\t\tobjectPath.del(record, field);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$min) {\n\t\t\t_.each(update.$min, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined || value < curValue) {\n\t\t\t\t\tobjectPath.set(record, field, value);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$max) {\n\t\t\t_.each(update.$max, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined || value > curValue) {\n\t\t\t\t\tobjectPath.set(record, field, value);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$inc) {\n\t\t\t_.each(update.$inc, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined) {\n\t\t\t\t\tcurValue = value;\n\t\t\t\t} else {\n\t\t\t\t\tcurValue += value;\n\t\t\t\t}\n\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$mul) {\n\t\t\t_.each(update.$mul, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined) {\n\t\t\t\t\tcurValue = 0;\n\t\t\t\t} else {\n\t\t\t\t\tcurValue *= value;\n\t\t\t\t}\n\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$rename) {\n\t\t\t_.each(update.$rename, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue !== undefined) {\n\t\t\t\t\tobjectPath.set(record, value, curValue);\n\t\t\t\t\tobjectPath.del(record, field);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$pullAll) {\n\t\t\t_.each(update.$pullAll, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (Array.isArray(curValue)) {\n\t\t\t\t\tcurValue = _.difference(curValue, value);\n\t\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$pop) {\n\t\t\t_.each(update.$pop, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (Array.isArray(curValue)) {\n\t\t\t\t\tif (value === -1) {\n\t\t\t\t\t\tcurValue.shift();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurValue.pop();\n\t\t\t\t\t}\n\t\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$addToSet) {\n\t\t\t_.each(update.$addToSet, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined) {\n\t\t\t\t\tcurValue = [];\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(curValue)) {\n\t\t\t\t\tconst length = curValue.length;\n\n\t\t\t\t\tif (value && value.$each && Array.isArray(value.$each)) {\n\t\t\t\t\t\tfor (const valueItem of value.$each) {\n\t\t\t\t\t\t\tif (curValue.indexOf(valueItem) === -1) {\n\t\t\t\t\t\t\t\tcurValue.push(valueItem);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (curValue.indexOf(value) === -1) {\n\t\t\t\t\t\tcurValue.push(value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (curValue.length > length) {\n\t\t\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.collection.update(record);\n\t\tthis.addToAllIndexes(record);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('updated', record, record);\n\t\t}\n\t}\n\n\tupdate(query, update, options = {}) {\n\t\tlet records = options.multi ? this.find(query).fetch() : this.findOne(query) || [];\n\t\tif (!Array.isArray(records)) {\n\t\t\trecords = [records];\n\t\t}\n\n\t\tfor (const record of records) {\n\t\t\tthis.updateRecord(record, update);\n\t\t}\n\t}\n\n\tremoveById(id) {\n\t\tconst record = this._findByIndex('_id', id);\n\t\tif (record) {\n\t\t\tthis.emit('beforeremove', record);\n\t\t\tthis.collection.removeWhere({_id: id});\n\t\t\tthis.removeFromAllIndexes(record);\n\t\t\tthis.emit('removed', record);\n\t\t}\n\t}\n}\n\nexport default ModelsBaseCache;\n","/* globals MongoInternals */\nimport _ from 'underscore';\n\nconst baseName = 'rocketchat_';\nimport {EventEmitter} from 'events';\n\nconst trash = new Mongo.Collection(`${ baseName }_trash`);\ntry {\n\ttrash._ensureIndex({ collection: 1 });\n\ttrash._ensureIndex({ _deletedAt: 1 }, { expireAfterSeconds: 60 * 60 * 24 * 30 });\n} catch (e) {\n\tconsole.log(e);\n}\n\nconst isOplogAvailable = MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && !!MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry;\nlet isOplogEnabled = isOplogAvailable;\nRocketChat.settings.get('Force_Disable_OpLog_For_Cache', (key, value) => {\n\tisOplogEnabled = isOplogAvailable && value === false;\n});\n\nclass ModelsBaseDb extends EventEmitter {\n\tconstructor(model, baseModel) {\n\t\tsuper();\n\n\t\tif (Match.test(model, String)) {\n\t\t\tthis.name = model;\n\t\t\tthis.collectionName = this.baseName + this.name;\n\t\t\tthis.model = new Mongo.Collection(this.collectionName);\n\t\t} else {\n\t\t\tthis.name = model._name;\n\t\t\tthis.collectionName = this.name;\n\t\t\tthis.model = model;\n\t\t}\n\n\t\tthis.baseModel = baseModel;\n\n\t\tthis.wrapModel();\n\n\t\t// When someone start listening for changes we start oplog if available\n\t\tthis.once('newListener', (event/*, listener*/) => {\n\t\t\tif (event === 'change') {\n\t\t\t\tif (isOplogEnabled) {\n\t\t\t\t\tconst query = {\n\t\t\t\t\t\tcollection: this.collectionName\n\t\t\t\t\t};\n\n\t\t\t\t\tMongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry(query, this.processOplogRecord.bind(this));\n\t\t\t\t\tMongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle._defineTooFarBehind(Number.MAX_SAFE_INTEGER);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.tryEnsureIndex({ '_updatedAt': 1 });\n\t}\n\n\tget baseName() {\n\t\treturn baseName;\n\t}\n\n\tsetUpdatedAt(record = {}) {\n\n\t\t// TODO: Check if this can be deleted, Rodrigo does not rememebr WHY he added it. So he removed it to fix issue #5541\n\t\t// setUpdatedAt(record = {}, checkQuery = false, query) {\n\t\t// if (checkQuery === true) {\n\t\t// \tif (!query || Object.keys(query).length === 0) {\n\t\t// \t\tthrow new Meteor.Error('Models._Base: Empty query');\n\t\t// \t}\n\t\t// }\n\n\t\tif (/(^|,)\\$/.test(Object.keys(record).join(','))) {\n\t\t\trecord.$set = record.$set || {};\n\t\t\trecord.$set._updatedAt = new Date;\n\t\t} else {\n\t\t\trecord._updatedAt = new Date;\n\t\t}\n\n\t\treturn record;\n\t}\n\n\twrapModel() {\n\t\tthis.originals = {\n\t\t\tinsert: this.model.insert.bind(this.model),\n\t\t\tupdate: this.model.update.bind(this.model),\n\t\t\tremove: this.model.remove.bind(this.model)\n\t\t};\n\t\tconst self = this;\n\n\t\tthis.model.insert = function() {\n\t\t\treturn self.insert(...arguments);\n\t\t};\n\n\t\tthis.model.update = function() {\n\t\t\treturn self.update(...arguments);\n\t\t};\n\n\t\tthis.model.remove = function() {\n\t\t\treturn self.remove(...arguments);\n\t\t};\n\t}\n\n\tfind() {\n\t\treturn this.model.find(...arguments);\n\t}\n\n\tfindOne() {\n\t\treturn this.model.findOne(...arguments);\n\t}\n\n\tfindOneById(_id, options) {\n\t\treturn this.model.findOne({ _id }, options);\n\t}\n\n\tfindOneByIds(ids, options) {\n\t\treturn this.model.findOne({ _id: { $in: ids }}, options);\n\t}\n\n\tdefineSyncStrategy(query, modifier, options) {\n\t\tif (this.baseModel.useCache === false) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\tif (options.upsert === true) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\t// const dbModifiers = [\n\t\t// \t'$currentDate',\n\t\t// \t'$bit',\n\t\t// \t'$pull',\n\t\t// \t'$pushAll',\n\t\t// \t'$push',\n\t\t// \t'$setOnInsert'\n\t\t// ];\n\n\t\tconst cacheAllowedModifiers = [\n\t\t\t'$set',\n\t\t\t'$unset',\n\t\t\t'$min',\n\t\t\t'$max',\n\t\t\t'$inc',\n\t\t\t'$mul',\n\t\t\t'$rename',\n\t\t\t'$pullAll',\n\t\t\t'$pop',\n\t\t\t'$addToSet'\n\t\t];\n\n\t\tconst notAllowedModifiers = Object.keys(modifier).filter(i => i.startsWith('$') && cacheAllowedModifiers.includes(i) === false);\n\n\t\tif (notAllowedModifiers.length > 0) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\tconst placeholderFields = Object.keys(query).filter(item => item.indexOf('$') > -1);\n\t\tif (placeholderFields.length > 0) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\treturn 'cache';\n\t}\n\n\tupdateHasPositionalOperator(update) {\n\t\treturn Object.keys(update).some(key => key.includes('.$') || (!Match.test(update[key], Object) && this.updateHasPositionalOperator(update[key])));\n\t}\n\n\tprocessOplogRecord(action) {\n\t\tif (isOplogEnabled === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (action.op.op === 'i') {\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'insert',\n\t\t\t\tid: action.op.o._id,\n\t\t\t\tdata: action.op.o,\n\t\t\t\toplog: true\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (action.op.op === 'u') {\n\t\t\tif (!action.op.o.$set && !action.op.o.$unset) {\n\t\t\t\tthis.emit('change', {\n\t\t\t\t\taction: 'update:record',\n\t\t\t\t\tid: action.id,\n\t\t\t\t\tdata: action.op.o,\n\t\t\t\t\toplog: true\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst diff = {};\n\t\t\tif (action.op.o.$set) {\n\t\t\t\tfor (const key in action.op.o.$set) {\n\t\t\t\t\tif (action.op.o.$set.hasOwnProperty(key)) {\n\t\t\t\t\t\tdiff[key] = action.op.o.$set[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (action.op.o.$unset) {\n\t\t\t\tfor (const key in action.op.o.$unset) {\n\t\t\t\t\tif (action.op.o.$unset.hasOwnProperty(key)) {\n\t\t\t\t\t\tdiff[key] = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'update:diff',\n\t\t\t\tid: action.id,\n\t\t\t\tdata: diff,\n\t\t\t\toplog: true\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (action.op.op === 'd') {\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'remove',\n\t\t\t\tid: action.id,\n\t\t\t\toplog: true\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t}\n\n\tinsert(record) {\n\t\tthis.setUpdatedAt(record);\n\n\t\tconst result = this.originals.insert(...arguments);\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0) {\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'insert',\n\t\t\t\tid: result,\n\t\t\t\tdata: _.extend({}, record),\n\t\t\t\toplog: false\n\t\t\t});\n\t\t}\n\n\t\trecord._id = result;\n\n\t\treturn result;\n\t}\n\n\tupdate(query, update, options = {}) {\n\t\tthis.setUpdatedAt(update, true, query);\n\n\t\tconst strategy = this.defineSyncStrategy(query, update, options);\n\t\tlet ids = [];\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0 && strategy === 'db') {\n\t\t\tconst findOptions = {fields: {_id: 1}};\n\t\t\tlet records = options.multi ? this.find(query, findOptions).fetch() : this.findOne(query, findOptions) || [];\n\t\t\tif (!Array.isArray(records)) {\n\t\t\t\trecords = [records];\n\t\t\t}\n\n\t\t\tids = records.map(item => item._id);\n\t\t\tif (options.upsert !== true && this.updateHasPositionalOperator(update) === false) {\n\t\t\t\tquery = {\n\t\t\t\t\t_id: {\n\t\t\t\t\t\t$in: ids\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst result = this.originals.update(query, update, options);\n\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0) {\n\t\t\tif (strategy === 'db') {\n\t\t\t\tif (options.upsert === true) {\n\t\t\t\t\tif (result.insertedId) {\n\t\t\t\t\t\tthis.emit('change', {\n\t\t\t\t\t\t\taction: 'insert',\n\t\t\t\t\t\t\tid: result.insertedId,\n\t\t\t\t\t\t\tdata: this.findOne({_id: result.insertedId}),\n\t\t\t\t\t\t\toplog: false\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tquery = {\n\t\t\t\t\t\t_id: {\n\t\t\t\t\t\t\t$in: ids\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet records = options.multi ? this.find(query).fetch() : this.findOne(query) || [];\n\t\t\t\tif (!Array.isArray(records)) {\n\t\t\t\t\trecords = [records];\n\t\t\t\t}\n\t\t\t\tfor (const record of records) {\n\t\t\t\t\tthis.emit('change', {\n\t\t\t\t\t\taction: 'update:record',\n\t\t\t\t\t\tid: record._id,\n\t\t\t\t\t\tdata: record,\n\t\t\t\t\t\toplog: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.emit('change', {\n\t\t\t\t\taction: 'update:query',\n\t\t\t\t\tid: undefined,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tquery,\n\t\t\t\t\t\tupdate,\n\t\t\t\t\t\toptions\n\t\t\t\t\t},\n\t\t\t\t\toplog: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tupsert(query, update, options = {}) {\n\t\toptions.upsert = true;\n\t\toptions._returnObject = true;\n\t\treturn this.update(query, update, options);\n\t}\n\n\tremove(query) {\n\t\tconst records = this.model.find(query).fetch();\n\n\t\tconst ids = [];\n\t\tfor (const record of records) {\n\t\t\tids.push(record._id);\n\n\t\t\trecord._deletedAt = new Date;\n\t\t\trecord.__collection__ = this.name;\n\n\t\t\ttrash.upsert({_id: record._id}, _.omit(record, '_id'));\n\t\t}\n\n\t\tquery = { _id: { $in: ids } };\n\n\t\tconst result = this.originals.remove(query);\n\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0) {\n\t\t\tfor (const record of records) {\n\t\t\t\tthis.emit('change', {\n\t\t\t\t\taction: 'remove',\n\t\t\t\t\tid: record._id,\n\t\t\t\t\tdata: _.extend({}, record),\n\t\t\t\t\toplog: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinsertOrUpsert(...args) {\n\t\tif (args[0] && args[0]._id) {\n\t\t\tconst _id = args[0]._id;\n\t\t\tdelete args[0]._id;\n\t\t\targs.unshift({\n\t\t\t\t_id\n\t\t\t});\n\n\t\t\tthis.upsert(...args);\n\t\t\treturn _id;\n\t\t} else {\n\t\t\treturn this.insert(...args);\n\t\t}\n\t}\n\n\tallow() {\n\t\treturn this.model.allow(...arguments);\n\t}\n\n\tdeny() {\n\t\treturn this.model.deny(...arguments);\n\t}\n\n\tensureIndex() {\n\t\treturn this.model._ensureIndex(...arguments);\n\t}\n\n\tdropIndex() {\n\t\treturn this.model._dropIndex(...arguments);\n\t}\n\n\ttryEnsureIndex() {\n\t\ttry {\n\t\t\treturn this.ensureIndex(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Error creating index:', this.name, '->', ...arguments, e);\n\t\t}\n\t}\n\n\ttryDropIndex() {\n\t\ttry {\n\t\t\treturn this.dropIndex(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Error dropping index:', this.name, '->', ...arguments, e);\n\t\t}\n\t}\n\n\ttrashFind(query, options) {\n\t\tquery.__collection__ = this.name;\n\n\t\treturn trash.find(query, options);\n\t}\n\n\ttrashFindDeletedAfter(deletedAt, query = {}, options) {\n\t\tquery.__collection__ = this.name;\n\t\tquery._deletedAt = {\n\t\t\t$gt: deletedAt\n\t\t};\n\n\t\treturn trash.find(query, options);\n\t}\n}\n\nexport default ModelsBaseDb;\n","import _ from 'underscore';\n\nconst AccessTokenServices = {};\n\nRocketChat.registerAccessTokenService = function(serviceName, handleAccessTokenRequest) {\n\tAccessTokenServices[serviceName] = {\n\t\tserviceName,\n\t\thandleAccessTokenRequest\n\t};\n};\n\n// Listen to calls to `login` with an oauth option set. This is where\n// users actually get logged in to meteor via oauth.\nAccounts.registerLoginHandler(function(options) {\n\tif (!options.accessToken) {\n\t\treturn undefined; // don't handle\n\t}\n\n\tcheck(options, Match.ObjectIncluding({\n\t\tserviceName: String\n\t}));\n\n\tconst service = AccessTokenServices[options.serviceName];\n\n\t// Skip everything if there's no service set by the oauth middleware\n\tif (!service) {\n\t\tthrow new Error(`Unexpected AccessToken service ${ options.serviceName }`);\n\t}\n\n\t// Make sure we're configured\n\tif (!ServiceConfiguration.configurations.findOne({service: service.serviceName})) {\n\t\tthrow new ServiceConfiguration.ConfigError();\n\t}\n\n\tif (!_.contains(Accounts.oauth.serviceNames(), service.serviceName)) {\n\t\t// serviceName was not found in the registered services list.\n\t\t// This could happen because the service never registered itself or\n\t\t// unregisterService was called on it.\n\t\treturn {\n\t\t\ttype: 'oauth',\n\t\t\terror: new Meteor.Error(\n\t\t\t\tAccounts.LoginCancelledError.numericError,\n\t\t\t\t`No registered oauth service found for: ${ service.serviceName }`\n\t\t\t)\n\t\t};\n\t}\n\n\tconst oauthResult = service.handleAccessTokenRequest(options);\n\n\treturn Accounts.updateOrCreateUserFromExternalService(service.serviceName, oauthResult.serviceData, oauthResult.options);\n});\n\n\n\n","/* globals Google */\nimport _ from 'underscore';\n\nfunction getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get(\n\t\t\t'https://www.googleapis.com/oauth2/v1/userinfo',\n\t\t\t{params: {access_token: accessToken}}).data;\n\t} catch (err) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Google. ${ err.message }`), {response: err.response});\n\t}\n}\n\nfunction getScopes(accessToken) {\n\ttry {\n\t\treturn HTTP.get(\n\t\t\t'https://www.googleapis.com/oauth2/v1/tokeninfo',\n\t\t\t{params: {access_token: accessToken}}).data.scope.split(' ');\n\t} catch (err) {\n\t\tthrow _.extend(new Error(`Failed to fetch tokeninfo from Google. ${ err.message }`), {response: err.response});\n\t}\n}\n\n\nRocketChat.registerAccessTokenService('google', function(options) {\n\tcheck(options, Match.ObjectIncluding({\n\t\taccessToken: String,\n\t\tidToken: String,\n\t\texpiresIn: Match.Integer,\n\t\tscope: Match.Maybe(String),\n\t\tidentity: Match.Maybe(Object)\n\t}));\n\n\tconst identity = options.identity || getIdentity(options.accessToken);\n\n\tconst serviceData = {\n\t\taccessToken: options.accessToken,\n\t\tidToken: options.idToken,\n\t\texpiresAt: (+new Date) + (1000 * parseInt(options.expiresIn, 10)),\n\t\tscope: options.scopes || getScopes(options.accessToken)\n\t};\n\n\tconst fields = _.pick(identity, Google.whitelistedFields);\n\t_.extend(serviceData, fields);\n\n\t// only set the token in serviceData if it's there. this ensures\n\t// that we don't lose old ones (since we only get this on the first\n\t// log in attempt)\n\tif (options.refreshToken) {\n\t\tserviceData.refreshToken = options.refreshToken;\n\t}\n\n\treturn {\n\t\tserviceData,\n\t\toptions: {\n\t\t\tprofile: {\n\t\t\t\tname: identity.name\n\t\t\t}\n\t\t}\n\t};\n});\n","/* globals OAuth */\nimport _ from 'underscore';\n\nOAuth._redirectUri = _.wrap(OAuth._redirectUri, function(func, serviceName, ...args) {\n\tconst proxy = RocketChat.settings.get('Accounts_OAuth_Proxy_services').replace(/\\s/g, '').split(',');\n\tif (proxy.includes(serviceName)) {\n\t\treturn `${ RocketChat.settings.get('Accounts_OAuth_Proxy_host') }/oauth_redirect`;\n\t} else {\n\t\treturn func(serviceName, ...args);\n\t}\n\n});\n","import {StatsD} from 'node-dogstatsd';\n\nRocketChat.statsTracker = new (class StatsTracker {\n\tconstructor() {\n\t\tthis.StatsD = StatsD;\n\t\tthis.dogstatsd = new this.StatsD();\n\t}\n\n\ttrack(type, stats, ...args) {\n\t\tthis.dogstatsd[type](`RocketChat.${ stats }`, ...args);\n\t}\n\n\tnow() {\n\t\tconst hrtime = process.hrtime();\n\t\treturn (hrtime[0] * 1000000 + hrtime[1] / 1000);\n\t}\n\n\ttiming(stats, time, tags) {\n\t\tthis.track('timing', stats, time, tags);\n\t}\n\n\tincrement(stats, time, tags) {\n\t\tthis.track('increment', stats, time, tags);\n\t}\n\n\tdecrement(stats, time, tags) {\n\t\tthis.track('decrement', stats, time, tags);\n\t}\n\n\thistogram(stats, time, tags) {\n\t\tthis.track('histogram', stats, time, tags);\n\t}\n\n\tgauge(stats, time, tags) {\n\t\tthis.track('gauge', stats, time, tags);\n\t}\n\n\tunique(stats, time, tags) {\n\t\tthis.track('unique', stats, time, tags);\n\t}\n\n\tset(stats, time, tags) {\n\t\tthis.track('set', stats, time, tags);\n\t}\n});\n","RocketChat.models.Rooms.cache.hasMany('Subscriptions', {\n\tfield: 'usernames',\n\tlink: {\n\t\tlocal: '_id',\n\t\tremote: 'rid',\n\t\ttransform(room, subscription) {\n\t\t\treturn subscription.u.username;\n\t\t},\n\t\tremove(arr, subscription) {\n\t\t\tif (arr.indexOf(subscription.u.username) > -1) {\n\t\t\t\tarr.splice(arr.indexOf(subscription.u.username), 1);\n\t\t\t}\n\t\t}\n\t}\n});\n\n\nRocketChat.models.Subscriptions.cache.hasOne('Rooms', {\n\tfield: '_room',\n\tlink: {\n\t\tlocal: 'rid',\n\t\tremote: '_id'\n\t}\n});\n\n\nRocketChat.models.Subscriptions.cache.hasOne('Users', {\n\tfield: '_user',\n\tlink: {\n\t\tlocal: 'u._id',\n\t\tremote: '_id'\n\t}\n});\n\nRocketChat.models.Subscriptions.cache.hasOne('Users', {\n\tfield: 'fname',\n\tlink: {\n\t\tlocal: 'name',\n\t\tremote: 'username',\n\t\twhere(subscription/*, user*/) {\n\t\t\treturn subscription.t === 'd';\n\t\t},\n\t\ttransform(subscription, user) {\n\t\t\tif (user == null || subscription == null) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\t// Prevent client cache for old subscriptions with new names\n\t\t\t// Cuz when a user change his name, the subscription's _updateAt\n\t\t\t// will not change\n\t\t\tif (subscription._updatedAt < user._updatedAt) {\n\t\t\t\tsubscription._updatedAt = user._updatedAt;\n\t\t\t}\n\t\t\treturn user.name;\n\t\t}\n\t}\n});\n\nRocketChat.models.Users.cache.load();\nRocketChat.models.Rooms.cache.load();\nRocketChat.models.Subscriptions.cache.load();\nRocketChat.models.Settings.cache.load();\n\n\nRocketChat.models.Users.cache.addDynamicView('highlights').applyFind({\n\t'settings.preferences.highlights': {$size: {$gt: 0}}\n});\n\nRocketChat.models.Subscriptions.cache.addDynamicView('notifications').applyFind({\n\t$or: [\n\t\t{desktopNotifications: {$in: ['all', 'nothing']}},\n\t\t{mobilePushNotifications: {$in: ['all', 'nothing']}}\n\t]\n});\n","/* globals WebAppInternals*/\nimport _ from 'underscore';\n\nfunction testWebAppInternals(fn) {\n\ttypeof WebAppInternals !== 'undefined' && fn(WebAppInternals);\n}\nRocketChat.settings.onload('CDN_PREFIX', function(key, value) {\n\tif (_.isString(value) && value.trim()) {\n\t\treturn testWebAppInternals(WebAppInternals => WebAppInternals.setBundledJsCssPrefix(value));\n\t}\n});\n\nMeteor.startup(function() {\n\tconst value = RocketChat.settings.get('CDN_PREFIX');\n\tif (_.isString(value) && value.trim()) {\n\t\treturn testWebAppInternals(WebAppInternals => WebAppInternals.setBundledJsCssPrefix(value));\n\t}\n});\n","import _ from 'underscore';\nimport { IMAPIntercepter } from '../lib/interceptDirectReplyEmails.js';\nimport { POP3Helper } from '../lib/interceptDirectReplyEmails.js';\n\nconst startEmailIntercepter = _.debounce(Meteor.bindEnvironment(function() {\n\tconsole.log('Starting Email Intercepter...');\n\n\tif (RocketChat.settings.get('Direct_Reply_Enable') && RocketChat.settings.get('Direct_Reply_Protocol') && RocketChat.settings.get('Direct_Reply_Host') && RocketChat.settings.get('Direct_Reply_Port') && RocketChat.settings.get('Direct_Reply_Username') && RocketChat.settings.get('Direct_Reply_Password')) {\n\t\tif (RocketChat.settings.get('Direct_Reply_Protocol') === 'IMAP') {\n\t\t\t// stop already running IMAP instance\n\t\t\tif (RocketChat.IMAP && RocketChat.IMAP.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running IMAP instance...');\n\t\t\t\tRocketChat.IMAP.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new IMAP instance......');\n\t\t\t\t\tRocketChat.IMAP = new IMAPIntercepter();\n\t\t\t\t\tRocketChat.IMAP.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else if (RocketChat.POP3 && RocketChat.POP3Helper && RocketChat.POP3Helper.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running POP instance...');\n\t\t\t\tRocketChat.POP3Helper.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new IMAP instance......');\n\t\t\t\t\tRocketChat.IMAP = new IMAPIntercepter();\n\t\t\t\t\tRocketChat.IMAP.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconsole.log('Starting new IMAP instance......');\n\t\t\t\tRocketChat.IMAP = new IMAPIntercepter();\n\t\t\t\tRocketChat.IMAP.start();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else if (RocketChat.settings.get('Direct_Reply_Protocol') === 'POP') {\n\t\t\t// stop already running POP instance\n\t\t\tif (RocketChat.POP3 && RocketChat.POP3Helper && RocketChat.POP3Helper.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running POP instance...');\n\t\t\t\tRocketChat.POP3Helper.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new POP instance......');\n\t\t\t\t\tRocketChat.POP3Helper = new POP3Helper();\n\t\t\t\t\tRocketChat.POP3Helper.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else if (RocketChat.IMAP && RocketChat.IMAP.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running IMAP instance...');\n\t\t\t\tRocketChat.IMAP.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new POP instance......');\n\t\t\t\t\tRocketChat.POP3Helper = new POP3Helper();\n\t\t\t\t\tRocketChat.POP3Helper.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconsole.log('Starting new POP instance......');\n\t\t\t\tRocketChat.POP3Helper = new POP3Helper();\n\t\t\t\tRocketChat.POP3Helper.start();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t} else if (RocketChat.IMAP && RocketChat.IMAP.isActive()) {\n\t\t// stop IMAP instance\n\t\tRocketChat.IMAP.stop();\n\t} else if (RocketChat.POP3 && RocketChat.POP3Helper.isActive()) {\n\t\t// stop POP3 instance\n\t\tRocketChat.POP3Helper.stop();\n\t}\n}), 1000);\n\nRocketChat.settings.onload(/^Direct_Reply_.+/, startEmailIntercepter);\n","import _ from 'underscore';\n\nconst buildMailURL = _.debounce(function() {\n\tconsole.log('Updating process.env.MAIL_URL');\n\n\tif (RocketChat.settings.get('SMTP_Host')) {\n\t\tprocess.env.MAIL_URL = `${ RocketChat.settings.get('SMTP_Protocol') }://`;\n\n\t\tif (RocketChat.settings.get('SMTP_Username') && RocketChat.settings.get('SMTP_Password')) {\n\t\t\tprocess.env.MAIL_URL += `${ encodeURIComponent(RocketChat.settings.get('SMTP_Username')) }:${ encodeURIComponent(RocketChat.settings.get('SMTP_Password')) }@`;\n\t\t}\n\n\t\tprocess.env.MAIL_URL += encodeURIComponent(RocketChat.settings.get('SMTP_Host'));\n\n\t\tif (RocketChat.settings.get('SMTP_Port')) {\n\t\t\tprocess.env.MAIL_URL += `:${ parseInt(RocketChat.settings.get('SMTP_Port')) }`;\n\t\t}\n\n\t\tprocess.env.MAIL_URL += `?pool=${ RocketChat.settings.get('SMTP_Pool') }`;\n\n\t\tif (RocketChat.settings.get('SMTP_Protocol') === 'smtp' && RocketChat.settings.get('SMTP_IgnoreTLS')) {\n\t\t\tprocess.env.MAIL_URL += '&secure=false&ignoreTLS=true';\n\t\t}\n\n\t\treturn process.env.MAIL_URL;\n\t}\n}, 500);\n\nRocketChat.settings.onload('SMTP_Host', function(key, value) {\n\tif (_.isString(value)) {\n\t\treturn buildMailURL();\n\t}\n});\n\nRocketChat.settings.onload('SMTP_Port', function() {\n\treturn buildMailURL();\n});\n\nRocketChat.settings.onload('SMTP_Username', function(key, value) {\n\tif (_.isString(value)) {\n\t\treturn buildMailURL();\n\t}\n});\n\nRocketChat.settings.onload('SMTP_Password', function(key, value) {\n\tif (_.isString(value)) {\n\t\treturn buildMailURL();\n\t}\n});\n\nRocketChat.settings.onload('SMTP_Protocol', function() {\n\treturn buildMailURL();\n});\n\nRocketChat.settings.onload('SMTP_Pool', function() {\n\treturn buildMailURL();\n});\n\nRocketChat.settings.onload('SMTP_IgnoreTLS', function() {\n\treturn buildMailURL();\n});\n\nMeteor.startup(function() {\n\treturn buildMailURL();\n});\n","/* globals CustomOAuth */\nimport _ from 'underscore';\n\nconst logger = new Logger('rocketchat:lib', {\n\tmethods: {\n\t\toauth_updated: {\n\t\t\ttype: 'info'\n\t\t}\n\t}\n});\n\nfunction _OAuthServicesUpdate() {\n\tconst services = RocketChat.settings.get(/^(Accounts_OAuth_|Accounts_OAuth_Custom-)[a-z0-9_]+$/i);\n\tservices.forEach((service) => {\n\t\tlogger.oauth_updated(service.key);\n\t\tlet serviceName = service.key.replace('Accounts_OAuth_', '');\n\t\tif (serviceName === 'Meteor') {\n\t\t\tserviceName = 'meteor-developer';\n\t\t}\n\t\tif (/Accounts_OAuth_Custom-/.test(service.key)) {\n\t\t\tserviceName = service.key.replace('Accounts_OAuth_Custom-', '');\n\t\t}\n\t\tif (service.value === true) {\n\t\t\tconst data = {\n\t\t\t\tclientId: RocketChat.settings.get(`${ service.key }_id`),\n\t\t\t\tsecret: RocketChat.settings.get(`${ service.key }_secret`)\n\t\t\t};\n\t\t\tif (/Accounts_OAuth_Custom-/.test(service.key)) {\n\t\t\t\tdata.custom = true;\n\t\t\t\tdata.clientId = RocketChat.settings.get(`${ service.key }-id`);\n\t\t\t\tdata.secret = RocketChat.settings.get(`${ service.key }-secret`);\n\t\t\t\tdata.serverURL = RocketChat.settings.get(`${ service.key }-url`);\n\t\t\t\tdata.tokenPath = RocketChat.settings.get(`${ service.key }-token_path`);\n\t\t\t\tdata.identityPath = RocketChat.settings.get(`${ service.key }-identity_path`);\n\t\t\t\tdata.authorizePath = RocketChat.settings.get(`${ service.key }-authorize_path`);\n\t\t\t\tdata.scope = RocketChat.settings.get(`${ service.key }-scope`);\n\t\t\t\tdata.buttonLabelText = RocketChat.settings.get(`${ service.key }-button_label_text`);\n\t\t\t\tdata.buttonLabelColor = RocketChat.settings.get(`${ service.key }-button_label_color`);\n\t\t\t\tdata.loginStyle = RocketChat.settings.get(`${ service.key }-login_style`);\n\t\t\t\tdata.buttonColor = RocketChat.settings.get(`${ service.key }-button_color`);\n\t\t\t\tdata.tokenSentVia = RocketChat.settings.get(`${ service.key }-token_sent_via`);\n\t\t\t\tdata.identityTokenSentVia = RocketChat.settings.get(`${ service.key }-identity_token_sent_via`);\n\t\t\t\tdata.usernameField = RocketChat.settings.get(`${ service.key }-username_field`);\n\t\t\t\tdata.mergeUsers = RocketChat.settings.get(`${ service.key }-merge_users`);\n\t\t\t\tnew CustomOAuth(serviceName.toLowerCase(), {\n\t\t\t\t\tserverURL: data.serverURL,\n\t\t\t\t\ttokenPath: data.tokenPath,\n\t\t\t\t\tidentityPath: data.identityPath,\n\t\t\t\t\tauthorizePath: data.authorizePath,\n\t\t\t\t\tscope: data.scope,\n\t\t\t\t\tloginStyle: data.loginStyle,\n\t\t\t\t\ttokenSentVia: data.tokenSentVia,\n\t\t\t\t\tidentityTokenSentVia: data.identityTokenSentVia,\n\t\t\t\t\tusernameField: data.usernameField,\n\t\t\t\t\tmergeUsers: data.mergeUsers\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (serviceName === 'Facebook') {\n\t\t\t\tdata.appId = data.clientId;\n\t\t\t\tdelete data.clientId;\n\t\t\t}\n\t\t\tif (serviceName === 'Twitter') {\n\t\t\t\tdata.consumerKey = data.clientId;\n\t\t\t\tdelete data.clientId;\n\t\t\t}\n\t\t\tServiceConfiguration.configurations.upsert({\n\t\t\t\tservice: serviceName.toLowerCase()\n\t\t\t}, {\n\t\t\t\t$set: data\n\t\t\t});\n\t\t} else {\n\t\t\tServiceConfiguration.configurations.remove({\n\t\t\t\tservice: serviceName.toLowerCase()\n\t\t\t});\n\t\t}\n\t});\n}\n\nconst OAuthServicesUpdate = _.debounce(Meteor.bindEnvironment(_OAuthServicesUpdate), 2000);\n\nfunction OAuthServicesRemove(_id) {\n\tconst serviceName = _id.replace('Accounts_OAuth_Custom-', '');\n\treturn ServiceConfiguration.configurations.remove({\n\t\tservice: serviceName.toLowerCase()\n\t});\n}\n\nRocketChat.settings.get(/^Accounts_OAuth_.+/, function() {\n\treturn OAuthServicesUpdate(); // eslint-disable-line new-cap\n});\n\nRocketChat.settings.get(/^Accounts_OAuth_Custom-[a-z0-9_]+/, function(key, value) {\n\tif (!value) {\n\t\treturn OAuthServicesRemove(key);// eslint-disable-line new-cap\n\t}\n});\n","// Insert server unique id if it doesn't exist\nRocketChat.settings.add('uniqueID', process.env.DEPLOYMENT_ID || Random.id(), {\n\t'public': true,\n\thidden: true\n});\n\n// When you define a setting and want to add a description, you don't need to automatically define the i18nDescription\n// if you add a node to the i18n.json with the same setting name but with `_Description` it will automatically work.\n\nRocketChat.settings.addGroup('Accounts', function() {\n\tthis.add('Accounts_AllowAnonymousRead', false, {\n\t\ttype: 'boolean',\n\t\tpublic: true\n\t});\n\tthis.add('Accounts_AllowAnonymousWrite', false, {\n\t\ttype: 'boolean',\n\t\tpublic: true,\n\t\tenableQuery: {\n\t\t\t_id: 'Accounts_AllowAnonymousRead',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Accounts_AllowDeleteOwnAccount', false, {\n\t\ttype: 'boolean',\n\t\t'public': true,\n\t\tenableQuery: {\n\t\t\t_id: 'Accounts_AllowUserProfileChange',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Accounts_AllowUserProfileChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowUserAvatarChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowRealNameChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowUsernameChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowEmailChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowPasswordChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_CustomFieldsToShowInUserInfo', '', {\n\t\ttype: 'string',\n\t\tpublic: true\n\t});\n\tthis.add('Accounts_LoginExpiration', 90, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_ShowFormLogin', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_EmailOrUsernamePlaceholder', '', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nLabel: 'Placeholder_for_email_or_username_login_field'\n\t});\n\tthis.add('Accounts_PasswordPlaceholder', '', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nLabel: 'Placeholder_for_password_login_field'\n\t});\n\tthis.add('Accounts_ForgetUserSessionOnWindowClose', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_SearchFields', 'username, name, emails.address', {\n\t\ttype: 'string',\n\t\tpublic: true\n\t});\n\n\tthis.section('Registration', function() {\n\t\tthis.add('Accounts_DefaultUsernamePrefixSuggestion', 'user', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_RequireNameForSignUp', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_RequirePasswordConfirmation', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_EmailVerification', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'SMTP_Host',\n\t\t\t\tvalue: {\n\t\t\t\t\t$exists: 1,\n\t\t\t\t\t$ne: ''\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.add('Accounts_ManuallyApproveNewUsers', false, {\n\t\t\t'public': true,\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_AllowedDomainsList', '', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_BlockedDomainsList', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_BlockedUsernameList', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_UseDefaultBlockedDomainsList', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_UseDNSDomainCheck', false, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_RegistrationForm', 'Public', {\n\t\t\ttype: 'select',\n\t\t\t'public': true,\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'Public',\n\t\t\t\t\ti18nLabel: 'Accounts_RegistrationForm_Public'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'Disabled',\n\t\t\t\t\ti18nLabel: 'Accounts_RegistrationForm_Disabled'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'Secret URL',\n\t\t\t\t\ti18nLabel: 'Accounts_RegistrationForm_Secret_URL'\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\tthis.add('Accounts_RegistrationForm_SecretURL', Random.id(), {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_RegistrationForm_LinkReplacementText', 'New user registration is currently disabled', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_Registration_AuthenticationServices_Enabled', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_Registration_AuthenticationServices_Default_Roles', 'user', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_Registration_AuthenticationServices_Enabled',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\t\tthis.add('Accounts_PasswordReset', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_CustomFields', '', {\n\t\t\ttype: 'code',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Custom_Fields'\n\t\t});\n\t});\n\n\tthis.section('Accounts_Default_User_Preferences', function() {\n\t\tthis.add('Accounts_Default_User_Preferences_enableAutoAway', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Enable_Auto_Away'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_idleTimeoutLimit', 300000, {\n\t\t\ttype: 'int',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Idle_Time_Limit'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_desktopNotificationDuration', 0, {\n\t\t\ttype: 'int',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Notification_Duration'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_audioNotifications', 'mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'all',\n\t\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'mentions',\n\t\t\t\t\ti18nLabel: 'Mentions'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'nothing',\n\t\t\t\t\ti18nLabel: 'Nothing'\n\t\t\t\t}\n\t\t\t],\n\t\t\tpublic: true\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_desktopNotifications', 'mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'all',\n\t\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'mentions',\n\t\t\t\t\ti18nLabel: 'Mentions'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'nothing',\n\t\t\t\t\ti18nLabel: 'Nothing'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_mobileNotifications', 'mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey : 'all',\n\t\t\t\t\ti18nLabel : 'All_messages'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey : 'mentions',\n\t\t\t\t\ti18nLabel : 'Mentions'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey : 'nothing',\n\t\t\t\t\ti18nLabel : 'Nothing'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_unreadAlert', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Unread_Tray_Icon_Alert'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_useEmojis', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Use_Emojis'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_convertAsciiEmoji', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Convert_Ascii_Emojis'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_autoImageLoad', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Auto_Load_Images'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_saveMobileBandwidth', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Save_Mobile_Bandwidth'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_collapseMediaByDefault', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Collapse_Embedded_Media_By_Default'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_hideUsernames', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Hide_usernames'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_hideRoles', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Hide_roles'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_hideFlexTab', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Hide_flextab'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_hideAvatars', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Hide_Avatars'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_roomsListExhibitionMode', 'category', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'unread',\n\t\t\t\t\ti18nLabel: 'Unread_Rooms_Mode'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'activity',\n\t\t\t\t\ti18nLabel: 'Sort_by_activity'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'category',\n\t\t\t\t\ti18nLabel: 'Split_by_categories'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Sidebar_list_mode'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_mergeChannels', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'UI_Merge_Channels_Groups'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_sidebarShowUnread', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Unread_on_top'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_sidebarShowFavorites', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Group_favorites'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_sendOnEnter', 'normal', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'normal',\n\t\t\t\t\ti18nLabel: 'Enter_Normal'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'alternative',\n\t\t\t\t\ti18nLabel: 'Enter_Alternative'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'desktop',\n\t\t\t\t\ti18nLabel: 'Only_On_Desktop'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Enter_Behaviour'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_viewMode', 0, {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 0,\n\t\t\t\t\ti18nLabel: 'Normal'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 1,\n\t\t\t\t\ti18nLabel: 'Cozy'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 2,\n\t\t\t\t\ti18nLabel: 'Compact'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'View_mode'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_emailNotificationMode', 'all', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'disabled',\n\t\t\t\t\ti18nLabel: 'Email_Notification_Mode_Disabled'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'all',\n\t\t\t\t\ti18nLabel: 'Email_Notification_Mode_All'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Email_Notification_Mode'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_roomCounterSidebar', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Show_room_counter_on_sidebar'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_newRoomNotification', 'door', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'none',\n\t\t\t\t\ti18nLabel: 'None'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'door',\n\t\t\t\t\ti18nLabel: 'Default'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'New_Room_Notification'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_newMessageNotification', 'chime', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'none',\n\t\t\t\t\ti18nLabel: 'None'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'chime',\n\t\t\t\t\ti18nLabel: 'Default'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'New_Message_Notification'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_muteFocusedConversations', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Mute_Focused_Conversations'\n\t\t});\n\t\tthis.add('Accounts_Default_User_Preferences_notificationsSoundVolume', 100, {\n\t\t\ttype: 'int',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Notifications_Sound_Volume'\n\t\t});\n\t});\n\n\tthis.section('Avatar', function() {\n\t\tthis.add('Accounts_AvatarResize', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_AvatarSize', 200, {\n\t\t\ttype: 'int',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_AvatarResize',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\n\t\treturn this.add('Accounts_SetDefaultAvatar', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('OAuth', function() {\n\tthis.section('Facebook', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Facebook',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Facebook', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Facebook_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Facebook_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Facebook_callback_url', '_oauth/facebook', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Google', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Google',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Google', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Google_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Google_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Google_callback_url', '_oauth/google', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('GitHub', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Github',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Github', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Github_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Github_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Github_callback_url', '_oauth/github', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Linkedin', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Linkedin',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Linkedin', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Linkedin_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Linkedin_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Linkedin_callback_url', '_oauth/linkedin', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Meteor', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Meteor',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Meteor', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Meteor_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Meteor_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Meteor_callback_url', '_oauth/meteor', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Twitter', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Twitter',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Twitter', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Twitter_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Twitter_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Twitter_callback_url', '_oauth/twitter', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\treturn this.section('Proxy', function() {\n\t\tthis.add('Accounts_OAuth_Proxy_host', 'https://oauth-proxy.rocket.chat', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Proxy_services', '', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('General', function() {\n\tthis.add('Site_Url', typeof __meteor_runtime_config__ !== 'undefined' && __meteor_runtime_config__ !== null ? __meteor_runtime_config__.ROOT_URL : null, {\n\t\ttype: 'string',\n\t\ti18nDescription: 'Site_Url_Description',\n\t\t'public': true\n\t});\n\tthis.add('Site_Name', 'Rocket.Chat', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Language', '', {\n\t\ttype: 'language',\n\t\t'public': true\n\t});\n\tthis.add('Allow_Invalid_SelfSigned_Certs', false, {\n\t\ttype: 'boolean'\n\t});\n\tthis.add('Favorite_Rooms', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('First_Channel_After_Login', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Unread_Count', 'user_and_group_mentions_only', {\n\t\ttype: 'select',\n\t\tvalues: [\n\t\t\t{\n\t\t\t\tkey: 'all_messages',\n\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t}, {\n\t\t\t\tkey: 'user_mentions_only',\n\t\t\t\ti18nLabel: 'User_mentions_only'\n\t\t\t}, {\n\t\t\t\tkey: 'group_mentions_only',\n\t\t\t\ti18nLabel: 'Group_mentions_only'\n\t\t\t}, {\n\t\t\t\tkey: 'user_and_group_mentions_only',\n\t\t\t\ti18nLabel: 'User_and_group_mentions_only'\n\t\t\t}\n\t\t],\n\t\t'public': true\n\t});\n\tthis.add('Unread_Count_DM', 'all_messages', {\n\t\ttype: 'select',\n\t\tvalues: [\n\t\t\t{\n\t\t\t\tkey: 'all_messages',\n\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t}, {\n\t\t\t\tkey: 'mentions_only',\n\t\t\t\ti18nLabel: 'Mentions_only'\n\t\t\t}\n\t\t],\n\t\t'public': true\n\t});\n\tthis.add('CDN_PREFIX', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Force_SSL', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('GoogleTagManager_id', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Bugsnag_api_key', '', {\n\t\ttype: 'string',\n\t\t'public': false\n\t});\n\tthis.add('Force_Disable_OpLog_For_Cache', false, {\n\t\ttype: 'boolean',\n\t\t'public': false\n\t});\n\tthis.add('Restart', 'restart_server', {\n\t\ttype: 'action',\n\t\tactionText: 'Restart_the_server'\n\t});\n\tthis.add('Store_Last_Message', false, {\n\t\ttype: 'boolean',\n\t\tpublic: true,\n\t\ti18nDescription: 'Store_Last_Message_Sent_per_Room'\n\t});\n\tthis.section('UTF8', function() {\n\t\tthis.add('UTF8_Names_Validation', '[0-9a-zA-Z-_.]+', {\n\t\t\ttype: 'string',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'UTF8_Names_Validation_Description'\n\t\t});\n\t\treturn this.add('UTF8_Names_Slugify', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t});\n\tthis.section('Reporting', function() {\n\t\treturn this.add('Statistics_reporting', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t});\n\tthis.section('Notifications', function() {\n\t\tthis.add('Notifications_Max_Room_Members', 100, {\n\t\t\ttype: 'int',\n\t\t\tpublic: true,\n\t\t\ti18nDescription: 'Notifications_Max_Room_Members_Description'\n\t\t});\n\n\t\tthis.add('Notifications_Always_Notify_Mobile', false, {\n\t\t\ttype: 'boolean',\n\t\t\tpublic: true,\n\t\t\ti18nDescription: 'Notifications_Always_Notify_Mobile_Description'\n\t\t});\n\t});\n\tthis.section('REST API', function() {\n\t\treturn this.add('API_User_Limit', 500, {\n\t\t\ttype: 'int',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'API_User_Limit'\n\t\t});\n\t});\n\tthis.section('Iframe_Integration', function() {\n\t\tthis.add('Iframe_Integration_send_enable', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Iframe_Integration_send_target_origin', '*', {\n\t\t\ttype: 'string',\n\t\t\t'public': true,\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Iframe_Integration_send_enable',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\t\tthis.add('Iframe_Integration_receive_enable', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Iframe_Integration_receive_origin', '*', {\n\t\t\ttype: 'string',\n\t\t\t'public': true,\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Iframe_Integration_receive_enable',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Translations', function() {\n\t\treturn this.add('Custom_Translations', '', {\n\t\t\ttype: 'code',\n\t\t\t'public': true\n\t\t});\n\t});\n\treturn this.section('Stream_Cast', function() {\n\t\treturn this.add('Stream_Cast_Address', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Email', function() {\n\tthis.section('Subject', function() {\n\t\tthis.add('Offline_DM_Email', '[[Site_Name]] You have been direct messaged by [User]', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Offline_DM_Email',\n\t\t\ti18nDescription: 'Offline_Email_Subject_Description'\n\t\t});\n\t\tthis.add('Offline_Mention_Email', '[[Site_Name]] You have been mentioned by [User] in #[Room]', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Offline_Mention_Email',\n\t\t\ti18nDescription: 'Offline_Email_Subject_Description'\n\t\t});\n\t\treturn this.add('Offline_Mention_All_Email', '[User] has posted a message in #[Room]', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Offline_Mention_All_Email',\n\t\t\ti18nDescription: 'Offline_Email_Subject_Description'\n\t\t});\n\t});\n\tthis.section('Header_and_Footer', function() {\n\t\tthis.add('Email_Header', '<html><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:collapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Header'\n\t\t});\n\t\tthis.add('Email_Footer', '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table></html>', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Footer'\n\t\t});\n\t\treturn this.add('Email_Footer_Direct_Reply', '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">You can directly reply to this email.<br>Do not modify previous emails in the thread.<br>Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table></html>', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Footer_Direct_Reply'\n\t\t});\n\t});\n\tthis.section('Direct_Reply', function() {\n\t\tthis.add('Direct_Reply_Enable', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Enable'\n\t\t});\n\t\tthis.add('Direct_Reply_Debug', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Debug',\n\t\t\ti18nDescription: 'Direct_Reply_Debug_Description'\n\t\t});\n\t\tthis.add('Direct_Reply_Protocol', 'IMAP', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'IMAP',\n\t\t\t\t\ti18nLabel: 'IMAP'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'POP',\n\t\t\t\t\ti18nLabel: 'POP'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Protocol'\n\t\t});\n\t\tthis.add('Direct_Reply_Host', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Host'\n\t\t});\n\t\tthis.add('Direct_Reply_Port', '143', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: '143',\n\t\t\t\t\ti18nLabel: '143'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '993',\n\t\t\t\t\ti18nLabel: '993'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '110',\n\t\t\t\t\ti18nLabel: '110'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '995',\n\t\t\t\t\ti18nLabel: '995'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Port'\n\t\t});\n\t\tthis.add('Direct_Reply_IgnoreTLS', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'IgnoreTLS'\n\t\t});\n\t\tthis.add('Direct_Reply_Frequency', 5, {\n\t\t\ttype: 'int',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Frequency',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Direct_Reply_Protocol',\n\t\t\t\tvalue: 'POP'\n\t\t\t}\n\t\t});\n\t\tthis.add('Direct_Reply_Delete', true, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Delete',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Direct_Reply_Protocol',\n\t\t\t\tvalue: 'IMAP'\n\t\t\t}\n\t\t});\n\t\tthis.add('Direct_Reply_Separator', '+', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: '!',\n\t\t\t\t\ti18nLabel: '!'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '#',\n\t\t\t\t\ti18nLabel: '#'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '$',\n\t\t\t\t\ti18nLabel: '$'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '%',\n\t\t\t\t\ti18nLabel: '%'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '&',\n\t\t\t\t\ti18nLabel: '&'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '\\'',\n\t\t\t\t\ti18nLabel: '\\''\n\t\t\t\t}, {\n\t\t\t\t\tkey: '*',\n\t\t\t\t\ti18nLabel: '*'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '+',\n\t\t\t\t\ti18nLabel: '+'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '-',\n\t\t\t\t\ti18nLabel: '-'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '/',\n\t\t\t\t\ti18nLabel: '/'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '=',\n\t\t\t\t\ti18nLabel: '='\n\t\t\t\t}, {\n\t\t\t\t\tkey: '?',\n\t\t\t\t\ti18nLabel: '?'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '^',\n\t\t\t\t\ti18nLabel: '^'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '_',\n\t\t\t\t\ti18nLabel: '_'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '`',\n\t\t\t\t\ti18nLabel: '`'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '{',\n\t\t\t\t\ti18nLabel: '{'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '|',\n\t\t\t\t\ti18nLabel: '|'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '}',\n\t\t\t\t\ti18nLabel: '}'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '~',\n\t\t\t\t\ti18nLabel: '~'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Separator'\n\t\t});\n\t\tthis.add('Direct_Reply_Username', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Username',\n\t\t\tplaceholder: 'email@domain'\n\t\t});\n\t\treturn this.add('Direct_Reply_Password', '', {\n\t\t\ttype: 'password',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Password'\n\t\t});\n\t});\n\tthis.section('SMTP', function() {\n\t\tthis.add('SMTP_Protocol', 'smtp', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'smtp',\n\t\t\t\t\ti18nLabel: 'smtp'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'smtps',\n\t\t\t\t\ti18nLabel: 'smtps'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Protocol'\n\t\t});\n\t\tthis.add('SMTP_Host', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Host'\n\t\t});\n\t\tthis.add('SMTP_Port', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Port'\n\t\t});\n\t\tthis.add('SMTP_IgnoreTLS', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'IgnoreTLS',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'SMTP_Protocol',\n\t\t\t\tvalue: 'smtp'\n\t\t\t}\n\t\t});\n\t\tthis.add('SMTP_Pool', true, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Pool'\n\t\t});\n\t\tthis.add('SMTP_Username', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Username'\n\t\t});\n\t\tthis.add('SMTP_Password', '', {\n\t\t\ttype: 'password',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Password'\n\t\t});\n\t\tthis.add('From_Email', '', {\n\t\t\ttype: 'string',\n\t\t\tplaceholder: 'email@domain'\n\t\t});\n\t\treturn this.add('SMTP_Test_Button', 'sendSMTPTestEmail', {\n\t\t\ttype: 'action',\n\t\t\tactionText: 'Send_a_test_mail_to_my_user'\n\t\t});\n\t});\n\tthis.section('Invitation', function() {\n\t\tthis.add('Invitation_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Invitation_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Invitation_HTML', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Invitation_HTML_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Registration', function() {\n\t\tthis.add('Accounts_Enrollment_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Accounts_Enrollment_Email_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Accounts_Enrollment_Email', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Registration_via_Admin', function() {\n\t\tthis.add('Accounts_UserAddedEmail_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Accounts_UserAddedEmailSubject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Accounts_UserAddedEmail', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Accounts_UserAddedEmail_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Forgot_password_section', function() {\n\t\tthis.add('Forgot_Password_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Forgot_Password_Email_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Forgot_Password_Email', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Forgot_Password_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\treturn this.section('Verification', function() {\n\t\tthis.add('Verification_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Verification_Email_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Verification_Email', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Verification_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Message', function() {\n\tthis.section('Message_Attachments', function() {\n\t\tthis.add('Message_Attachments_GroupAttach', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Message_Attachments_GroupAttachDescription'\n\t\t});\n\t\tthis.add('Message_AudioRecorderEnabled', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Message_AudioRecorderEnabledDescription'\n\t\t});\n\t});\n\tthis.add('Message_AllowEditing', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowEditing_BlockEditInMinutes', 0, {\n\t\ttype: 'int',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_AllowEditing_BlockEditInMinutesDescription'\n\t});\n\tthis.add('Message_AllowDeleting', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowDeleting_BlockDeleteInMinutes', 0, {\n\t\ttype: 'int',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_AllowDeleting_BlockDeleteInMinutes'\n\t});\n\tthis.add('Message_AllowUnrecognizedSlashCommand', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowDirectMessagesToYourself', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AlwaysSearchRegExp', false, {\n\t\ttype: 'boolean'\n\t});\n\tthis.add('Message_ShowEditedStatus', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_ShowDeletedStatus', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowBadWordsFilter', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_BadWordsFilterList', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Message_KeepHistory', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_MaxAll', 0, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Message_MaxAllowedSize', 5000, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Message_ShowFormattingTips', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_SetNameToAliasEnabled', false, {\n\t\ttype: 'boolean',\n\t\t'public': false,\n\t\ti18nDescription: 'Message_SetNameToAliasEnabled_Description'\n\t});\n\tthis.add('Message_GroupingPeriod', 300, {\n\t\ttype: 'int',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_GroupingPeriodDescription'\n\t});\n\tthis.add('API_Embed', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('API_Embed_UserAgent', 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('API_EmbedCacheExpirationDays', 30, {\n\t\ttype: 'int',\n\t\t'public': false\n\t});\n\tthis.add('API_Embed_clear_cache_now', 'OEmbedCacheCleanup', {\n\t\ttype: 'action',\n\t\tactionText: 'clear',\n\t\ti18nLabel: 'clear_cache_now'\n\t});\n\tthis.add('API_EmbedDisabledFor', '', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'API_EmbedDisabledFor_Description'\n\t});\n\tthis.add('API_EmbedIgnoredHosts', 'localhost, 127.0.0.1, 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16', {\n\t\ttype: 'string',\n\t\ti18nDescription: 'API_EmbedIgnoredHosts_Description'\n\t});\n\tthis.add('API_EmbedSafePorts', '80, 443', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Message_TimeFormat', 'LT', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_TimeFormat_Description'\n\t});\n\tthis.add('Message_DateFormat', 'LL', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_DateFormat_Description'\n\t});\n\tthis.add('Message_TimeAndDateFormat', 'LLL', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_TimeAndDateFormat_Description'\n\t});\n\tthis.add('Message_QuoteChainLimit', 2, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_uj', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_ul', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_ru', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_au', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\n\tthis.add('Message_HideType_mute_unmute', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\n\tthis.add('Message_GlobalSearch', false, {\n\t\ttype: 'boolean',\n\t\t'public': true,\n\t\talert: 'This feature is currently in beta and could decrease the application performance! Please report bugs to github.com/RocketChat/Rocket.Chat/issues'\n\t});\n});\n\nRocketChat.settings.addGroup('Meta', function() {\n\tthis.add('Meta_language', '', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_fb_app_id', '', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_robots', 'INDEX,FOLLOW', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_google-site-verification', '', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_msvalidate01', '', {\n\t\ttype: 'string'\n\t});\n\treturn this.add('Meta_custom', '', {\n\t\ttype: 'code',\n\t\tcode: 'text/html',\n\t\tmultiline: true\n\t});\n});\n\nRocketChat.settings.addGroup('Push', function() {\n\tthis.add('Push_enable', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Push_debug', false, {\n\t\ttype: 'boolean',\n\t\t'public': true,\n\t\tenableQuery: {\n\t\t\t_id: 'Push_enable',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Push_enable_gateway', true, {\n\t\ttype: 'boolean',\n\t\tenableQuery: {\n\t\t\t_id: 'Push_enable',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Push_gateway', 'https://gateway.rocket.chat', {\n\t\ttype: 'string',\n\t\tenableQuery: [\n\t\t\t{\n\t\t\t\t_id: 'Push_enable',\n\t\t\t\tvalue: true\n\t\t\t}, {\n\t\t\t\t_id: 'Push_enable_gateway',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t]\n\t});\n\tthis.add('Push_production', true, {\n\t\ttype: 'boolean',\n\t\t'public': true,\n\t\tenableQuery: [\n\t\t\t{\n\t\t\t\t_id: 'Push_enable',\n\t\t\t\tvalue: true\n\t\t\t}, {\n\t\t\t\t_id: 'Push_enable_gateway',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t]\n\t});\n\tthis.add('Push_test_push', 'push_test', {\n\t\ttype: 'action',\n\t\tactionText: 'Send_a_test_push_to_my_user',\n\t\tenableQuery: {\n\t\t\t_id: 'Push_enable',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.section('Certificates_and_Keys', function() {\n\t\tthis.add('Push_apn_passphrase', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Push_apn_key', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_apn_cert', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_apn_dev_passphrase', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Push_apn_dev_key', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_apn_dev_cert', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_gcm_api_key', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\treturn this.add('Push_gcm_project_number', '', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t});\n\treturn this.section('Privacy', function() {\n\t\tthis.add('Push_show_username_room', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Push_show_message', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Layout', function() {\n\tthis.section('Content', function() {\n\t\tthis.add('Layout_Home_Title', 'Home', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Home_Body', '<p>Welcome to Rocket.Chat!</p>\\n<p>The Rocket.Chat desktops apps for Windows, macOS and Linux are available to download <a title=\"Rocket.Chat desktop apps\" href=\"https://rocket.chat/download\" target=\"_blank\" rel=\"noopener\">here</a>.</p><p>The native mobile app, Rocket.Chat+,\\n  for Android and iOS is available from <a title=\"Rocket.Chat+ on Google Play\" href=\"https://play.google.com/store/apps/details?id=chat.rocket.android\" target=\"_blank\" rel=\"noopener\">Google Play</a> and the <a title=\"Rocket.Chat+ on the App Store\" href=\"https://itunes.apple.com/app/rocket-chat/id1148741252\" target=\"_blank\" rel=\"noopener\">App Store</a>.</p>\\n<p>For further help, please consult the <a title=\"Rocket.Chat Documentation\" href=\"https://rocket.chat/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a>.</p>\\n<p>If you\\'re an admin, feel free to change this content via <strong>Administration</strong> -> <strong>Layout</strong> -> <strong>Home Body</strong>. Or clicking <a title=\"Home Body Layout\" href=\"/admin/Layout\">here</a>.</p>', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Terms_of_Service', 'Terms of Service <br> Go to APP SETTINGS -> Layout to customize this page.', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Login_Terms', 'By proceeding you are agreeing to our <a href=\"terms-of-service\">Terms of Service</a> and <a href=\"privacy-policy\">Privacy Policy</a>.', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Privacy_Policy', 'Privacy Policy <br> Go to APP SETTINGS -> Layout to customize this page.', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Layout_Sidenav_Footer', '<a href=\"/home\"><img src=\"assets/logo\"/></a>', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Layout_Sidenav_Footer_description'\n\t\t});\n\t});\n\tthis.section('Custom_Scripts', function() {\n\t\tthis.add('Custom_Script_Logged_Out', '//Add your script', {\n\t\t\ttype: 'code',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Custom_Script_Logged_In', '//Add your script', {\n\t\t\ttype: 'code',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t});\n\treturn this.section('User_Interface', function() {\n\t\tthis.add('UI_DisplayRoles', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Merge_Channels_Groups', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Use_Name_Avatar', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Use_Real_Name', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Click_Direct_Message', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Unread_Counter_Style', 'Different_Style_For_User_Mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'Same_Style_For_Mentions',\n\t\t\t\t\ti18nLabel: 'Same_Style_For_Mentions'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'Different_Style_For_User_Mentions',\n\t\t\t\t\ti18nLabel: 'Different_Style_For_User_Mentions'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Allow_room_names_with_special_chars', false, {\n\t\t\ttype: 'boolean',\n\t\t\tpublic: true\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Logs', function() {\n\tthis.add('Log_Level', '0', {\n\t\ttype: 'select',\n\t\tvalues: [\n\t\t\t{\n\t\t\t\tkey: '0',\n\t\t\t\ti18nLabel: '0_Errors_Only'\n\t\t\t}, {\n\t\t\t\tkey: '1',\n\t\t\t\ti18nLabel: '1_Errors_and_Information'\n\t\t\t}, {\n\t\t\t\tkey: '2',\n\t\t\t\ti18nLabel: '2_Erros_Information_and_Debug'\n\t\t\t}\n\t\t],\n\t\t'public': true\n\t});\n\tthis.add('Log_Package', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Log_File', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\treturn this.add('Log_View_Limit', 1000, {\n\t\ttype: 'int'\n\t});\n});\n\nRocketChat.settings.init();\n","import _ from 'underscore';\n\nMeteor.methods({\n\t'public-settings/get'(updatedAt) {\n\t\tthis.unblock();\n\t\tconst records = RocketChat.models.Settings.find().fetch().filter(function(record) {\n\t\t\treturn record.hidden !== true && record['public'] === true;\n\t\t});\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Settings.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\thidden: {\n\t\t\t\t\t\t$ne: true\n\t\t\t\t\t},\n\t\t\t\t\t'public': true\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\t\treturn records;\n\t},\n\t'private-settings/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\t\tthis.unblock();\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-privileged-setting')) {\n\t\t\treturn [];\n\t\t}\n\t\tconst records = RocketChat.models.Settings.find().fetch().filter(function(record) {\n\t\t\treturn record.hidden !== true;\n\t\t});\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Settings.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\thidden: {\n\t\t\t\t\t\t$ne: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\t\treturn records;\n\t}\n});\n\nRocketChat.models.Settings.cache.on('changed', function(type, setting) {\n\tif (setting['public'] === true) {\n\t\tRocketChat.Notifications.notifyAllInThisInstance('public-settings-changed', type, _.pick(setting, '_id', 'value', 'editor', 'properties'));\n\t}\n\treturn RocketChat.Notifications.notifyLoggedInThisInstance('private-settings-changed', type, setting);\n});\n\nRocketChat.Notifications.streamAll.allowRead('private-settings-changed', function() {\n\tif (this.userId == null) {\n\t\treturn false;\n\t}\n\treturn RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting');\n});\n","/* eslint no-multi-spaces: 0 */\n/* eslint comma-spacing: 0 */\nimport s from 'underscore.string';\n\nMeteor.methods({\n\taddOAuthService(name) {\n\n\t\tcheck(name, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'addOAuthService' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'add-oauth-service') !== true) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Adding OAuth Services is not allowed', { method: 'addOAuthService', action: 'Adding_OAuth_Services' });\n\t\t}\n\n\t\tname = name.toLowerCase().replace(/[^a-z0-9_]/g, '');\n\t\tname = s.capitalize(name);\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }`                        , false             , { type: 'boolean', group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Enable', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-url`                    , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'URL', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-token_path`             , '/oauth/token'    , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Token_Path', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-token_sent_via`         , 'payload'         , { type: 'select' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Token_Sent_Via', persistent: true, values: [ { key: 'header', i18nLabel: 'Header' }, { key: 'payload', i18nLabel: 'Payload' } ] });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-identity_token_sent_via`, 'default'         , { type: 'select' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Identity_Token_Sent_Via', persistent: true, values: [ { key: 'default', i18nLabel: 'Same_As_Token_Sent_Via' }, { key: 'header', i18nLabel: 'Header' }, { key: 'payload', i18nLabel: 'Payload' } ] });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-identity_path`          , '/me'             , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Identity_Path', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-authorize_path`         , '/oauth/authorize', { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Authorize_Path', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-scope`                  , 'openid'          , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Scope', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-id`                     , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_id', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-secret`                 , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Secret', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-login_style`            , 'popup'           , { type: 'select' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Login_Style', persistent: true, values: [ { key: 'redirect', i18nLabel: 'Redirect' }, { key: 'popup', i18nLabel: 'Popup' }, { key: '', i18nLabel: 'Default' } ] });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-button_label_text`      , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Button_Label_Text', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-button_label_color`     , '#FFFFFF'         , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Button_Label_Color', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-button_color`           , '#13679A'         , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Button_Color', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-username_field`         , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Username_Field', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-merge_users`            , false             , { type: 'boolean', group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Merge_Users', persistent: true });\n\t}});\n","Meteor.methods({\n\trefreshOAuthService() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'refreshOAuthService' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'add-oauth-service') !== true) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Refresh OAuth Services is not allowed', { method: 'refreshOAuthService', action: 'Refreshing_OAuth_Services' });\n\t\t}\n\n\t\tServiceConfiguration.configurations.remove({});\n\n\t\tRocketChat.models.Settings.update({_id: /^Accounts_OAuth_.+/}, {$set: {_updatedAt: new Date}}, {multi: true});\n\t}\n});\n","Meteor.methods({\n\taddUserToRoom(data) {\n\t\treturn Meteor.call('addUsersToRoom', {\n\t\t\trid: data.rid,\n\t\t\tusers: [ data.username ]\n\t\t});\n\t}\n});\n","Meteor.methods({\n\taddUsersToRoom(data = {}) {\n\t\t// Validate user and room\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!Match.test(data.rid, String)) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Get user and room details\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\t\tconst userId = Meteor.userId();\n\t\tconst user = Meteor.user();\n\t\tconst userInRoom = Array.isArray(room.usernames) && room.usernames.includes(user.username);\n\n\t\t// Can't add to direct room ever\n\t\tif (room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-cant-invite-for-direct-room', 'Can\\'t invite user to direct rooms', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Can add to any room you're in, with permission, otherwise need specific room type permission\n\t\tlet canAddUser = false;\n\t\tif (userInRoom && RocketChat.authz.hasPermission(userId, 'add-user-to-joined-room', room._id)) {\n\t\t\tcanAddUser = true;\n\t\t} else if (room.t === 'c' && RocketChat.authz.hasPermission(userId, 'add-user-to-any-c-room')) {\n\t\t\tcanAddUser = true;\n\t\t} else if (room.t === 'p' && RocketChat.authz.hasPermission(userId, 'add-user-to-any-p-room')) {\n\t\t\tcanAddUser = true;\n\t\t}\n\n\t\t// Adding wasn't allowed\n\t\tif (!canAddUser) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Missing the users to be added\n\t\tif (!Array.isArray(data.users)) {\n\t\t\tthrow new Meteor.Error('error-invalid-arguments', 'Invalid arguments', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Validate each user, then add to room\n\t\tdata.users.forEach((username) => {\n\t\t\tconst newUser = RocketChat.models.Users.findOneByUsername(username);\n\t\t\tif (!newUser) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-username', 'Invalid username', {\n\t\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.addUserToRoom(data.rid, newUser, user);\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tarchiveRoom(rid) {\n\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'archiveRoom' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'archiveRoom' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'archive-room', room._id)) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'archiveRoom' });\n\t\t}\n\n\t\tif (room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-direct-message-room', 'Direct Messages can not be archived', { method: 'archiveRoom' });\n\t\t}\n\n\t\treturn RocketChat.archiveRoom(rid);\n\t}\n});\n","Meteor.methods({\n\tblockUser({rid, blocked}) {\n\n\t\tcheck(rid, String);\n\t\tcheck(blocked, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'blockUser' });\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tconst subscription2 = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, blocked);\n\n\t\tif (!subscription || !subscription2) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'blockUser' });\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.setBlockedByRoomId(rid, blocked, Meteor.userId());\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tcheckRegistrationSecretURL(hash) {\n\n\t\tcheck(hash, String);\n\n\t\treturn hash === RocketChat.settings.get('Accounts_RegistrationForm_SecretURL');\n\t}\n});\n","Meteor.methods({\n\tcheckUsernameAvailability(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setUsername' });\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (user.username && !RocketChat.settings.get('Accounts_AllowUsernameChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setUsername' });\n\t\t}\n\n\t\tif (user.username === username) {\n\t\t\treturn true;\n\t\t}\n\t\treturn RocketChat.checkUsernameAvailability(username);\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('checkUsernameAvailability', 1, 1000, {\n\tuserId() { return true; }\n});\n","Meteor.methods({\n\tcleanChannelHistory({roomId, latest, oldest, inclusive}) {\n\t\tcheck(roomId, String);\n\t\tcheck(latest, Date);\n\t\tcheck(oldest, Date);\n\t\tcheck(inclusive, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'cleanChannelHistory' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'clean-channel-history')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'cleanChannelHistory' });\n\t\t}\n\n\t\tif (inclusive) {\n\t\t\tRocketChat.models.Messages.remove({\n\t\t\t\trid: roomId,\n\t\t\t\tts: {\n\t\t\t\t\t$gte: oldest,\n\t\t\t\t\t$lte: latest\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tRocketChat.models.Messages.remove({\n\t\t\t\trid: roomId,\n\t\t\t\tts: {\n\t\t\t\t\t$gt: oldest,\n\t\t\t\t\t$lt: latest\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tcreateChannel(name, members, readOnly = false, customFields = {}) {\n\t\tcheck(name, String);\n\t\tcheck(members, Match.Optional([String]));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'createChannel' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-c')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'createChannel' });\n\t\t}\n\n\t\treturn RocketChat.createRoom('c', name, Meteor.user() && Meteor.user().username, members, readOnly, {customFields});\n\t}\n});\n","Meteor.methods({\n\tcreateToken(userId) {\n\t\tif (Meteor.userId() !== userId && !RocketChat.authz.hasPermission(Meteor.userId(), 'user-generate-access-token')) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'createToken' });\n\t\t}\n\t\tconst token = Accounts._generateStampedLoginToken();\n\t\tAccounts._insertLoginToken(userId, token);\n\t\treturn {\n\t\t\tuserId,\n\t\t\tauthToken: token.token\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tcreatePrivateGroup(name, members, readOnly = false, customFields = {}, extraData = {}) {\n\t\tcheck(name, String);\n\t\tcheck(members, Match.Optional([String]));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'createPrivateGroup' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-p')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'createPrivateGroup' });\n\t\t}\n\n\t\t// validate extra data schema\n\t\tcheck(extraData, Match.ObjectIncluding({\n\t\t\ttokenpass: Match.Maybe({\n\t\t\t\trequire: String,\n\t\t\t\ttokens: [{\n\t\t\t\t\ttoken: String,\n\t\t\t\t\tbalance: String\n\t\t\t\t}]\n\t\t\t})\n\t\t}));\n\n\t\treturn RocketChat.createRoom('p', name, Meteor.user() && Meteor.user().username, members, readOnly, {customFields, ...extraData});\n\t}\n});\n","import moment from 'moment';\n\nMeteor.methods({\n\tdeleteMessage(message) {\n\t\tcheck(message, Match.ObjectIncluding({\n\t\t\t_id: String\n\t\t}));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteMessage'\n\t\t\t});\n\t\t}\n\t\tconst originalMessage = RocketChat.models.Messages.findOneById(message._id, {\n\t\t\tfields: {\n\t\t\t\tu: 1,\n\t\t\t\trid: 1,\n\t\t\t\tfile: 1,\n\t\t\t\tts: 1\n\t\t\t}\n\t\t});\n\t\tif (originalMessage == null) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteMessage',\n\t\t\t\taction: 'Delete_message'\n\t\t\t});\n\t\t}\n\t\tconst forceDelete = RocketChat.authz.hasPermission(Meteor.userId(), 'force-delete-message', originalMessage.rid);\n\t\tconst hasPermission = RocketChat.authz.hasPermission(Meteor.userId(), 'delete-message', originalMessage.rid);\n\t\tconst deleteAllowed = RocketChat.settings.get('Message_AllowDeleting');\n\t\tconst deleteOwn = originalMessage && originalMessage.u && originalMessage.u._id === Meteor.userId();\n\t\tif (!(hasPermission || (deleteAllowed && deleteOwn)) && !(forceDelete)) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteMessage',\n\t\t\t\taction: 'Delete_message'\n\t\t\t});\n\t\t}\n\t\tconst blockDeleteInMinutes = RocketChat.settings.get('Message_AllowDeleting_BlockDeleteInMinutes');\n\t\tif (blockDeleteInMinutes != null && blockDeleteInMinutes !== 0 && !forceDelete) {\n\t\t\tif (originalMessage.ts == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst msgTs = moment(originalMessage.ts);\n\t\t\tif (msgTs == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst currentTsDiff = moment().diff(msgTs, 'minutes');\n\t\t\tif (currentTsDiff > blockDeleteInMinutes) {\n\t\t\t\tthrow new Meteor.Error('error-message-deleting-blocked', 'Message deleting is blocked', {\n\t\t\t\t\tmethod: 'deleteMessage'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn RocketChat.deleteMessage(originalMessage, Meteor.user());\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tdeleteUserOwnAccount(password) {\n\n\t\tcheck(password, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowDeleteOwnAccount')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tconst userId = Meteor.userId();\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tif (user.services && user.services.password && s.trim(user.services.password.bcrypt)) {\n\t\t\tconst result = Accounts._checkPassword(user, { digest: password, algorithm: 'sha-256' });\n\t\t\tif (result.error) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', { method: 'deleteUserOwnAccount' });\n\t\t\t}\n\t\t} else if (user.username !== s.trim(password)) {\n\t\t\tthrow new Meteor.Error('error-invalid-username', 'Invalid username', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.deleteUser(userId);\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","import Filter from 'bad-words';\n\nRocketChat.callbacks.add('beforeSaveMessage', function(message) {\n\n\tif (RocketChat.settings.get('Message_AllowBadWordsFilter')) {\n\t\tconst badWordsList = RocketChat.settings.get('Message_BadWordsFilterList');\n\t\tlet options;\n\n\t\t// Add words to the blacklist\n\t\tif (!!badWordsList && badWordsList.length) {\n\t\t\toptions = {\n\t\t\t\tlist: badWordsList.split(',')\n\t\t\t};\n\t\t}\n\t\tconst filter = new Filter(options);\n\t\tmessage.msg = filter.clean(message.msg);\n\t}\n\n\treturn message;\n\n}, 1, 'filterBadWords');\n","import _ from 'underscore';\n\nRocketChat.callbacks.add('beforeSaveMessage', function(message) {\n\t// Test if the message mentions include @all.\n\tif (message.mentions != null &&\n\t\t_.pluck(message.mentions, '_id').some((item) => item === 'all')) {\n\n\t\t// Check if the user has permissions to use @all in both global and room scopes.\n\t\tif (!RocketChat.authz.hasPermission(message.u._id, 'mention-all') && !RocketChat.authz.hasPermission(message.u._id, 'mention-all', message.rid)) {\n\n\t\t\t// Get the language of the user for the error notification.\n\t\t\tconst language = RocketChat.models.Users.findOneById(message.u._id).language;\n\t\t\tconst action = TAPi18n.__('Notify_all_in_this_room', {}, language);\n\n\t\t\t// Add a notification to the chat, informing the user that this\n\t\t\t// action is not allowed.\n\t\t\tRocketChat.Notifications.notifyUser(message.u._id, 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: message.rid,\n\t\t\t\tts: new Date,\n\t\t\t\tmsg: TAPi18n.__('error-action-not-allowed', { action }, language)\n\t\t\t});\n\n\t\t\t// Also throw to stop propagation of 'sendMessage'.\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Notify all in this room not allowed', {\n\t\t\t\tmethod: 'filterATAllTag',\n\t\t\t\taction: 'Notify_all_in_this_room'\n\t\t\t});\n\t\t}\n\t}\n\n\treturn message;\n\n}, 1, 'filterATAllTag');\n","import _ from 'underscore';\n\nRocketChat.callbacks.add('beforeSaveMessage', function(message) {\n\t// Test if the message mentions include @here.\n\tif (message.mentions != null &&\n\t\t_.pluck(message.mentions, '_id').some((item) => item === 'here')) {\n\n\t\t// Check if the user has permissions to use @here in both global and room scopes.\n\t\tif (!RocketChat.authz.hasPermission(message.u._id, 'mention-here') && !RocketChat.authz.hasPermission(message.u._id, 'mention-here', message.rid)) {\n\n\t\t\t// Get the language of the user for the error notification.\n\t\t\tconst language = RocketChat.models.Users.findOneById(message.u._id).language;\n\t\t\tconst action = TAPi18n.__('Notify_active_in_this_room', {}, language);\n\n\t\t\t// Add a notification to the chat, informing the user that this\n\t\t\t// action is not allowed.\n\t\t\tRocketChat.Notifications.notifyUser(message.u._id, 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: message.rid,\n\t\t\t\tts: new Date,\n\t\t\t\tmsg: TAPi18n.__('error-action-not-allowed', { action }, language)\n\t\t\t});\n\n\t\t\t// Also throw to stop propagation of 'sendMessage'.\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Notify here in this room not allowed', {\n\t\t\t\tmethod: 'filterATHereTag',\n\t\t\t\taction: 'Notify_active_in_this_room'\n\t\t\t});\n\t\t}\n\t}\n\n\treturn message;\n\n}, 1, 'filterATHereTag');\n","import _ from 'underscore';\n\nMeteor.methods({\n\tgetChannelHistory({rid, latest, oldest, inclusive, count = 20, unreads}) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getChannelHistory' });\n\t\t}\n\n\t\tconst fromUserId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromUserId);\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\t//Make sure they can access the room\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(fromUserId, 'preview-c-room') && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\t//Ensure latest is always defined.\n\t\tif (_.isUndefined(latest)) {\n\t\t\tlatest = new Date();\n\t\t}\n\n\t\t//Verify oldest is a date if it exists\n\t\tif (!_.isUndefined(oldest) && !_.isDate(oldest)) {\n\t\t\tthrow new Meteor.Error('error-invalid-date', 'Invalid date', { method: 'getChannelHistory' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: count\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = { 'editedAt': 0 };\n\t\t}\n\n\t\tlet records = [];\n\t\tif (_.isUndefined(oldest) && inclusive) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestampInclusive(rid, latest, options).fetch();\n\t\t} else if (_.isUndefined(oldest) && !inclusive) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(rid, latest, options).fetch();\n\t\t} else if (!_.isUndefined(oldest) && inclusive) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestampsInclusive(rid, oldest, latest, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestamps(rid, oldest, latest, options).fetch();\n\t\t}\n\n\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\tconst messages = _.map(records, (message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, { _id: fromUserId });\n\t\t\tif (message.u && message.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\t\t\t\tmessage.u.name = user && user.name;\n\t\t\t}\n\t\t\tif (message.mentions && message.mentions.length && UI_Use_Real_Name) {\n\t\t\t\tmessage.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn message;\n\t\t});\n\n\t\tif (unreads) {\n\t\t\tlet unreadNotLoaded = 0;\n\t\t\tlet firstUnread = undefined;\n\n\t\t\tif (!_.isUndefined(oldest)) {\n\t\t\t\tconst firstMsg = messages[messages.length - 1];\n\t\t\t\tif (!_.isUndefined(firstMsg) && firstMsg.ts > oldest) {\n\t\t\t\t\tconst unreadMessages = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestamps(rid, oldest, firstMsg.ts, { limit: 1, sort: { ts: 1 } });\n\t\t\t\t\tfirstUnread = unreadMessages.fetch()[0];\n\t\t\t\t\tunreadNotLoaded = unreadMessages.count();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmessages: messages || [],\n\t\t\t\tfirstUnread,\n\t\t\t\tunreadNotLoaded\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tmessages: messages || []\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tgetFullUserData({ filter = '', limit }) {\n\t\tconst result = RocketChat.getFullUserData({ userId: Meteor.userId(), filter, limit });\n\n\t\tif (!result) {\n\t\t\treturn result;\n\t\t}\n\n\t\treturn result.fetch();\n\t}\n});\n","Meteor.methods({\n\tgetRoomJoinCode(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getJoinCode' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-join-code')) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'getJoinCode' });\n\t\t}\n\n\t\tconst [ room ] = RocketChat.models.Rooms.findById(rid).fetch();\n\n\t\treturn room && room.joinCode;\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tgetRoomRoles(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomRoles' });\n\t\t}\n\n\t\tcheck(rid, String);\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\t'u.username': 1\n\t\t\t},\n\t\t\tfields: {\n\t\t\t\trid: 1,\n\t\t\t\tu: 1,\n\t\t\t\troles: 1\n\t\t\t}\n\t\t};\n\n\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\tconst roles = RocketChat.models.Roles.find({ scope: 'Subscriptions', description: { $exists: 1, $ne: '' } }).fetch();\n\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, _.pluck(roles, '_id'), options).fetch();\n\n\t\tif (!UI_Use_Real_Name) {\n\t\t\treturn subscriptions;\n\t\t} else {\n\t\t\treturn subscriptions.map(subscription => {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(subscription.u._id);\n\t\t\t\tsubscription.u.name = user && user.name;\n\t\t\t\treturn subscription;\n\t\t\t});\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tgetServerInfo() {\n\t\treturn RocketChat.Info;\n\t}\n});\n","Meteor.methods({\n\tgetSingleMessage(msgId) {\n\t\tcheck(msgId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getSingleMessage' });\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(msgId);\n\n\t\tif (!msg && !msg.rid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tMeteor.call('canAccessRoom', msg.rid, Meteor.userId());\n\n\t\treturn msg;\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tgetUserRoles() {\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUserRoles' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\t'username': 1\n\t\t\t},\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\troles: 1\n\t\t\t}\n\t\t};\n\n\t\tconst roles = RocketChat.models.Roles.find({ scope: 'Users', description: { $exists: 1, $ne: '' } }).fetch();\n\t\tconst roleIds = _.pluck(roles, '_id');\n\n\t\t// Security issue: we should not send all user's roles to all clients, only the 'public' roles\n\t\t// We must remove all roles that are not part of the query from the returned users\n\t\tconst users = RocketChat.models.Users.findUsersInRoles(roleIds, null, options).fetch();\n\t\tfor (const user of users) {\n\t\t\tuser.roles = _.intersection(user.roles, roleIds);\n\t\t}\n\t\treturn users;\n\t}\n});\n","Meteor.methods({\n\tinsertOrUpdateUser(userData) {\n\n\t\tcheck(userData, Object);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'insertOrUpdateUser' });\n\t\t}\n\n\t\treturn RocketChat.saveUser(Meteor.userId(), userData);\n\t}\n});\n","Meteor.methods({\n\tjoinDefaultChannels(silenced) {\n\t\tcheck(silenced, Match.Optional(Boolean));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'joinDefaultChannels' });\n\t\t}\n\n\t\tthis.unblock();\n\t\treturn RocketChat.addUserToDefaultChannels(Meteor.user(), silenced);\n\t}\n});\n","Meteor.methods({\n\tjoinRoom(rid, code) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'joinRoom' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'joinRoom' });\n\t\t}\n\n\t\t// TODO we should have a 'beforeJoinRoom' call back so external services can do their own validations\n\t\tconst user = Meteor.user();\n\t\tif (room.tokenpass && user && user.services && user.services.tokenpass) {\n\t\t\tconst balances = RocketChat.updateUserTokenpassBalances(user);\n\n\t\t\tif (!RocketChat.Tokenpass.validateAccess(room.tokenpass, balances)) {\n\t\t\t\tthrow new Meteor.Error('error-not-allowed', 'Token required', { method: 'joinRoom' });\n\t\t\t}\n\t\t} else {\n\t\t\tif ((room.t !== 'c') || (RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true)) {\n\t\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'joinRoom' });\n\t\t\t}\n\n\t\t\tif ((room.joinCodeRequired === true) && (code !== room.joinCode) && !RocketChat.authz.hasPermission(Meteor.userId(), 'join-without-join-code')) {\n\t\t\t\tthrow new Meteor.Error('error-code-invalid', 'Invalid Room Password', { method: 'joinRoom' });\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.addUserToRoom(rid, user);\n\t}\n});\n","Meteor.methods({\n\tleaveRoom(rid) {\n\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'leaveRoom' });\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tconst user = Meteor.user();\n\n\t\tif (room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'leaveRoom' });\n\t\t}\n\n\t\tif (!Array.from(room.usernames || []).includes(user.username)) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'You are not in this room', { method: 'leaveRoom' });\n\t\t}\n\n\t\t// If user is room owner, check if there are other owners. If there isn't anyone else, warn user to set a new owner.\n\t\tif (RocketChat.authz.hasRole(user._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', { method: 'leaveRoom' });\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.removeUserFromRoom(rid, Meteor.user());\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tremoveOAuthService(name) {\n\n\t\tcheck(name, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'removeOAuthService' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'add-oauth-service') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'removeOAuthService' });\n\t\t}\n\n\t\tname = name.toLowerCase().replace(/[^a-z0-9_]/g, '');\n\t\tname = s.capitalize(name);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-url`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-token_path`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-identity_path`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-authorize_path`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-scope`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-token_sent_via`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-identity_token_sent_via`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-id`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-secret`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-button_label_text`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-button_label_color`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-button_color`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-login_style`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-username_field`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-merge_users`);\n\t}\n});\n","Meteor.methods({\n\trestart_server() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'restart_server' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasRole(Meteor.userId(), 'admin') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'restart_server' });\n\t\t}\n\n\t\tMeteor.setTimeout(() => {\n\t\t\tMeteor.setTimeout(() => {\n\t\t\t\tconsole.warn('Call to process.exit() timed out, aborting.');\n\t\t\t\tprocess.abort();\n\t\t\t}, 1000);\n\t\t\tprocess.exit(1);\n\t\t}, 1000);\n\n\t\treturn {\n\t\t\tmessage: 'The_server_will_restart_in_s_seconds',\n\t\t\tparams: [2]\n\t\t};\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\t'robot.modelCall'(model, method, args) {\n\t\tcheck(model, String);\n\t\tcheck(method, String);\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'robot.modelCall'\n\t\t\t});\n\t\t}\n\t\tif (!RocketChat.authz.hasRole(Meteor.userId(), 'robot')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'robot.modelCall'\n\t\t\t});\n\t\t}\n\t\tconst m = RocketChat.models[model];\n\n\t\tif (!m || !_.isFunction(m[method])) {\n\t\t\tthrow new Meteor.Error('error-invalid-method', 'Invalid method', {\n\t\t\t\tmethod: 'robot.modelCall'\n\t\t\t});\n\t\t}\n\t\tconst cursor = RocketChat.models[model][method].apply(RocketChat.models[model], args);\n\t\treturn cursor && cursor.fetch ? cursor.fetch() : cursor;\n\t}\n});\n","/* eslint new-cap: 0 */\n\nMeteor.methods({\n\tsaveSetting(_id, value, editor) {\n\t\tif (Meteor.userId() === null) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing settings is not allowed', {\n\t\t\t\tmethod: 'saveSetting'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'edit-privileged-setting')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing settings is not allowed', {\n\t\t\t\tmethod: 'saveSetting'\n\t\t\t});\n\t\t}\n\n\t\t//Verify the _id passed in is a string.\n\t\tcheck(_id, String);\n\n\t\tconst setting = RocketChat.models.Settings.db.findOneById(_id);\n\n\t\t//Verify the value is what it should be\n\t\tswitch (setting.type) {\n\t\t\tcase 'roomPick':\n\t\t\t\tcheck(value, Match.OneOf([Object], ''));\n\t\t\t\tbreak;\n\t\t\tcase 'boolean':\n\t\t\t\tcheck(value, Boolean);\n\t\t\t\tbreak;\n\t\t\tcase 'int':\n\t\t\t\tcheck(value, Number);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tcheck(value, String);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tRocketChat.settings.updateById(_id, value, editor);\n\t\treturn true;\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tsendInvitationEmail(emails) {\n\t\tcheck(emails, [String]);\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendInvitationEmail'\n\t\t\t});\n\t\t}\n\t\tif (!RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'sendInvitationEmail'\n\t\t\t});\n\t\t}\n\t\tconst rfcMailPattern = /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n\t\tconst validEmails = _.compact(_.map(emails, function(email) {\n\t\t\tif (rfcMailPattern.test(email)) {\n\t\t\t\treturn email;\n\t\t\t}\n\t\t}));\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\t\tlet html;\n\t\tlet subject;\n\t\tconst user = Meteor.user();\n\t\tconst lng = user.language || RocketChat.settings.get('language') || 'en';\n\t\tif (RocketChat.settings.get('Invitation_Customized')) {\n\t\t\tsubject = RocketChat.settings.get('Invitation_Subject');\n\t\t\thtml = RocketChat.settings.get('Invitation_HTML');\n\t\t} else {\n\t\t\tsubject = TAPi18n.__('Invitation_Subject_Default', {\n\t\t\t\tlng\n\t\t\t});\n\t\t\thtml = TAPi18n.__('Invitation_HTML_Default', {\n\t\t\t\tlng\n\t\t\t});\n\t\t}\n\t\tsubject = RocketChat.placeholders.replace(subject);\n\t\tvalidEmails.forEach(email => {\n\t\t\tthis.unblock();\n\t\t\thtml = RocketChat.placeholders.replace(html, {\n\t\t\t\temail\n\t\t\t});\n\t\t\ttry {\n\t\t\t\tEmail.send({\n\t\t\t\t\tto: email,\n\t\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\t\tsubject,\n\t\t\t\t\thtml: header + html + footer\n\t\t\t\t});\n\t\t\t} catch ({message}) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ message }`, {\n\t\t\t\t\tmethod: 'sendInvitationEmail',\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn validEmails;\n\t}\n});\n","import moment from 'moment';\n\nMeteor.methods({\n\tsendMessage(message) {\n\t\tcheck(message, Object);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (message.ts) {\n\t\t\tconst tsDiff = Math.abs(moment(message.ts).diff());\n\t\t\tif (tsDiff > 60000) {\n\t\t\t\tthrow new Meteor.Error('error-message-ts-out-of-sync', 'Message timestamp is out of sync', {\n\t\t\t\t\tmethod: 'sendMessage',\n\t\t\t\t\tmessage_ts: message.ts,\n\t\t\t\t\tserver_ts: new Date().getTime()\n\t\t\t\t});\n\t\t\t} else if (tsDiff > 10000) {\n\t\t\t\tmessage.ts = new Date();\n\t\t\t}\n\t\t} else {\n\t\t\tmessage.ts = new Date();\n\t\t}\n\n\t\tif (message.msg && message.msg.length > RocketChat.settings.get('Message_MaxAllowedSize')) {\n\t\t\tthrow new Meteor.Error('error-message-size-exceeded', 'Message size exceeds Message_MaxAllowedSize', {\n\t\t\t\tmethod: 'sendMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId(), {\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1\n\t\t\t}\n\t\t});\n\n\t\tconst room = Meteor.call('canAccessRoom', message.rid, user._id);\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(message.rid, Meteor.userId());\n\t\tif (subscription && subscription.blocked || subscription.blocker) {\n\t\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: room._id,\n\t\t\t\tts: new Date,\n\t\t\t\tmsg: TAPi18n.__('room_is_blocked', {}, user.language)\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\tif ((room.muted||[]).includes(user.username)) {\n\t\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: room._id,\n\t\t\t\tts: new Date,\n\t\t\t\tmsg: TAPi18n.__('You_have_been_muted', {}, user.language)\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\tif (message.alias == null && RocketChat.settings.get('Message_SetNameToAliasEnabled')) {\n\t\t\tmessage.alias = user.name;\n\t\t}\n\n\t\tif (Meteor.settings['public'].sandstorm) {\n\t\t\tmessage.sandstormSessionId = this.connection.sandstormSessionId();\n\t\t}\n\n\t\tRocketChat.metrics.messagesSent.inc(); // TODO This line needs to be moved to it's proper place. See the comments on: https://github.com/RocketChat/Rocket.Chat/pull/5736\n\t\treturn RocketChat.sendMessage(user, message, room);\n\t}\n});\n// Limit a user, who does not have the \"bot\" role, to sending 5 msgs/second\nRocketChat.RateLimiter.limitMethod('sendMessage', 5, 1000, {\n\tuserId(userId) {\n\t\treturn !RocketChat.authz.hasPermission(userId, 'send-many-messages');\n\t}\n});\n","Meteor.methods({\n\tsendSMTPTestEmail() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendSMTPTestEmail'\n\t\t\t});\n\t\t}\n\t\tconst user = Meteor.user();\n\t\tif (!user.emails && !user.emails[0] && user.emails[0].address) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email', {\n\t\t\t\tmethod: 'sendSMTPTestEmail'\n\t\t\t});\n\t\t}\n\t\tthis.unblock();\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\t\tconsole.log(`Sending test email to ${ user.emails[0].address }`);\n\t\ttry {\n\t\t\tEmail.send({\n\t\t\t\tto: user.emails[0].address,\n\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\tsubject: 'SMTP Test Email',\n\t\t\t\thtml: `${ header }<p>You have successfully sent an email</p>${ footer }`\n\t\t\t});\n\t\t} catch ({message}) {\n\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ message }`, {\n\t\t\t\tmethod: 'sendSMTPTestEmail',\n\t\t\t\tmessage\n\t\t\t});\n\t\t}\n\t\treturn {\n\t\t\tmessage: 'Your_mail_was_sent_to_s',\n\t\t\tparams: [user.emails[0].address]\n\t\t};\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'sendSMTPTestEmail',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 1000);\n","Meteor.methods({\n\tsetAdminStatus(userId, admin) {\n\n\t\tcheck(userId, String);\n\t\tcheck(admin, Match.Optional(Boolean));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setAdminStatus' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'assign-admin-role') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setAdminStatus' });\n\t\t}\n\n\t\tconst user = Meteor.users.findOne({ _id: userId }, { fields: { username: 1 } });\n\n\t\tif (admin) {\n\t\t\treturn Meteor.call('authorization:addUserToRole', 'admin', user.username);\n\t\t} else {\n\t\t\treturn Meteor.call('authorization:removeUserFromRole', 'admin', user.username);\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tsetRealName(name) {\n\n\t\tcheck(name, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setRealName' });\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowRealNameChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setRealName' });\n\t\t}\n\n\t\tif (!RocketChat.setRealName(Meteor.userId(), name)) {\n\t\t\tthrow new Meteor.Error('error-could-not-change-name', 'Could not change name', { method: 'setRealName' });\n\t\t}\n\n\t\treturn name;\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('setRealName', 1, 1000, {\n\tuserId: () => true\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tsetUsername(username, param = {}) {\n\t\tconst { joinDefaultChannelsSilenced } = param;\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setUsername' });\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (user.username && !RocketChat.settings.get('Accounts_AllowUsernameChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setUsername' });\n\t\t}\n\n\t\tif (user.username === username || (user.username && user.username.toLowerCase() === username.toLowerCase())) {\n\t\t\treturn username;\n\t\t}\n\n\t\tlet nameValidation;\n\t\ttry {\n\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t} catch (error) {\n\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t}\n\n\t\tif (!nameValidation.test(username)) {\n\t\t\tthrow new Meteor.Error('username-invalid', `${ _.escape(username) } is not a valid username, use only letters, numbers, dots, hyphens and underscores`);\n\t\t}\n\n\t\tif (!RocketChat.checkUsernameAvailability(username)) {\n\t\t\tthrow new Meteor.Error('error-field-unavailable', `<strong>${ _.escape(username) }</strong> is already in use :(`, { method: 'setUsername', field: username });\n\t\t}\n\n\t\tif (!RocketChat.setUsername(user._id, username)) {\n\t\t\tthrow new Meteor.Error('error-could-not-change-username', 'Could not change username', { method: 'setUsername' });\n\t\t}\n\n\t\tif (!user.username) {\n\t\t\tMeteor.runAsUser(user._id, () => Meteor.call('joinDefaultChannels', joinDefaultChannelsSilenced));\n\t\t\tMeteor.defer(function() {\n\t\t\t\treturn RocketChat.callbacks.run('afterCreateUser', RocketChat.models.Users.findOneById(user._id));\n\t\t\t});\n\t\t}\n\n\t\treturn username;\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('setUsername', 1, 1000, {\n\tuserId() { return true; }\n});\n","Meteor.methods({\n\tsetEmail(email) {\n\n\t\tcheck (email, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setEmail' });\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowEmailChange')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Changing email is not allowed', { method: 'setEmail', action: 'Changing_email' });\n\t\t}\n\n\t\tif (user.emails && user.emails[0] && user.emails[0].address === email) {\n\t\t\treturn email;\n\t\t}\n\n\t\tif (!RocketChat.setEmail(user._id, email)) {\n\t\t\tthrow new Meteor.Error('error-could-not-change-email', 'Could not change email', { method: 'setEmail' });\n\t\t}\n\n\t\treturn email;\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('setEmail', 1, 1000, {\n\tuserId(/*userId*/) { return true; }\n});\n","Meteor.methods({\n\tunarchiveRoom(rid) {\n\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'unarchiveRoom' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'unarchiveRoom' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'unarchive-room', room._id)) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'unarchiveRoom' });\n\t\t}\n\n\t\treturn RocketChat.unarchiveRoom(rid);\n\t}\n});\n","Meteor.methods({\n\tunblockUser({rid, blocked}) {\n\n\t\tcheck(rid, String);\n\t\tcheck(blocked, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'blockUser' });\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tconst subscription2 = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, blocked);\n\n\t\tif (!subscription || !subscription2) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'blockUser' });\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.unsetBlockedByRoomId(rid, blocked, Meteor.userId());\n\n\t\treturn true;\n\t}\n});\n","import moment from 'moment';\n\nMeteor.methods({\n\tupdateMessage(message) {\n\n\t\tcheck(message, Match.ObjectIncluding({_id:String}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'updateMessage' });\n\t\t}\n\n\t\tconst originalMessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!originalMessage || !originalMessage._id) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasPermission = RocketChat.authz.hasPermission(Meteor.userId(), 'edit-message', message.rid);\n\t\tconst editAllowed = RocketChat.settings.get('Message_AllowEditing');\n\t\tconst editOwn = originalMessage.u && originalMessage.u._id === Meteor.userId();\n\n\t\tif (!hasPermission && (!editAllowed || !editOwn)) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Message editing not allowed', { method: 'updateMessage', action: 'Message_editing' });\n\t\t}\n\n\t\tconst blockEditInMinutes = RocketChat.settings.get('Message_AllowEditing_BlockEditInMinutes');\n\t\tif (Match.test(blockEditInMinutes, Number) && blockEditInMinutes !== 0) {\n\t\t\tlet currentTsDiff;\n\t\t\tlet msgTs;\n\n\t\t\tif (Match.test(originalMessage.ts, Number)) {\n\t\t\t\tmsgTs = moment(originalMessage.ts);\n\t\t\t}\n\t\t\tif (msgTs) {\n\t\t\t\tcurrentTsDiff = moment().diff(msgTs, 'minutes');\n\t\t\t}\n\t\t\tif (currentTsDiff > blockEditInMinutes) {\n\t\t\t\tthrow new Meteor.Error('error-message-editing-blocked', 'Message editing is blocked', { method: 'updateMessage' });\n\t\t\t}\n\t\t}\n\n\t\t// It is possible to have an empty array as the attachments property, so ensure both things exist\n\t\tif (originalMessage.attachments && originalMessage.attachments.length > 0 && originalMessage.attachments[0].description !== undefined) {\n\t\t\tmessage.attachments = originalMessage.attachments;\n\t\t\tmessage.attachments[0].description = message.msg;\n\t\t\tmessage.msg = originalMessage.msg;\n\t\t}\n\n\t\tmessage.u = originalMessage.u;\n\n\t\treturn RocketChat.updateMessage(message, Meteor.user());\n\t}\n});\n","import {\n\tConversationRoomType,\n\tDirectMessageRoomType,\n\tFavoriteRoomType,\n\tPrivateRoomType,\n\tPublicRoomType,\n\tUnreadRoomType\n} from '../lib/roomTypes';\n\nRocketChat.roomTypes.add(new UnreadRoomType());\nRocketChat.roomTypes.add(new FavoriteRoomType());\nRocketChat.roomTypes.add(new ConversationRoomType());\nRocketChat.roomTypes.add(new PublicRoomType());\nRocketChat.roomTypes.add(new PrivateRoomType());\nRocketChat.roomTypes.add(new DirectMessageRoomType());\n"]}